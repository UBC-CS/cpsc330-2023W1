

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 10: Regression metrics &#8212; CPSC 330 Applied Machine Learning 2023W1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/10_regression-metrics';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 11: Ensembles" href="11_ensembles.html" />
    <link rel="prev" title="Lecture 9: Classification metrics" href="09_classification-metrics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/UBC-CS-logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/UBC-CS-logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Things you should know</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/README.html">CPSC 330 Documents</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_intro.html">Lecture 1: Course Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_decision-trees.html">Lecture 2: Terminology, Baselines, Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_ml-fundamentals.html">Lecture 3: Machine Learning Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_kNNs-SVM-RBF.html">Lecture 4: <span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours and SVM RBFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_preprocessing-pipelines.html">Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_column-transformer-text-feats.html">Lecture 6: <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and Text Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_linear-models.html">Lecture 7: Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_hyperparameter-optimization.html">Lecture 8: Hyperparameter Optimization and Optimization Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_classification-metrics.html">Lecture 9: Classification metrics</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 10: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_ensembles.html">Lecture 11: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_feat-importances.html">Lecture 12: Feature importances and model transparency</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_feature-engineering-selection.html">Lecture 13: Feature engineering and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_K-Means.html">Lecture 14: K-Means Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_DBSCAN-hierarchical.html">Lecture 15: More Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_recommender-systems.html">Lecture 16: Recommender Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="17_natural-language-processing.html">Lecture 17: Introduction to natural language processing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="class_demos/03_class-demo.html">Lecture 3: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/04_class-demo.html">Lecture 4: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/05-06_class-demo.html">Lectures 5 and 6: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/07_class-demo.html">Lectures 7: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/09_class-demo.html">Exploring classification metrics</a></li>

<li class="toctree-l1"><a class="reference internal" href="class_demos/14_class-demo.html">Lecture 14: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/15_class-demo.html">Lecture 15: Class demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Appendix-A.html">Appendix A</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-B.html">Appendix-B</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">Attributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSE.html">LICENSE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/10_regression-metrics.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 10: Regression metrics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-comments-on-tackling-class-imbalance">More comments on tackling class imbalance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-video">Dataset [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pandas-profiler"><code class="docutils literal notranslate"><span class="pre">pandas_profiler</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-types">Feature types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Feature types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-feature-transformations">Applying feature transformations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-preprocessed-data">Examining the preprocessed data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-possible-preprocessing">Other possible preprocessing?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-building">Model building</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummyregressor"><code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-a-linear-model-ridge">Let’s try a linear model: <code class="docutils literal notranslate"><span class="pre">Ridge</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-names-of-transformed-data">Feature names of transformed data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-alpha-hyperparameter-of-ridge">Tuning <code class="docutils literal notranslate"><span class="pre">alpha</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">Ridge</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridgecv"><code class="docutils literal notranslate"><span class="pre">RidgeCV</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-10-1">iClicker Exercise 10.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-scoring-functions">Regression scoring functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-squared-error-mse">Mean squared error (MSE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#root-mean-squared-error-or-rmse">Root mean squared error or RMSE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#r-2-not-in-detail"><span class="math notranslate nohighlight">\(R^2\)</span> (not in detail)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mape">MAPE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transforming-the-targets">Transforming the targets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#different-scoring-functions-with-cross-validate">Different scoring functions with <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-multiple-metrics-in-gridsearchcv-or-randomizedsearchcv">Using multiple metrics in <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> or <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-regression-metrics-with-scikit-learn">Using regression metrics with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-10-2">iClicker Exercise 10.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-learn-today">What did we learn today?</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="../_images/330-banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-10-regression-metrics">
<h1>Lecture 10: Regression metrics<a class="headerlink" href="#lecture-10-regression-metrics" title="Permalink to this heading">#</a></h1>
<p>UBC, 2023-24</p>
<p>Instructor: Varada Kolhatkar and Andrew Roth</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ColumnTransformer</span><span class="p">,</span>
    <span class="n">TransformedTargetRegressor</span><span class="p">,</span>
    <span class="n">make_column_transformer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">RidgeCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GridSearchCV</span><span class="p">,</span>
    <span class="n">cross_val_score</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="announcements">
<h3>Announcements<a class="headerlink" href="#announcements" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>HW4 is due tonight.</p></li>
<li><p>HW5 will be posted today. It is a project-type homework assignment and will be due after the midterm.</p></li>
<li><p>Midterm: Thursday, October 26th, 2023 at 6:00pm (~75 mins long)</p>
<ul>
<li><p>Checkout the midterm information announcement on Piazza (&#64;407)</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="learning-outcomes">
<h2>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h2>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Carry out feature transformations on somewhat complicated dataset.</p></li>
<li><p>Visualize transformed features as a dataframe.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> and <code class="docutils literal notranslate"><span class="pre">RidgeCV</span></code>.</p></li>
<li><p>Explain how <code class="docutils literal notranslate"><span class="pre">alpha</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> relates to the fundamental tradeoff.</p></li>
<li><p>Explain the effect of <code class="docutils literal notranslate"><span class="pre">alpha</span></code> on the magnitude of the learned coefficients.</p></li>
<li><p>Examine coefficients of transformed features.</p></li>
<li><p>Appropriately select a scoring metric given a regression problem.</p></li>
<li><p>Interpret and communicate the meanings of different scoring metrics on regression problems.</p>
<ul>
<li><p>MSE, RMSE, <span class="math notranslate nohighlight">\(R^2\)</span>, MAPE</p></li>
</ul>
</li>
<li><p>Apply log-transform on the target values in a regression problem with <code class="docutils literal notranslate"><span class="pre">TransformedTargetRegressor</span></code>.</p></li>
</ul>
<p>After carrying out preprocessing, why it’s useful to get feature names for transformed features?</p>
<section id="more-comments-on-tackling-class-imbalance">
<h3>More comments on tackling class imbalance<a class="headerlink" href="#more-comments-on-tackling-class-imbalance" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In lecture 9 we talked about a few rather simple approaches to deal with class imbalance.</p></li>
<li><p>If you have a problem such as fraud detection problem where you want to spot rare events, you can also think of this problem as anomaly detection problem and use different kinds of algorithms such as <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html">isolation forests</a>.</p></li>
<li><p>If you are interested in this area, it might be worth checking out this book on this topic.
<a class="reference external" href="https://www.amazon.com/dp/1118074629/ref=as_li_ss_tl?&amp;linkCode=sl1&amp;tag=inspiredalgor-20&amp;linkId=615e87a9105582e292ad2b7e2c7ea339&amp;language=en_US">Imbalanced Learning: Foundations, Algorithms, and Applications</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you calculate precision, recall, f1 score, by default only the positive label is evaluated, assuming by default that the positive class is labeled 1. This is configurable through the <code class="docutils literal notranslate"><span class="pre">pos_label</span></code> parameter.</p>
</div>
</section>
</section>
<section id="dataset-video">
<h2>Dataset [<a class="reference external" href="https://youtu.be/lgGTKLwNgkQ">video</a>]<a class="headerlink" href="#dataset-video" title="Permalink to this heading">#</a></h2>
<p>In this lecture, we’ll be using <a class="reference external" href="https://www.kaggle.com/c/home-data-for-ml-course/">Kaggle House Prices dataset</a>. As usual, to run this notebook you’ll need to download the data. For this dataset, train and test have already been separated. We’ll be working with the train portion in this lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing-kaggle/train.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing-kaggle/train.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/pandas/io/parsers/readers.py:912,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">900</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">910</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">912</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/pandas/io/parsers/readers.py:577,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">577</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">580</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/pandas/io/parsers/readers.py:1407,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1404</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1406</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1407</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/pandas/io/parsers/readers.py:1661,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1659</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1660</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1661</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1662</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1663</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1664</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1665</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1666</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1667</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1668</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1669</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1670</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1671</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1672</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/pandas/io/common.py:859,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">854</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">855</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">856</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">857</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">859</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/housing-kaggle/train.csv&#39;
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The supervised machine learning problem is predicting housing price given features associated with properties.</p></li>
<li><p>Here, the target is <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code>, which is continuous. So it’s a <strong>regression problem</strong> (as opposed to classification).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 81)
</pre></div>
</div>
</div>
</div>
<section id="let-s-separate-x-and-y">
<h3>Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code><a class="headerlink" href="#let-s-separate-x-and-y" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="eda">
<h3>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>WoodDeckSF</th>
      <th>OpenPorchSF</th>
      <th>EnclosedPorch</th>
      <th>3SsnPorch</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1089.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1307.000000</td>
      <td>1314.000000</td>
      <td>...</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
      <td>1314.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>734.182648</td>
      <td>56.472603</td>
      <td>69.641873</td>
      <td>10273.261035</td>
      <td>6.076104</td>
      <td>5.570015</td>
      <td>1970.995434</td>
      <td>1984.659056</td>
      <td>102.514155</td>
      <td>441.425419</td>
      <td>...</td>
      <td>94.281583</td>
      <td>45.765601</td>
      <td>21.726788</td>
      <td>3.624049</td>
      <td>13.987062</td>
      <td>3.065449</td>
      <td>46.951294</td>
      <td>6.302131</td>
      <td>2007.840183</td>
      <td>179802.147641</td>
    </tr>
    <tr>
      <th>std</th>
      <td>422.224662</td>
      <td>42.036646</td>
      <td>23.031794</td>
      <td>8997.895541</td>
      <td>1.392612</td>
      <td>1.112848</td>
      <td>30.198127</td>
      <td>20.639754</td>
      <td>178.301563</td>
      <td>459.276687</td>
      <td>...</td>
      <td>125.436492</td>
      <td>65.757545</td>
      <td>60.766423</td>
      <td>30.320430</td>
      <td>53.854129</td>
      <td>42.341109</td>
      <td>522.283421</td>
      <td>2.698206</td>
      <td>1.332824</td>
      <td>79041.260572</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>20.000000</td>
      <td>21.000000</td>
      <td>1300.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1872.000000</td>
      <td>1950.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2006.000000</td>
      <td>34900.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>369.250000</td>
      <td>20.000000</td>
      <td>59.000000</td>
      <td>7500.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>1953.000000</td>
      <td>1966.250000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.000000</td>
      <td>2007.000000</td>
      <td>129600.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>735.500000</td>
      <td>50.000000</td>
      <td>69.000000</td>
      <td>9391.000000</td>
      <td>6.000000</td>
      <td>5.000000</td>
      <td>1972.000000</td>
      <td>1993.000000</td>
      <td>0.000000</td>
      <td>376.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>24.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.000000</td>
      <td>2008.000000</td>
      <td>162000.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1099.750000</td>
      <td>70.000000</td>
      <td>80.000000</td>
      <td>11509.000000</td>
      <td>7.000000</td>
      <td>6.000000</td>
      <td>2000.000000</td>
      <td>2004.000000</td>
      <td>165.500000</td>
      <td>704.750000</td>
      <td>...</td>
      <td>168.000000</td>
      <td>66.750000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>8.000000</td>
      <td>2009.000000</td>
      <td>212975.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1460.000000</td>
      <td>190.000000</td>
      <td>313.000000</td>
      <td>215245.000000</td>
      <td>10.000000</td>
      <td>9.000000</td>
      <td>2010.000000</td>
      <td>2010.000000</td>
      <td>1378.000000</td>
      <td>5644.000000</td>
      <td>...</td>
      <td>857.000000</td>
      <td>547.000000</td>
      <td>552.000000</td>
      <td>508.000000</td>
      <td>480.000000</td>
      <td>738.000000</td>
      <td>15500.000000</td>
      <td>12.000000</td>
      <td>2010.000000</td>
      <td>755000.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 38 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 1314 entries, 302 to 1389
Data columns (total 81 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   Id             1314 non-null   int64  
 1   MSSubClass     1314 non-null   int64  
 2   MSZoning       1314 non-null   object 
 3   LotFrontage    1089 non-null   float64
 4   LotArea        1314 non-null   int64  
 5   Street         1314 non-null   object 
 6   Alley          81 non-null     object 
 7   LotShape       1314 non-null   object 
 8   LandContour    1314 non-null   object 
 9   Utilities      1314 non-null   object 
 10  LotConfig      1314 non-null   object 
 11  LandSlope      1314 non-null   object 
 12  Neighborhood   1314 non-null   object 
 13  Condition1     1314 non-null   object 
 14  Condition2     1314 non-null   object 
 15  BldgType       1314 non-null   object 
 16  HouseStyle     1314 non-null   object 
 17  OverallQual    1314 non-null   int64  
 18  OverallCond    1314 non-null   int64  
 19  YearBuilt      1314 non-null   int64  
 20  YearRemodAdd   1314 non-null   int64  
 21  RoofStyle      1314 non-null   object 
 22  RoofMatl       1314 non-null   object 
 23  Exterior1st    1314 non-null   object 
 24  Exterior2nd    1314 non-null   object 
 25  MasVnrType     528 non-null    object 
 26  MasVnrArea     1307 non-null   float64
 27  ExterQual      1314 non-null   object 
 28  ExterCond      1314 non-null   object 
 29  Foundation     1314 non-null   object 
 30  BsmtQual       1280 non-null   object 
 31  BsmtCond       1280 non-null   object 
 32  BsmtExposure   1279 non-null   object 
 33  BsmtFinType1   1280 non-null   object 
 34  BsmtFinSF1     1314 non-null   int64  
 35  BsmtFinType2   1280 non-null   object 
 36  BsmtFinSF2     1314 non-null   int64  
 37  BsmtUnfSF      1314 non-null   int64  
 38  TotalBsmtSF    1314 non-null   int64  
 39  Heating        1314 non-null   object 
 40  HeatingQC      1314 non-null   object 
 41  CentralAir     1314 non-null   object 
 42  Electrical     1313 non-null   object 
 43  1stFlrSF       1314 non-null   int64  
 44  2ndFlrSF       1314 non-null   int64  
 45  LowQualFinSF   1314 non-null   int64  
 46  GrLivArea      1314 non-null   int64  
 47  BsmtFullBath   1314 non-null   int64  
 48  BsmtHalfBath   1314 non-null   int64  
 49  FullBath       1314 non-null   int64  
 50  HalfBath       1314 non-null   int64  
 51  BedroomAbvGr   1314 non-null   int64  
 52  KitchenAbvGr   1314 non-null   int64  
 53  KitchenQual    1314 non-null   object 
 54  TotRmsAbvGrd   1314 non-null   int64  
 55  Functional     1314 non-null   object 
 56  Fireplaces     1314 non-null   int64  
 57  FireplaceQu    687 non-null    object 
 58  GarageType     1241 non-null   object 
 59  GarageYrBlt    1241 non-null   float64
 60  GarageFinish   1241 non-null   object 
 61  GarageCars     1314 non-null   int64  
 62  GarageArea     1314 non-null   int64  
 63  GarageQual     1241 non-null   object 
 64  GarageCond     1241 non-null   object 
 65  PavedDrive     1314 non-null   object 
 66  WoodDeckSF     1314 non-null   int64  
 67  OpenPorchSF    1314 non-null   int64  
 68  EnclosedPorch  1314 non-null   int64  
 69  3SsnPorch      1314 non-null   int64  
 70  ScreenPorch    1314 non-null   int64  
 71  PoolArea       1314 non-null   int64  
 72  PoolQC         7 non-null      object 
 73  Fence          259 non-null    object 
 74  MiscFeature    50 non-null     object 
 75  MiscVal        1314 non-null   int64  
 76  MoSold         1314 non-null   int64  
 77  YrSold         1314 non-null   int64  
 78  SaleType       1314 non-null   object 
 79  SaleCondition  1314 non-null   object 
 80  SalePrice      1314 non-null   int64  
dtypes: float64(3), int64(35), object(43)
memory usage: 841.8+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="pandas-profiler">
<h3><code class="docutils literal notranslate"><span class="pre">pandas_profiler</span></code><a class="headerlink" href="#pandas-profiler" title="Permalink to this heading">#</a></h3>
<p>We do not have <code class="docutils literal notranslate"><span class="pre">pandas_profiling</span></code> in our course environment. You will  have to install it in the environment on your own if you want to run the code below.</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">pandas-profiling</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from pandas_profiling import ProfileReport</span>

<span class="c1"># profile = ProfileReport(train_df, title=&quot;Pandas Profiling Report&quot;)  # , minimal=True)</span>
<span class="c1"># profile.to_notebook_iframe()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-types">
<h3>Feature types<a class="headerlink" href="#feature-types" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Do not blindly trust all the info given to you by automated tools.</p></li>
<li><p>How does pandas profiling figure out the data type?</p>
<ul>
<li><p>You can look at the Python data type and say floats are numeric, strings are categorical.</p></li>
<li><p>However, in doing so you would miss out on various subtleties such as some of the string features being ordinal rather than truly categorical.</p></li>
<li><p>Also, it will think free text is categorical.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>In addition to tools such as above, it’s important to go through data description to understand the data.</p></li>
<li><p>The data description for our dataset is available <a class="reference external" href="https://www.kaggle.com/c/home-data-for-ml-course/data?select=data_description.txt">here</a>.</p></li>
</ul>
</section>
<section id="id1">
<h3>Feature types<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We have mixed feature types and a bunch of missing values.</p></li>
<li><p>Now, let’s identify feature types and transformations.</p></li>
</ul>
<ul class="simple">
<li><p>Let’s get the numeric-looking columns.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_looking_columns</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">numeric_looking_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Id&#39;, &#39;MSSubClass&#39;, &#39;LotFrontage&#39;, &#39;LotArea&#39;, &#39;OverallQual&#39;, &#39;OverallCond&#39;, &#39;YearBuilt&#39;, &#39;YearRemodAdd&#39;, &#39;MasVnrArea&#39;, &#39;BsmtFinSF1&#39;, &#39;BsmtFinSF2&#39;, &#39;BsmtUnfSF&#39;, &#39;TotalBsmtSF&#39;, &#39;1stFlrSF&#39;, &#39;2ndFlrSF&#39;, &#39;LowQualFinSF&#39;, &#39;GrLivArea&#39;, &#39;BsmtFullBath&#39;, &#39;BsmtHalfBath&#39;, &#39;FullBath&#39;, &#39;HalfBath&#39;, &#39;BedroomAbvGr&#39;, &#39;KitchenAbvGr&#39;, &#39;TotRmsAbvGrd&#39;, &#39;Fireplaces&#39;, &#39;GarageYrBlt&#39;, &#39;GarageCars&#39;, &#39;GarageArea&#39;, &#39;WoodDeckSF&#39;, &#39;OpenPorchSF&#39;, &#39;EnclosedPorch&#39;, &#39;3SsnPorch&#39;, &#39;ScreenPorch&#39;, &#39;PoolArea&#39;, &#39;MiscVal&#39;, &#39;MoSold&#39;, &#39;YrSold&#39;]
</pre></div>
</div>
</div>
</div>
<p>Not all numeric looking columns are necessarily numeric.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;MSSubClass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 20,  50,  30,  60, 160,  85,  90, 120, 180,  80,  70,  75, 190,
        45,  40])
</pre></div>
</div>
</div>
</div>
<p>MSSubClass: Identifies the type of dwelling involved in the sale.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    20	1-STORY 1946 &amp; NEWER ALL STYLES
    30	1-STORY 1945 &amp; OLDER
    40	1-STORY W/FINISHED ATTIC ALL AGES
    45	1-1/2 STORY - UNFINISHED ALL AGES
    50	1-1/2 STORY FINISHED ALL AGES
    60	2-STORY 1946 &amp; NEWER
    70	2-STORY 1945 &amp; OLDER
    75	2-1/2 STORY ALL AGES
    80	SPLIT OR MULTI-LEVEL
    85	SPLIT FOYER
    90	DUPLEX - ALL STYLES AND AGES
   120	1-STORY PUD (Planned Unit Development) - 1946 &amp; NEWER
   150	1-1/2 STORY PUD - ALL AGES
   160	2-STORY PUD - 1946 &amp; NEWER
   180	PUD - MULTILEVEL - INCL SPLIT LEV/FOYER
   190	2 FAMILY CONVERSION - ALL STYLES AND AGES
</pre></div>
</div>
<p>Also, month sold is more of a categorical feature than a numeric feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;MoSold&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># Month Sold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1,  7,  3,  5,  8, 10,  6,  9, 12,  2,  4, 11])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drop_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;BedroomAbvGr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LotFrontage&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LotArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OverallQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OverallCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YearBuilt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YearRemodAdd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MasVnrArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinSF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinSF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1stFlrSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LowQualFinSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GrLivArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FullBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HalfBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TotRmsAbvGrd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fireplaces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageYrBlt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageCars&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WoodDeckSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3SsnPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ScreenPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PoolArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MiscVal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YrSold&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I’ve not looked at all the features carefully. It might be appropriate to apply some other encoding on some of the numeric features above.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">numeric_looking_columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">numeric_features</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">drop_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;MSSubClass&#39;, &#39;MoSold&#39;}
</pre></div>
</div>
</div>
</div>
<p>We’ll treat the above numeric-looking features as categorical features.</p>
<ul class="simple">
<li><p>There are a bunch of ordinal features in this dataset.</p></li>
<li><p>Ordinal features with the same scale</p>
<ul>
<li><p>Poor (Po), Fair (Fa), Typical (TA), Good (Gd), Excellent (Ex)</p></li>
<li><p>These we’ll be calling <code class="docutils literal notranslate"><span class="pre">ordinal_features_reg</span></code>.</p></li>
</ul>
</li>
<li><p>Ordinal features with different scales</p>
<ul>
<li><p>These we’ll be calling <code class="docutils literal notranslate"><span class="pre">ordinal_features_oth</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ordinal_features_reg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ExterQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ExterCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HeatingQC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KitchenQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FireplaceQu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PoolQC&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Po&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fa&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ex&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># if N/A it will just impute something, per below</span>
<span class="n">ordering_ordinal_reg</span> <span class="o">=</span> <span class="p">[</span><span class="n">ordering</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
<span class="n">ordering_ordinal_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;]]
</pre></div>
</div>
</div>
</div>
<p>We’ll pass the above as categories in our <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code>.</p>
<ul class="simple">
<li><p>There are a bunch more ordinal features using different scales.</p>
<ul>
<li><p>These we’ll be calling <code class="docutils literal notranslate"><span class="pre">ordinal_features_oth</span></code>.</p></li>
<li><p>We are encoding them separately.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ordinal_features_oth</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;BsmtExposure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinType1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinType2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Functional&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fence&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ordering_ordinal_oth</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="s2">&quot;Mn&quot;</span><span class="p">,</span> <span class="s2">&quot;Av&quot;</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span><span class="p">,</span> <span class="s2">&quot;ALQ&quot;</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span><span class="p">,</span> <span class="s2">&quot;ALQ&quot;</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Sal&quot;</span><span class="p">,</span> <span class="s2">&quot;Sev&quot;</span><span class="p">,</span> <span class="s2">&quot;Maj2&quot;</span><span class="p">,</span> <span class="s2">&quot;Maj1&quot;</span><span class="p">,</span> <span class="s2">&quot;Mod&quot;</span><span class="p">,</span> <span class="s2">&quot;Min2&quot;</span><span class="p">,</span> <span class="s2">&quot;Min1&quot;</span><span class="p">,</span> <span class="s2">&quot;Typ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;MnWw&quot;</span><span class="p">,</span> <span class="s2">&quot;GdWo&quot;</span><span class="p">,</span> <span class="s2">&quot;MnPrv&quot;</span><span class="p">,</span> <span class="s2">&quot;GdPrv&quot;</span><span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The remaining features are categorical features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="nb">set</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">numeric_features</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordinal_features_oth</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">drop_features</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">categorical_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LotShape&#39;,
 &#39;GarageFinish&#39;,
 &#39;SaleCondition&#39;,
 &#39;PavedDrive&#39;,
 &#39;HouseStyle&#39;,
 &#39;BldgType&#39;,
 &#39;CentralAir&#39;,
 &#39;MiscFeature&#39;,
 &#39;Utilities&#39;,
 &#39;MSSubClass&#39;,
 &#39;GarageType&#39;,
 &#39;Street&#39;,
 &#39;Alley&#39;,
 &#39;MSZoning&#39;,
 &#39;LotConfig&#39;,
 &#39;LandSlope&#39;,
 &#39;Condition2&#39;,
 &#39;Neighborhood&#39;,
 &#39;RoofMatl&#39;,
 &#39;Condition1&#39;,
 &#39;LandContour&#39;,
 &#39;MoSold&#39;,
 &#39;RoofStyle&#39;,
 &#39;Exterior1st&#39;,
 &#39;Exterior2nd&#39;,
 &#39;Heating&#39;,
 &#39;Foundation&#39;,
 &#39;MasVnrType&#39;,
 &#39;SaleType&#39;,
 &#39;Electrical&#39;]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We are not doing it here but we can engineer our own features too.</p></li>
<li><p>Would price per square foot be a good feature to add in here?</p></li>
</ul>
</section>
<section id="applying-feature-transformations">
<h3>Applying feature transformations<a class="headerlink" href="#applying-feature-transformations" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Since we have mixed feature types, let’s use <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> to apply different transformations on different features types.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="n">ordinal_transformer_reg</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span>
    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ordering_ordinal_reg</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">ordinal_transformer_oth</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span>
    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ordering_ordinal_oth</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer_reg</span><span class="p">,</span> <span class="n">ordinal_features_reg</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer_oth</span><span class="p">,</span> <span class="n">ordinal_features_oth</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examining-the-preprocessed-data">
<h3>Examining the preprocessed data<a class="headerlink" href="#examining-the-preprocessed-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># Calling fit to examine all the transformers.</span>
<span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;drop&#39;: &#39;drop&#39;,
 &#39;pipeline-1&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;median&#39;)),
                 (&#39;standardscaler&#39;, StandardScaler())]),
 &#39;pipeline-2&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;most_frequent&#39;)),
                 (&#39;ordinalencoder&#39;,
                  OrdinalEncoder(categories=[[&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;]]))]),
 &#39;pipeline-3&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;most_frequent&#39;)),
                 (&#39;ordinalencoder&#39;,
                  OrdinalEncoder(categories=[[&#39;NA&#39;, &#39;No&#39;, &#39;Mn&#39;, &#39;Av&#39;, &#39;Gd&#39;],
                                             [&#39;NA&#39;, &#39;Unf&#39;, &#39;LwQ&#39;, &#39;Rec&#39;, &#39;BLQ&#39;,
                                              &#39;ALQ&#39;, &#39;GLQ&#39;],
                                             [&#39;NA&#39;, &#39;Unf&#39;, &#39;LwQ&#39;, &#39;Rec&#39;, &#39;BLQ&#39;,
                                              &#39;ALQ&#39;, &#39;GLQ&#39;],
                                             [&#39;Sal&#39;, &#39;Sev&#39;, &#39;Maj2&#39;, &#39;Maj1&#39;,
                                              &#39;Mod&#39;, &#39;Min2&#39;, &#39;Min1&#39;, &#39;Typ&#39;],
                                             [&#39;NA&#39;, &#39;MnWw&#39;, &#39;GdWo&#39;, &#39;MnPrv&#39;,
                                              &#39;GdPrv&#39;]]))]),
 &#39;pipeline-4&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;,
                  SimpleImputer(fill_value=&#39;missing&#39;, strategy=&#39;constant&#39;)),
                 (&#39;onehotencoder&#39;,
                  OneHotEncoder(handle_unknown=&#39;ignore&#39;, sparse_output=False))])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-4&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_features</span> <span class="o">+</span> <span class="n">ordinal_features_reg</span> <span class="o">+</span> <span class="n">ordinal_features_oth</span> <span class="o">+</span> <span class="n">ohe_columns</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span>
<span class="p">)</span>
<span class="n">X_train_enc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>SaleType_ConLw</th>
      <th>SaleType_New</th>
      <th>SaleType_Oth</th>
      <th>SaleType_WD</th>
      <th>Electrical_FuseA</th>
      <th>Electrical_FuseF</th>
      <th>Electrical_FuseP</th>
      <th>Electrical_Mix</th>
      <th>Electrical_SBrkr</th>
      <th>Electrical_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>2.312501</td>
      <td>0.381428</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.840492</td>
      <td>0.269972</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>767</th>
      <td>1.372763</td>
      <td>-0.222647</td>
      <td>0.260890</td>
      <td>0.248457</td>
      <td>-0.054669</td>
      <td>1.285467</td>
      <td>-1.026793</td>
      <td>0.016525</td>
      <td>-0.573129</td>
      <td>0.476092</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>429</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>2.885044</td>
      <td>0.131607</td>
      <td>-0.054669</td>
      <td>-0.512408</td>
      <td>0.563314</td>
      <td>0.161931</td>
      <td>-0.573129</td>
      <td>1.227559</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>1.358264</td>
      <td>-0.171468</td>
      <td>-0.773017</td>
      <td>-0.512408</td>
      <td>-1.689338</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>0.443419</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>558</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.597924</td>
      <td>1.289541</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.828332</td>
      <td>0.598149</td>
      <td>-0.573129</td>
      <td>0.354114</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 262 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 80)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 262)
</pre></div>
</div>
</div>
</div>
<p>We went from 80 features to 263 features!!</p>
</section>
<section id="other-possible-preprocessing">
<h3>Other possible preprocessing?<a class="headerlink" href="#other-possible-preprocessing" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>There is a lot of room for improvement …</p></li>
<li><p>We’re just using <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code>.</p>
<ul>
<li><p>In reality we’d want to go through this more carefully.</p></li>
<li><p>We may also want to drop some columns that are almost entirely missing.</p></li>
</ul>
</li>
<li><p>We could also check for outliers, and do other exploratory data analysis (EDA).</p></li>
<li><p>But for now this is good enough …</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="model-building">
<h2>Model building<a class="headerlink" href="#model-building" title="Permalink to this heading">#</a></h2>
<section id="dummyregressor">
<h3><code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code><a class="headerlink" href="#dummyregressor" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.001178</td>
      <td>0.000296</td>
      <td>-0.003547</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000589</td>
      <td>0.000204</td>
      <td>-0.001266</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000532</td>
      <td>0.000197</td>
      <td>-0.011767</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000585</td>
      <td>0.000215</td>
      <td>-0.006744</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000525</td>
      <td>0.000189</td>
      <td>-0.076533</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000524</td>
      <td>0.000205</td>
      <td>-0.003133</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.000518</td>
      <td>0.000187</td>
      <td>-0.000397</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.000548</td>
      <td>0.000187</td>
      <td>-0.003785</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.000515</td>
      <td>0.000186</td>
      <td>-0.001740</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.000517</td>
      <td>0.000188</td>
      <td>-0.000117</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="let-s-try-a-linear-model-ridge">
<h3>Let’s try a linear model: <code class="docutils literal notranslate"><span class="pre">Ridge</span></code><a class="headerlink" href="#let-s-try-a-linear-model-ridge" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Recall that we are going to use <code class="docutils literal notranslate"><span class="pre">Ridge()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">LinearRegression()</span></code> in this course.</p></li>
<li><p>Similar to linear regression, ridge regression is also a linear model for regression.</p></li>
<li><p>So the formula it uses to make predictions is the same one used for ordinary least squares.</p></li>
<li><p>But it has a hyperparameter <code class="docutils literal notranslate"><span class="pre">alpha</span></code> which controls the fundamental tradeoff.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_preds</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">lr_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([224865.34161762,  65243.29045704, 133337.46729488, 250900.65424895,
       128984.32127053, 205597.8361313 , 334576.71199006, 158982.72345029,
       148343.09009799, 129257.94933723])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_preds</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">lr_preds</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(411412.6718650304, 38853.27502379066)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Smallest coefficient: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Largest coefficient:&quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Smallest coefficient:  -191169.0717446893
Largest coefficient: 83603.0131199604
</pre></div>
</div>
</div>
</div>
<p>Let’s carry out cross-validation with <code class="docutils literal notranslate"><span class="pre">Ridge</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">lr_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.028890</td>
      <td>0.005978</td>
      <td>0.862432</td>
      <td>0.911846</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.027618</td>
      <td>0.005765</td>
      <td>0.812363</td>
      <td>0.913849</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.025527</td>
      <td>0.006600</td>
      <td>0.775270</td>
      <td>0.915952</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.025537</td>
      <td>0.005596</td>
      <td>0.874532</td>
      <td>0.910843</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.026065</td>
      <td>0.005624</td>
      <td>0.852104</td>
      <td>0.911615</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.024473</td>
      <td>0.005501</td>
      <td>0.826142</td>
      <td>0.910174</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.025475</td>
      <td>0.005876</td>
      <td>0.825697</td>
      <td>0.913767</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.025521</td>
      <td>0.005527</td>
      <td>0.873704</td>
      <td>0.910018</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.024918</td>
      <td>0.005524</td>
      <td>0.196599</td>
      <td>0.921438</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.026598</td>
      <td>0.005554</td>
      <td>0.890457</td>
      <td>0.908215</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Quite a bit of variation in the test scores.</p></li>
<li><p>Performing poorly in fold 8. Not sure why.</p>
<ul>
<li><p>Probably it contains the outliers in the data which we kind of ignored.</p></li>
</ul>
</li>
</ul>
</section>
<section id="feature-names-of-transformed-data">
<h3>Feature names of transformed data<a class="headerlink" href="#feature-names-of-transformed-data" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>If you want to get the column names of newly created columns, you need to fit the transformer.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                (&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;,
                                  &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                  &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;,
                                  &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;,
                                  &#x27;TotalBsmtSF&#x27;, &#x27;...
                                 [&#x27;LotShape&#x27;, &#x27;GarageFinish&#x27;, &#x27;SaleCondition&#x27;,
                                  &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;, &#x27;BldgType&#x27;,
                                  &#x27;CentralAir&#x27;, &#x27;MiscFeature&#x27;, &#x27;Utilities&#x27;,
                                  &#x27;MSSubClass&#x27;, &#x27;GarageType&#x27;, &#x27;Street&#x27;, &#x27;Alley&#x27;,
                                  &#x27;MSZoning&#x27;, &#x27;LotConfig&#x27;, &#x27;LandSlope&#x27;,
                                  &#x27;Condition2&#x27;, &#x27;Neighborhood&#x27;, &#x27;RoofMatl&#x27;,
                                  &#x27;Condition1&#x27;, &#x27;LandContour&#x27;, &#x27;MoSold&#x27;,
                                  &#x27;RoofStyle&#x27;, &#x27;Exterior1st&#x27;, &#x27;Exterior2nd&#x27;,
                                  &#x27;Heating&#x27;, &#x27;Foundation&#x27;, &#x27;MasVnrType&#x27;,
                                  &#x27;SaleType&#x27;, &#x27;Electrical&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                (&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;,
                                  &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                  &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;,
                                  &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;,
                                  &#x27;TotalBsmtSF&#x27;, &#x27;...
                                 [&#x27;LotShape&#x27;, &#x27;GarageFinish&#x27;, &#x27;SaleCondition&#x27;,
                                  &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;, &#x27;BldgType&#x27;,
                                  &#x27;CentralAir&#x27;, &#x27;MiscFeature&#x27;, &#x27;Utilities&#x27;,
                                  &#x27;MSSubClass&#x27;, &#x27;GarageType&#x27;, &#x27;Street&#x27;, &#x27;Alley&#x27;,
                                  &#x27;MSZoning&#x27;, &#x27;LotConfig&#x27;, &#x27;LandSlope&#x27;,
                                  &#x27;Condition2&#x27;, &#x27;Neighborhood&#x27;, &#x27;RoofMatl&#x27;,
                                  &#x27;Condition1&#x27;, &#x27;LandContour&#x27;, &#x27;MoSold&#x27;,
                                  &#x27;RoofStyle&#x27;, &#x27;Exterior1st&#x27;, &#x27;Exterior2nd&#x27;,
                                  &#x27;Heating&#x27;, &#x27;Foundation&#x27;, &#x27;MasVnrType&#x27;,
                                  &#x27;SaleType&#x27;, &#x27;Electrical&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;Id&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;, &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;, &#x27;TotalBsmtSF&#x27;, &#x27;1stFlrSF&#x27;, &#x27;2ndFlrSF&#x27;, &#x27;LowQualFinSF&#x27;, &#x27;GrLivArea&#x27;, &#x27;BsmtFullBath&#x27;, &#x27;BsmtHalfBath&#x27;, &#x27;FullBath&#x27;, &#x27;HalfBath&#x27;, &#x27;TotRmsAbvGrd&#x27;, &#x27;Fireplaces&#x27;, &#x27;GarageYrBlt&#x27;, &#x27;GarageCars&#x27;, &#x27;GarageArea&#x27;, &#x27;WoodDeckSF&#x27;, &#x27;OpenPorchSF&#x27;, &#x27;EnclosedPorch&#x27;, &#x27;3SsnPorch&#x27;, &#x27;ScreenPorch&#x27;, &#x27;PoolArea&#x27;, &#x27;MiscVal&#x27;, &#x27;YrSold&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;ExterQual&#x27;, &#x27;ExterCond&#x27;, &#x27;BsmtQual&#x27;, &#x27;BsmtCond&#x27;, &#x27;HeatingQC&#x27;, &#x27;KitchenQual&#x27;, &#x27;FireplaceQu&#x27;, &#x27;GarageQual&#x27;, &#x27;GarageCond&#x27;, &#x27;PoolQC&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-3</label><div class="sk-toggleable__content"><pre>[&#x27;BsmtExposure&#x27;, &#x27;BsmtFinType1&#x27;, &#x27;BsmtFinType2&#x27;, &#x27;Functional&#x27;, &#x27;Fence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;NA&#x27;, &#x27;No&#x27;, &#x27;Mn&#x27;, &#x27;Av&#x27;, &#x27;Gd&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;Sal&#x27;, &#x27;Sev&#x27;, &#x27;Maj2&#x27;, &#x27;Maj1&#x27;, &#x27;Mod&#x27;, &#x27;Min2&#x27;, &#x27;Min1&#x27;,
                            &#x27;Typ&#x27;],
                           [&#x27;NA&#x27;, &#x27;MnWw&#x27;, &#x27;GdWo&#x27;, &#x27;MnPrv&#x27;, &#x27;GdPrv&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-4</label><div class="sk-toggleable__content"><pre>[&#x27;LotShape&#x27;, &#x27;GarageFinish&#x27;, &#x27;SaleCondition&#x27;, &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;, &#x27;BldgType&#x27;, &#x27;CentralAir&#x27;, &#x27;MiscFeature&#x27;, &#x27;Utilities&#x27;, &#x27;MSSubClass&#x27;, &#x27;GarageType&#x27;, &#x27;Street&#x27;, &#x27;Alley&#x27;, &#x27;MSZoning&#x27;, &#x27;LotConfig&#x27;, &#x27;LandSlope&#x27;, &#x27;Condition2&#x27;, &#x27;Neighborhood&#x27;, &#x27;RoofMatl&#x27;, &#x27;Condition1&#x27;, &#x27;LandContour&#x27;, &#x27;MoSold&#x27;, &#x27;RoofStyle&#x27;, &#x27;Exterior1st&#x27;, &#x27;Exterior2nd&#x27;, &#x27;Heating&#x27;, &#x27;Foundation&#x27;, &#x27;MasVnrType&#x27;, &#x27;SaleType&#x27;, &#x27;Electrical&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-4&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ohe_columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LotShape_IR1&#39;,
 &#39;LotShape_IR2&#39;,
 &#39;LotShape_IR3&#39;,
 &#39;LotShape_Reg&#39;,
 &#39;GarageFinish_Fin&#39;,
 &#39;GarageFinish_RFn&#39;,
 &#39;GarageFinish_Unf&#39;,
 &#39;GarageFinish_missing&#39;,
 &#39;SaleCondition_Abnorml&#39;,
 &#39;SaleCondition_AdjLand&#39;,
 &#39;SaleCondition_Alloca&#39;,
 &#39;SaleCondition_Family&#39;,
 &#39;SaleCondition_Normal&#39;,
 &#39;SaleCondition_Partial&#39;,
 &#39;PavedDrive_N&#39;,
 &#39;PavedDrive_P&#39;,
 &#39;PavedDrive_Y&#39;,
 &#39;HouseStyle_1.5Fin&#39;,
 &#39;HouseStyle_1.5Unf&#39;,
 &#39;HouseStyle_1Story&#39;,
 &#39;HouseStyle_2.5Fin&#39;,
 &#39;HouseStyle_2.5Unf&#39;,
 &#39;HouseStyle_2Story&#39;,
 &#39;HouseStyle_SFoyer&#39;,
 &#39;HouseStyle_SLvl&#39;,
 &#39;BldgType_1Fam&#39;,
 &#39;BldgType_2fmCon&#39;,
 &#39;BldgType_Duplex&#39;,
 &#39;BldgType_Twnhs&#39;,
 &#39;BldgType_TwnhsE&#39;,
 &#39;CentralAir_N&#39;,
 &#39;CentralAir_Y&#39;,
 &#39;MiscFeature_Gar2&#39;,
 &#39;MiscFeature_Othr&#39;,
 &#39;MiscFeature_Shed&#39;,
 &#39;MiscFeature_TenC&#39;,
 &#39;MiscFeature_missing&#39;,
 &#39;Utilities_AllPub&#39;,
 &#39;Utilities_NoSeWa&#39;,
 &#39;MSSubClass_20&#39;,
 &#39;MSSubClass_30&#39;,
 &#39;MSSubClass_40&#39;,
 &#39;MSSubClass_45&#39;,
 &#39;MSSubClass_50&#39;,
 &#39;MSSubClass_60&#39;,
 &#39;MSSubClass_70&#39;,
 &#39;MSSubClass_75&#39;,
 &#39;MSSubClass_80&#39;,
 &#39;MSSubClass_85&#39;,
 &#39;MSSubClass_90&#39;,
 &#39;MSSubClass_120&#39;,
 &#39;MSSubClass_160&#39;,
 &#39;MSSubClass_180&#39;,
 &#39;MSSubClass_190&#39;,
 &#39;GarageType_2Types&#39;,
 &#39;GarageType_Attchd&#39;,
 &#39;GarageType_Basment&#39;,
 &#39;GarageType_BuiltIn&#39;,
 &#39;GarageType_CarPort&#39;,
 &#39;GarageType_Detchd&#39;,
 &#39;GarageType_missing&#39;,
 &#39;Street_Grvl&#39;,
 &#39;Street_Pave&#39;,
 &#39;Alley_Grvl&#39;,
 &#39;Alley_Pave&#39;,
 &#39;Alley_missing&#39;,
 &#39;MSZoning_C (all)&#39;,
 &#39;MSZoning_FV&#39;,
 &#39;MSZoning_RH&#39;,
 &#39;MSZoning_RL&#39;,
 &#39;MSZoning_RM&#39;,
 &#39;LotConfig_Corner&#39;,
 &#39;LotConfig_CulDSac&#39;,
 &#39;LotConfig_FR2&#39;,
 &#39;LotConfig_FR3&#39;,
 &#39;LotConfig_Inside&#39;,
 &#39;LandSlope_Gtl&#39;,
 &#39;LandSlope_Mod&#39;,
 &#39;LandSlope_Sev&#39;,
 &#39;Condition2_Artery&#39;,
 &#39;Condition2_Feedr&#39;,
 &#39;Condition2_Norm&#39;,
 &#39;Condition2_PosA&#39;,
 &#39;Condition2_PosN&#39;,
 &#39;Condition2_RRAe&#39;,
 &#39;Condition2_RRAn&#39;,
 &#39;Condition2_RRNn&#39;,
 &#39;Neighborhood_Blmngtn&#39;,
 &#39;Neighborhood_Blueste&#39;,
 &#39;Neighborhood_BrDale&#39;,
 &#39;Neighborhood_BrkSide&#39;,
 &#39;Neighborhood_ClearCr&#39;,
 &#39;Neighborhood_CollgCr&#39;,
 &#39;Neighborhood_Crawfor&#39;,
 &#39;Neighborhood_Edwards&#39;,
 &#39;Neighborhood_Gilbert&#39;,
 &#39;Neighborhood_IDOTRR&#39;,
 &#39;Neighborhood_MeadowV&#39;,
 &#39;Neighborhood_Mitchel&#39;,
 &#39;Neighborhood_NAmes&#39;,
 &#39;Neighborhood_NPkVill&#39;,
 &#39;Neighborhood_NWAmes&#39;,
 &#39;Neighborhood_NoRidge&#39;,
 &#39;Neighborhood_NridgHt&#39;,
 &#39;Neighborhood_OldTown&#39;,
 &#39;Neighborhood_SWISU&#39;,
 &#39;Neighborhood_Sawyer&#39;,
 &#39;Neighborhood_SawyerW&#39;,
 &#39;Neighborhood_Somerst&#39;,
 &#39;Neighborhood_StoneBr&#39;,
 &#39;Neighborhood_Timber&#39;,
 &#39;Neighborhood_Veenker&#39;,
 &#39;RoofMatl_ClyTile&#39;,
 &#39;RoofMatl_CompShg&#39;,
 &#39;RoofMatl_Membran&#39;,
 &#39;RoofMatl_Metal&#39;,
 &#39;RoofMatl_Roll&#39;,
 &#39;RoofMatl_Tar&amp;Grv&#39;,
 &#39;RoofMatl_WdShake&#39;,
 &#39;RoofMatl_WdShngl&#39;,
 &#39;Condition1_Artery&#39;,
 &#39;Condition1_Feedr&#39;,
 &#39;Condition1_Norm&#39;,
 &#39;Condition1_PosA&#39;,
 &#39;Condition1_PosN&#39;,
 &#39;Condition1_RRAe&#39;,
 &#39;Condition1_RRAn&#39;,
 &#39;Condition1_RRNe&#39;,
 &#39;Condition1_RRNn&#39;,
 &#39;LandContour_Bnk&#39;,
 &#39;LandContour_HLS&#39;,
 &#39;LandContour_Low&#39;,
 &#39;LandContour_Lvl&#39;,
 &#39;MoSold_1&#39;,
 &#39;MoSold_2&#39;,
 &#39;MoSold_3&#39;,
 &#39;MoSold_4&#39;,
 &#39;MoSold_5&#39;,
 &#39;MoSold_6&#39;,
 &#39;MoSold_7&#39;,
 &#39;MoSold_8&#39;,
 &#39;MoSold_9&#39;,
 &#39;MoSold_10&#39;,
 &#39;MoSold_11&#39;,
 &#39;MoSold_12&#39;,
 &#39;RoofStyle_Flat&#39;,
 &#39;RoofStyle_Gable&#39;,
 &#39;RoofStyle_Gambrel&#39;,
 &#39;RoofStyle_Hip&#39;,
 &#39;RoofStyle_Mansard&#39;,
 &#39;RoofStyle_Shed&#39;,
 &#39;Exterior1st_AsbShng&#39;,
 &#39;Exterior1st_AsphShn&#39;,
 &#39;Exterior1st_BrkComm&#39;,
 &#39;Exterior1st_BrkFace&#39;,
 &#39;Exterior1st_CBlock&#39;,
 &#39;Exterior1st_CemntBd&#39;,
 &#39;Exterior1st_HdBoard&#39;,
 &#39;Exterior1st_ImStucc&#39;,
 &#39;Exterior1st_MetalSd&#39;,
 &#39;Exterior1st_Plywood&#39;,
 &#39;Exterior1st_Stone&#39;,
 &#39;Exterior1st_Stucco&#39;,
 &#39;Exterior1st_VinylSd&#39;,
 &#39;Exterior1st_Wd Sdng&#39;,
 &#39;Exterior1st_WdShing&#39;,
 &#39;Exterior2nd_AsbShng&#39;,
 &#39;Exterior2nd_AsphShn&#39;,
 &#39;Exterior2nd_Brk Cmn&#39;,
 &#39;Exterior2nd_BrkFace&#39;,
 &#39;Exterior2nd_CBlock&#39;,
 &#39;Exterior2nd_CmentBd&#39;,
 &#39;Exterior2nd_HdBoard&#39;,
 &#39;Exterior2nd_ImStucc&#39;,
 &#39;Exterior2nd_MetalSd&#39;,
 &#39;Exterior2nd_Other&#39;,
 &#39;Exterior2nd_Plywood&#39;,
 &#39;Exterior2nd_Stone&#39;,
 &#39;Exterior2nd_Stucco&#39;,
 &#39;Exterior2nd_VinylSd&#39;,
 &#39;Exterior2nd_Wd Sdng&#39;,
 &#39;Exterior2nd_Wd Shng&#39;,
 &#39;Heating_Floor&#39;,
 &#39;Heating_GasA&#39;,
 &#39;Heating_GasW&#39;,
 &#39;Heating_Grav&#39;,
 &#39;Heating_OthW&#39;,
 &#39;Heating_Wall&#39;,
 &#39;Foundation_BrkTil&#39;,
 &#39;Foundation_CBlock&#39;,
 &#39;Foundation_PConc&#39;,
 &#39;Foundation_Slab&#39;,
 &#39;Foundation_Stone&#39;,
 &#39;Foundation_Wood&#39;,
 &#39;MasVnrType_BrkCmn&#39;,
 &#39;MasVnrType_BrkFace&#39;,
 &#39;MasVnrType_Stone&#39;,
 &#39;MasVnrType_missing&#39;,
 &#39;SaleType_COD&#39;,
 &#39;SaleType_CWD&#39;,
 &#39;SaleType_Con&#39;,
 &#39;SaleType_ConLD&#39;,
 &#39;SaleType_ConLI&#39;,
 &#39;SaleType_ConLw&#39;,
 &#39;SaleType_New&#39;,
 &#39;SaleType_Oth&#39;,
 &#39;SaleType_WD&#39;,
 &#39;Electrical_FuseA&#39;,
 &#39;Electrical_FuseF&#39;,
 &#39;Electrical_FuseP&#39;,
 &#39;Electrical_Mix&#39;,
 &#39;Electrical_SBrkr&#39;,
 &#39;Electrical_missing&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_columns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_features</span> <span class="o">+</span> <span class="n">ordinal_features_reg</span> <span class="o">+</span> <span class="n">ordinal_features_oth</span> <span class="o">+</span> <span class="n">ohe_columns</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tuning-alpha-hyperparameter-of-ridge">
<h3>Tuning <code class="docutils literal notranslate"><span class="pre">alpha</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">Ridge</span></code><a class="headerlink" href="#tuning-alpha-hyperparameter-of-ridge" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Recall that <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> has a hyperparameter <code class="docutils literal notranslate"><span class="pre">alpha</span></code> that controls the fundamental tradeoff.</p></li>
<li><p>This is like <code class="docutils literal notranslate"><span class="pre">C</span></code> in <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> but, annoyingly, <code class="docutils literal notranslate"><span class="pre">alpha</span></code> is the inverse of <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p></li>
<li><p>That is, large <code class="docutils literal notranslate"><span class="pre">C</span></code> is like small <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and vice versa.</p></li>
<li><p>Smaller <code class="docutils literal notranslate"><span class="pre">alpha</span></code>: lower training error (overfitting)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ridge__alpha&quot;</span><span class="p">:</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>

<span class="n">pipe_ridge</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe_ridge</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">train_scores</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;mean_train_score&quot;</span><span class="p">]</span>
<span class="n">cv_scores</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;ridge__alpha&quot;</span><span class="p">],</span> <span class="n">train_scores</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;ridge__alpha&quot;</span><span class="p">],</span> <span class="n">cv_scores</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cv&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/af985011e12d1a13cd52fbd560cb70a0a7e228ed15acd1249e43fa90eec51059.png" src="../_images/af985011e12d1a13cd52fbd560cb70a0a7e228ed15acd1249e43fa90eec51059.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_alpha</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">best_params_</span>
<span class="n">best_alpha</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ridge__alpha&#39;: 100.0}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7951559890417762
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>It seems alpha=100 is the best choice here.</p></li>
</ul>
<ul class="simple">
<li><p>General intuition: larger <code class="docutils literal notranslate"><span class="pre">alpha</span></code> leads to smaller coefficients.</p></li>
<li><p>Smaller coefficients mean the predictions are less sensitive to changes in the data. Hence less chance of overfitting.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_bigalpha</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">pipe_bigalpha</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">bigalpha_coeffs</span> <span class="o">=</span> <span class="n">pipe_bigalpha</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">bigalpha_coeffs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>OverallQual</th>
      <td>9691.378159</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>7816.490033</td>
    </tr>
    <tr>
      <th>1stFlrSF</th>
      <td>5931.401623</td>
    </tr>
    <tr>
      <th>TotRmsAbvGrd</th>
      <td>5209.377032</td>
    </tr>
    <tr>
      <th>GarageCars</th>
      <td>5057.215412</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>SaleType_WD</th>
      <td>-1214.532034</td>
    </tr>
    <tr>
      <th>GarageFinish_Unf</th>
      <td>-1281.596864</td>
    </tr>
    <tr>
      <th>Foundation_CBlock</th>
      <td>-1766.048889</td>
    </tr>
    <tr>
      <th>RoofStyle_Gable</th>
      <td>-1985.253914</td>
    </tr>
    <tr>
      <th>KitchenAbvGr</th>
      <td>-2623.509001</td>
    </tr>
  </tbody>
</table>
<p>262 rows × 1 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Smaller <code class="docutils literal notranslate"><span class="pre">alpha</span></code> leads to bigger coefficients.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_smallalpha</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">pipe_smallalpha</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">smallalpha_coeffs</span> <span class="o">=</span> <span class="n">pipe_smallalpha</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">smallalpha_coeffs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>128384.117412</td>
    </tr>
    <tr>
      <th>RoofMatl_Membran</th>
      <td>127326.497787</td>
    </tr>
    <tr>
      <th>RoofMatl_Metal</th>
      <td>106023.481515</td>
    </tr>
    <tr>
      <th>Condition2_PosA</th>
      <td>83437.787574</td>
    </tr>
    <tr>
      <th>RoofMatl_CompShg</th>
      <td>70568.838951</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>Exterior1st_ImStucc</th>
      <td>-34441.626206</td>
    </tr>
    <tr>
      <th>Heating_OthW</th>
      <td>-34806.290424</td>
    </tr>
    <tr>
      <th>Condition2_RRAe</th>
      <td>-63362.335309</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>-194985.470060</td>
    </tr>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-582469.424221</td>
    </tr>
  </tbody>
</table>
<p>262 rows × 1 columns</p>
</div></div></div>
</div>
<p>With the best alpha found by the grid search, the coefficients are somewhere in between.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_bestalpha</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;ridge__alpha&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">pipe_bestalpha</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">bestalpha_coeffs</span> <span class="o">=</span> <span class="n">pipe_bestalpha</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">bestalpha_coeffs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>OverallQual</th>
      <td>14485.526602</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>11693.792577</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>9661.926657</td>
    </tr>
    <tr>
      <th>Neighborhood_NoRidge</th>
      <td>9492.921850</td>
    </tr>
    <tr>
      <th>BsmtQual</th>
      <td>8076.988901</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-3991.413796</td>
    </tr>
    <tr>
      <th>LandContour_Bnk</th>
      <td>-5002.470666</td>
    </tr>
    <tr>
      <th>Neighborhood_Gilbert</th>
      <td>-5212.984664</td>
    </tr>
    <tr>
      <th>Neighborhood_CollgCr</th>
      <td>-5461.450739</td>
    </tr>
    <tr>
      <th>Neighborhood_Edwards</th>
      <td>-5789.889086</td>
    </tr>
  </tbody>
</table>
<p>262 rows × 1 columns</p>
</div></div></div>
</div>
<p>To summarize:</p>
<ul class="simple">
<li><p>Higher values of <code class="docutils literal notranslate"><span class="pre">alpha</span></code> means a more restricted model.</p></li>
<li><p>The values of coefficients are likely to be smaller for higher values of <code class="docutils literal notranslate"><span class="pre">alpha</span></code> compared to lower values of alpha.</p></li>
</ul>
</section>
<section id="ridgecv">
<h3><code class="docutils literal notranslate"><span class="pre">RidgeCV</span></code><a class="headerlink" href="#ridgecv" title="Permalink to this heading">#</a></h3>
<p>Because it’s so common to want to tune <code class="docutils literal notranslate"><span class="pre">alpha</span></code> with <code class="docutils literal notranslate"><span class="pre">Ridge</span></code>, sklearn provides a class called <code class="docutils literal notranslate"><span class="pre">RidgeCV</span></code>, which automatically tunes <code class="docutils literal notranslate"><span class="pre">alpha</span></code> based on cross-validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alphas</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ridgecv_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RidgeCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ridgecv_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ridgecv_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridgecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span>

<span class="n">best_alpha</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100.0
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
<p>Let’s examine the tuned model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge_tuned</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">best_alpha</span><span class="p">))</span>
<span class="n">ridge_tuned</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">ridge_preds</span> <span class="o">=</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">ridge_preds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([228603.06797961, 104643.99931883, 155624.61029914, 246332.07245741,
       127614.33726089, 243243.60429913, 304784.87844893, 145425.67512181,
       157008.6526853 , 128528.91515735])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;coefficients&quot;</span><span class="p">:</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;coefficients&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>OverallQual</th>
      <td>14485.526602</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>11693.792577</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>9661.926657</td>
    </tr>
    <tr>
      <th>Neighborhood_NoRidge</th>
      <td>9492.921850</td>
    </tr>
    <tr>
      <th>BsmtQual</th>
      <td>8076.988901</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-3991.413796</td>
    </tr>
    <tr>
      <th>LandContour_Bnk</th>
      <td>-5002.470666</td>
    </tr>
    <tr>
      <th>Neighborhood_Gilbert</th>
      <td>-5212.984664</td>
    </tr>
    <tr>
      <th>Neighborhood_CollgCr</th>
      <td>-5461.450739</td>
    </tr>
    <tr>
      <th>Neighborhood_Edwards</th>
      <td>-5789.889086</td>
    </tr>
  </tbody>
</table>
<p>262 rows × 1 columns</p>
</div></div></div>
</div>
<p>So according to this model:</p>
<ul class="simple">
<li><p>As <code class="docutils literal notranslate"><span class="pre">OverallQual</span></code> feature gets bigger the housing price will get bigger.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Neighborhood_Edwards</span></code> is associated with reducing the housing price.</p>
<ul>
<li><p>We’ll talk more about interpretation of different kinds of features next week.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge_preds</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ridge_preds</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(390725.7472092075, 30815.281220255296)
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</section>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-10-1">
<h3>iClicker Exercise 10.1<a class="headerlink" href="#iclicker-exercise-10-1" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p><strong>Select all of the following statements which are TRUE.</strong></p>
<ul class="simple">
<li><p>(A) Price per square foot would be a good feature to add in our <code class="docutils literal notranslate"><span class="pre">X</span></code>.</p></li>
<li><p>(B) The <code class="docutils literal notranslate"><span class="pre">alpha</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> has similar interpretation of <code class="docutils literal notranslate"><span class="pre">C</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code>; higher <code class="docutils literal notranslate"><span class="pre">alpha</span></code> means more complex model.</p></li>
<li><p>(C) In <code class="docutils literal notranslate"><span class="pre">Ridge</span></code>, smaller alpha means bigger coefficients whereas bigger alpha means smaller coefficients.</p></li>
</ul>
<p>Can we use the metrics we looked at in the previous lecture for this problem? Why or why not?</p>
<p><br><br><br><br></p>
</section>
</section>
<section id="regression-scoring-functions">
<h2>Regression scoring functions<a class="headerlink" href="#regression-scoring-functions" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We aren’t doing classification anymore, so we can’t just check for equality:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span> <span class="o">==</span> <span class="n">y_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>302     False
767     False
429     False
1139    False
558     False
        ...  
1041    False
1122    False
1346    False
1406    False
1389    False
Name: SalePrice, Length: 1314, dtype: bool
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([205000, 160000, 175000, ..., 262500, 133000, 131000])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([212870.41150573, 178494.22221894, 189981.34426571, ...,
       245329.56804591, 129904.71327467, 135422.67672595])
</pre></div>
</div>
</div>
</div>
<p>We need a score that reflects how right/wrong each prediction is.</p>
<p>There are a number of popular scoring functions for regression. We are going to look at some common metrics:</p>
<ul class="simple">
<li><p>mean squared error (MSE)</p></li>
<li><p><span class="math notranslate nohighlight">\(R^2\)</span></p></li>
<li><p>root mean squared error (RMSE)</p></li>
<li><p>MAPE</p></li>
</ul>
<p>See <a class="reference external" href="https://scikit-learn.org/stable/modules/model_evaluation.html#regression-metrics">sklearn documentation</a> for more details.</p>
<section id="mean-squared-error-mse">
<h3>Mean squared error (MSE)<a class="headerlink" href="#mean-squared-error-mse" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A common metric is mean squared error:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_train</span> <span class="o">-</span> <span class="n">preds</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>872961060.7986535
</pre></div>
</div>
</div>
</div>
<p>Perfect predictions would have MSE=0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_train</span> <span class="o">-</span> <span class="n">y_train</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>This is also implemented in sklearn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>872961060.7986535
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>MSE looks huge and unreasonable. There is an error of ~$1 Billion!</p></li>
<li><p>Is this score good or bad?</p></li>
</ul>
<ul class="simple">
<li><p>Unlike classification, with regression <strong>our target has units</strong>.</p></li>
<li><p>The target is in dollars, the mean squared error is in <span class="math notranslate nohighlight">\(dollars^2\)</span></p></li>
<li><p>The score also depends on the scale of the targets.</p></li>
<li><p>If we were working in cents instead of dollars, our MSE would be <span class="math notranslate nohighlight">\(10,000 \times (100^2\)</span>) higher!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_train</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">preds</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8729610607986.533
</pre></div>
</div>
</div>
</div>
</section>
<section id="root-mean-squared-error-or-rmse">
<h3>Root mean squared error or RMSE<a class="headerlink" href="#root-mean-squared-error-or-rmse" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The MSE above is in <span class="math notranslate nohighlight">\(dollars^2\)</span>.</p></li>
<li><p>A more relatable metric would be the root mean squared error, or RMSE</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>29545.91445189425
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Error of $30,000 makes more sense.</p></li>
<li><p>Let’s dig deeper.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="s2">&quot;--k&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;true price&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;predicted price&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/738403f3a6d0c3ed7da228aa17633295d26204a28fd48389a29333ee09676800.png" src="../_images/738403f3a6d0c3ed7da228aa17633295d26204a28fd48389a29333ee09676800.png" />
</div>
</div>
<ul class="simple">
<li><p>Here we can see a few cases where our prediction is way off.</p></li>
<li><p>Is there something weird about those houses, perhaps? Outliers?</p></li>
<li><p>Under the line means we’re under-predicting, over the line means we’re over-predicting.</p></li>
</ul>
</section>
<section id="r-2-not-in-detail">
<h3><span class="math notranslate nohighlight">\(R^2\)</span> (not in detail)<a class="headerlink" href="#r-2-not-in-detail" title="Permalink to this heading">#</a></h3>
<p>A common score is the <span class="math notranslate nohighlight">\(R^2\)</span></p>
<ul class="simple">
<li><p>This is the score that <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> uses by default when you call score()</p></li>
<li><p>You can <a class="reference external" href="https://en.wikipedia.org/wiki/Coefficient_of_determination">read about it</a> if interested.</p></li>
<li><p><span class="math notranslate nohighlight">\(R^2\)</span> measures the proportion of variability in <span class="math notranslate nohighlight">\(y\)</span> that can be explained using <span class="math notranslate nohighlight">\(X\)</span>.</p></li>
<li><p>Independent of the scale of <span class="math notranslate nohighlight">\(y\)</span>. So the max is 1.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[R^2(y, \hat{y}) = 1 - \frac{\sum_{i=1}^n (y_i - \hat{y_i})^2}{\sum_{i=1}^n (y_i - \bar{y})^2}\]</div>
<ul class="simple">
<li><p>The denominator measures the total variance in <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
<li><p>The amount of variability that is left unexplained after performing regression.</p></li>
</ul>
<p>Key points:</p>
<ul class="simple">
<li><p>The maximum is 1 for perfect predictions</p></li>
<li><p>Negative values are very bad: “worse than DummyRegressor” (very bad)</p></li>
</ul>
<p>(Optional) Warning: MSE is “reversible” but <span class="math notranslate nohighlight">\(R^2\)</span> is not:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>872961060.7986535
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>872961060.7986535
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8601643854446084
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8280229354283186
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>When you call <code class="docutils literal notranslate"><span class="pre">fit</span></code> it minimizes MSE / maximizes <span class="math notranslate nohighlight">\(R^2\)</span> (or something like that) by default.</p></li>
<li><p>Just like in classification, this isn’t always what you want!!</p></li>
</ul>
</section>
<section id="mape">
<h3>MAPE<a class="headerlink" href="#mape" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We got an RMSE of ~$30,000 before.</p></li>
</ul>
<p>Question: Is an error of $30,000 acceptable?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>29545.91445189425
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>For a house worth $600k, it seems reasonable! That’s 5% error.</p></li>
<li><p>For a house worth $60k, that is terrible. It’s 50% error.</p></li>
</ul>
<p>We have both of these cases in our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e56842299e9f1a92dc78cdd0347c3fd2569c9f668812b1ada206316456632f26.png" src="../_images/e56842299e9f1a92dc78cdd0347c3fd2569c9f668812b1ada206316456632f26.png" />
</div>
</div>
<p>How about looking at percent error?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_train</span> <span class="o">=</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">percent_errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_train</span> <span class="o">-</span> <span class="n">y_train</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_train</span> <span class="o">*</span> <span class="mf">100.0</span>
<span class="n">percent_errors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>302      3.839225
767     11.558889
429      8.560768
1139   -16.405650
558     17.194710
          ...    
1041    -0.496213
1122   -28.624615
1346    -6.541117
1406    -2.327283
1389     3.376089
Name: SalePrice, Length: 1314, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>These are both positive (predict too high) and negative (predict too low).</p>
<p>We can look at the absolute percent error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">percent_errors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>302      3.839225
767     11.558889
429      8.560768
1139    16.405650
558     17.194710
          ...    
1041     0.496213
1122    28.624615
1346     6.541117
1406     2.327283
1389     3.376089
Name: SalePrice, Length: 1314, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>And, like MSE, we can take the average over examples. This is called mean absolute percent error (MAPE).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_mape</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">pred</span> <span class="o">-</span> <span class="n">true</span><span class="p">)</span> <span class="o">/</span> <span class="n">true</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_mape</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.10092665203438769
</pre></div>
</div>
</div>
</div>
<p>Let’s use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> to calculate MAPE.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.10092665203438769
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ok, this is quite interpretable.</p></li>
<li><p>On average, we have around 10% error.</p></li>
</ul>
</section>
<section id="transforming-the-targets">
<h3>Transforming the targets<a class="headerlink" href="#transforming-the-targets" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>When you have prices or count data, the target values are skewed.</p></li>
<li><p>Let’s look at our target column.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e56842299e9f1a92dc78cdd0347c3fd2569c9f668812b1ada206316456632f26.png" src="../_images/e56842299e9f1a92dc78cdd0347c3fd2569c9f668812b1ada206316456632f26.png" />
</div>
</div>
<ul class="simple">
<li><p>A common trick in such cases is applying a log transform on the target column to make it more normal and less skewed.</p></li>
<li><p>That is, transform <span class="math notranslate nohighlight">\(y\rightarrow \log(y)\)</span>.</p></li>
<li><p>Linear regression will usually work better on something that looks more normal.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dac2122446d5c1370bd9883bcc7a49a15937541c1bd09619d505e73ecd94f07e.png" src="../_images/dac2122446d5c1370bd9883bcc7a49a15937541c1bd09619d505e73ecd94f07e.png" />
</div>
</div>
<p>We can incorporate this in our pipeline using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">TransformedTargetRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ttr</span> <span class="o">=</span> <span class="n">TransformedTargetRegressor</span><span class="p">(</span>
    <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">best_alpha</span><span class="p">),</span> <span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">inverse_func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span>
<span class="p">)</span> <span class="c1"># transformer for log transforming the target</span>
<span class="n">ttr_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">ttr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ttr_pipe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;MSZoning&#x27;, &#x27;LotConfig&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;Condition2&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;RoofMatl&#x27;,
                                                   &#x27;Condition1&#x27;, &#x27;LandContour&#x27;,
                                                   &#x27;MoSold&#x27;, &#x27;RoofStyle&#x27;,
                                                   &#x27;Exterior1st&#x27;, &#x27;Exterior2nd&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;Foundation&#x27;,
                                                   &#x27;MasVnrType&#x27;, &#x27;SaleType&#x27;,
                                                   &#x27;Electrical&#x27;])])),
                (&#x27;transformedtargetregressor&#x27;,
                 TransformedTargetRegressor(func=&lt;ufunc &#x27;log1p&#x27;&gt;,
                                            inverse_func=&lt;ufunc &#x27;expm1&#x27;&gt;,
                                            regressor=Ridge(alpha=100.0)))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;MSZoning&#x27;, &#x27;LotConfig&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;Condition2&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;RoofMatl&#x27;,
                                                   &#x27;Condition1&#x27;, &#x27;LandContour&#x27;,
                                                   &#x27;MoSold&#x27;, &#x27;RoofStyle&#x27;,
                                                   &#x27;Exterior1st&#x27;, &#x27;Exterior2nd&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;Foundation&#x27;,
                                                   &#x27;MasVnrType&#x27;, &#x27;SaleType&#x27;,
                                                   &#x27;Electrical&#x27;])])),
                (&#x27;transformedtargetregressor&#x27;,
                 TransformedTargetRegressor(func=&lt;ufunc &#x27;log1p&#x27;&gt;,
                                            inverse_func=&lt;ufunc &#x27;expm1&#x27;&gt;,
                                            regressor=Ridge(alpha=100.0)))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                (&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;,
                                  &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                  &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;,
                                  &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;,
                                  &#x27;TotalBsmtSF&#x27;, &#x27;...
                                 [&#x27;LotShape&#x27;, &#x27;GarageFinish&#x27;, &#x27;SaleCondition&#x27;,
                                  &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;, &#x27;BldgType&#x27;,
                                  &#x27;CentralAir&#x27;, &#x27;MiscFeature&#x27;, &#x27;Utilities&#x27;,
                                  &#x27;MSSubClass&#x27;, &#x27;GarageType&#x27;, &#x27;Street&#x27;, &#x27;Alley&#x27;,
                                  &#x27;MSZoning&#x27;, &#x27;LotConfig&#x27;, &#x27;LandSlope&#x27;,
                                  &#x27;Condition2&#x27;, &#x27;Neighborhood&#x27;, &#x27;RoofMatl&#x27;,
                                  &#x27;Condition1&#x27;, &#x27;LandContour&#x27;, &#x27;MoSold&#x27;,
                                  &#x27;RoofStyle&#x27;, &#x27;Exterior1st&#x27;, &#x27;Exterior2nd&#x27;,
                                  &#x27;Heating&#x27;, &#x27;Foundation&#x27;, &#x27;MasVnrType&#x27;,
                                  &#x27;SaleType&#x27;, &#x27;Electrical&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;Id&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;, &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;, &#x27;TotalBsmtSF&#x27;, &#x27;1stFlrSF&#x27;, &#x27;2ndFlrSF&#x27;, &#x27;LowQualFinSF&#x27;, &#x27;GrLivArea&#x27;, &#x27;BsmtFullBath&#x27;, &#x27;BsmtHalfBath&#x27;, &#x27;FullBath&#x27;, &#x27;HalfBath&#x27;, &#x27;TotRmsAbvGrd&#x27;, &#x27;Fireplaces&#x27;, &#x27;GarageYrBlt&#x27;, &#x27;GarageCars&#x27;, &#x27;GarageArea&#x27;, &#x27;WoodDeckSF&#x27;, &#x27;OpenPorchSF&#x27;, &#x27;EnclosedPorch&#x27;, &#x27;3SsnPorch&#x27;, &#x27;ScreenPorch&#x27;, &#x27;PoolArea&#x27;, &#x27;MiscVal&#x27;, &#x27;YrSold&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;ExterQual&#x27;, &#x27;ExterCond&#x27;, &#x27;BsmtQual&#x27;, &#x27;BsmtCond&#x27;, &#x27;HeatingQC&#x27;, &#x27;KitchenQual&#x27;, &#x27;FireplaceQu&#x27;, &#x27;GarageQual&#x27;, &#x27;GarageCond&#x27;, &#x27;PoolQC&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-3</label><div class="sk-toggleable__content"><pre>[&#x27;BsmtExposure&#x27;, &#x27;BsmtFinType1&#x27;, &#x27;BsmtFinType2&#x27;, &#x27;Functional&#x27;, &#x27;Fence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;NA&#x27;, &#x27;No&#x27;, &#x27;Mn&#x27;, &#x27;Av&#x27;, &#x27;Gd&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;Sal&#x27;, &#x27;Sev&#x27;, &#x27;Maj2&#x27;, &#x27;Maj1&#x27;, &#x27;Mod&#x27;, &#x27;Min2&#x27;, &#x27;Min1&#x27;,
                            &#x27;Typ&#x27;],
                           [&#x27;NA&#x27;, &#x27;MnWw&#x27;, &#x27;GdWo&#x27;, &#x27;MnPrv&#x27;, &#x27;GdPrv&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox" ><label for="sk-estimator-id-29" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-4</label><div class="sk-toggleable__content"><pre>[&#x27;LotShape&#x27;, &#x27;GarageFinish&#x27;, &#x27;SaleCondition&#x27;, &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;, &#x27;BldgType&#x27;, &#x27;CentralAir&#x27;, &#x27;MiscFeature&#x27;, &#x27;Utilities&#x27;, &#x27;MSSubClass&#x27;, &#x27;GarageType&#x27;, &#x27;Street&#x27;, &#x27;Alley&#x27;, &#x27;MSZoning&#x27;, &#x27;LotConfig&#x27;, &#x27;LandSlope&#x27;, &#x27;Condition2&#x27;, &#x27;Neighborhood&#x27;, &#x27;RoofMatl&#x27;, &#x27;Condition1&#x27;, &#x27;LandContour&#x27;, &#x27;MoSold&#x27;, &#x27;RoofStyle&#x27;, &#x27;Exterior1st&#x27;, &#x27;Exterior2nd&#x27;, &#x27;Heating&#x27;, &#x27;Foundation&#x27;, &#x27;MasVnrType&#x27;, &#x27;SaleType&#x27;, &#x27;Electrical&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" ><label for="sk-estimator-id-30" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox" ><label for="sk-estimator-id-31" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox" ><label for="sk-estimator-id-32" class="sk-toggleable__label sk-toggleable__label-arrow">transformedtargetregressor: TransformedTargetRegressor</label><div class="sk-toggleable__content"><pre>TransformedTargetRegressor(func=&lt;ufunc &#x27;log1p&#x27;&gt;, inverse_func=&lt;ufunc &#x27;expm1&#x27;&gt;,
                           regressor=Ridge(alpha=100.0))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox" ><label for="sk-estimator-id-33" class="sk-toggleable__label sk-toggleable__label-arrow">regressor: Ridge</label><div class="sk-toggleable__content"><pre>Ridge(alpha=100.0)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox" ><label for="sk-estimator-id-34" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge(alpha=100.0)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>Why can’t we incorporate preprocessing targets in our column transformer?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ttr_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span> <span class="c1"># y_train automatically transformed</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ttr_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># predictions automatically un-transformed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([221329.43833466, 170670.12761659, 182639.31984311, ...,
       248609.60023631, 132158.15026771, 133270.71866979])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ttr_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.07808506982896254
</pre></div>
</div>
</div>
</div>
<p>We reduced MAPE from ~10% to ~8% with this trick!</p>
<ul class="simple">
<li><p>Does <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> know we care about MAPE?</p></li>
<li><p>No, it doesn’t. Why are we minimizing MSE (or something similar) if we care about MAPE??</p></li>
<li><p>When minimizing MSE, the expensive houses will dominate because they have the biggest error.</p></li>
</ul>
</section>
<section id="different-scoring-functions-with-cross-validate">
<h3>Different scoring functions with <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code><a class="headerlink" href="#different-scoring-functions-with-cross-validate" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s try using MSE instead of the default <span class="math notranslate nohighlight">\(R^2\)</span> score.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">ridge_tuned</span><span class="p">,</span>
        <span class="n">X_train</span><span class="p">,</span>
        <span class="n">y_train</span><span class="p">,</span>
        <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.026120</td>
      <td>0.006816</td>
      <td>-7.055915e+08</td>
      <td>-9.379875e+08</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.024906</td>
      <td>0.007267</td>
      <td>-1.239944e+09</td>
      <td>-8.264283e+08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.024179</td>
      <td>0.007524</td>
      <td>-1.125440e+09</td>
      <td>-8.758062e+08</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.023939</td>
      <td>0.006499</td>
      <td>-9.801219e+08</td>
      <td>-8.849438e+08</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.024087</td>
      <td>0.006732</td>
      <td>-2.267612e+09</td>
      <td>-7.395282e+08</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a scorer function that we can pass into cross-validation</span>
<span class="n">mape_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">my_mape</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">ridge_tuned</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">mape_scorer</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.024398</td>
      <td>0.006702</td>
      <td>-0.096960</td>
      <td>-0.104070</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.027555</td>
      <td>0.007023</td>
      <td>-0.107985</td>
      <td>-0.099685</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.023322</td>
      <td>0.006587</td>
      <td>-0.118347</td>
      <td>-0.101796</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.025249</td>
      <td>0.006643</td>
      <td>-0.107947</td>
      <td>-0.102435</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.023129</td>
      <td>0.006506</td>
      <td>-0.121985</td>
      <td>-0.098307</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If you are finding <code class="docutils literal notranslate"><span class="pre">greater_is_better=False</span></code> argument confusing, here is the documentation:</p>
<blockquote>
<div><p>greater_is_better(bool), default=True
Whether score_func is a score function (default), meaning high is good, or a loss function, meaning low is good. In the latter case, the scorer object will sign-flip the outcome of the score_func.</p>
</div></blockquote>
<p>Since our custom scorer <code class="docutils literal notranslate"><span class="pre">mape</span></code> gives an error and not a score, I’m passing <code class="docutils literal notranslate"><span class="pre">False</span></code> to it and it’ll sign flip so that we can interpret bigger numbers as better performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ?make_scorer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mape_scorer&quot;</span><span class="p">:</span> <span class="n">mape_scorer</span><span class="p">,</span> <span class="c1"># just for demonstration for a custom scorer</span>
    <span class="s2">&quot;sklearn MAPE&quot;</span><span class="p">:</span> <span class="s2">&quot;neg_mean_absolute_percentage_error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;neg_root_mean_square_error&quot;</span><span class="p">:</span> <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">:</span> <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">ridge_tuned</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>2.713084e-02</td>
      <td>2.348495e-02</td>
      <td>2.353811e-02</td>
      <td>2.354980e-02</td>
      <td>2.490115e-02</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>7.678986e-03</td>
      <td>7.263899e-03</td>
      <td>7.298708e-03</td>
      <td>7.651091e-03</td>
      <td>7.533073e-03</td>
    </tr>
    <tr>
      <th>test_r2</th>
      <td>8.669805e-01</td>
      <td>8.200326e-01</td>
      <td>8.262156e-01</td>
      <td>8.514598e-01</td>
      <td>6.110915e-01</td>
    </tr>
    <tr>
      <th>train_r2</th>
      <td>8.551862e-01</td>
      <td>8.636849e-01</td>
      <td>8.580539e-01</td>
      <td>8.561645e-01</td>
      <td>8.834356e-01</td>
    </tr>
    <tr>
      <th>test_mape_scorer</th>
      <td>-9.696034e-02</td>
      <td>-1.079852e-01</td>
      <td>-1.183471e-01</td>
      <td>-1.079471e-01</td>
      <td>-1.219845e-01</td>
    </tr>
    <tr>
      <th>train_mape_scorer</th>
      <td>-1.040698e-01</td>
      <td>-9.968514e-02</td>
      <td>-1.017959e-01</td>
      <td>-1.024351e-01</td>
      <td>-9.830712e-02</td>
    </tr>
    <tr>
      <th>test_sklearn MAPE</th>
      <td>-9.696034e-02</td>
      <td>-1.079852e-01</td>
      <td>-1.183471e-01</td>
      <td>-1.079471e-01</td>
      <td>-1.219845e-01</td>
    </tr>
    <tr>
      <th>train_sklearn MAPE</th>
      <td>-1.040698e-01</td>
      <td>-9.968514e-02</td>
      <td>-1.017959e-01</td>
      <td>-1.024351e-01</td>
      <td>-9.830712e-02</td>
    </tr>
    <tr>
      <th>test_neg_root_mean_square_error</th>
      <td>-2.656297e+04</td>
      <td>-3.521284e+04</td>
      <td>-3.354759e+04</td>
      <td>-3.130690e+04</td>
      <td>-4.761945e+04</td>
    </tr>
    <tr>
      <th>train_neg_root_mean_square_error</th>
      <td>-3.062658e+04</td>
      <td>-2.874767e+04</td>
      <td>-2.959402e+04</td>
      <td>-2.974801e+04</td>
      <td>-2.719427e+04</td>
    </tr>
    <tr>
      <th>test_neg_mean_squared_error</th>
      <td>-7.055915e+08</td>
      <td>-1.239944e+09</td>
      <td>-1.125440e+09</td>
      <td>-9.801219e+08</td>
      <td>-2.267612e+09</td>
    </tr>
    <tr>
      <th>train_neg_mean_squared_error</th>
      <td>-9.379875e+08</td>
      <td>-8.264283e+08</td>
      <td>-8.758062e+08</td>
      <td>-8.849438e+08</td>
      <td>-7.395282e+08</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Are we getting the same <code class="docutils literal notranslate"><span class="pre">alpha</span></code> with mape?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ridge__alpha&quot;</span><span class="p">:</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>

<span class="n">pipe_ridge</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">pipe_ridge</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">mape_scorer</span>
<span class="p">)</span>
<span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best hyperparameter values: &quot;</span><span class="p">,</span> <span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">))</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span>
    <span class="p">[</span>
        <span class="s2">&quot;mean_train_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_ridge__alpha&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_fit_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rank_test_score&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;rank_test_score&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best hyperparameter values:  {&#39;ridge__alpha&#39;: 100.0}
Best score: -0.111
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rank_test_score</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_train_score</th>
      <td>-0.101259</td>
      <td>-0.111543</td>
      <td>-0.096462</td>
      <td>-0.090785</td>
      <td>-0.085698</td>
      <td>-0.085508</td>
      <td>-0.085546</td>
      <td>-0.08555</td>
      <td>-0.085551</td>
      <td>-0.085551</td>
      <td>-0.203421</td>
      <td>-0.33213</td>
    </tr>
    <tr>
      <th>mean_test_score</th>
      <td>-0.110645</td>
      <td>-0.115401</td>
      <td>-0.116497</td>
      <td>-0.122331</td>
      <td>-0.125644</td>
      <td>-0.127242</td>
      <td>-0.127418</td>
      <td>-0.127439</td>
      <td>-0.127441</td>
      <td>-0.127441</td>
      <td>-0.204692</td>
      <td>-0.33271</td>
    </tr>
    <tr>
      <th>param_ridge__alpha</th>
      <td>100.0</td>
      <td>1000.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.001</td>
      <td>0.0001</td>
      <td>0.00001</td>
      <td>0.000001</td>
      <td>10000.0</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>mean_fit_time</th>
      <td>0.044169</td>
      <td>0.041085</td>
      <td>0.044295</td>
      <td>0.050607</td>
      <td>0.039236</td>
      <td>0.035071</td>
      <td>0.037367</td>
      <td>0.046649</td>
      <td>0.052672</td>
      <td>0.069799</td>
      <td>0.042478</td>
      <td>0.032924</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="using-multiple-metrics-in-gridsearchcv-or-randomizedsearchcv">
<h3>Using multiple metrics in <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> or <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code><a class="headerlink" href="#using-multiple-metrics-in-gridsearchcv-or-randomizedsearchcv" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We could use multiple metrics with <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> or <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>.</p></li>
<li><p>But if you do so, you need to set <code class="docutils literal notranslate"><span class="pre">refit</span></code> to the metric (string) for which the <code class="docutils literal notranslate"><span class="pre">best_params_</span></code> will be found and used to build the <code class="docutils literal notranslate"><span class="pre">best_estimator_</span></code> on the whole dataset.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_multi</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">pipe_ridge</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="p">,</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
    <span class="n">refit</span><span class="o">=</span><span class="s2">&quot;sklearn MAPE&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">search_multi</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best hyperparameter values: &quot;</span><span class="p">,</span> <span class="n">search_multi</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">search_multi</span><span class="o">.</span><span class="n">best_score_</span><span class="p">))</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">search_multi</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;rank_test_mape_scorer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best hyperparameter values:  {&#39;ridge__alpha&#39;: 100.0}
Best score: -0.111
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_ridge__alpha</th>
      <th>params</th>
      <th>split0_test_r2</th>
      <th>split1_test_r2</th>
      <th>split2_test_r2</th>
      <th>split3_test_r2</th>
      <th>...</th>
      <th>mean_test_neg_mean_squared_error</th>
      <th>std_test_neg_mean_squared_error</th>
      <th>rank_test_neg_mean_squared_error</th>
      <th>split0_train_neg_mean_squared_error</th>
      <th>split1_train_neg_mean_squared_error</th>
      <th>split2_train_neg_mean_squared_error</th>
      <th>split3_train_neg_mean_squared_error</th>
      <th>split4_train_neg_mean_squared_error</th>
      <th>mean_train_neg_mean_squared_error</th>
      <th>std_train_neg_mean_squared_error</th>
    </tr>
    <tr>
      <th>rank_test_mape_scorer</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.039535</td>
      <td>0.003742</td>
      <td>0.011913</td>
      <td>0.003011</td>
      <td>100.0</td>
      <td>{'ridge__alpha': 100.0}</td>
      <td>0.866980</td>
      <td>0.820033</td>
      <td>0.826216</td>
      <td>0.851460</td>
      <td>...</td>
      <td>-1.263742e+09</td>
      <td>5.328077e+08</td>
      <td>1</td>
      <td>-9.379875e+08</td>
      <td>-8.264283e+08</td>
      <td>-8.758062e+08</td>
      <td>-8.849438e+08</td>
      <td>-7.395282e+08</td>
      <td>-8.529388e+08</td>
      <td>6.685103e+07</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.039521</td>
      <td>0.004809</td>
      <td>0.012029</td>
      <td>0.002788</td>
      <td>1000.0</td>
      <td>{'ridge__alpha': 1000.0}</td>
      <td>0.827261</td>
      <td>0.786555</td>
      <td>0.802902</td>
      <td>0.812272</td>
      <td>...</td>
      <td>-1.362185e+09</td>
      <td>3.262269e+08</td>
      <td>3</td>
      <td>-1.282021e+09</td>
      <td>-1.156311e+09</td>
      <td>-1.207814e+09</td>
      <td>-1.225301e+09</td>
      <td>-1.029950e+09</td>
      <td>-1.180279e+09</td>
      <td>8.521743e+07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.037204</td>
      <td>0.004855</td>
      <td>0.011907</td>
      <td>0.002939</td>
      <td>10.0</td>
      <td>{'ridge__alpha': 10.0}</td>
      <td>0.859318</td>
      <td>0.820564</td>
      <td>0.832866</td>
      <td>0.846650</td>
      <td>...</td>
      <td>-1.283119e+09</td>
      <td>5.511620e+08</td>
      <td>2</td>
      <td>-7.034979e+08</td>
      <td>-6.276943e+08</td>
      <td>-6.910456e+08</td>
      <td>-6.701186e+08</td>
      <td>-5.915714e+08</td>
      <td>-6.567856e+08</td>
      <td>4.155178e+07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.037038</td>
      <td>0.008245</td>
      <td>0.009942</td>
      <td>0.003876</td>
      <td>1.0</td>
      <td>{'ridge__alpha': 1.0}</td>
      <td>0.835749</td>
      <td>0.810073</td>
      <td>0.831611</td>
      <td>0.843992</td>
      <td>...</td>
      <td>-1.386071e+09</td>
      <td>6.378971e+08</td>
      <td>4</td>
      <td>-5.394113e+08</td>
      <td>-4.898703e+08</td>
      <td>-5.405227e+08</td>
      <td>-5.290961e+08</td>
      <td>-5.046193e+08</td>
      <td>-5.207039e+08</td>
      <td>2.011269e+07</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.039365</td>
      <td>0.010348</td>
      <td>0.013747</td>
      <td>0.003891</td>
      <td>0.1</td>
      <td>{'ridge__alpha': 0.1}</td>
      <td>0.821807</td>
      <td>0.792828</td>
      <td>0.805198</td>
      <td>0.863941</td>
      <td>...</td>
      <td>-1.465279e+09</td>
      <td>6.931439e+08</td>
      <td>5</td>
      <td>-4.579559e+08</td>
      <td>-4.009514e+08</td>
      <td>-4.345386e+08</td>
      <td>-4.515351e+08</td>
      <td>-4.846260e+08</td>
      <td>-4.459214e+08</td>
      <td>2.766317e+07</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.043641</td>
      <td>0.008413</td>
      <td>0.009649</td>
      <td>0.001835</td>
      <td>0.01</td>
      <td>{'ridge__alpha': 0.01}</td>
      <td>0.824884</td>
      <td>0.782183</td>
      <td>0.787933</td>
      <td>0.868003</td>
      <td>...</td>
      <td>-1.501304e+09</td>
      <td>7.090376e+08</td>
      <td>6</td>
      <td>-4.522563e+08</td>
      <td>-3.926733e+08</td>
      <td>-4.251158e+08</td>
      <td>-4.446284e+08</td>
      <td>-4.837022e+08</td>
      <td>-4.396752e+08</td>
      <td>3.014081e+07</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.034559</td>
      <td>0.006943</td>
      <td>0.011439</td>
      <td>0.003445</td>
      <td>0.001</td>
      <td>{'ridge__alpha': 0.001}</td>
      <td>0.826553</td>
      <td>0.780497</td>
      <td>0.785399</td>
      <td>0.868281</td>
      <td>...</td>
      <td>-1.505592e+09</td>
      <td>7.117899e+08</td>
      <td>7</td>
      <td>-4.521578e+08</td>
      <td>-3.925288e+08</td>
      <td>-4.249618e+08</td>
      <td>-4.445124e+08</td>
      <td>-4.836880e+08</td>
      <td>-4.395697e+08</td>
      <td>3.018459e+07</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.034803</td>
      <td>0.003166</td>
      <td>0.009893</td>
      <td>0.001694</td>
      <td>0.0001</td>
      <td>{'ridge__alpha': 0.0001}</td>
      <td>0.826739</td>
      <td>0.780316</td>
      <td>0.785134</td>
      <td>0.868305</td>
      <td>...</td>
      <td>-1.506035e+09</td>
      <td>7.120769e+08</td>
      <td>8</td>
      <td>-4.521567e+08</td>
      <td>-3.925272e+08</td>
      <td>-4.249601e+08</td>
      <td>-4.445111e+08</td>
      <td>-4.836878e+08</td>
      <td>-4.395686e+08</td>
      <td>3.018507e+07</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.035842</td>
      <td>0.005237</td>
      <td>0.011238</td>
      <td>0.004693</td>
      <td>0.00001</td>
      <td>{'ridge__alpha': 1e-05}</td>
      <td>0.826758</td>
      <td>0.780298</td>
      <td>0.785108</td>
      <td>0.868308</td>
      <td>...</td>
      <td>-1.506079e+09</td>
      <td>7.121056e+08</td>
      <td>9</td>
      <td>-4.521567e+08</td>
      <td>-3.925272e+08</td>
      <td>-4.249601e+08</td>
      <td>-4.445111e+08</td>
      <td>-4.836878e+08</td>
      <td>-4.395686e+08</td>
      <td>3.018507e+07</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.035297</td>
      <td>0.003129</td>
      <td>0.013451</td>
      <td>0.003190</td>
      <td>0.000001</td>
      <td>{'ridge__alpha': 1e-06}</td>
      <td>0.826760</td>
      <td>0.780296</td>
      <td>0.785105</td>
      <td>0.868308</td>
      <td>...</td>
      <td>-1.506084e+09</td>
      <td>7.121084e+08</td>
      <td>10</td>
      <td>-4.521567e+08</td>
      <td>-3.925272e+08</td>
      <td>-4.249601e+08</td>
      <td>-4.445111e+08</td>
      <td>-4.836878e+08</td>
      <td>-4.395686e+08</td>
      <td>3.018507e+07</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.037244</td>
      <td>0.007337</td>
      <td>0.009396</td>
      <td>0.002154</td>
      <td>10000.0</td>
      <td>{'ridge__alpha': 10000.0}</td>
      <td>0.593370</td>
      <td>0.551975</td>
      <td>0.568663</td>
      <td>0.557739</td>
      <td>...</td>
      <td>-2.686348e+09</td>
      <td>3.316395e+08</td>
      <td>11</td>
      <td>-2.762093e+09</td>
      <td>-2.571901e+09</td>
      <td>-2.662541e+09</td>
      <td>-2.624450e+09</td>
      <td>-2.595569e+09</td>
      <td>-2.643311e+09</td>
      <td>6.665351e+07</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.041230</td>
      <td>0.006415</td>
      <td>0.010986</td>
      <td>0.002783</td>
      <td>100000.0</td>
      <td>{'ridge__alpha': 100000.0}</td>
      <td>0.135384</td>
      <td>0.113837</td>
      <td>0.118874</td>
      <td>0.123367</td>
      <td>...</td>
      <td>-5.442377e+09</td>
      <td>5.531116e+08</td>
      <td>12</td>
      <td>-5.629792e+09</td>
      <td>-5.271738e+09</td>
      <td>-5.379416e+09</td>
      <td>-5.342605e+09</td>
      <td>-5.498133e+09</td>
      <td>-5.424337e+09</td>
      <td>1.262079e+08</td>
    </tr>
  </tbody>
</table>
<p>12 rows × 80 columns</p>
</div></div></div>
</div>
<p>What’s the test score?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_multi</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.09503409246217502
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge_tuned</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.09503409246217502
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-regression-metrics-with-scikit-learn">
<h3>Using regression metrics with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code><a class="headerlink" href="#using-regression-metrics-with-scikit-learn" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>, you will notice that it has negative version of the metrics above (e.g., <code class="docutils literal notranslate"><span class="pre">neg_mean_squared_error</span></code>, <code class="docutils literal notranslate"><span class="pre">neg_root_mean_squared_error</span></code>).</p></li>
<li><p>The reason for this is that scores return a value to maximize, the higher the better.</p></li>
</ul>
</section>
</section>
<section id="id2">
<h2>❓❓ Questions for you<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-10-2">
<h3>iClicker Exercise 10.2<a class="headerlink" href="#iclicker-exercise-10-2" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p><strong>Select all of the following statements which are TRUE.</strong></p>
<ul class="simple">
<li><p>(A) We can use still use precision and recall for regression problems but now we have other metrics we can use as well.</p></li>
<li><p>(B) In <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> for regression problems, using <code class="docutils literal notranslate"><span class="pre">r2_score()</span></code> and <code class="docutils literal notranslate"><span class="pre">.score()</span></code> (with default values) will produce the same results.</p></li>
<li><p>(C) RMSE is always going to be non-negative.</p></li>
<li><p>(D) MSE does not directly provide the information about whether the model is underpredicting or overpredicting.</p></li>
<li><p>(E) We can pass multiple scoring metrics to <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> or <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> for regression as well as classification problems.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="what-did-we-learn-today">
<h2>What did we learn today?<a class="headerlink" href="#what-did-we-learn-today" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>House prices dataset target is price, which is numeric -&gt; regression rather than classification</p></li>
<li><p>There are corresponding versions of all the tools we used:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Ridge</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ridge</span></code> hyperparameter <code class="docutils literal notranslate"><span class="pre">alpha</span></code> is like <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> hyperparameter <code class="docutils literal notranslate"><span class="pre">C</span></code>, but opposite meaning</p></li>
<li><p>We’ll avoid <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> in this course.</p></li>
</ul>
<ul class="simple">
<li><p>Scoring metrics</p></li>
<li><p><span class="math notranslate nohighlight">\(R^2\)</span> is the default .score(), it is unitless, 0 is bad, 1 is best</p></li>
<li><p>MSE (mean squared error) is in units of target squared, hard to interpret; 0 is best</p></li>
<li><p>RMSE (root mean squared error) is in the same units as the target; 0 is best</p></li>
<li><p>MAPE (mean absolute percent error) is unitless; 0 is best, 1 is bad</p></li>
</ul>
<p><img alt="" src="../_images/eva-seeyou.png" /></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "cpsc330"
        },
        kernelOptions: {
            name: "cpsc330",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'cpsc330'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="09_classification-metrics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 9: Classification metrics</p>
      </div>
    </a>
    <a class="right-next"
       href="11_ensembles.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 11: Ensembles</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-comments-on-tackling-class-imbalance">More comments on tackling class imbalance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-video">Dataset [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pandas-profiler"><code class="docutils literal notranslate"><span class="pre">pandas_profiler</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-types">Feature types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Feature types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-feature-transformations">Applying feature transformations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-preprocessed-data">Examining the preprocessed data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-possible-preprocessing">Other possible preprocessing?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-building">Model building</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummyregressor"><code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-a-linear-model-ridge">Let’s try a linear model: <code class="docutils literal notranslate"><span class="pre">Ridge</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-names-of-transformed-data">Feature names of transformed data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-alpha-hyperparameter-of-ridge">Tuning <code class="docutils literal notranslate"><span class="pre">alpha</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">Ridge</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridgecv"><code class="docutils literal notranslate"><span class="pre">RidgeCV</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-10-1">iClicker Exercise 10.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-scoring-functions">Regression scoring functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-squared-error-mse">Mean squared error (MSE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#root-mean-squared-error-or-rmse">Root mean squared error or RMSE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#r-2-not-in-detail"><span class="math notranslate nohighlight">\(R^2\)</span> (not in detail)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mape">MAPE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transforming-the-targets">Transforming the targets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#different-scoring-functions-with-cross-validate">Different scoring functions with <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-multiple-metrics-in-gridsearchcv-or-randomizedsearchcv">Using multiple metrics in <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> or <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-regression-metrics-with-scikit-learn">Using regression metrics with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-10-2">iClicker Exercise 10.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-learn-today">What did we learn today?</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>