

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 12: Feature importances and feature selection &#8212; CPSC 330 Applied Machine Learning 2023W1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/573_12_feat-importances';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/UBC-CS-logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/UBC-CS-logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Things you should know</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/README.html">CPSC 330 Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning-objectives.html">Course Learning Objectives</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_intro.html">Lecture 1: Course Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_decision-trees.html">Lecture 2: Terminology, Baselines, Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_ml-fundamentals.html">Lecture 3: Machine Learning Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_kNNs-SVM-RBF.html">Lecture 4: <span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours and SVM RBFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_preprocessing-pipelines.html">Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_column-transformer-text-feats.html">Lecture 6: <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and Text Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_linear-models.html">Lecture 7: Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_hyperparameter-optimization.html">Lecture 8: Hyperparameter Optimization and Optimization Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_classification-metrics.html">Lecture 9: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_regression-metrics.html">Lecture 10: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_ensembles.html">Lecture 11: Ensembles</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="class_demos/03_class-demo.html">Lecture 3: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/04_class-demo.html">Lecture 4: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/05-06_class-demo.html">Lectures 5 and 6: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/07_class-demo.html">Lectures 7: Class demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">Attributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSE.html">LICENSE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/573_12_feat-importances.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 12: Feature importances and feature selection</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lecture 12: Feature importances and feature selection</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-4-feature-importances-and-feature-selection">Lecture 4: Feature importances and feature selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-los">Imports and LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-identify-feature-types">Let’s identify feature types</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">Feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplefeature-correlations">SimpleFeature correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances-in-linear-models">Feature importances in linear models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-features">Ordinal features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features">Categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-numeric-features">Interpreting coefficients of numeric features</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features">Example showing how can we interpret coefficients of scaled features.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-introduction-and-motivation">Feature selection: Introduction and motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-selection">What is feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-feature-selection">Why feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-carry-out-feature-selection">How do we carry out feature selection?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-using-feature-importances">Feature selection using feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-based-feature-selection">Model-based feature selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-feature-elimination-rfe">Recursive feature elimination (RFE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-algorithm">RFE algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-and-categorical-features">Feature selection and categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-feature-selection-and-ohe">(Optional) Feature selection and OHE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-with-cross-validation-rfecv">RFE with cross-validation (RFECV)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-feature-importances"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-search-and-score-methods">(Optional) Search and score methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea-of-search-and-score-methods">General idea of search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-or-backward-selection">Forward or backward selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-ways-to-search">Other ways to search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#warnings-about-feature-selection">Warnings about feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-advice-on-finding-relevant-features">General advice on finding relevant features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-12-1">iClicker Exercise 12.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-problems-with-feature-selection">(Optional) Problems with feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-is-relevance-clearly-defined">Example: Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#is-relevance-clearly-defined">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Warnings about feature selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-resources">Relevant resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="../_images/330-banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-12-feature-importances-and-feature-selection">
<h1>Lecture 12: Feature importances and feature selection<a class="headerlink" href="#lecture-12-feature-importances-and-feature-selection" title="Permalink to this heading">#</a></h1>
<p>UBC 2023-24</p>
<p>Instructor: Varada Kolhatkar</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-4-feature-importances-and-feature-selection">
<h1>Lecture 4: Feature importances and feature selection<a class="headerlink" href="#lecture-4-feature-importances-and-feature-selection" title="Permalink to this heading">#</a></h1>
<p>UBC Master of Data Science program, 2022-23</p>
<p>Instructor: Varada Kolhatkar</p>
<section id="imports-and-los">
<h2>Imports and LOs<a class="headerlink" href="#imports-and-los" title="Permalink to this heading">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">cross_val_score</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="learning-outcomes">
<h3>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h3>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Explain the limitations of simple correlation-based approaches to identify feature importances.</p></li>
<li><p>Interpret the coefficients of linear regression, including for scaled numeric features.</p></li>
<li><p>Explain the purpose of feature selection.</p></li>
<li><p>Discuss and compare different feature selection methods at a high level.</p></li>
<li><p>Explain and use model-based feature selection.</p></li>
<li><p>Explain recursive feature elimination at a high level.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s implementation of recursive feature elimination (<code class="docutils literal notranslate"><span class="pre">RFE</span></code>).</p></li>
<li><p>Explain how RFECV (cross-validated recursive feature elimination) works.</p></li>
<li><p>Explain forward and backward feature selection at a high level.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s implementation of forward and backward selection.</p></li>
</ul>
<p>I’m using <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> in this lecture for easy heatmap plotting, which is not in the course environment. You can install it as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">conda</span> <span class="n">activate</span> <span class="n">cpsc330</span>
<span class="o">&gt;</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">anaconda</span> <span class="n">seaborn</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this heading">#</a></h2>
<p>In the first part of this lecture, we’ll be using <a class="reference external" href="https://www.kaggle.com/c/home-data-for-ml-course/">Kaggle House Prices dataset</a>, the dataset we used in lecture 10. As usual, to run this notebook you’ll need to download the data. Unzip the data into a subdirectory called <code class="docutils literal notranslate"><span class="pre">data</span></code>. For this dataset, train and test have already been separated. We’ll be working with the train portion in this lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing-kaggle/train.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>303</td>
      <td>20</td>
      <td>RL</td>
      <td>118.0</td>
      <td>13704</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>1</td>
      <td>2006</td>
      <td>WD</td>
      <td>Normal</td>
      <td>205000</td>
    </tr>
    <tr>
      <th>767</th>
      <td>768</td>
      <td>50</td>
      <td>RL</td>
      <td>75.0</td>
      <td>12508</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Shed</td>
      <td>1300</td>
      <td>7</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>160000</td>
    </tr>
    <tr>
      <th>429</th>
      <td>430</td>
      <td>20</td>
      <td>RL</td>
      <td>130.0</td>
      <td>11457</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>3</td>
      <td>2009</td>
      <td>WD</td>
      <td>Normal</td>
      <td>175000</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>1140</td>
      <td>30</td>
      <td>RL</td>
      <td>98.0</td>
      <td>8731</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>144000</td>
    </tr>
    <tr>
      <th>558</th>
      <td>559</td>
      <td>60</td>
      <td>RL</td>
      <td>57.0</td>
      <td>21872</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR2</td>
      <td>HLS</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>8</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>175000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 81 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>The prediction task is predicting <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> given features related to properties.</p></li>
<li><p>Note that the target is numeric, not categorical.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 81)
</pre></div>
</div>
</div>
</div>
<section id="let-s-separate-x-and-y">
<h3>Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code><a class="headerlink" href="#let-s-separate-x-and-y" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="let-s-identify-feature-types">
<h3>Let’s identify feature types<a class="headerlink" href="#let-s-identify-feature-types" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drop_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;BedroomAbvGr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LotFrontage&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LotArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OverallQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OverallCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YearBuilt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YearRemodAdd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MasVnrArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinSF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinSF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1stFlrSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LowQualFinSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GrLivArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FullBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HalfBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TotRmsAbvGrd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fireplaces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageYrBlt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageCars&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WoodDeckSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3SsnPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ScreenPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PoolArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MiscVal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YrSold&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ordinal_features_reg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ExterQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ExterCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HeatingQC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KitchenQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FireplaceQu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PoolQC&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Po&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fa&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ex&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># if N/A it will just impute something, per below</span>
<span class="n">ordering_ordinal_reg</span> <span class="o">=</span> <span class="p">[</span><span class="n">ordering</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
<span class="n">ordering_ordinal_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ordinal_features_oth</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;BsmtExposure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinType1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinType2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Functional&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fence&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ordering_ordinal_oth</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="s2">&quot;Mn&quot;</span><span class="p">,</span> <span class="s2">&quot;Av&quot;</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span><span class="p">,</span> <span class="s2">&quot;ALQ&quot;</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span><span class="p">,</span> <span class="s2">&quot;ALQ&quot;</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Sal&quot;</span><span class="p">,</span> <span class="s2">&quot;Sev&quot;</span><span class="p">,</span> <span class="s2">&quot;Maj2&quot;</span><span class="p">,</span> <span class="s2">&quot;Maj1&quot;</span><span class="p">,</span> <span class="s2">&quot;Mod&quot;</span><span class="p">,</span> <span class="s2">&quot;Min2&quot;</span><span class="p">,</span> <span class="s2">&quot;Min1&quot;</span><span class="p">,</span> <span class="s2">&quot;Typ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;MnWw&quot;</span><span class="p">,</span> <span class="s2">&quot;GdWo&quot;</span><span class="p">,</span> <span class="s2">&quot;MnPrv&quot;</span><span class="p">,</span> <span class="s2">&quot;GdPrv&quot;</span><span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="nb">set</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">numeric_features</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordinal_features_oth</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">drop_features</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">categorical_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;GarageType&#39;,
 &#39;GarageFinish&#39;,
 &#39;LotShape&#39;,
 &#39;Neighborhood&#39;,
 &#39;Utilities&#39;,
 &#39;RoofMatl&#39;,
 &#39;Foundation&#39;,
 &#39;CentralAir&#39;,
 &#39;SaleType&#39;,
 &#39;LandSlope&#39;,
 &#39;LotConfig&#39;,
 &#39;Condition1&#39;,
 &#39;MasVnrType&#39;,
 &#39;Heating&#39;,
 &#39;Street&#39;,
 &#39;Condition2&#39;,
 &#39;SaleCondition&#39;,
 &#39;PavedDrive&#39;,
 &#39;HouseStyle&#39;,
 &#39;Exterior2nd&#39;,
 &#39;Electrical&#39;,
 &#39;MoSold&#39;,
 &#39;MiscFeature&#39;,
 &#39;MSSubClass&#39;,
 &#39;MSZoning&#39;,
 &#39;RoofStyle&#39;,
 &#39;LandContour&#39;,
 &#39;Alley&#39;,
 &#39;Exterior1st&#39;,
 &#39;BldgType&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="n">ordinal_transformer_reg</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span>
    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ordering_ordinal_reg</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">ordinal_transformer_oth</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span>
    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ordering_ordinal_oth</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer_reg</span><span class="p">,</span> <span class="n">ordinal_features_reg</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer_oth</span><span class="p">,</span> <span class="n">ordinal_features_oth</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;drop&#39;: &#39;drop&#39;,
 &#39;pipeline-1&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;median&#39;)),
                 (&#39;standardscaler&#39;, StandardScaler())]),
 &#39;pipeline-2&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;most_frequent&#39;)),
                 (&#39;ordinalencoder&#39;,
                  OrdinalEncoder(categories=[[&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;]]))]),
 &#39;pipeline-3&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;most_frequent&#39;)),
                 (&#39;ordinalencoder&#39;,
                  OrdinalEncoder(categories=[[&#39;NA&#39;, &#39;No&#39;, &#39;Mn&#39;, &#39;Av&#39;, &#39;Gd&#39;],
                                             [&#39;NA&#39;, &#39;Unf&#39;, &#39;LwQ&#39;, &#39;Rec&#39;, &#39;BLQ&#39;,
                                              &#39;ALQ&#39;, &#39;GLQ&#39;],
                                             [&#39;NA&#39;, &#39;Unf&#39;, &#39;LwQ&#39;, &#39;Rec&#39;, &#39;BLQ&#39;,
                                              &#39;ALQ&#39;, &#39;GLQ&#39;],
                                             [&#39;Sal&#39;, &#39;Sev&#39;, &#39;Maj2&#39;, &#39;Maj1&#39;,
                                              &#39;Mod&#39;, &#39;Min2&#39;, &#39;Min1&#39;, &#39;Typ&#39;],
                                             [&#39;NA&#39;, &#39;MnWw&#39;, &#39;GdWo&#39;, &#39;MnPrv&#39;,
                                              &#39;GdPrv&#39;]]))]),
 &#39;pipeline-4&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;,
                  SimpleImputer(fill_value=&#39;missing&#39;, strategy=&#39;constant&#39;)),
                 (&#39;onehotencoder&#39;,
                  OneHotEncoder(handle_unknown=&#39;ignore&#39;, sparse=False,
                                sparse_output=False))])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-4&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_features</span> <span class="o">+</span> <span class="n">ordinal_features_reg</span> <span class="o">+</span> <span class="n">ordinal_features_oth</span> <span class="o">+</span> <span class="n">ohe_columns</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span>
<span class="p">)</span>
<span class="n">X_train_enc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>Exterior1st_Stone</th>
      <th>Exterior1st_Stucco</th>
      <th>Exterior1st_VinylSd</th>
      <th>Exterior1st_Wd Sdng</th>
      <th>Exterior1st_WdShing</th>
      <th>BldgType_1Fam</th>
      <th>BldgType_2fmCon</th>
      <th>BldgType_Duplex</th>
      <th>BldgType_Twnhs</th>
      <th>BldgType_TwnhsE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>2.312501</td>
      <td>0.381428</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.840492</td>
      <td>0.269972</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>767</th>
      <td>1.372763</td>
      <td>-0.222647</td>
      <td>0.260890</td>
      <td>0.248457</td>
      <td>-0.054669</td>
      <td>1.285467</td>
      <td>-1.026793</td>
      <td>0.016525</td>
      <td>-0.573129</td>
      <td>0.476092</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>429</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>2.885044</td>
      <td>0.131607</td>
      <td>-0.054669</td>
      <td>-0.512408</td>
      <td>0.563314</td>
      <td>0.161931</td>
      <td>-0.573129</td>
      <td>1.227559</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>1.358264</td>
      <td>-0.171468</td>
      <td>-0.773017</td>
      <td>-0.512408</td>
      <td>-1.689338</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>0.443419</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>558</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.597924</td>
      <td>1.289541</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.828332</td>
      <td>0.598149</td>
      <td>-0.573129</td>
      <td>0.354114</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1041</th>
      <td>1.372763</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>-0.127107</td>
      <td>-0.054669</td>
      <td>2.184405</td>
      <td>-0.165485</td>
      <td>0.743555</td>
      <td>0.843281</td>
      <td>-0.090231</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1122</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>-0.149788</td>
      <td>-1.491366</td>
      <td>-2.310284</td>
      <td>-0.496757</td>
      <td>-1.389065</td>
      <td>-0.573129</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>1.168244</td>
      <td>0.663680</td>
      <td>1.285467</td>
      <td>-0.099230</td>
      <td>0.888961</td>
      <td>-0.573129</td>
      <td>-0.314582</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1406</th>
      <td>-1.063173</td>
      <td>-0.222647</td>
      <td>0.022331</td>
      <td>-0.203265</td>
      <td>-0.773017</td>
      <td>1.285467</td>
      <td>0.033279</td>
      <td>1.082835</td>
      <td>-0.573129</td>
      <td>0.467379</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1389</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.454788</td>
      <td>-0.475099</td>
      <td>-0.054669</td>
      <td>0.386530</td>
      <td>-0.993666</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>-0.144686</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1314 rows × 262 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 262)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">lr_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.030300</td>
      <td>0.007789</td>
      <td>0.835749</td>
      <td>0.916722</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.026809</td>
      <td>0.007301</td>
      <td>0.810073</td>
      <td>0.919198</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.025009</td>
      <td>0.007485</td>
      <td>0.831611</td>
      <td>0.912395</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.025228</td>
      <td>0.007068</td>
      <td>0.843992</td>
      <td>0.914003</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.024789</td>
      <td>0.007052</td>
      <td>0.548831</td>
      <td>0.920462</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br><br><br></p>
</section>
</section>
<section id="feature-importances">
<h2>Feature importances<a class="headerlink" href="#feature-importances" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>How does the output depend upon the input?</p></li>
<li><p>How do the predictions change as a function of a particular feature?</p></li>
<li><p>If the model is bad interpretability does not make sense.</p></li>
</ul>
<section id="simplefeature-correlations">
<h3>SimpleFeature correlations<a class="headerlink" href="#simplefeature-correlations" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s look at the correlations between various features with other features and the target in our encoded data (first row/column).</p></li>
<li><p>In simple terms here is how you can interpret correlations between two variables <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>:</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> goes up when <span class="math notranslate nohighlight">\(X\)</span> goes up, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are positively correlated.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> goes down when <span class="math notranslate nohighlight">\(X\)</span> goes up, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are negatively correlated.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> is unchanged when <span class="math notranslate nohighlight">\(X\)</span> changes, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are uncorrelated.</p></li>
</ul>
</li>
</ul>
<p>Let’s examine the correlations among different columns, including the target column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">y_train</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7a1e89e97900a831949357b13ce92d227d2fcb48dc66361de51ac697966c2a1f.png" src="../_images/7a1e89e97900a831949357b13ce92d227d2fcb48dc66361de51ac697966c2a1f.png" />
</div>
</div>
<ul class="simple">
<li><p>We can immediately see that <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> is highly correlated with <code class="docutils literal notranslate"><span class="pre">OverallQual</span></code>.</p></li>
<li><p>This is an early hint that <code class="docutils literal notranslate"><span class="pre">OverallQual</span></code> is a useful feature in predicting <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code>.</p></li>
<li><p>However, this approach is <strong>extremely simplistic</strong>.</p>
<ul>
<li><p>It only looks at each feature in isolation.</p></li>
<li><p>It only looks at linear associations:</p>
<ul>
<li><p>What if <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> is high when <code class="docutils literal notranslate"><span class="pre">BsmtFullBath</span></code> is 2 or 3, but low when it’s 0, 1, or 4? They might seem uncorrelated.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">y_train</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0529d491f91abee291989223143db503e97ec445370b46720005608ff4e8b80c.png" src="../_images/0529d491f91abee291989223143db503e97ec445370b46720005608ff4e8b80c.png" />
</div>
</div>
<ul class="simple">
<li><p>Looking at this diagram also tells us the relationship between features.</p>
<ul>
<li><p>For example, <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> and <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> are highly correlated.</p></li>
<li><p>Do we need both of them?</p></li>
<li><p>If our model says <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> is very important and <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> is very unimportant, do we trust those values?</p></li>
<li><p>Maybe <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> only “becomes important” if <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> is removed.</p></li>
<li><p>Sometimes the opposite happens: a feature only becomes important if another feature is <em>added</em>.</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="feature-importances-in-linear-models">
<h3>Feature importances in linear models<a class="headerlink" href="#feature-importances-in-linear-models" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>With linear regression we can look at the <em>coefficients</em> for each feature.</p></li>
<li><p>Overall idea: predicted price = intercept + <span class="math notranslate nohighlight">\(\sum_i\)</span> coefficient i <span class="math notranslate nohighlight">\(\times\)</span> feature i.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the coefficients.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">lr_coefs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BedroomAbvGr</th>
      <td>-3717.542624</td>
    </tr>
    <tr>
      <th>KitchenAbvGr</th>
      <td>-4552.332671</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>-1582.710031</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>5118.035161</td>
    </tr>
    <tr>
      <th>OverallQual</th>
      <td>12498.401830</td>
    </tr>
    <tr>
      <th>OverallCond</th>
      <td>4854.438906</td>
    </tr>
    <tr>
      <th>YearBuilt</th>
      <td>4234.888066</td>
    </tr>
    <tr>
      <th>YearRemodAdd</th>
      <td>317.185155</td>
    </tr>
    <tr>
      <th>MasVnrArea</th>
      <td>5253.253432</td>
    </tr>
    <tr>
      <th>BsmtFinSF1</th>
      <td>3681.749118</td>
    </tr>
    <tr>
      <th>BsmtFinSF2</th>
      <td>581.237935</td>
    </tr>
    <tr>
      <th>BsmtUnfSF</th>
      <td>-1273.072243</td>
    </tr>
    <tr>
      <th>TotalBsmtSF</th>
      <td>2759.043319</td>
    </tr>
    <tr>
      <th>1stFlrSF</th>
      <td>6744.462545</td>
    </tr>
    <tr>
      <th>2ndFlrSF</th>
      <td>13407.646050</td>
    </tr>
    <tr>
      <th>LowQualFinSF</th>
      <td>-447.627722</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>15992.080694</td>
    </tr>
    <tr>
      <th>BsmtFullBath</th>
      <td>2305.121599</td>
    </tr>
    <tr>
      <th>BsmtHalfBath</th>
      <td>500.215865</td>
    </tr>
    <tr>
      <th>FullBath</th>
      <td>2836.007434</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s try to interpret coefficients for different types of features.</p>
</section>
<section id="ordinal-features">
<h3>Ordinal features<a class="headerlink" href="#ordinal-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The ordinal features are easiest to interpret.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ExterQual&#39;, &#39;ExterCond&#39;, &#39;BsmtQual&#39;, &#39;BsmtCond&#39;, &#39;HeatingQC&#39;, &#39;KitchenQual&#39;, &#39;FireplaceQu&#39;, &#39;GarageQual&#39;, &#39;GarageCond&#39;, &#39;PoolQC&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient    4236.969653
Name: ExterQual, dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Increasing by one category of exterior quality (e.g. good -&gt; excellent) increases the predicted price by <span class="math notranslate nohighlight">\(\sim\$4195\)</span>.</p>
<ul>
<li><p>Wow, that’s a lot!</p></li>
<li><p>Remember this is just what the model has learned. It doesn’t tell us how the world works.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span><span class="p">[[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ExterQual</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Gd</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s perturb the example and change <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code> to <code class="docutils literal notranslate"><span class="pre">Ex</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ex&quot;</span>  <span class="c1"># Change Gd to Ex</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span><span class="p">[[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ExterQual</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Ex</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How does the prediction change after changing <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code> from <code class="docutils literal notranslate"><span class="pre">Gd</span></code> to <code class="docutils literal notranslate"><span class="pre">Ex</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the original example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the perturbed example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;After changing ExterQual from Gd to Ex increased the prediction by: &quot;</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction on the original example:  [224865.34161762]
Prediction on the perturbed example:  [229102.31127015]
After changing ExterQual from Gd to Ex increased the prediction by:  [4236.96965253]
</pre></div>
</div>
</div>
</div>
<p>That’s exactly the learned coefficient for <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code>!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient    4236.969653
Name: ExterQual, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>So our interpretation is correct!</p>
<ul class="simple">
<li><p>Increasing by one category of exterior quality (e.g. good -&gt; excellent) increases the predicted price by <span class="math notranslate nohighlight">\(\sim\$4195\)</span>.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="categorical-features">
<h3>Categorical features<a class="headerlink" href="#categorical-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What about the categorical features?</p></li>
<li><p>We have created a number of columns for each category with OHE and each category gets it’s own coefficient.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;GarageType&#39;, &#39;GarageFinish&#39;, &#39;LotShape&#39;, &#39;Neighborhood&#39;, &#39;Utilities&#39;, &#39;RoofMatl&#39;, &#39;Foundation&#39;, &#39;CentralAir&#39;, &#39;SaleType&#39;, &#39;LandSlope&#39;, &#39;LotConfig&#39;, &#39;Condition1&#39;, &#39;MasVnrType&#39;, &#39;Heating&#39;, &#39;Street&#39;, &#39;Condition2&#39;, &#39;SaleCondition&#39;, &#39;PavedDrive&#39;, &#39;HouseStyle&#39;, &#39;Exterior2nd&#39;, &#39;Electrical&#39;, &#39;MoSold&#39;, &#39;MiscFeature&#39;, &#39;MSSubClass&#39;, &#39;MSZoning&#39;, &#39;RoofStyle&#39;, &#39;LandContour&#39;, &#39;Alley&#39;, &#39;Exterior1st&#39;, &#39;BldgType&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs_landslope</span> <span class="o">=</span> <span class="n">lr_coefs</span><span class="p">[</span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;LandSlope&quot;</span><span class="p">)]</span>
<span class="n">lr_coefs_landslope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LandSlope_Gtl</th>
      <td>468.638169</td>
    </tr>
    <tr>
      <th>LandSlope_Mod</th>
      <td>7418.923432</td>
    </tr>
    <tr>
      <th>LandSlope_Sev</th>
      <td>-7887.561602</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>We can talk about switching from one of these categories to another by picking a “reference” category:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs_landslope</span> <span class="o">-</span> <span class="n">lr_coefs_landslope</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;LandSlope_Gtl&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LandSlope_Gtl</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>LandSlope_Mod</th>
      <td>6950.285263</td>
    </tr>
    <tr>
      <th>LandSlope_Sev</th>
      <td>-8356.199771</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>If you change the category from <code class="docutils literal notranslate"><span class="pre">LandSlope_Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">LandSlope_Mod</span></code> the prediction price goes up by <span class="math notranslate nohighlight">\(\sim\$6963\)</span></p></li>
<li><p>If you change the category from <code class="docutils literal notranslate"><span class="pre">LandSlope_Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">LandSlope_Sev</span></code> the prediction price goes down by <span class="math notranslate nohighlight">\(\sim\$8334\)</span></p></li>
</ul>
<p>Note that this might not make sense in the real world but this is what our model decided to learn given this small amount of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">one_example</span><span class="p">[[</span><span class="s1">&#39;LandSlope&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LandSlope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Gtl</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s perturb the example and change <code class="docutils literal notranslate"><span class="pre">LandSlope</span></code> to <code class="docutils literal notranslate"><span class="pre">Mod</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;LandSlope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Mod&quot;</span>  <span class="c1"># Change Gd to Ex</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span><span class="p">[[</span><span class="s2">&quot;LandSlope&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LandSlope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Mod</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How does the prediction change after changing <code class="docutils literal notranslate"><span class="pre">LandSlope</span></code> from <code class="docutils literal notranslate"><span class="pre">Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">Mod</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the original example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the perturbed example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;After changing ExterQual from Gd to Ex increased the prediction by: &quot;</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction on the original example:  [224865.34161762]
Prediction on the perturbed example:  [231815.62688064]
After changing ExterQual from Gd to Ex increased the prediction by:  [6950.28526302]
</pre></div>
</div>
</div>
</div>
<p>Our interpretation above is correct!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-191169.071745</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>-105656.864205</td>
    </tr>
    <tr>
      <th>Heating_OthW</th>
      <td>-27263.223804</td>
    </tr>
    <tr>
      <th>MSZoning_C (all)</th>
      <td>-22001.877390</td>
    </tr>
    <tr>
      <th>Exterior1st_ImStucc</th>
      <td>-19422.775311</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>PoolQC</th>
      <td>34182.041704</td>
    </tr>
    <tr>
      <th>RoofMatl_CompShg</th>
      <td>36525.193346</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>37546.996765</td>
    </tr>
    <tr>
      <th>Neighborhood_StoneBr</th>
      <td>39931.371722</td>
    </tr>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>83603.013120</td>
    </tr>
  </tbody>
</table>
<p>262 rows × 1 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>For example, the above coefficient says that “If the roof is made of clay or tile, the predicted price is \$191K less”?</p></li>
<li><p>Do we believe these interpretations??</p>
<ul>
<li><p>Do we believe this is how the predictions are being computed? Yes.</p></li>
<li><p>Do we believe that this is how the world works? No.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you did <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code> (we didn’t) then you already have a reference class, and all the values are with respect to that one. The interpretation depends on whether we did <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code>, hence the hassle.</p>
</div>
<p><br><br></p>
</section>
<section id="interpreting-coefficients-of-numeric-features">
<h3>Interpreting coefficients of numeric features<a class="headerlink" href="#interpreting-coefficients-of-numeric-features" title="Permalink to this heading">#</a></h3>
<p>Let’s look at coefficients of <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code>, <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code>, <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;PoolArea&quot;</span><span class="p">,</span> <span class="s2">&quot;LotFrontage&quot;</span><span class="p">,</span> <span class="s2">&quot;LotArea&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PoolArea</th>
      <td>2817.196385</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>-1582.710031</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>5118.035161</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Intuition:</p>
<ul class="simple">
<li><p>Tricky because numeric features are <strong>scaled</strong>!</p></li>
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code> by 1 scaled unit <strong>increases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$2822\)</span>.</p></li>
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by 1 scaled unit <strong>increases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$5109\)</span>.</p></li>
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code> by 1 scaled unit <strong>decreases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$1578\)</span>.</p></li>
</ul>
<p>Does that sound reasonable?</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code> and <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>, yes.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code>, that’s surprising. Something positive would have made more sense?</p></li>
</ul>
<p>It might be the case that <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code> is correlated with some other variable, which might have a larger positive coefficient.</p>
<p>BTW, let’s make sure the predictions behave as expected:</p>
<section id="example-showing-how-can-we-interpret-coefficients-of-scaled-features">
<h4>Example showing how can we interpret coefficients of scaled features.<a class="headerlink" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What’s one scaled unit for <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>?</p></li>
<li><p>The scaler subtracted the mean and divided by the standard deviation.</p></li>
<li><p>The division actually changed the scale!</p></li>
<li><p>For the unit conversion, we don’t care about the subtraction, but only the scaling.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-1&quot;</span><span class="p">][</span><span class="s2">&quot;standardscaler&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_scales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">var_</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">numeric_features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Scale&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">lr_scales</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BedroomAbvGr</th>
      <td>0.821040</td>
    </tr>
    <tr>
      <th>KitchenAbvGr</th>
      <td>0.218760</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>20.959139</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>8994.471032</td>
    </tr>
    <tr>
      <th>OverallQual</th>
      <td>1.392082</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>It seems like <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> was divided by 8994.471032 sqft.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LotArea</th>
      <td>5118.035161</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The coefficient tells us that if we increase the <strong>scaled</strong> <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by one scaled unit the price would go up by <span class="math notranslate nohighlight">\(\approx\$5109\)</span>.</p></li>
<li><p>One scaled unit represents <span class="math notranslate nohighlight">\(\sim 8994\)</span> sqft in the original scale.</p></li>
</ul>
<p>Let’s examine whether this behaves as expected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_ex_preprocessed</span> <span class="o">=</span> <span class="n">X_test_enc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">one_ex_preprocessed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>Exterior1st_Stone</th>
      <th>Exterior1st_Stucco</th>
      <th>Exterior1st_VinylSd</th>
      <th>Exterior1st_Wd Sdng</th>
      <th>Exterior1st_WdShing</th>
      <th>BldgType_1Fam</th>
      <th>BldgType_2fmCon</th>
      <th>BldgType_Duplex</th>
      <th>BldgType_Twnhs</th>
      <th>BldgType_TwnhsE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>-0.085415</td>
      <td>0.66368</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.792023</td>
      <td>0.438592</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 262 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orig_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_ex_preprocessed</span><span class="p">)</span>
<span class="n">orig_pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/base.py:457: UserWarning: X has feature names, but Ridge was fitted without feature names
  warnings.warn(
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([224865.34161762])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_ex_preprocessed_perturbed</span> <span class="o">=</span> <span class="n">one_ex_preprocessed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_ex_preprocessed_perturbed</span><span class="p">[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># we are adding one to the scaled LotArea</span>
<span class="n">one_ex_preprocessed_perturbed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>Exterior1st_Stone</th>
      <th>Exterior1st_Stucco</th>
      <th>Exterior1st_VinylSd</th>
      <th>Exterior1st_Wd Sdng</th>
      <th>Exterior1st_WdShing</th>
      <th>BldgType_1Fam</th>
      <th>BldgType_2fmCon</th>
      <th>BldgType_Duplex</th>
      <th>BldgType_Twnhs</th>
      <th>BldgType_TwnhsE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>0.914585</td>
      <td>0.66368</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.792023</td>
      <td>0.438592</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 262 columns</p>
</div></div></div>
</div>
<p>We are expecting an increase of $5109.35671809 in the prediction compared to the original value of <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">perturbed_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_ex_preprocessed_perturbed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/base.py:457: UserWarning: X has feature names, but Ridge was fitted without feature names
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">perturbed_pred</span> <span class="o">-</span> <span class="n">orig_pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([5118.03516073])
</pre></div>
</div>
</div>
</div>
<p>Our interpretation is correct!</p>
<ul class="simple">
<li><p>Humans find it easier to think about features in their original scale.</p></li>
<li><p>How can we interpret this coefficient in the original scale?</p></li>
<li><p>If I increase original <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by one square foot then the predicted price would go up by this amount:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">5109.356718094072</span> <span class="o">/</span> <span class="mf">8994.471032</span> <span class="c1"># Coefficient learned on the scaled features / the scaling factor for this feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5680552752814816
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>148</td>
      <td>60</td>
      <td>RL</td>
      <td>NaN</td>
      <td>9505</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 80 columns</p>
</div></div></div>
</div>
<p>Let’s perturb the example and add 1 to the <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>if we add 8994.471032 to the original LotArea, the housing price prediction should go up by the coefficient 5109.35671794.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>148</td>
      <td>60</td>
      <td>RL</td>
      <td>NaN</td>
      <td>9506</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 80 columns</p>
</div></div></div>
</div>
<p>Prediction on the original example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([224865.34161762])
</pre></div>
</div>
</div>
</div>
<p>Prediction on the perturbed example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([224865.91063776])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s the difference between predictions?</p></li>
<li><p>Does the difference make sense given the coefficient of the feature?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.56902014])
</pre></div>
</div>
</div>
</div>
<p>Yes! Our interpretation is correct.</p>
<ul class="simple">
<li><p>That said don’t read too much into these coefficients without statistical training.</p></li>
</ul>
</section>
</section>
<section id="interim-summary">
<h3>Interim summary<a class="headerlink" href="#interim-summary" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Correlation among features might make coefficients completely uninterpretable.</p></li>
<li><p>Fairly straightforward to interpret coefficients of ordinal features.</p></li>
<li><p>In categorical features, it’s often helpful to consider one category as a reference point and think about relative importance.</p></li>
<li><p>For numeric features, relative importance is meaningful after scaling.</p></li>
<li><p>You have to be careful about the scale of the feature when interpreting the coefficients.</p></li>
<li><p>Remember that explaining the model <span class="math notranslate nohighlight">\(\neq\)</span> explaining the data or explaining how the world works.</p></li>
<li><p>The coefficients tell us only about the model and they might not accurately reflect the data.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="feature-selection-introduction-and-motivation">
<h2>Feature selection: Introduction and motivation<a class="headerlink" href="#feature-selection-introduction-and-motivation" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>With so many ways to add new features, we can increase dimensionality of the data.</p></li>
<li><p>More features means more complex models, which means increasing the chance of overfitting.</p></li>
</ul>
<section id="what-is-feature-selection">
<h3>What is feature selection?<a class="headerlink" href="#what-is-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Find the features	(columns) <span class="math notranslate nohighlight">\(X\)</span> that are important for predicting	<span class="math notranslate nohighlight">\(y\)</span>, and remove the features that aren’t.</p></li>
<li><p>Given <span class="math notranslate nohighlight">\(X = \begin{bmatrix}\\  \\  \\  \end{bmatrix}\)</span> and <span class="math notranslate nohighlight">\(y = \begin{bmatrix}\\  \\  \\  \end{bmatrix}\)</span>, find the columns <span class="math notranslate nohighlight">\(1 \leq j \leq n\)</span> in <span class="math notranslate nohighlight">\(X\)</span> that are important for predicting <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
</ul>
</section>
<section id="why-feature-selection">
<h3>Why feature selection?<a class="headerlink" href="#why-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Interpretability: Models are more interpretable with fewer features. If you get the same performance with 10 features instead of 500 features, why not use the model with smaller number of features?</p></li>
<li><p>Computation: Models fit/predict faster with fewer columns.</p></li>
<li><p>Data collection: What type of new data should I collect? It may be cheaper to collect fewer columns.</p></li>
<li><p>Fundamental tradeoff: Can I reduce overfitting by removing useless features?</p></li>
</ul>
<p>Feature selection can often result in better performing (less overfit), easier to understand, and faster model.</p>
</section>
<section id="how-do-we-carry-out-feature-selection">
<h3>How do we carry out feature selection?<a class="headerlink" href="#how-do-we-carry-out-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>There are a number of ways.</p></li>
<li><p>You could use domain knowledge to discard features.</p></li>
<li><p>We are briefly going to look at a few automatic feature selection methods.</p>
<ul>
<li><p>Model-based selection</p></li>
<li><p>Recursive feature elimination</p></li>
<li><p>Forward/Backward selection</p></li>
</ul>
</li>
<li><p>Very related to looking at feature importances.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s start with the dummy model.</p>
<p>We’ll be using the user-defined function <code class="docutils literal notranslate"><span class="pre">mean_std_cross_val_scores</span></code> to keep track of the results. You can find the code of the function in <code class="docutils literal notranslate"><span class="pre">code/utils.py</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">DummyRegressor</span><span class="p">(),</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> without any feature selection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_lr</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.026 (+/- 0.001)</td>
      <td>0.008 (+/- 0.001)</td>
      <td>0.774 (+/- 0.127)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now let’s try <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code>.</p>
<p><em>We have not talked about this model yet. At this point it’s enough to know that it’s a tree-based model which is a good off-the-shelf model. We’ll be talking about it in Week 4.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;rf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.026 (+/- 0.001)</td>
      <td>0.008 (+/- 0.001)</td>
      <td>0.774 (+/- 0.127)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.630 (+/- 0.020)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.858 (+/- 0.037)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we’ll try a number of feature selection methods and compare the results with the scores above.</p>
</section>
</section>
<section id="break-5-min">
<h2>Break (5 min)<a class="headerlink" href="#break-5-min" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="../_images/eva-coffee.png" /></p>
<p><br><br><br><br></p>
</section>
<section id="feature-selection-using-feature-importances">
<h2>Feature selection using feature importances<a class="headerlink" href="#feature-selection-using-feature-importances" title="Permalink to this heading">#</a></h2>
<section id="model-based-feature-selection">
<h3>Model-based feature selection<a class="headerlink" href="#model-based-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Use a supervised machine learning model to judge the importance of each feature.</p></li>
<li><p>Keep only the most important once.</p></li>
<li><p>Supervised machine learning model used for feature selection can be different that the one used as the final estimator.</p></li>
<li><p>Use a model which has some way to calculate feature importances.</p></li>
</ul>
<p>Let’s examine the least important features according to the model (features associated with coefficients with small magnitude).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;coefficient&quot;</span><span class="p">:</span> <span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s2">&quot;magnitude&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;magnitude&quot;</span><span class="p">)</span>
<span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coefficient</th>
      <th>magnitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BsmtFinType2</th>
      <td>-8.235387</td>
      <td>8.235387</td>
    </tr>
    <tr>
      <th>SaleCondition_Alloca</th>
      <td>-14.618810</td>
      <td>14.618810</td>
    </tr>
    <tr>
      <th>GarageArea</th>
      <td>101.756286</td>
      <td>101.756286</td>
    </tr>
    <tr>
      <th>HouseStyle_SFoyer</th>
      <td>106.185037</td>
      <td>106.185037</td>
    </tr>
    <tr>
      <th>MiscFeature_missing</th>
      <td>-138.411353</td>
      <td>138.411353</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>37546.996765</td>
      <td>37546.996765</td>
    </tr>
    <tr>
      <th>Neighborhood_StoneBr</th>
      <td>39931.371722</td>
      <td>39931.371722</td>
    </tr>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>83603.013120</td>
      <td>83603.013120</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>-105656.864205</td>
      <td>105656.864205</td>
    </tr>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-191169.071745</td>
      <td>191169.071745</td>
    </tr>
  </tbody>
</table>
<p>262 rows × 2 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Seems like there are a number of features with tiny coefficients compared to other features.</p></li>
<li><p>These features are not going to have a big impact on the prediction.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coefs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;coef&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;coef != 0&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;coef&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;variable&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="c1"># coefs.style.background_gradient(&#39;PuOr&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s examine the coefficients.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="n">coefs</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; Coefficients&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;coef&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-1e41cd09b1cb457f9d6febe0e565a1d5.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-1e41cd09b1cb457f9d6febe0e565a1d5.vega-embed details,
  #altair-viz-1e41cd09b1cb457f9d6febe0e565a1d5.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-1e41cd09b1cb457f9d6febe0e565a1d5"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-1e41cd09b1cb457f9d6febe0e565a1d5") {
      outputDiv = document.getElementById("altair-viz-1e41cd09b1cb457f9d6febe0e565a1d5");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.14.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.14.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-668616aec8284084aa99f4f81b3ff275"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "coef", "type": "quantitative"}, "y": {"field": "variable", "sort": "x", "type": "nominal"}}, "title": "Ridge Coefficients", "$schema": "https://vega.github.io/schema/vega-lite/v5.14.1.json", "datasets": {"data-668616aec8284084aa99f4f81b3ff275": [{"variable": "RoofMatl_ClyTile", "coef": -191169.07174468983}, {"variable": "Condition2_PosN", "coef": -105656.86420532408}, {"variable": "Heating_OthW", "coef": -27263.223804468103}, {"variable": "MSZoning_C (all)", "coef": -22001.877389936733}, {"variable": "Exterior1st_ImStucc", "coef": -19422.775310686815}, {"variable": "LotShape_IR3", "coef": -19134.681693756535}, {"variable": "Condition1_RRAe", "coef": -18492.19114069843}, {"variable": "Neighborhood_Edwards", "coef": -17333.226634910003}, {"variable": "Utilities_NoSeWa", "coef": -15664.901413263233}, {"variable": "HouseStyle_2.5Fin", "coef": -15632.39459661555}, {"variable": "Foundation_Wood", "coef": -15431.385418713791}, {"variable": "Neighborhood_Gilbert", "coef": -15358.511971016624}, {"variable": "SaleType_COD", "coef": -14767.211521578205}, {"variable": "Neighborhood_Mitchel", "coef": -14645.98094131084}, {"variable": "LotConfig_FR3", "coef": -13943.472081149059}, {"variable": "Exterior2nd_Stucco", "coef": -13933.091064400143}, {"variable": "GarageType_2Types", "coef": -13080.143115388886}, {"variable": "MSSubClass_120", "coef": -12999.3789253294}, {"variable": "Neighborhood_NWAmes", "coef": -12651.723451516526}, {"variable": "Street_Grvl", "coef": -12137.880295200923}, {"variable": "BldgType_Twnhs", "coef": -12136.37089297016}, {"variable": "MSSubClass_160", "coef": -11458.33223141443}, {"variable": "Neighborhood_Timber", "coef": -11451.721201074499}, {"variable": "SaleType_WD", "coef": -11404.116781057159}, {"variable": "RoofStyle_Gable", "coef": -11308.000252936572}, {"variable": "Neighborhood_NAmes", "coef": -10901.237254068634}, {"variable": "Neighborhood_CollgCr", "coef": -10458.006269546046}, {"variable": "HouseStyle_2Story", "coef": -10266.34348470144}, {"variable": "SaleType_ConLw", "coef": -10210.889236022032}, {"variable": "MSSubClass_180", "coef": -9943.350969116913}, {"variable": "LandContour_Bnk", "coef": -9756.067751957564}, {"variable": "RoofStyle_Gambrel", "coef": -9396.76496937188}, {"variable": "Neighborhood_ClearCr", "coef": -9149.57657538579}, {"variable": "Condition2_RRAe", "coef": -9128.071271496117}, {"variable": "Exterior2nd_Other", "coef": -8803.885266821166}, {"variable": "MSSubClass_75", "coef": -8721.666588364373}, {"variable": "Neighborhood_MeadowV", "coef": -8663.530195297715}, {"variable": "Neighborhood_OldTown", "coef": -8541.933664781744}, {"variable": "MiscFeature_Gar2", "coef": -8418.815858799231}, {"variable": "HouseStyle_1.5Fin", "coef": -8072.75636887845}, {"variable": "LandSlope_Sev", "coef": -7887.561601882439}, {"variable": "Exterior1st_AsphShn", "coef": -7344.799788928826}, {"variable": "Exterior2nd_Wd Shng", "coef": -7324.55331037868}, {"variable": "BldgType_TwnhsE", "coef": -7087.115480058099}, {"variable": "RoofStyle_Hip", "coef": -7059.750562077944}, {"variable": "MSSubClass_190", "coef": -7009.2001210674625}, {"variable": "MoSold_10", "coef": -6776.720245060938}, {"variable": "Exterior2nd_Stone", "coef": -6438.665484352322}, {"variable": "Electrical_SBrkr", "coef": -6084.386514769683}, {"variable": "Neighborhood_SWISU", "coef": -5960.3666685865555}, {"variable": "SaleCondition_Family", "coef": -5896.993471887925}, {"variable": "SaleCondition_Partial", "coef": -5891.519110922998}, {"variable": "Neighborhood_IDOTRR", "coef": -5714.435176181851}, {"variable": "MasVnrType_BrkCmn", "coef": -5084.190591805818}, {"variable": "Neighborhood_Sawyer", "coef": -5017.714353355886}, {"variable": "Neighborhood_SawyerW", "coef": -4970.445911516107}, {"variable": "GarageFinish_RFn", "coef": -4833.359695787075}, {"variable": "LotConfig_FR2", "coef": -4805.624102913844}, {"variable": "KitchenAbvGr", "coef": -4552.332671399602}, {"variable": "SaleType_Oth", "coef": -4165.144299029192}, {"variable": "BedroomAbvGr", "coef": -3717.542623593056}, {"variable": "Electrical_FuseF", "coef": -3617.2885245161456}, {"variable": "ExterCond", "coef": -3566.5892268694174}, {"variable": "Exterior2nd_MetalSd", "coef": -3401.839251651842}, {"variable": "Exterior1st_HdBoard", "coef": -3342.1927662735216}, {"variable": "MoSold_8", "coef": -3303.6891721993265}, {"variable": "MoSold_2", "coef": -3250.9858693848137}, {"variable": "Condition1_RRNe", "coef": -3079.8408579676848}, {"variable": "Condition1_Feedr", "coef": -2780.6366296664787}, {"variable": "LandContour_Low", "coef": -2738.060001347162}, {"variable": "GarageType_BuiltIn", "coef": -2715.778733642388}, {"variable": "Exterior2nd_AsphShn", "coef": -2604.310479071059}, {"variable": "Electrical_FuseA", "coef": -2443.128079400671}, {"variable": "Neighborhood_Blmngtn", "coef": -2325.91272988179}, {"variable": "MasVnrType_BrkFace", "coef": -2283.3145816204938}, {"variable": "Exterior1st_Wd Sdng", "coef": -2069.5055738265146}, {"variable": "Exterior1st_VinylSd", "coef": -2019.6413515133963}, {"variable": "Condition1_PosN", "coef": -1871.690668181204}, {"variable": "Fence", "coef": -1853.6258038085625}, {"variable": "PavedDrive_P", "coef": -1760.1813804561018}, {"variable": "GarageFinish_Unf", "coef": -1753.8966378799437}, {"variable": "MoSold_12", "coef": -1739.2841631896779}, {"variable": "Condition1_Artery", "coef": -1716.3483110072818}, {"variable": "Electrical_missing", "coef": -1649.844169349088}, {"variable": "LotFrontage", "coef": -1582.7100311648992}, {"variable": "Alley_Grvl", "coef": -1544.0160808148619}, {"variable": "MiscFeature_TenC", "coef": -1537.513669947297}, {"variable": "Foundation_BrkTil", "coef": -1501.7743182688885}, {"variable": "Exterior1st_Plywood", "coef": -1389.315034942961}, {"variable": "Exterior2nd_BrkFace", "coef": -1367.2334672595866}, {"variable": "GarageType_Attchd", "coef": -1274.4687351107123}, {"variable": "BsmtUnfSF", "coef": -1273.0722430104672}, {"variable": "Exterior1st_Stucco", "coef": -1154.1716299820403}, {"variable": "Exterior2nd_Plywood", "coef": -995.383313292351}, {"variable": "RoofStyle_Mansard", "coef": -963.0300603982312}, {"variable": "Neighborhood_Blueste", "coef": -850.5489628182296}, {"variable": "Exterior2nd_Brk Cmn", "coef": -840.1178337136499}, {"variable": "Alley_missing", "coef": -635.684511740792}, {"variable": "SaleCondition_Abnorml", "coef": -532.7611435384562}, {"variable": "GarageYrBlt", "coef": -523.3276948068726}, {"variable": "LowQualFinSF", "coef": -447.6277220310076}, {"variable": "EnclosedPorch", "coef": -390.3959354932673}, {"variable": "YrSold", "coef": -382.00870708877886}, {"variable": "MSSubClass_40", "coef": -328.06469839129676}, {"variable": "Neighborhood_BrkSide", "coef": -302.77771154517944}, {"variable": "CentralAir_N", "coef": -301.552535789223}, {"variable": "MiscFeature_missing", "coef": -138.41135318653284}, {"variable": "SaleCondition_Alloca", "coef": -14.61881013012085}, {"variable": "BsmtFinType2", "coef": -8.235386515751845}, {"variable": "GarageArea", "coef": 101.75628642816328}, {"variable": "HouseStyle_SFoyer", "coef": 106.18503688859111}, {"variable": "OpenPorchSF", "coef": 207.68502907127623}, {"variable": "MiscVal", "coef": 260.095668881491}, {"variable": "BsmtCond", "coef": 264.2144313115591}, {"variable": "Exterior1st_BrkComm", "coef": 265.4593034690416}, {"variable": "CentralAir_Y", "coef": 301.552535786405}, {"variable": "YearRemodAdd", "coef": 317.18515497468184}, {"variable": "MSSubClass_85", "coef": 395.9029965521925}, {"variable": "LandSlope_Gtl", "coef": 468.6381694331784}, {"variable": "PavedDrive_N", "coef": 474.76907571990927}, {"variable": "MoSold_6", "coef": 486.1409311444875}, {"variable": "Exterior2nd_AsbShng", "coef": 489.8083461283861}, {"variable": "BsmtHalfBath", "coef": 500.2158652099991}, {"variable": "GarageCond", "coef": 501.2880010328541}, {"variable": "SaleType_ConLI", "coef": 535.1173432911357}, {"variable": "BsmtFinSF2", "coef": 581.2379346817726}, {"variable": "HeatingQC", "coef": 635.0931402366169}, {"variable": "MiscFeature_Shed", "coef": 700.4216559893871}, {"variable": "MoSold_9", "coef": 703.1977656585346}, {"variable": "FireplaceQu", "coef": 779.1923609660688}, {"variable": "GarageType_Detchd", "coef": 929.2682078407432}, {"variable": "BsmtFinType1", "coef": 1019.1201789036885}, {"variable": "MoSold_11", "coef": 1025.7001721964712}, {"variable": "WoodDeckSF", "coef": 1136.3155520227278}, {"variable": "PavedDrive_Y", "coef": 1285.4123047329126}, {"variable": "LandContour_Lvl", "coef": 1451.6903649052822}, {"variable": "GarageType_CarPort", "coef": 1505.4434884568104}, {"variable": "Exterior2nd_HdBoard", "coef": 1511.2476422985565}, {"variable": "3SsnPorch", "coef": 1523.892444539871}, {"variable": "MoSold_1", "coef": 1612.3261835958874}, {"variable": "GarageFinish_Fin", "coef": 1647.220655187036}, {"variable": "HalfBath", "coef": 1759.778859441992}, {"variable": "ScreenPorch", "coef": 1794.8079036283495}, {"variable": "MoSold_4", "coef": 1815.461296020852}, {"variable": "MSZoning_RM", "coef": 2012.9761510367948}, {"variable": "MSSubClass_45", "coef": 2157.1695365540845}, {"variable": "Alley_Pave", "coef": 2179.7005925600365}, {"variable": "Exterior1st_WdShing", "coef": 2202.448502505412}, {"variable": "Heating_Floor", "coef": 2205.7775811094875}, {"variable": "Exterior2nd_Wd Sdng", "coef": 2246.591398675128}, {"variable": "Fireplaces", "coef": 2282.783388980116}, {"variable": "BsmtFullBath", "coef": 2305.121599409851}, {"variable": "HouseStyle_SLvl", "coef": 2390.8255260597657}, {"variable": "Exterior1st_Stone", "coef": 2531.2338227794426}, {"variable": "MoSold_3", "coef": 2544.1460911690647}, {"variable": "TotalBsmtSF", "coef": 2759.0433191048814}, {"variable": "PoolArea", "coef": 2817.1963846286903}, {"variable": "FullBath", "coef": 2836.00743352105}, {"variable": "LotConfig_Inside", "coef": 2896.406849934316}, {"variable": "LotConfig_Corner", "coef": 3006.245631328558}, {"variable": "MasVnrType_Stone", "coef": 3209.0947791404924}, {"variable": "MoSold_7", "coef": 3213.1725023050717}, {"variable": "Foundation_CBlock", "coef": 3230.3373921510824}, {"variable": "Exterior1st_CBlock", "coef": 3299.9007125296607}, {"variable": "Exterior2nd_CBlock", "coef": 3299.900712529679}, {"variable": "LotShape_IR1", "coef": 3419.9085664709246}, {"variable": "Neighborhood_Somerst", "coef": 3614.0805841478295}, {"variable": "Exterior1st_CemntBd", "coef": 3629.5545063462137}, {"variable": "MoSold_5", "coef": 3670.5345077401716}, {"variable": "BsmtFinSF1", "coef": 3681.7491180160428}, {"variable": "Foundation_PConc", "coef": 3769.817726837674}, {"variable": "BldgType_1Fam", "coef": 3944.719052135667}, {"variable": "Condition1_RRNn", "coef": 4049.661234836103}, {"variable": "Exterior2nd_VinylSd", "coef": 4105.2799991933725}, {"variable": "MasVnrType_missing", "coef": 4158.410394289684}, {"variable": "MSSubClass_80", "coef": 4230.149090073648}, {"variable": "YearBuilt", "coef": 4234.888066281127}, {"variable": "ExterQual", "coef": 4236.96965253247}, {"variable": "Electrical_Mix", "coef": 4293.7241907739235}, {"variable": "Foundation_Stone", "coef": 4411.664021648898}, {"variable": "TotRmsAbvGrd", "coef": 4466.022287539251}, {"variable": "BldgType_Duplex", "coef": 4516.1926198054225}, {"variable": "MSSubClass_90", "coef": 4516.192619807067}, {"variable": "GarageQual", "coef": 4633.751184788737}, {"variable": "HouseStyle_2.5Unf", "coef": 4648.208471240836}, {"variable": "SaleCondition_Normal", "coef": 4790.538779619616}, {"variable": "Heating_GasW", "coef": 4832.085666656957}, {"variable": "Functional", "coef": 4853.69387551617}, {"variable": "OverallCond", "coef": 4854.438905726671}, {"variable": "GarageType_missing", "coef": 4940.035678482757}, {"variable": "GarageFinish_missing", "coef": 4940.035678483285}, {"variable": "LotArea", "coef": 5118.035160726029}, {"variable": "Condition1_PosA", "coef": 5131.105534083273}, {"variable": "Exterior1st_AsbShng", "coef": 5136.4468929206205}, {"variable": "LotShape_Reg", "coef": 5200.046701139543}, {"variable": "Heating_Grav", "coef": 5206.635745498498}, {"variable": "MasVnrArea", "coef": 5253.253432086253}, {"variable": "Foundation_Slab", "coef": 5521.340596344897}, {"variable": "BsmtExposure", "coef": 5602.786721939819}, {"variable": "Neighborhood_Veenker", "coef": 5786.179398938002}, {"variable": "MSSubClass_20", "coef": 5969.333248777459}, {"variable": "MSZoning_RL", "coef": 6047.949761681876}, {"variable": "Heating_GasA", "coef": 6141.518469371522}, {"variable": "MSSubClass_60", "coef": 6231.346634226495}, {"variable": "MSSubClass_30", "coef": 6517.123432863829}, {"variable": "KitchenQual", "coef": 6626.334642134442}, {"variable": "1stFlrSF", "coef": 6744.462544573747}, {"variable": "MSZoning_RH", "coef": 6906.150927338395}, {"variable": "BsmtQual", "coef": 6945.023017257185}, {"variable": "MSZoning_FV", "coef": 7034.800549904047}, {"variable": "Exterior1st_MetalSd", "coef": 7179.813186499359}, {"variable": "GarageCars", "coef": 7312.41251326517}, {"variable": "LandSlope_Mod", "coef": 7418.923432457184}, {"variable": "RoofMatl_Tar&Grv", "coef": 7472.836324371109}, {"variable": "SaleCondition_AdjLand", "coef": 7545.353756884005}, {"variable": "SaleType_CWD", "coef": 7651.857751110355}, {"variable": "Neighborhood_Crawfor", "coef": 8563.055911597261}, {"variable": "MSSubClass_70", "coef": 8627.582447116014}, {"variable": "SaleType_Con", "coef": 8795.987714887613}, {"variable": "Heating_Wall", "coef": 8877.20634182848}, {"variable": "RoofMatl_Roll", "coef": 8950.826729115175}, {"variable": "Condition1_RRAn", "coef": 9165.683851249407}, {"variable": "Neighborhood_BrDale", "coef": 9193.411473026008}, {"variable": "MiscFeature_Othr", "coef": 9394.31922594002}, {"variable": "Electrical_FuseP", "coef": 9500.923097258787}, {"variable": "Condition1_Norm", "coef": 9594.256987354967}, {"variable": "GarageType_Basment", "coef": 9695.643209347625}, {"variable": "Exterior2nd_CmentBd", "coef": 9869.781912221837}, {"variable": "LotShape_IR2", "coef": 10514.726426152742}, {"variable": "BldgType_2fmCon", "coef": 10762.574701079113}, {"variable": "Neighborhood_NPkVill", "coef": 10774.639898712896}, {"variable": "LandContour_HLS", "coef": 11042.437388406039}, {"variable": "SaleType_ConLD", "coef": 11336.859010565779}, {"variable": "MSSubClass_50", "coef": 11815.193527708683}, {"variable": "Street_Pave", "coef": 12137.880295200957}, {"variable": "SaleType_New", "coef": 12227.540017830564}, {"variable": "Exterior1st_BrkFace", "coef": 12497.544529098872}, {"variable": "OverallQual", "coef": 12498.401830389665}, {"variable": "HouseStyle_1Story", "coef": 12815.860857744747}, {"variable": "LotConfig_CulDSac", "coef": 12846.44370280755}, {"variable": "Condition2_RRAn", "coef": 13010.791096792618}, {"variable": "RoofMatl_WdShake", "coef": 13300.600713643667}, {"variable": "2ndFlrSF", "coef": 13407.646049594578}, {"variable": "RoofStyle_Flat", "coef": 13634.261100408037}, {"variable": "HouseStyle_1.5Unf", "coef": 14010.41455826622}, {"variable": "Condition2_Norm", "coef": 14179.433146805586}, {"variable": "RoofStyle_Shed", "coef": 15093.284744367442}, {"variable": "Utilities_AllPub", "coef": 15664.901413263107}, {"variable": "GrLivArea", "coef": 15992.080694314101}, {"variable": "Condition2_RRNn", "coef": 16035.045246925803}, {"variable": "RoofMatl_Metal", "coef": 16781.61783767643}, {"variable": "Condition2_Feedr", "coef": 18355.584270252275}, {"variable": "Condition2_Artery", "coef": 21006.272031361943}, {"variable": "Exterior2nd_ImStucc", "coef": 24186.46945991518}, {"variable": "RoofMatl_Membran", "coef": 24534.98367435535}, {"variable": "Neighborhood_NoRidge", "coef": 28887.913919559498}, {"variable": "Condition2_PosA", "coef": 32197.809684683078}, {"variable": "PoolQC", "coef": 34182.04170390881}, {"variable": "RoofMatl_CompShg", "coef": 36525.1933455644}, {"variable": "Neighborhood_NridgHt", "coef": 37546.99676466147}, {"variable": "Neighborhood_StoneBr", "coef": 39931.371722134856}, {"variable": "RoofMatl_WdShngl", "coef": 83603.01311995997}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<ul class="simple">
<li><p>How about getting rid of some of these features?</p>
<ul>
<li><p>That’s the idea of Model-based feature selection.</p></li>
</ul>
</li>
<li><p>How do we use model-based selection?</p>
<ul>
<li><p>Decide a threshold.</p></li>
<li><p>Discard all features whose feature importances / coefficients are smaller than the threshold.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>To use model-based selection, we use <code class="docutils literal notranslate"><span class="pre">SelectFromModel</span></code> transformer.</p></li>
<li><p>It selects features which have the feature importances greater than the provided threshold.</p></li>
<li><p>Below I’m using <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> for feature selection with threshold “median” of feature importances.</p></li>
<li><p>Approximately how many features will be selected?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectFromModel</span>

<span class="n">select_lr</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can put the feature selection transformer in a pipeline.</p></li>
<li><p>Should we put it before preprocessing or after preprocessing?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">select_lr</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>  <span class="c1"># Feature selection with Ridge and final estimator is RandomForestRegressor</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;model_based_fs + rf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf_model_based</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.026 (+/- 0.001)</td>
      <td>0.008 (+/- 0.001)</td>
      <td>0.774 (+/- 0.127)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.630 (+/- 0.020)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.858 (+/- 0.037)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.714 (+/- 0.085)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.843 (+/- 0.037)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>How many features were passed to feature selection?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;selectfrommodel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">n_features_in_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>262
</pre></div>
</div>
</div>
</div>
<p>What’s the threshold used for feature selection?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;selectfrommodel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">threshold_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4843.526785651622
</pre></div>
</div>
</div>
</div>
<p>How many and which features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_selected_feature_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
    <span class="c1"># visualize the mask. yellow is True, blue is False</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Feature index&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(());</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_based_mask</span> <span class="o">=</span> <span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;selectfrommodel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">model_based_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/118f3cec7e5915e8d660d593c5b5c85eb9595d9731849242637a44adfc69920c.png" src="../_images/118f3cec7e5915e8d660d593c5b5c85eb9595d9731849242637a44adfc69920c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mb_selected_feats</span> <span class="o">=</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">model_based_mask</span><span class="p">]</span>
<span class="n">mb_selected_feats</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(131,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coefficient</th>
      <th>magnitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BsmtFinType2</th>
      <td>-8.235387</td>
      <td>8.235387</td>
    </tr>
    <tr>
      <th>SaleCondition_Alloca</th>
      <td>-14.618810</td>
      <td>14.618810</td>
    </tr>
    <tr>
      <th>GarageArea</th>
      <td>101.756286</td>
      <td>101.756286</td>
    </tr>
    <tr>
      <th>HouseStyle_SFoyer</th>
      <td>106.185037</td>
      <td>106.185037</td>
    </tr>
    <tr>
      <th>MiscFeature_missing</th>
      <td>-138.411353</td>
      <td>138.411353</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>37546.996765</td>
      <td>37546.996765</td>
    </tr>
    <tr>
      <th>Neighborhood_StoneBr</th>
      <td>39931.371722</td>
      <td>39931.371722</td>
    </tr>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>83603.013120</td>
      <td>83603.013120</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>-105656.864205</td>
      <td>105656.864205</td>
    </tr>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-191169.071745</td>
      <td>191169.071745</td>
    </tr>
  </tbody>
</table>
<p>262 rows × 2 columns</p>
</div></div></div>
</div>
<p>BsmtFinType2 feature with a coefficient of smallest magnitude is not selected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;BsmtFinType2&quot;</span> <span class="ow">in</span> <span class="n">mb_selected_feats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>About half of the features are selected because our threshold is median.</p></li>
<li><p>We are getting similar results using only half of the features, i.e., with 132 features instead of 263 features!!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.026 (+/- 0.001)</td>
      <td>0.008 (+/- 0.001)</td>
      <td>0.774 (+/- 0.127)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.630 (+/- 0.020)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.858 (+/- 0.037)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.714 (+/- 0.085)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.843 (+/- 0.037)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</section>
<section id="recursive-feature-elimination-rfe">
<h3>Recursive feature elimination (RFE)<a class="headerlink" href="#recursive-feature-elimination-rfe" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Similar to model-based selection,</p></li>
<li><p>Based on feature importances</p></li>
<li><p>But it’s different in the sense that it <strong>iteratively</strong> eliminates unimportant features.</p></li>
<li><p>It builds a series of models. At each iteration, discards the least important feature according to the model.</p></li>
<li><p>Computationally expensive</p></li>
</ul>
</section>
<section id="rfe-algorithm">
<h3>RFE algorithm<a class="headerlink" href="#rfe-algorithm" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Decide the number of features to select.</p></li>
<li><p><strong>Assign</strong> importances to features, e.g. by fitting a model and looking at <code class="docutils literal notranslate"><span class="pre">coef_</span></code> or <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code>.</p></li>
<li><p><strong>Remove</strong> the least important feature.</p></li>
<li><p><strong>Repeat</strong> steps 2-3 until only <span class="math notranslate nohighlight">\(k\)</span> features are remaining.</p></li>
</ol>
<p>Note that this is <strong>not</strong> the same as just removing all the less important features in one shot!</p>
<p>How do we use it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">RFE</span>

<span class="n">rfe</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>

<span class="n">pipe_rf_rfe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">rfe</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;rfe + rfe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf_rfe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.026 (+/- 0.001)</td>
      <td>0.008 (+/- 0.001)</td>
      <td>0.774 (+/- 0.127)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.630 (+/- 0.020)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.858 (+/- 0.037)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.714 (+/- 0.085)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.843 (+/- 0.037)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>rfe + rfe</th>
      <td>1.105 (+/- 0.067)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.863 (+/- 0.034)</td>
      <td>0.980 (+/- 0.002)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Slightly better results with less features!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>How many features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">n_features_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>120
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s the ranking of the selected features?</p></li>
<li><p>Selected features have a rank of 1.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ranking_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 25,  19,  79,   1,   1,   1,   1, 132,   1,  37, 115,   1,   1,
         1,   1, 123,   1,  63, 122,  67,  85,  24,  58, 125,   1, 141,
        94, 138, 128,  81,  78,  53, 134, 130,   5,  52,   1, 136, 114,
         1, 113,  35, 106,   1,   1,  95, 143,  12,  83,   1,  68,   2,
        55,  36, 108,   1,   1,  49,  86,   1,   7,   1,   1,   6,  65,
        91,   1, 135,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
         1,   1,   1,   1,  27,   1,   1,  57,   1,   1,  40,   1,   1,
         1,   1,   1,   1,   1,   1,   1,   1,  92,  17,  16,  21,  41,
         1, 126, 133,   1,   1,   1,   1, 121,  18,   1,  54,  15, 120,
         1,   1,  73,   1,   1,   1,  72,  60,  59,   1,   4,  62,   1,
         1,  88,   1,  47,  76,   3,   1,  93,  31,  32,  33,   1,   1,
         1,   1,   1,   1,   1,   1,   1,   1,   1,   1, 116,   1, 142,
         1,  30,  14, 127,  43,  87,   1,   1,   1,   1,  44,   1, 140,
        61, 131,  96, 101, 103,  48,   1,  89,   1,  22,   1, 102,   1,
         1,  46,  50,   1,  71,  66,   1,  34,  42,  77, 104,   8,  80,
       105,  69, 119,  70,   9, 118,   1, 117,  38,   1,  10, 107, 109,
       139,   1,   1, 124,  82,   1,   1,   1,  45,   1, 129,  39,   1,
         1,   1,   1,   1,   1,  28,  26,  84,   1,   1,   1,   1, 112,
         1,   1,   1,   1,  75, 110,  51, 111,  29,   1, 137,   1,  56,
        11,  90,   1,  13,  97,  74, 100,  98,  99,  23,  64,   1,  20,
         1,   1])
</pre></div>
</div>
</div>
</div>
<p>What features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfe_mask</span> <span class="o">=</span> <span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">rfe_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6c336ab989dba4b3466554b2b322a3962dd8f6c97207f8bf42e8760e536249e1.png" src="../_images/6c336ab989dba4b3466554b2b322a3962dd8f6c97207f8bf42e8760e536249e1.png" />
</div>
</div>
<ul class="simple">
<li><p>Let’s compare the selected features with features selected with model-based selection.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">model_based_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/118f3cec7e5915e8d660d593c5b5c85eb9595d9731849242637a44adfc69920c.png" src="../_images/118f3cec7e5915e8d660d593c5b5c85eb9595d9731849242637a44adfc69920c.png" />
</div>
</div>
<p>It seems like there is some overlap between selected features between the two methods but they are not exactly the same.</p>
</section>
<section id="feature-selection-and-categorical-features">
<h3>Feature selection and categorical features<a class="headerlink" href="#feature-selection-and-categorical-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What about categorical features?</p></li>
<li><p>What if it removes one of the one-hot encoded feature and keeps other columns?</p></li>
<li><p>Does it make sense?</p></li>
<li><p>This seems to be unresolved in sklearn: https://github.com/scikit-learn/scikit-learn/issues/8480</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;BldgType&quot;</span><span class="p">)</span>
<span class="p">]</span>  <span class="c1"># All OHE features for the BldgType categorical feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;BldgType_1Fam&#39;,
 &#39;BldgType_2fmCon&#39;,
 &#39;BldgType_Duplex&#39;,
 &#39;BldgType_Twnhs&#39;,
 &#39;BldgType_TwnhsE&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">removed_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">rfe_mask</span><span class="p">]</span>
<span class="p">]</span>
<span class="p">[</span>
    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">removed_columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;BldgType&quot;</span><span class="p">)</span>
<span class="p">]</span>  <span class="c1"># removed features for the BldgType categorical feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;BldgType_1Fam&#39;, &#39;BldgType_Duplex&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-feature-selection-and-ohe">
<h3>(Optional) Feature selection and OHE<a class="headerlink" href="#optional-feature-selection-and-ohe" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>If you are using OHE with <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code>, and then feature selection, the choice to drop the first is no longer arbitrary.</p>
<ul>
<li><p>Say you have categories A,B,C,D</p></li>
<li><p>you drop=’first’</p></li>
<li><p>so then you have B,C,D and 0,0,0 means A.</p></li>
<li><p>Then you feature select out D</p></li>
<li><p>Now you have B,C</p></li>
<li><p>but now 0,0 means A or D.</p></li>
<li><p>So now the feature removed by feature selection becomes mixed up with the “arbitrary” feature A.</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="rfe-with-cross-validation-rfecv">
<h3>RFE with cross-validation (RFECV)<a class="headerlink" href="#rfe-with-cross-validation-rfecv" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We arbitrarily picked 120 features before.</p></li>
<li><p>How do we know what value to pass to <code class="docutils literal notranslate"><span class="pre">n_features_to_select</span></code>?</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">RFECV</span></code> which uses cross-validation to select number of features.</p></li>
<li><p>Slow because there is cross validation within cross validation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">RFECV</span>

<span class="n">rfecv</span> <span class="o">=</span> <span class="n">RFECV</span><span class="p">(</span><span class="n">Ridge</span><span class="p">())</span>

<span class="n">pipe_rf_rfecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">rfecv</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfecv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;LotConfig&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;MasVnrType&#x27;, &#x27;Heating&#x27;,
                                                   &#x27;Street&#x27;, &#x27;Condition2&#x27;,
                                                   &#x27;SaleCondition&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;Exterior2nd&#x27;, &#x27;Electrical&#x27;,
                                                   &#x27;MoSold&#x27;, &#x27;MiscFeature&#x27;,
                                                   &#x27;MSSubClass&#x27;, &#x27;MSZoning&#x27;,
                                                   &#x27;RoofStyle&#x27;, &#x27;LandContour&#x27;,
                                                   &#x27;Alley&#x27;, &#x27;Exterior1st&#x27;,
                                                   &#x27;BldgType&#x27;])])),
                (&#x27;rfecv&#x27;, RFECV(estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;LotConfig&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;MasVnrType&#x27;, &#x27;Heating&#x27;,
                                                   &#x27;Street&#x27;, &#x27;Condition2&#x27;,
                                                   &#x27;SaleCondition&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;Exterior2nd&#x27;, &#x27;Electrical&#x27;,
                                                   &#x27;MoSold&#x27;, &#x27;MiscFeature&#x27;,
                                                   &#x27;MSSubClass&#x27;, &#x27;MSZoning&#x27;,
                                                   &#x27;RoofStyle&#x27;, &#x27;LandContour&#x27;,
                                                   &#x27;Alley&#x27;, &#x27;Exterior1st&#x27;,
                                                   &#x27;BldgType&#x27;])])),
                (&#x27;rfecv&#x27;, RFECV(estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                (&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;,
                                  &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                  &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;,
                                  &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;,
                                  &#x27;TotalBsmtSF&#x27;, &#x27;...
                                 [&#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LotShape&#x27;,
                                  &#x27;Neighborhood&#x27;, &#x27;Utilities&#x27;, &#x27;RoofMatl&#x27;,
                                  &#x27;Foundation&#x27;, &#x27;CentralAir&#x27;, &#x27;SaleType&#x27;,
                                  &#x27;LandSlope&#x27;, &#x27;LotConfig&#x27;, &#x27;Condition1&#x27;,
                                  &#x27;MasVnrType&#x27;, &#x27;Heating&#x27;, &#x27;Street&#x27;,
                                  &#x27;Condition2&#x27;, &#x27;SaleCondition&#x27;, &#x27;PavedDrive&#x27;,
                                  &#x27;HouseStyle&#x27;, &#x27;Exterior2nd&#x27;, &#x27;Electrical&#x27;,
                                  &#x27;MoSold&#x27;, &#x27;MiscFeature&#x27;, &#x27;MSSubClass&#x27;,
                                  &#x27;MSZoning&#x27;, &#x27;RoofStyle&#x27;, &#x27;LandContour&#x27;,
                                  &#x27;Alley&#x27;, &#x27;Exterior1st&#x27;, &#x27;BldgType&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;Id&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;, &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;, &#x27;TotalBsmtSF&#x27;, &#x27;1stFlrSF&#x27;, &#x27;2ndFlrSF&#x27;, &#x27;LowQualFinSF&#x27;, &#x27;GrLivArea&#x27;, &#x27;BsmtFullBath&#x27;, &#x27;BsmtHalfBath&#x27;, &#x27;FullBath&#x27;, &#x27;HalfBath&#x27;, &#x27;TotRmsAbvGrd&#x27;, &#x27;Fireplaces&#x27;, &#x27;GarageYrBlt&#x27;, &#x27;GarageCars&#x27;, &#x27;GarageArea&#x27;, &#x27;WoodDeckSF&#x27;, &#x27;OpenPorchSF&#x27;, &#x27;EnclosedPorch&#x27;, &#x27;3SsnPorch&#x27;, &#x27;ScreenPorch&#x27;, &#x27;PoolArea&#x27;, &#x27;MiscVal&#x27;, &#x27;YrSold&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;ExterQual&#x27;, &#x27;ExterCond&#x27;, &#x27;BsmtQual&#x27;, &#x27;BsmtCond&#x27;, &#x27;HeatingQC&#x27;, &#x27;KitchenQual&#x27;, &#x27;FireplaceQu&#x27;, &#x27;GarageQual&#x27;, &#x27;GarageCond&#x27;, &#x27;PoolQC&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-3</label><div class="sk-toggleable__content"><pre>[&#x27;BsmtExposure&#x27;, &#x27;BsmtFinType1&#x27;, &#x27;BsmtFinType2&#x27;, &#x27;Functional&#x27;, &#x27;Fence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;NA&#x27;, &#x27;No&#x27;, &#x27;Mn&#x27;, &#x27;Av&#x27;, &#x27;Gd&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;Sal&#x27;, &#x27;Sev&#x27;, &#x27;Maj2&#x27;, &#x27;Maj1&#x27;, &#x27;Mod&#x27;, &#x27;Min2&#x27;, &#x27;Min1&#x27;,
                            &#x27;Typ&#x27;],
                           [&#x27;NA&#x27;, &#x27;MnWw&#x27;, &#x27;GdWo&#x27;, &#x27;MnPrv&#x27;, &#x27;GdPrv&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-4</label><div class="sk-toggleable__content"><pre>[&#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LotShape&#x27;, &#x27;Neighborhood&#x27;, &#x27;Utilities&#x27;, &#x27;RoofMatl&#x27;, &#x27;Foundation&#x27;, &#x27;CentralAir&#x27;, &#x27;SaleType&#x27;, &#x27;LandSlope&#x27;, &#x27;LotConfig&#x27;, &#x27;Condition1&#x27;, &#x27;MasVnrType&#x27;, &#x27;Heating&#x27;, &#x27;Street&#x27;, &#x27;Condition2&#x27;, &#x27;SaleCondition&#x27;, &#x27;PavedDrive&#x27;, &#x27;HouseStyle&#x27;, &#x27;Exterior2nd&#x27;, &#x27;Electrical&#x27;, &#x27;MoSold&#x27;, &#x27;MiscFeature&#x27;, &#x27;MSSubClass&#x27;, &#x27;MSZoning&#x27;, &#x27;RoofStyle&#x27;, &#x27;LandContour&#x27;, &#x27;Alley&#x27;, &#x27;Exterior1st&#x27;, &#x27;BldgType&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse=False)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">rfecv: RFECV</label><div class="sk-toggleable__content"><pre>RFECV(estimator=Ridge())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(random_state=42)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfecv_fs</span> <span class="o">=</span> <span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span>
<span class="n">rfecv_fs</span><span class="o">.</span><span class="n">n_features_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>182
</pre></div>
</div>
</div>
</div>
<p>Let’s examine the difference between the features selected by RFECV vs RFE with 120 features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fc74e62caf4e7e2971443e40e1089880ae90813ddbce35b45d3a80ea30cbcc8a.png" src="../_images/fc74e62caf4e7e2971443e40e1089880ae90813ddbce35b45d3a80ea30cbcc8a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6c336ab989dba4b3466554b2b322a3962dd8f6c97207f8bf42e8760e536249e1.png" src="../_images/6c336ab989dba4b3466554b2b322a3962dd8f6c97207f8bf42e8760e536249e1.png" />
</div>
</div>
<p>Are we improving the final scores with RFECV?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">rfecv</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;rf+rfecv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf_rfecv</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.026 (+/- 0.001)</td>
      <td>0.008 (+/- 0.001)</td>
      <td>0.774 (+/- 0.127)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.630 (+/- 0.020)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.858 (+/- 0.037)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.714 (+/- 0.085)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.843 (+/- 0.037)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>rfe + rfe</th>
      <td>1.105 (+/- 0.067)</td>
      <td>0.012 (+/- 0.000)</td>
      <td>0.863 (+/- 0.034)</td>
      <td>0.980 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>rf+rfecv</th>
      <td>3.423 (+/- 0.292)</td>
      <td>0.013 (+/- 0.001)</td>
      <td>0.845 (+/- 0.059)</td>
      <td>0.975 (+/- 0.007)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How many features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">n_features_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>182
</pre></div>
</div>
</div>
</div>
<p>Let’s examine number of features selected and corresponding cross-validation scores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_features_to_select</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Minimum number of features to consider</span>
<span class="n">pipe_rfecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">RFECV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_features_to_select</span><span class="o">=</span><span class="n">min_features_to_select</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">pipe_rfecv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">plot_cross_validated_rfe</span><span class="p">(</span><span class="n">pipe_rfecv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimal number of features : 182
</pre></div>
</div>
<img alt="../_images/94f09168e737bc1136806ce5a8d8e4a383486b51256d732cc7080cf87f1f61b5.png" src="../_images/94f09168e737bc1136806ce5a8d8e4a383486b51256d732cc7080cf87f1f61b5.png" />
</div>
</div>
<ul class="simple">
<li><p>Our model is giving us the best results at number of features = 73.</p></li>
<li><p>But in our case when we pass these 73 selected features to <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code>, which is a non-linear model, the scores get worse compared to 120 features or model-based selection. That said, we have reduced the dimensionality a lot.</p></li>
<li><p>This is similar to using cross-validation to tune a hyperparameter.</p></li>
<li><p>Indeed, the number of selected features is a hyperparameter.</p></li>
</ul>
</section>
<section id="sklearn-feature-importances">
<h3><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code><a class="headerlink" href="#sklearn-feature-importances" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Do we have to use Ridge for feature selection?</p></li>
<li><p>Many <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> models have <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code> attribute.</p></li>
<li><p>For tree-based models it’s calculated based on impurity (gini index or information gain).</p></li>
<li><p>For example, you can use <code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code> for feature selection. It will use <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code> attribute instead of coefficients.</p></li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="optional-search-and-score-methods">
<h2>(Optional) Search and score methods<a class="headerlink" href="#optional-search-and-score-methods" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Not based on feature importances.</p></li>
<li><p>Can work for models which do not have feature importances.</p></li>
<li><p>Define a <strong>scoring function</strong> <span class="math notranslate nohighlight">\(f(S)\)</span> that measures the quality of the set of features <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p>Now <strong>search</strong> for the set of features <span class="math notranslate nohighlight">\(S\)</span> with the best score.</p></li>
</ul>
<section id="general-idea-of-search-and-score-methods">
<h3>General idea of search and score methods<a class="headerlink" href="#general-idea-of-search-and-score-methods" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Example: Suppose you have three features: <span class="math notranslate nohighlight">\(A, B, C\)</span></p>
<ul>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S= \{B\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,B\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{B,C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,B,C\}\)</span></p></li>
</ul>
</li>
<li><p>Return <span class="math notranslate nohighlight">\(S\)</span> with the best score.</p></li>
<li><p>How many distinct combinations we have to try out?</p></li>
<li><p>This is intractable. So we go with greedy search methods such as forward or backward selection.</p></li>
</ul>
</section>
<section id="forward-or-backward-selection">
<h3>Forward or backward selection<a class="headerlink" href="#forward-or-backward-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Also called wrapper methods</p></li>
<li><p>Shrink or grow feature set by removing or adding one feature at a time</p></li>
<li><p>Makes the decision based on whether adding/removing the feature improves the CV score or not</p></li>
</ul>
<p>Given <span class="math notranslate nohighlight">\(X = \{x_1, x_2, \dots, x_n\}\)</span> and <span class="math notranslate nohighlight">\(y\)</span></p>
<ol class="arabic simple">
<li><p>Start with an empty set of features <span class="math notranslate nohighlight">\(S = \{\}\)</span></p></li>
<li><p>Initialize the score (e.g., score = <span class="math notranslate nohighlight">\(\infty\)</span>, if score is validation error)</p></li>
<li><p>For each possible feature <span class="math notranslate nohighlight">\(x_j, 1\leq j \leq n\)</span></p>
<ul class="simple">
<li><p>Compute the scores of features in <span class="math notranslate nohighlight">\(S\)</span> combined with <span class="math notranslate nohighlight">\(x_j\)</span></p></li>
</ul>
</li>
<li><p>If no <span class="math notranslate nohighlight">\(x_j\)</span> improves the score or desired number of selected features is reached, stop.</p></li>
<li><p>Otherwise add feature <span class="math notranslate nohighlight">\(x_j\)</span> to <span class="math notranslate nohighlight">\(S\)</span> which improves the score the most, update the score, and go back to step 2.</p></li>
</ol>
<p>How do we use these methods in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SequentialFeatureSelector</span>

<span class="n">pipe_forward</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">),</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># results[&#39;rf_forward_fs&#39;] = mean_std_cross_val_scores(pipe_forward, X_train, y_train, return_train_score=True)</span>

<span class="n">pipe_forward</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">94</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">pipe_forward</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">preprocessor</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1"># results[&#39;rf_forward_fs&#39;] = mean_std_cross_val_scores(pipe_forward, X_train, y_train, return_train_score=True)</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">pipe_forward</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/base.py:1151,</span> in <span class="ni">_fit_context.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper</span><span class="nt">(estimator, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1144</span>     <span class="n">estimator</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1146</span> <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1147</span>     <span class="n">skip_parameter_validation</span><span class="o">=</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1148</span>         <span class="n">prefer_skip_nested_validation</span> <span class="ow">or</span> <span class="n">global_skip_validation</span>
<span class="g g-Whitespace">   </span><span class="mi">1149</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1150</span> <span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1151</span>     <span class="k">return</span> <span class="n">fit_method</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/pipeline.py:416,</span> in <span class="ni">Pipeline.fit</span><span class="nt">(self, X, y, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Fit the model.</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">392</span><span class="sd"> Fit all the transformers one after the other and transform the</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">413</span><span class="sd">     Pipeline with fitted steps.</span>
<span class="g g-Whitespace">    </span><span class="mi">414</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">415</span> <span class="n">fit_params_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_fit_params</span><span class="p">(</span><span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">416</span> <span class="n">Xt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params_steps</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">417</span> <span class="k">with</span> <span class="n">_print_elapsed_time</span><span class="p">(</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_message</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_final_estimator</span> <span class="o">!=</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/pipeline.py:370,</span> in <span class="ni">Pipeline._fit</span><span class="nt">(self, X, y, **fit_params_steps)</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span>     <span class="n">cloned_transformer</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">transformer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">369</span> <span class="c1"># Fit or load from cache the current transformer</span>
<span class="ne">--&gt; </span><span class="mi">370</span> <span class="n">X</span><span class="p">,</span> <span class="n">fitted_transformer</span> <span class="o">=</span> <span class="n">fit_transform_one_cached</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">371</span>     <span class="n">cloned_transformer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span>     <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">373</span>     <span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">374</span>     <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">375</span>     <span class="n">message_clsname</span><span class="o">=</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span>     <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_message</span><span class="p">(</span><span class="n">step_idx</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">377</span>     <span class="o">**</span><span class="n">fit_params_steps</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">378</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="c1"># Replace the transformer of the step with the fitted</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span> <span class="c1"># transformer. This is necessary when loading the transformer</span>
<span class="g g-Whitespace">    </span><span class="mi">381</span> <span class="c1"># from the cache.</span>
<span class="g g-Whitespace">    </span><span class="mi">382</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fitted_transformer</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/joblib/memory.py:353,</span> in <span class="ni">NotMemorizedFunc.__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">353</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/pipeline.py:950,</span> in <span class="ni">_fit_transform_one</span><span class="nt">(transformer, X, y, weight, message_clsname, message, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">948</span> <span class="k">with</span> <span class="n">_print_elapsed_time</span><span class="p">(</span><span class="n">message_clsname</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span>     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="s2">&quot;fit_transform&quot;</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">950</span>         <span class="n">res</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">951</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span>         <span class="n">res</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/utils/_set_output.py:140,</span> in <span class="ni">_wrap_method_output.&lt;locals&gt;.wrapped</span><span class="nt">(self, X, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span> <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">140</span>     <span class="n">data_to_wrap</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_to_wrap</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span>         <span class="c1"># only wrap the first output for cross decomposition</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span>         <span class="n">return_tuple</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>             <span class="n">_wrap_data_with_container</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">data_to_wrap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span>             <span class="o">*</span><span class="n">data_to_wrap</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span>         <span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/base.py:918,</span> in <span class="ni">TransformerMixin.fit_transform</span><span class="nt">(self, X, y, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">915</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">916</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">917</span>     <span class="c1"># fit method of arity 2 (supervised transformation)</span>
<span class="ne">--&gt; </span><span class="mi">918</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/base.py:1151,</span> in <span class="ni">_fit_context.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper</span><span class="nt">(estimator, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1144</span>     <span class="n">estimator</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1146</span> <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1147</span>     <span class="n">skip_parameter_validation</span><span class="o">=</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1148</span>         <span class="n">prefer_skip_nested_validation</span> <span class="ow">or</span> <span class="n">global_skip_validation</span>
<span class="g g-Whitespace">   </span><span class="mi">1149</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1150</span> <span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1151</span>     <span class="k">return</span> <span class="n">fit_method</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/feature_selection/_sequential.py:246,</span> in <span class="ni">SequentialFeatureSelector.fit</span><span class="nt">(self, X, y)</span>
<span class="g g-Whitespace">    </span><span class="mi">244</span> <span class="n">is_auto_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_to_select</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">245</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iterations</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">246</span>     <span class="n">new_feature_idx</span><span class="p">,</span> <span class="n">new_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_best_new_feature_score</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">247</span>         <span class="n">cloned_estimator</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">current_mask</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">249</span>     <span class="k">if</span> <span class="n">is_auto_select</span> <span class="ow">and</span> <span class="p">((</span><span class="n">new_score</span> <span class="o">-</span> <span class="n">old_score</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">250</span>         <span class="k">break</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/feature_selection/_sequential.py:277,</span> in <span class="ni">SequentialFeatureSelector._get_best_new_feature_score</span><span class="nt">(self, estimator, X, y, cv, current_mask)</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span>         <span class="n">candidate_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">candidate_mask</span>
<span class="g g-Whitespace">    </span><span class="mi">276</span>     <span class="n">X_new</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">candidate_mask</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">277</span>     <span class="n">scores</span><span class="p">[</span><span class="n">feature_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">278</span>         <span class="n">estimator</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">279</span>         <span class="n">X_new</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">280</span>         <span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">281</span>         <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span>         <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span>         <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span>     <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span> <span class="n">new_feature_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">feature_idx</span><span class="p">:</span> <span class="n">scores</span><span class="p">[</span><span class="n">feature_idx</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span> <span class="k">return</span> <span class="n">new_feature_idx</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="n">new_feature_idx</span><span class="p">]</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/model_selection/_validation.py:562,</span> in <span class="ni">cross_val_score</span><span class="nt">(estimator, X, y, groups, scoring, cv, n_jobs, verbose, fit_params, pre_dispatch, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span> <span class="c1"># To ensure multimetric format is not supported</span>
<span class="g g-Whitespace">    </span><span class="mi">560</span> <span class="n">scorer</span> <span class="o">=</span> <span class="n">check_scoring</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">562</span> <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span>     <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span>     <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">565</span>     <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span>     <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span>     <span class="n">scoring</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">scorer</span><span class="p">},</span>
<span class="g g-Whitespace">    </span><span class="mi">568</span>     <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span>     <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span>     <span class="n">fit_params</span><span class="o">=</span><span class="n">fit_params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span>     <span class="n">pre_dispatch</span><span class="o">=</span><span class="n">pre_dispatch</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span>     <span class="n">error_score</span><span class="o">=</span><span class="n">error_score</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">575</span> <span class="k">return</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">]</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/utils/_param_validation.py:211,</span> in <span class="ni">validate_params.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">205</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>     <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>         <span class="n">skip_parameter_validation</span><span class="o">=</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span>             <span class="n">prefer_skip_nested_validation</span> <span class="ow">or</span> <span class="n">global_skip_validation</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span>     <span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">211</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">212</span> <span class="k">except</span> <span class="n">InvalidParameterError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">213</span>     <span class="c1"># When the function is just a wrapper around an estimator, we allow</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span>     <span class="c1"># the function to delegate validation to the estimator, but we replace</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span>     <span class="c1"># the name of the estimator by the name of the function in the error</span>
<span class="g g-Whitespace">    </span><span class="mi">216</span>     <span class="c1"># message to avoid confusion.</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span>     <span class="n">msg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span>         <span class="sa">r</span><span class="s2">&quot;parameter of \w+ must be&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>         <span class="sa">f</span><span class="s2">&quot;parameter of </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2"> must be&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>         <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>     <span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/model_selection/_validation.py:309,</span> in <span class="ni">cross_validate</span><span class="nt">(estimator, X, y, groups, scoring, cv, n_jobs, verbose, fit_params, pre_dispatch, return_train_score, return_estimator, return_indices, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">306</span> <span class="c1"># We clone the estimator to make sure that all the folds are</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="c1"># independent, and that it is pickle-able.</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span> <span class="n">parallel</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">pre_dispatch</span><span class="o">=</span><span class="n">pre_dispatch</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">309</span> <span class="n">results</span> <span class="o">=</span> <span class="n">parallel</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>     <span class="n">delayed</span><span class="p">(</span><span class="n">_fit_and_score</span><span class="p">)(</span>
<span class="g g-Whitespace">    </span><span class="mi">311</span>         <span class="n">clone</span><span class="p">(</span><span class="n">estimator</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span>         <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span>         <span class="n">scorers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">315</span>         <span class="n">train</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">316</span>         <span class="n">test</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span>         <span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span>         <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span>         <span class="n">fit_params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">320</span>         <span class="n">return_train_score</span><span class="o">=</span><span class="n">return_train_score</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span>         <span class="n">return_times</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">322</span>         <span class="n">return_estimator</span><span class="o">=</span><span class="n">return_estimator</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span>         <span class="n">error_score</span><span class="o">=</span><span class="n">error_score</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span>     <span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">indices</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span> <span class="n">_warn_or_raise_about_fit_failures</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">error_score</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span> <span class="c1"># For callable scoring, the return type is only know after calling. If the</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span> <span class="c1"># return type is a dictionary, the error scores can now be inserted with</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span> <span class="c1"># the correct key.</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/utils/parallel.py:65,</span> in <span class="ni">Parallel.__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">iterable_with_config</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>     <span class="p">(</span><span class="n">_with_config</span><span class="p">(</span><span class="n">delayed_func</span><span class="p">,</span> <span class="n">config</span><span class="p">),</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>     <span class="k">for</span> <span class="n">delayed_func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">iterable</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span> <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">65</span> <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">iterable_with_config</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/joblib/parallel.py:1863,</span> in <span class="ni">Parallel.__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1861</span>     <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sequential_output</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1862</span>     <span class="nb">next</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1863</span>     <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_generator</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1865</span> <span class="c1"># Let&#39;s create an ID that uniquely identifies the current call. If the</span>
<span class="g g-Whitespace">   </span><span class="mi">1866</span> <span class="c1"># call is interrupted early and that the same instance is immediately</span>
<span class="g g-Whitespace">   </span><span class="mi">1867</span> <span class="c1"># re-used, this id will be used to prevent workers that were</span>
<span class="g g-Whitespace">   </span><span class="mi">1868</span> <span class="c1"># concurrently finalizing a task from the previous call to run the</span>
<span class="g g-Whitespace">   </span><span class="mi">1869</span> <span class="c1"># callback.</span>
<span class="g g-Whitespace">   </span><span class="mi">1870</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/joblib/parallel.py:1792,</span> in <span class="ni">Parallel._get_sequential_output</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1790</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dispatched_batches</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="g g-Whitespace">   </span><span class="mi">1791</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dispatched_tasks</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="ne">-&gt; </span><span class="mi">1792</span> <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1793</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_completed_tasks</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="g g-Whitespace">   </span><span class="mi">1794</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_progress</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/utils/parallel.py:127,</span> in <span class="ni">_FuncWrapper.__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span> <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">127</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/model_selection/_validation.py:732,</span> in <span class="ni">_fit_and_score</span><span class="nt">(estimator, X, y, scorer, train, test, verbose, parameters, fit_params, return_train_score, return_parameters, return_n_test_samples, return_times, return_estimator, split_progress, candidate_progress, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">730</span>         <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">731</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">732</span>         <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">734</span> <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">735</span>     <span class="c1"># Note fit time as time until error</span>
<span class="g g-Whitespace">    </span><span class="mi">736</span>     <span class="n">fit_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/base.py:1151,</span> in <span class="ni">_fit_context.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper</span><span class="nt">(estimator, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1144</span>     <span class="n">estimator</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1146</span> <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1147</span>     <span class="n">skip_parameter_validation</span><span class="o">=</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1148</span>         <span class="n">prefer_skip_nested_validation</span> <span class="ow">or</span> <span class="n">global_skip_validation</span>
<span class="g g-Whitespace">   </span><span class="mi">1149</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1150</span> <span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1151</span>     <span class="k">return</span> <span class="n">fit_method</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/linear_model/_ridge.py:1142,</span> in <span class="ni">Ridge.fit</span><span class="nt">(self, X, y, sample_weight)</span>
<span class="g g-Whitespace">   </span><span class="mi">1133</span> <span class="n">_accept_sparse</span> <span class="o">=</span> <span class="n">_get_valid_accept_sparse</span><span class="p">(</span><span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1134</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_data</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1135</span>     <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1136</span>     <span class="n">y</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1140</span>     <span class="n">y_numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1141</span> <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1142</span> <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/linear_model/_ridge.py:894,</span> in <span class="ni">_BaseRidge.fit</span><span class="nt">(self, X, y, sample_weight)</span>
<span class="g g-Whitespace">    </span><span class="mi">890</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">891</span>         <span class="c1"># for dense matrices or when intercept is set to 0</span>
<span class="g g-Whitespace">    </span><span class="mi">892</span>         <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">--&gt; </span><span class="mi">894</span>     <span class="bp">self</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter_</span> <span class="o">=</span> <span class="n">_ridge_regression</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>         <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">896</span>         <span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>         <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span>         <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span>         <span class="n">max_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">900</span>         <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span>         <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">902</span>         <span class="n">positive</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">positive</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">903</span>         <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">904</span>         <span class="n">return_n_iter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">905</span>         <span class="n">return_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">906</span>         <span class="n">check_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">907</span>         <span class="n">fit_intercept</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_intercept</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>         <span class="o">**</span><span class="n">params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">910</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_set_intercept</span><span class="p">(</span><span class="n">X_offset</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">X_scale</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">912</span> <span class="k">return</span> <span class="bp">self</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/linear_model/_ridge.py:704,</span> in <span class="ni">_ridge_regression</span><span class="nt">(X, y, alpha, sample_weight, solver, max_iter, tol, verbose, positive, random_state, return_n_iter, return_intercept, X_scale, X_offset, check_input, fit_intercept)</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">704</span>         <span class="n">coef</span> <span class="o">=</span> <span class="n">_solve_cholesky</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>     <span class="k">except</span> <span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>         <span class="c1"># use SVD solver if matrix is singular</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>         <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;svd&quot;</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/sklearn/linear_model/_ridge.py:211,</span> in <span class="ni">_solve_cholesky</span><span class="nt">(X, y, alpha)</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span> <span class="k">if</span> <span class="n">one_alpha</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span>     <span class="n">A</span><span class="o">.</span><span class="n">flat</span><span class="p">[::</span> <span class="n">n_features</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">211</span>     <span class="k">return</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">Xy</span><span class="p">,</span> <span class="n">assume_a</span><span class="o">=</span><span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="n">overwrite_a</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="g g-Whitespace">    </span><span class="mi">212</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">213</span>     <span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">n_targets</span><span class="p">,</span> <span class="n">n_features</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/scipy/linalg/_basic.py:148,</span> in <span class="ni">solve</span><span class="nt">(a, b, lower, overwrite_a, overwrite_b, check_finite, assume_a, transposed)</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span> <span class="c1"># Flags for 1-D or N-D right-hand side</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span> <span class="n">b_is_1D</span> <span class="o">=</span> <span class="kc">False</span>
<span class="ne">--&gt; </span><span class="mi">148</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">atleast_2d</span><span class="p">(</span><span class="n">_asarray_validated</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">check_finite</span><span class="o">=</span><span class="n">check_finite</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">atleast_1d</span><span class="p">(</span><span class="n">_asarray_validated</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">check_finite</span><span class="o">=</span><span class="n">check_finite</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/scipy/_lib/_util.py:240,</span> in <span class="ni">_asarray_validated</span><span class="nt">(a, check_finite, sparse_ok, objects_ok, mask_ok, as_inexact)</span>
<span class="g g-Whitespace">    </span><span class="mi">238</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;masked arrays are not supported&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">239</span> <span class="n">toarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray_chkfinite</span> <span class="k">if</span> <span class="n">check_finite</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span>
<span class="ne">--&gt; </span><span class="mi">240</span> <span class="n">a</span> <span class="o">=</span> <span class="n">toarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">241</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">objects_ok</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">242</span>     <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">):</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/numpy/lib/function_base.py:629,</span> in <span class="ni">asarray_chkfinite</span><span class="nt">(a, dtype, order)</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Convert the input to an array, checking for NaNs or Infs.</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">568</span><span class="sd"> Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">627</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">628</span> <span class="n">a</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">629</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">in</span> <span class="n">typecodes</span><span class="p">[</span><span class="s1">&#39;AllFloat&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">631</span>         <span class="s2">&quot;array must not contain infs or NaNs&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">632</span> <span class="k">return</span> <span class="n">a</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/numpy/core/_methods.py:64,</span> in <span class="ni">_all</span><span class="nt">(a, axis, dtype, out, keepdims, where)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="k">def</span> <span class="nf">_all</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>     <span class="c1"># Parsing keyword arguments is currently fairly slow, so avoid it for now</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>     <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">64</span>         <span class="k">return</span> <span class="n">umr_all</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>     <span class="k">return</span> <span class="n">umr_all</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_forward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_forward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>VERY SLOW on this dataset and the scores did not improve.</p></li>
<li><p>By default it’s going to select <span class="math notranslate nohighlight">\(d/2\)</span> features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SequentialFeatureSelector</span>

<span class="n">pipe_backward</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">),</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># results[&#39;rf_backward_fs&#39;] = mean_std_cross_val_scores(pipe_forward, X_train, y_train, return_train_score=True)</span>
<span class="n">pipe_backward</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_backward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_backward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="other-ways-to-search">
<h3>Other ways to search<a class="headerlink" href="#other-ways-to-search" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Stochastic local search</p>
<ul>
<li><p>Inject randomness so that we can explore new parts of the search space</p></li>
<li><p>Simulated annealing</p></li>
<li><p>Genetic algorithms</p></li>
</ul>
</li>
</ul>
</section>
<section id="warnings-about-feature-selection">
<h3>Warnings about feature selection<a class="headerlink" href="#warnings-about-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A feature’s relevance is only defined in the context of other features.</p>
<ul>
<li><p>Adding/removing features can make features relevant/irrelevant.</p></li>
</ul>
</li>
<li><p>If features can be predicted from other features, you cannot know which one to pick.</p></li>
<li><p>Relevance for features does not have a causal relationship.</p></li>
<li><p>Don’t be overconfident.</p>
<ul>
<li><p>The methods we have seen probably do not discover the ground truth and how the world really works.</p></li>
<li><p>They simply tell you which features help in predicting <span class="math notranslate nohighlight">\(y_i\)</span> for the data you have.</p></li>
</ul>
</li>
</ul>
<section id="general-advice-on-finding-relevant-features">
<h4>General advice on finding relevant features<a class="headerlink" href="#general-advice-on-finding-relevant-features" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Try RFE, forward selection or other feature selection methods (e.g., simulated annealing, genetic algorithms)</p></li>
<li><p>Talk to domain experts; they probably have an idea why certain features are relevant.</p></li>
<li><p>Don’t be overconfident.</p>
<ul>
<li><p>The methods we have seen probably do not discover the ground truth and how the world really works.</p></li>
<li><p>They simply tell you which features help in predicting <span class="math notranslate nohighlight">\(y_i\)</span>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-12-1">
<h3>iClicker Exercise 12.1<a class="headerlink" href="#iclicker-exercise-12-1" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p><strong>Select the below.</strong></p>
<ul class="simple">
<li><p>(A) Simple association-based feature selection approaches do not take into account the interaction between features.</p></li>
<li><p>(B) You can carry out feature selection using linear models by pruning the features which have very small weights (i.e., coefficients less than a threshold).</p></li>
<li><p>(C) Forward search is guaranteed to find the best feature set.</p></li>
<li><p>(D) RFE and backward selection are basically the same.</p></li>
<li><p>(E) The order of features removed given by <code class="docutils literal notranslate"><span class="pre">rfe.ranking_</span></code> is the same as the order of original feature importances given by the model.</p></li>
</ul>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>What did we learn today?</p>
<ul class="simple">
<li><p>Feature importances</p></li>
<li><p>Limitations of correlation based methods.</p></li>
<li><p>How to interpret coefficients of different types of features</p></li>
<li><p>Why do we need feature selection?</p></li>
<li><p>Model based feature selection</p></li>
<li><p>Recursive feature elimination</p></li>
</ul>
<p><br><br><br><br></p>
<section id="optional-problems-with-feature-selection">
<h3>(Optional) Problems with feature selection<a class="headerlink" href="#optional-problems-with-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The term ‘relevance’ is not clearly defined.</p></li>
<li><p>What all things can go wrong with feature selection?</p></li>
<li><p>Attribution: From CPSC 340.</p></li>
</ul>
<section id="example-is-relevance-clearly-defined">
<h4>Example: Is “Relevance” clearly defined?<a class="headerlink" href="#example-is-relevance-clearly-defined" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Consider a supervised classification task of predicting whether someone has particular genetic variation (SNP)</p></li>
</ul>
<!-- <img src='img/sex_mom_dad.png' width="600" height="600" /> -->
<p><img alt="" src="../_images/sex_mom_dad.png" /></p>
<ul class="simple">
<li><p>True model: You almost have the same value as your biological mom.</p></li>
</ul>
</section>
<section id="is-relevance-clearly-defined">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#is-relevance-clearly-defined" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>True model: You almost have the same value for SNP as your biological mom.</p>
<ul>
<li><p>(SNP = biological mom) with very high probability</p></li>
<li><p>(SNP != biological mom) with very low probability</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/SNP.png' width="400" height="400"/> -->
<p><img alt="" src="../_images/SNP.png" /></p>
</section>
<section id="id1">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if “mom” feature is repeated?</p></li>
<li><p>Should we pick both? Should we pick one of them because it predicts the other?</p></li>
<li><p>Dependence, collinearity for linear models</p>
<ul>
<li><p>If a feature can be predicted from the other, don’t know which one to pick.</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_mom_mom2_dad.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_mom_mom2_dad.png" /></p>
</section>
<section id="id2">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if we add (maternal) “grandma” feature?</p></li>
<li><p>Is it relevant?</p>
<ul>
<li><p>We can predict SNP accurately using this feature</p></li>
</ul>
</li>
<li><p>Conditional independence</p>
<ul>
<li><p>But grandma is irrelevant given biological mom feature</p></li>
<li><p>Relevant features may become irrelevant given other features</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_mom_dad_grandma.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_mom_dad_grandma.png" /></p>
</section>
<section id="id3">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if we do not know biological mom feature and we just have grandma feature</p></li>
<li><p>It becomes relevant now.</p>
<ul>
<li><p>Without mom feature this is the best we can do.</p></li>
</ul>
</li>
<li><p>General problem (“taco Tuesday” problem)</p>
<ul>
<li><p>Features can become relevant due to missing information</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad_grandma.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad_grandma.png" /></p>
</section>
<section id="id4">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Are there any relevant features now?</p></li>
<li><p>They may have some common maternal ancestor.</p></li>
<li><p>What if mom likes dad because they share SNP?</p></li>
<li><p>General problem (Confounding)</p>
<ul>
<li><p>Hidden features can make irrelevant features relevant.</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad.png" /></p>
</section>
<section id="id5">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Now what if we have “sibling” feature?</p></li>
<li><p>The feature is relevant in predicting SNP but not the cause of SNP.</p></li>
<li><p>General problem (non causality)</p>
<ul>
<li><p>the relevant feature may not be causal</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad_sibling.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad_sibling.png" /></p>
</section>
<section id="id6">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if you are given “baby” feature?</p></li>
<li><p>Now the sex feature becomes relevant.</p>
<ul>
<li><p>“baby” feature is relevant when sex == F</p></li>
</ul>
</li>
<li><p>General problem (context specific relevance)</p>
<ul>
<li><p>adding a feature can make an irrelevant feature relevant</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad_baby.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad_baby.png" /></p>
</section>
<section id="id7">
<h4>Warnings about feature selection<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>A feature is only relevant in the context of other features.</p>
<ul>
<li><p>Adding/removing features can make features relevant/irrelevant.</p></li>
</ul>
</li>
<li><p>Confounding factors can make irrelevant features the most relevant.</p></li>
<li><p>If features can be predicted from other other features, you cannot know which one to pick.</p></li>
<li><p>Relevance for features does not have a causal relationship.</p></li>
<li><p>Is feature selection completely hopeless?</p>
<ul>
<li><p>It is messy but we still need to do it. So we try to do our best!</p></li>
</ul>
</li>
</ul>
</section>
<section id="relevant-resources">
<h4>Relevant resources<a class="headerlink" href="#relevant-resources" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Genome-wide_association_study">Genome-wide association study</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/feature_selection.html">sklearn feature selection</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=ioXKxulmwVQ">PyData: A Practical Guide to Dimensionality Reduction Techniques</a></p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "cpsc330"
        },
        kernelOptions: {
            name: "cpsc330",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'cpsc330'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Lecture 12: Feature importances and feature selection</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-4-feature-importances-and-feature-selection">Lecture 4: Feature importances and feature selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-los">Imports and LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-identify-feature-types">Let’s identify feature types</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">Feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplefeature-correlations">SimpleFeature correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances-in-linear-models">Feature importances in linear models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-features">Ordinal features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features">Categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-numeric-features">Interpreting coefficients of numeric features</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features">Example showing how can we interpret coefficients of scaled features.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-introduction-and-motivation">Feature selection: Introduction and motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-selection">What is feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-feature-selection">Why feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-carry-out-feature-selection">How do we carry out feature selection?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-using-feature-importances">Feature selection using feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-based-feature-selection">Model-based feature selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-feature-elimination-rfe">Recursive feature elimination (RFE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-algorithm">RFE algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-and-categorical-features">Feature selection and categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-feature-selection-and-ohe">(Optional) Feature selection and OHE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-with-cross-validation-rfecv">RFE with cross-validation (RFECV)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-feature-importances"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-search-and-score-methods">(Optional) Search and score methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea-of-search-and-score-methods">General idea of search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-or-backward-selection">Forward or backward selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-ways-to-search">Other ways to search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#warnings-about-feature-selection">Warnings about feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-advice-on-finding-relevant-features">General advice on finding relevant features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-12-1">iClicker Exercise 12.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-problems-with-feature-selection">(Optional) Problems with feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-is-relevance-clearly-defined">Example: Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#is-relevance-clearly-defined">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Warnings about feature selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-resources">Relevant resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>