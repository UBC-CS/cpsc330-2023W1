

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 16: Recommender Systems &#8212; CPSC 330 Applied Machine Learning 2023W1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/16_recommender-systems';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 17: Introduction to natural language processing" href="17_natural-language-processing.html" />
    <link rel="prev" title="Lecture 15: More Clustering" href="15_DBSCAN-hierarchical.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/UBC-CS-logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/UBC-CS-logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Things you should know</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/README.html">CPSC 330 Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning-objectives.html">Course Learning Objectives</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_intro.html">Lecture 1: Course Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_decision-trees.html">Lecture 2: Terminology, Baselines, Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_ml-fundamentals.html">Lecture 3: Machine Learning Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_kNNs-SVM-RBF.html">Lecture 4: <span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours and SVM RBFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_preprocessing-pipelines.html">Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_column-transformer-text-feats.html">Lecture 6: <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and Text Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_linear-models.html">Lecture 7: Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_hyperparameter-optimization.html">Lecture 8: Hyperparameter Optimization and Optimization Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_classification-metrics.html">Lecture 9: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_regression-metrics.html">Lecture 10: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_ensembles.html">Lecture 11: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_feat-importances.html">Lecture 12: Feature importances and model transparency</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_feature-engineering-selection.html">Lecture 13: Feature engineering and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_K-Means.html">Lecture 14: K-Means Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_DBSCAN-hierarchical.html">Lecture 15: More Clustering</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 16: Recommender Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="17_natural-language-processing.html">Lecture 17: Introduction to natural language processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="18_intro_to_computer-vision.html">Lecture 18: Multi-class classification and introduction to computer vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="19_time-series.html">Lecture 19: Time series</a></li>
<li class="toctree-l1"><a class="reference internal" href="20_survival-analysis.html">Lecture 20: Survival analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="21_communication.html">Lecture 21: Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="23_deployment-conclusion.html">Lecture 23: Deployment and conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="class_demos/03_class-demo.html">Lecture 3: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/04_class-demo.html">Lecture 4: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/05-06_class-demo.html">Lectures 5 and 6: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/07_class-demo.html">Lectures 7: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/09_class-demo.html">Exploring classification metrics</a></li>

<li class="toctree-l1"><a class="reference internal" href="class_demos/14_class-demo.html">Lecture 14: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_demos/15_class-demo.html">Lecture 15: Class demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Appendix-A.html">Appendix A</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-B.html">Appendix-B</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">Attributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSE.html">LICENSE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/16_recommender-systems.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 16: Recommender Systems</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes-a-name-lo-a">Learning outcomes <a name="lo"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommender-systems-motivation">Recommender systems motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-recommender-system">What is a recommender system?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-recommender-systems">Example: Recommender Systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-should-we-care-about-recommendation-systems">Why should we care about recommendation systems?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-capstone-project-qxmd">An example Capstone project: QxMD</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-kind-of-data-we-need-to-build-recommendation-systems">What kind of data we need to build recommendation systems?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#main-approaches">Main approaches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-netflix-prize">The Netflix prize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">The Netflix prize</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommender-systems-problem">Recommender systems problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-formulation">Problem formulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utility-matrix">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sparsity-of-utility-matrix">Sparsity of utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-do-we-predict">What do we predict?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-dataset-jester-1-7m-jokes-ratings-dataset">Example dataset: Jester 1.7M jokes ratings dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-stats">Dataset stats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-utility-matrix">Creating utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utility-matrix-for-the-example-problem">Utility matrix for the example problem</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-approaches">Baseline Approaches</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation">Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-splitting">Data splitting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Questions for you</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baselines">Baselines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-average-baseline">Global average baseline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nearest-neighbours-imputation"><span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours imputation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-nearest-neighbors">Finding nearest neighbors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-k-nearest-neighbours-on-a-query-joke">(Optional) <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours on a query joke</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-to-do-with-predictions">What to do with predictions?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#collaborative-filtering">Collaborative filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Collaborative filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-or-regression">Classification or regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rating-prediction">Rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#toy-movie-recommendation-example">Toy movie recommendation example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rating-prediction-using-the-surprise-package">Rating prediction using the surprise package</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-cross-validation-for-recommender-systems">(Optional) Cross-validation for recommender systems</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content-based-filtering">Content-based filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-content-based-filtering">What is content-based filtering?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#item-and-user-features">Item and user features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#toy-example-movie-recommendation">Toy example: Movie recommendation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ratings-data">Ratings data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#movie-features">Movie features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overall-idea">Overall idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pat-s-ratings">Pat’s ratings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-approach-to-rating-prediction">Supervised approach to rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Supervised approach to rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-build-user-profiles">Let’s build user profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-user-profiles">Examine user profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pat-s-profile">Pat’s profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eva-s-profile">Eva’s profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-models-for-users">Regression models for users</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-model-for-pat">Regression model for Pat</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictions-for-pat">Predictions for Pat</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-model-for-eva">Regression model for Eva</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictions-for-eva">Predictions for Eva</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completing-the-utility-matrix-with-content-based-filtering">Completing the utility matrix with content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-comments-on-content-based-filtering">More comments on content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-content-based-filtering">Advantages of content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#disadvantages-of-content-based-filtering">Disadvantages of content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hybrid-filtering">Hybrid filtering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-comments-and-summary-a-name-1-a">Final comments and summary <a name="1"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formulating-the-problem-of-recommender-systems">Formulating the problem of recommender systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-cover">What did we cover?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-error-rate-in-recommendation-systems">Beyond error rate in recommendation systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-issues-important-in-recommender-systems">Other issues important in recommender systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#are-these-good-recommendations">Are these good recommendations?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Are these good recommendations?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-data">Types of data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-thoughts-on-recommendation-systems">Some thoughts on recommendation systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Some thoughts on recommendation systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#my-advice">My advice</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="../_images/330-banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-16-recommender-systems">
<h1>Lecture 16: Recommender Systems<a class="headerlink" href="#lecture-16-recommender-systems" title="Permalink to this heading">#</a></h1>
<p>UBC 2023-24</p>
<p>Instructor: Varada Kolhatkar and Andrew Roth</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="s2">&quot;code&quot;</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">plotting_functions_unsup</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>

<span class="c1"># plt.style.use(&quot;seaborn&quot;)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
</pre></div>
</div>
<img alt="../_images/4f4c4e8190776ba24319df3c1de0c2c44241d7f9ff15289c637f49cf998cfa1b.png" src="../_images/4f4c4e8190776ba24319df3c1de0c2c44241d7f9ff15289c637f49cf998cfa1b.png" />
</div>
</div>
</section>
<section id="learning-outcomes-a-name-lo-a">
<h2>Learning outcomes <a name="lo"></a><a class="headerlink" href="#learning-outcomes-a-name-lo-a" title="Permalink to this heading">#</a></h2>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>State the problem of recommender systems.</p></li>
<li><p>Describe components of a utility matrix.</p></li>
<li><p>Create a utility matrix given ratings data.</p></li>
<li><p>Describe a common approach to evaluate recommender systems.</p></li>
<li><p>Implement some baseline approaches to complete the utility matrix.</p></li>
<li><p>Explain the idea of collaborative filtering.</p></li>
<li><p>Formulate the rating prediction problem as a supervised machine learning problem.</p></li>
<li><p>Create a content-based filter given ratings data and item features to predict missing ratings in the utility matrix.</p></li>
<li><p>Explain some serious consequences of recommendation systems.</p></li>
</ul>
</section>
<section id="announcements">
<h2>Announcements<a class="headerlink" href="#announcements" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Homework 6 is due Monday, November 13th at 11:59pm.</p></li>
<li><p>No classes or OH during the midterm break.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p>What percentage of watch time on YouTube do you think comes from recommendations?</p>
<ul class="simple">
<li><p>(A) 50%</p></li>
<li><p>(B) 60%</p></li>
<li><p>(C) 20%</p></li>
<li><p>(D) 90%</p></li>
</ul>
<p>This <a class="reference external" href="https://developers.google.com/machine-learning/recommendation/overview">source</a> says 60%. But the statistics might have changed now.</p>
</section>
<section id="recommender-systems-motivation">
<h2>Recommender systems motivation<a class="headerlink" href="#recommender-systems-motivation" title="Permalink to this heading">#</a></h2>
<section id="what-is-a-recommender-system">
<h3>What is a recommender system?<a class="headerlink" href="#what-is-a-recommender-system" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A recommender or a recommendation system <strong>recommends</strong> a particular product or service to users they are likely to consume.</p></li>
</ul>
<p><img alt="" src="../_images/recommendation_system.png" /></p>
<!-- <img src="img/recommendation_system.png" alt="" height="900" width="900">  -->
</section>
<section id="example-recommender-systems">
<h3>Example: Recommender Systems<a class="headerlink" href="#example-recommender-systems" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A client goes to Amazon to buy products.</p></li>
<li><p>Amazon has some information about the client. They also have information about other clients buying similar products.</p></li>
<li><p>What should they recommend to the client, so that they buy more products?</p></li>
<li><p>There’s no “right” answer (no label).</p></li>
<li><p>The whole idea is to understand user behavior in order to recommend them products they are likely to consume.</p></li>
</ul>
</section>
<section id="why-should-we-care-about-recommendation-systems">
<h3>Why should we care about recommendation systems?<a class="headerlink" href="#why-should-we-care-about-recommendation-systems" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Almost everything we buy or consume today is in some way or the other influenced by recommendation systems.</p>
<ul>
<li><p>Music (Spotify), videos (YouTube), news, books and products (Amazon), movies (Netflix), jokes, restaurants, dating , friends (Facebook), professional connections (Linkedin)</p></li>
</ul>
</li>
<li><p>Recommendation systems are at the core of the success of many companies.</p>
<ul>
<li><p>Amazon</p></li>
<li><p><a class="reference external" href="https://help.netflix.com/en/node/100639">Netflix</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="an-example-capstone-project-qxmd">
<h3>An example Capstone project: <a class="reference external" href="https://qxmd.com/">QxMD</a><a class="headerlink" href="#an-example-capstone-project-qxmd" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Present personalized journal article recommendations to health care professionals.</p></li>
</ul>
</section>
<section id="what-kind-of-data-we-need-to-build-recommendation-systems">
<h3>What kind of data we need to build recommendation systems?<a class="headerlink" href="#what-kind-of-data-we-need-to-build-recommendation-systems" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>User ratings data</strong> (most common)</p></li>
<li><p><strong>Features related to items or users</strong></p></li>
<li><p>Customer purchase history data</p></li>
</ul>
</section>
<section id="main-approaches">
<h3>Main approaches<a class="headerlink" href="#main-approaches" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Collaborative filtering</p>
<ul>
<li><p>“Unsupervised” learning</p></li>
<li><p>We only have labels <span class="math notranslate nohighlight">\(y_{ij}\)</span> (rating of user <span class="math notranslate nohighlight">\(i\)</span> for item <span class="math notranslate nohighlight">\(j\)</span>).</p></li>
<li><p>We learn features.</p></li>
</ul>
</li>
<li><p>Content-based recommenders</p>
<ul>
<li><p>Supervised learning</p></li>
<li><p>Extract features <span class="math notranslate nohighlight">\(x_i\)</span> of users and/or items and building a model to predict rating <span class="math notranslate nohighlight">\(y_i\)</span> given <span class="math notranslate nohighlight">\(x_i\)</span>.</p></li>
<li><p>Apply model to predict for new users/items.</p></li>
</ul>
</li>
<li><p>Hybrid</p>
<ul>
<li><p>Combining collaborative filtering with content-based filtering</p></li>
</ul>
</li>
</ul>
</section>
<section id="the-netflix-prize">
<h3>The Netflix prize<a class="headerlink" href="#the-netflix-prize" title="Permalink to this heading">#</a></h3>
<p><img alt="" src="../_images/netflix.png" /></p>
<p><a class="reference external" href="https://netflixtechblog.com/netflix-recommendations-beyond-the-5-stars-part-1-55838468f429">Source</a></p>
</section>
<section id="id1">
<h3>The Netflix prize<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>100M ratings from 0.5M users on 18k movies.</p></li>
<li><p>Grand prize was $1M for first team to reduce squared error at least by 10%.</p></li>
<li><p>Winning entry (and most entries) used collaborative filtering:</p>
<ul>
<li><p>Methods that only looks at ratings, not features of movies/users.</p></li>
</ul>
</li>
<li><p>A simple collaborative filtering method that does really well:</p>
<ul>
<li><p>Now adopted by many companies.</p></li>
</ul>
</li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="recommender-systems-problem">
<h2>Recommender systems problem<a class="headerlink" href="#recommender-systems-problem" title="Permalink to this heading">#</a></h2>
<section id="problem-formulation">
<h3>Problem formulation<a class="headerlink" href="#problem-formulation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Most often the data for recommender systems come in as <strong>ratings</strong> for a set of items from a set of users.</p></li>
<li><p>We have two entities: <span class="math notranslate nohighlight">\(N\)</span> <strong>users</strong> and <span class="math notranslate nohighlight">\(M\)</span> <strong>items</strong>.</p></li>
<li><p><strong>Users</strong> are consumers.</p></li>
<li><p><strong>Items</strong> are the products or services offered.</p>
<ul>
<li><p>E.g., movies (Netflix), books (Amazon), songs (spotify), people (tinder)</p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/utility_matrix.png" /></p>
<!-- <img src="img/utility_matrix.png" alt="" height="900" width="900">  -->
</section>
<section id="utility-matrix">
<h3>Utility matrix<a class="headerlink" href="#utility-matrix" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A <strong>utility matrix</strong> is the matrix that captures <strong>interactions</strong> between <span class="math notranslate nohighlight">\(N\)</span> <strong>users</strong> and <span class="math notranslate nohighlight">\(M\)</span> <strong>items</strong>.</p></li>
<li><p>The interaction may come in different forms:</p>
<ul>
<li><p>ratings, clicks, purchases</p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/utility_matrix.png" /></p>
<!-- <img src="img/utility_mat.png" alt="" height="900" width="900">  --></section>
<section id="id2">
<h3>Utility matrix<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Below is a toy utility matrix. Here <span class="math notranslate nohighlight">\(N\)</span> = 6 and <span class="math notranslate nohighlight">\(M\)</span> = 5.</p></li>
<li><p>Each entry <span class="math notranslate nohighlight">\(y_{ij}\)</span> (<span class="math notranslate nohighlight">\(i^{th}\)</span> row and <span class="math notranslate nohighlight">\(j^{th}\)</span> column) denotes the rating given by the user <span class="math notranslate nohighlight">\(i\)</span> to item <span class="math notranslate nohighlight">\(j\)</span>.</p></li>
<li><p>We represent users in terms of items and items in terms of users.</p></li>
</ul>
<p><img alt="" src="../_images/utility_matrix.png" /></p>
<!-- <img src="img/utility_matrix.png" alt="" height="900" width="900">  --></section>
<section id="sparsity-of-utility-matrix">
<h3>Sparsity of utility matrix<a class="headerlink" href="#sparsity-of-utility-matrix" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The utility matrix is very sparse because usually users only interact with a few items.</p></li>
<li><p>For example:</p>
<ul>
<li><p>all Netflix users will have rated only a small percentage of content available on Netflix</p></li>
<li><p>all amazon clients will have rated only a small fraction of items among all items available on Amazon</p></li>
</ul>
</li>
</ul>
</section>
<section id="what-do-we-predict">
<h3>What do we predict?<a class="headerlink" href="#what-do-we-predict" title="Permalink to this heading">#</a></h3>
<p>Given a utility matrix of <span class="math notranslate nohighlight">\(N\)</span> users and <span class="math notranslate nohighlight">\(M\)</span> items, <strong>complete the utility matrix</strong>. In other words, <strong>predict missing values in the matrix</strong>.</p>
<p><img alt="" src="../_images/utility_matrix.png" /></p>
<!-- <img src="img/utility_matrix.png" alt="" height="900" width="900">  --><ul class="simple">
<li><p>Once we have predicted ratings, we can recommend items to users they are likely to rate higher.</p></li>
</ul>
</section>
<section id="example-dataset-jester-1-7m-jokes-ratings-dataset">
<h3>Example dataset: <a class="reference external" href="https://www.kaggle.com/vikashrajluhaniwal/jester-17m-jokes-ratings-dataset?select=jester_ratings.csv">Jester 1.7M jokes ratings dataset</a><a class="headerlink" href="#example-dataset-jester-1-7m-jokes-ratings-dataset" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We’ll use a sample of <a class="reference external" href="https://www.kaggle.com/vikashrajluhaniwal/jester-17m-jokes-ratings-dataset">Jester 1.7M jokes ratings dataset</a> to demonstrate different recommendation systems.</p></li>
</ul>
<p>The dataset comes with two CSVs</p>
<ul class="simple">
<li><p>A CSV containing ratings (-10.0 to +10.0) of 150 jokes from 59,132 users.</p></li>
<li><p>A CSV containing joke IDs and the actual text of jokes.</p></li>
</ul>
<blockquote>
<div><p>Some jokes might be offensive. Please do not look too much into the actual text data if you are sensitive to such language.</p>
</div></blockquote>
<ul class="simple">
<li><p>Recommendation systems are most effective when you have a large amount of data.</p></li>
<li><p>But we are only taking a sample here for speed.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;data/jester_ratings.csv&quot;</span>
<span class="n">ratings_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings_full</span><span class="p">[</span><span class="n">ratings_full</span><span class="p">[</span><span class="s2">&quot;userId&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">4000</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>jokeId</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>5</td>
      <td>0.219</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>7</td>
      <td>-9.281</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>8</td>
      <td>-9.281</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>13</td>
      <td>-6.781</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>15</td>
      <td>0.875</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_key</span> <span class="o">=</span> <span class="s2">&quot;userId&quot;</span>
<span class="n">item_key</span> <span class="o">=</span> <span class="s2">&quot;jokeId&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataset-stats">
<h3>Dataset stats<a class="headerlink" href="#dataset-stats" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 141362 entries, 0 to 141361
Data columns (total 3 columns):
 #   Column  Non-Null Count   Dtype  
---  ------  --------------   -----  
 0   userId  141362 non-null  int64  
 1   jokeId  141362 non-null  int64  
 2   rating  141362 non-null  float64
dtypes: float64(1), int64(2)
memory usage: 4.3 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">item_key</span><span class="o">=</span><span class="s2">&quot;jokeId&quot;</span><span class="p">,</span> <span class="n">user_key</span><span class="o">=</span><span class="s2">&quot;userId&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of ratings:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average rating:  </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">])))</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users (N): </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">N</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of items (M): </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">M</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fraction non-nan ratings: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span>


<span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of ratings: 141362
Average rating:  1.200
Number of users (N): 3635
Number of items (M): 140
Fraction non-nan ratings: 0.278
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-utility-matrix">
<h3>Creating utility matrix<a class="headerlink" href="#creating-utility-matrix" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s construct utility matrix with <code class="docutils literal notranslate"><span class="pre">number</span> <span class="pre">of</span> <span class="pre">users</span></code> rows and <code class="docutils literal notranslate"><span class="pre">number</span> <span class="pre">of</span> <span class="pre">items</span></code> columns from the ratings data.</p></li>
</ul>
<blockquote>
<div><p>Note we are constructing a non-sparse matrix for demonstration purpose here. In real life it’s recommended that you work with sparse matrices.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span>
<span class="n">item_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">))))</span>
<span class="n">user_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">])))</span>
<span class="n">item_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_Y_from_ratings</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">user_mapper</span><span class="p">,</span> <span class="n">item_mapper</span><span class="p">,</span> <span class="n">user_key</span><span class="o">=</span><span class="s2">&quot;userId&quot;</span><span class="p">,</span> <span class="n">item_key</span><span class="o">=</span><span class="s2">&quot;jokeId&quot;</span>
<span class="p">):</span>  <span class="c1"># Function to create a dense utility matrix</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">user_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="utility-matrix-for-the-example-problem">
<h3>Utility matrix for the example problem<a class="headerlink" href="#utility-matrix-for-the-example-problem" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Rows represent users.</p></li>
<li><p>Columns represent items (jokes in our case).</p></li>
<li><p>Each cell gives the rating given by the user to the corresponding joke.</p></li>
<li><p>Users are features for jokes and jokes are features for users.</p></li>
<li><p>We want to predict the missing entries.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y_mat</span> <span class="o">=</span> <span class="n">create_Y_from_ratings</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">user_mapper</span><span class="p">,</span> <span class="n">item_mapper</span><span class="p">)</span>
<span class="n">Y_mat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3635, 140)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y_mat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>130</th>
      <th>131</th>
      <th>132</th>
      <th>133</th>
      <th>134</th>
      <th>135</th>
      <th>136</th>
      <th>137</th>
      <th>138</th>
      <th>139</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.219</td>
      <td>-9.281</td>
      <td>-9.281</td>
      <td>-6.781</td>
      <td>0.875</td>
      <td>-9.656</td>
      <td>-9.031</td>
      <td>-7.469</td>
      <td>-8.719</td>
      <td>-9.156</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-9.688</td>
      <td>9.938</td>
      <td>9.531</td>
      <td>9.938</td>
      <td>0.406</td>
      <td>3.719</td>
      <td>9.656</td>
      <td>-2.688</td>
      <td>-9.562</td>
      <td>-9.125</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-9.844</td>
      <td>-9.844</td>
      <td>-7.219</td>
      <td>-2.031</td>
      <td>-9.938</td>
      <td>-9.969</td>
      <td>-9.875</td>
      <td>-9.812</td>
      <td>-9.781</td>
      <td>-6.844</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.812</td>
      <td>-4.500</td>
      <td>-4.906</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6.906</td>
      <td>4.750</td>
      <td>-5.906</td>
      <td>-0.406</td>
      <td>-4.031</td>
      <td>3.875</td>
      <td>6.219</td>
      <td>5.656</td>
      <td>6.094</td>
      <td>5.406</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3630</th>
      <td>NaN</td>
      <td>-9.812</td>
      <td>-0.062</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3631</th>
      <td>NaN</td>
      <td>-9.844</td>
      <td>7.531</td>
      <td>-9.719</td>
      <td>-9.344</td>
      <td>3.875</td>
      <td>9.812</td>
      <td>8.938</td>
      <td>8.375</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3632</th>
      <td>NaN</td>
      <td>-1.906</td>
      <td>3.969</td>
      <td>-2.312</td>
      <td>-0.344</td>
      <td>-8.844</td>
      <td>4.188</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3633</th>
      <td>NaN</td>
      <td>-8.875</td>
      <td>-9.156</td>
      <td>-9.156</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3634</th>
      <td>NaN</td>
      <td>-6.312</td>
      <td>1.281</td>
      <td>-3.531</td>
      <td>2.125</td>
      <td>-5.812</td>
      <td>5.562</td>
      <td>-6.062</td>
      <td>0.125</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.188</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>3635 rows × 140 columns</p>
</div></div></div>
</div>
<p><br><br><br><br></p>
</section>
</section>
<section id="baseline-approaches">
<h2>Baseline Approaches<a class="headerlink" href="#baseline-approaches" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Recall that our goal is to predict missing entries in the utility matrix.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y_mat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>130</th>
      <th>131</th>
      <th>132</th>
      <th>133</th>
      <th>134</th>
      <th>135</th>
      <th>136</th>
      <th>137</th>
      <th>138</th>
      <th>139</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.219</td>
      <td>-9.281</td>
      <td>-9.281</td>
      <td>-6.781</td>
      <td>0.875</td>
      <td>-9.656</td>
      <td>-9.031</td>
      <td>-7.469</td>
      <td>-8.719</td>
      <td>-9.156</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-9.688</td>
      <td>9.938</td>
      <td>9.531</td>
      <td>9.938</td>
      <td>0.406</td>
      <td>3.719</td>
      <td>9.656</td>
      <td>-2.688</td>
      <td>-9.562</td>
      <td>-9.125</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-9.844</td>
      <td>-9.844</td>
      <td>-7.219</td>
      <td>-2.031</td>
      <td>-9.938</td>
      <td>-9.969</td>
      <td>-9.875</td>
      <td>-9.812</td>
      <td>-9.781</td>
      <td>-6.844</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.812</td>
      <td>-4.500</td>
      <td>-4.906</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6.906</td>
      <td>4.750</td>
      <td>-5.906</td>
      <td>-0.406</td>
      <td>-4.031</td>
      <td>3.875</td>
      <td>6.219</td>
      <td>5.656</td>
      <td>6.094</td>
      <td>5.406</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3630</th>
      <td>NaN</td>
      <td>-9.812</td>
      <td>-0.062</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3631</th>
      <td>NaN</td>
      <td>-9.844</td>
      <td>7.531</td>
      <td>-9.719</td>
      <td>-9.344</td>
      <td>3.875</td>
      <td>9.812</td>
      <td>8.938</td>
      <td>8.375</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3632</th>
      <td>NaN</td>
      <td>-1.906</td>
      <td>3.969</td>
      <td>-2.312</td>
      <td>-0.344</td>
      <td>-8.844</td>
      <td>4.188</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3633</th>
      <td>NaN</td>
      <td>-8.875</td>
      <td>-9.156</td>
      <td>-9.156</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3634</th>
      <td>NaN</td>
      <td>-6.312</td>
      <td>1.281</td>
      <td>-3.531</td>
      <td>2.125</td>
      <td>-5.812</td>
      <td>5.562</td>
      <td>-6.062</td>
      <td>0.125</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.188</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>3635 rows × 140 columns</p>
</div></div></div>
</div>
<section id="evaluation">
<h3>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We’ll try a number of methods to do this.</p></li>
<li><p>Although there is no notion of “accurate” recommendations, we need a way to evaluate our predictions so that we’ll be able to compare different methods.</p></li>
<li><p>Although we are doing unsupervised learning, we’ll split the data and evaluate our predictions as follows.</p></li>
</ul>
</section>
<section id="data-splitting">
<h3>Data splitting<a class="headerlink" href="#data-splitting" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We split the ratings into train and validation sets.</p></li>
<li><p>It’s easier to split the ratings data instead of splitting the utility matrix.</p></li>
<li><p>Don’t worry about <code class="docutils literal notranslate"><span class="pre">y</span></code>; we’re not really going to use it.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((113089, 3), (28273, 3))
</pre></div>
</div>
</div>
</div>
<p>Now we will create utility matrices for train and validation splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_mat</span> <span class="o">=</span> <span class="n">create_Y_from_ratings</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">user_mapper</span><span class="p">,</span> <span class="n">item_mapper</span><span class="p">)</span>
<span class="n">valid_mat</span> <span class="o">=</span> <span class="n">create_Y_from_ratings</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">user_mapper</span><span class="p">,</span> <span class="n">item_mapper</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">valid_mat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((3635, 140), (3635, 140))
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">train_mat</span></code> has only ratings from the train set and <code class="docutils literal notranslate"><span class="pre">valid_mat</span></code> has only ratings from the valid set.</p></li>
<li><p>During training we assume that we do not have access to some of the available ratings. We predict these ratings and evaluate them against ratings in the validation set.</p></li>
</ul>
</section>
<section id="id3">
<h3>Questions for you<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>How do train and validation utility matrices differ?</p></li>
<li><p>Why are utility matrices for train and validation sets are of the same shape?
<br><br></p></li>
</ul>
<p><strong>Answer:</strong></p>
<ul class="simple">
<li><p>The training matrix <code class="docutils literal notranslate"><span class="pre">train_mat</span></code> is of shape N by M but only has ratings from <code class="docutils literal notranslate"><span class="pre">X_train</span></code> and all other ratings missing.</p></li>
<li><p>The validation matrix <code class="docutils literal notranslate"><span class="pre">valid_mat</span></code> is also of shape N by M but it only has ratings <code class="docutils literal notranslate"><span class="pre">X_valid</span></code> and all other ratings missing.</p></li>
<li><p>They have the same shape because both have the same number of users and items; that’s how we have constructed them.</p></li>
</ul>
</section>
<section id="id4">
<h3>Evaluation<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Now that we have train and validation sets, how do we evaluate our predictions?</p></li>
<li><p>You can calculate the error between actual ratings and predicted ratings with metrics of your choice.</p>
<ul>
<li><p>Most common ones are MSE or RMSE.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">error</span></code> function below calculates RMSE and <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> function prints train and validation RMSE.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the root mean squared error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">X1</span> <span class="o">-</span> <span class="n">X2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">pred_X</span><span class="p">,</span> <span class="n">train_X</span><span class="p">,</span> <span class="n">valid_X</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;Global average&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> train RMSE: </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">error</span><span class="p">(</span><span class="n">pred_X</span><span class="p">,</span> <span class="n">train_X</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> valid RMSE: </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">error</span><span class="p">(</span><span class="n">pred_X</span><span class="p">,</span> <span class="n">valid_X</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</section>
<section id="baselines">
<h3>Baselines<a class="headerlink" href="#baselines" title="Permalink to this heading">#</a></h3>
<p>Let’s first try some simple approaches to predict missing entries.</p>
<ol class="arabic simple">
<li><p>Global average baseline</p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.KNNImputer.html"><span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours imputation</a></p></li>
</ol>
</section>
<section id="global-average-baseline">
<h3>Global average baseline<a class="headerlink" href="#global-average-baseline" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s examine RMSE of the global average baseline.</p></li>
<li><p>In this baseline we predict everything as the global average rating</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">train_mat</span><span class="p">)</span>
<span class="n">pred_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">train_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">avg</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred_g</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>130</th>
      <th>131</th>
      <th>132</th>
      <th>133</th>
      <th>134</th>
      <th>135</th>
      <th>136</th>
      <th>137</th>
      <th>138</th>
      <th>139</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>...</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>...</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>...</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>...</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>...</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
      <td>1.20741</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 140 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evaluate</span><span class="p">(</span><span class="n">pred_g</span><span class="p">,</span> <span class="n">train_mat</span><span class="p">,</span> <span class="n">valid_mat</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;Global average&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Global average train RMSE: 5.75
Global average valid RMSE: 5.77
</pre></div>
</div>
</div>
</div>
</section>
<section id="k-nearest-neighbours-imputation">
<h3><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.KNNImputer.html"><span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours imputation</a><a class="headerlink" href="#k-nearest-neighbours-imputation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Can we try <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours type imputation?</p></li>
<li><p>Impute missing values using the mean value from <span class="math notranslate nohighlight">\(k\)</span> nearest neighbours found in the training set.</p></li>
<li><p>Calculate distances between examples using features where neither value is missing.</p></li>
</ul>
<p><img alt="" src="../_images/utility_matrix.png" /></p>
<!-- <img src="img/utility_matrix.png" alt="" height="900" width="900">  --><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>

<span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">train_mat_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_mat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_mat_imp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>130</th>
      <th>131</th>
      <th>132</th>
      <th>133</th>
      <th>134</th>
      <th>135</th>
      <th>136</th>
      <th>137</th>
      <th>138</th>
      <th>139</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-5.9406</td>
      <td>-9.2810</td>
      <td>-9.2810</td>
      <td>-6.7810</td>
      <td>0.8750</td>
      <td>-9.6560</td>
      <td>-9.0310</td>
      <td>-7.4690</td>
      <td>-8.7190</td>
      <td>-9.1560</td>
      <td>...</td>
      <td>-4.5311</td>
      <td>1.8968</td>
      <td>0.6905</td>
      <td>-3.1218</td>
      <td>1.2843</td>
      <td>-2.6063</td>
      <td>-0.1812</td>
      <td>-1.3937</td>
      <td>1.7625</td>
      <td>-0.4092</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.3405</td>
      <td>9.9380</td>
      <td>9.5310</td>
      <td>9.9380</td>
      <td>0.4060</td>
      <td>3.7190</td>
      <td>9.6560</td>
      <td>-2.6880</td>
      <td>4.3438</td>
      <td>-9.1250</td>
      <td>...</td>
      <td>2.2437</td>
      <td>3.1719</td>
      <td>5.0251</td>
      <td>5.1812</td>
      <td>8.2407</td>
      <td>5.9311</td>
      <td>5.8375</td>
      <td>6.3812</td>
      <td>1.1687</td>
      <td>6.2532</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-9.8440</td>
      <td>-3.5750</td>
      <td>-7.2190</td>
      <td>-2.0310</td>
      <td>-9.9380</td>
      <td>-9.9690</td>
      <td>-9.8750</td>
      <td>-9.8120</td>
      <td>-9.7810</td>
      <td>-6.8440</td>
      <td>...</td>
      <td>-4.4186</td>
      <td>-3.1156</td>
      <td>-1.5655</td>
      <td>-5.6250</td>
      <td>0.3720</td>
      <td>-4.0439</td>
      <td>-6.0500</td>
      <td>-5.5563</td>
      <td>-5.4125</td>
      <td>-5.5874</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.8120</td>
      <td>-2.4624</td>
      <td>-4.9060</td>
      <td>-2.7781</td>
      <td>-0.0532</td>
      <td>-3.8594</td>
      <td>1.7031</td>
      <td>-0.3687</td>
      <td>1.8469</td>
      <td>0.0593</td>
      <td>...</td>
      <td>-2.0344</td>
      <td>2.1469</td>
      <td>2.8875</td>
      <td>1.6845</td>
      <td>1.2437</td>
      <td>-0.0156</td>
      <td>1.2595</td>
      <td>3.8219</td>
      <td>3.1971</td>
      <td>5.0249</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.3157</td>
      <td>4.7500</td>
      <td>1.8658</td>
      <td>-0.4060</td>
      <td>1.7937</td>
      <td>3.8750</td>
      <td>6.2190</td>
      <td>1.9220</td>
      <td>6.0940</td>
      <td>5.4060</td>
      <td>...</td>
      <td>-0.2844</td>
      <td>1.1313</td>
      <td>4.0157</td>
      <td>3.0344</td>
      <td>4.0406</td>
      <td>0.5218</td>
      <td>4.3594</td>
      <td>4.0968</td>
      <td>3.9250</td>
      <td>3.9657</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3630</th>
      <td>-0.7750</td>
      <td>-9.8120</td>
      <td>-0.0620</td>
      <td>-2.8218</td>
      <td>-4.1470</td>
      <td>-4.8281</td>
      <td>2.2718</td>
      <td>-2.8782</td>
      <td>-1.0125</td>
      <td>0.0688</td>
      <td>...</td>
      <td>-6.6844</td>
      <td>3.0531</td>
      <td>2.8687</td>
      <td>1.5281</td>
      <td>4.5002</td>
      <td>-0.1878</td>
      <td>2.0031</td>
      <td>4.0908</td>
      <td>2.3563</td>
      <td>5.0406</td>
    </tr>
    <tr>
      <th>3631</th>
      <td>2.5188</td>
      <td>-5.0625</td>
      <td>-0.4001</td>
      <td>-9.7190</td>
      <td>-9.3440</td>
      <td>-1.6408</td>
      <td>-4.1187</td>
      <td>8.9380</td>
      <td>8.3750</td>
      <td>-0.9314</td>
      <td>...</td>
      <td>-4.0344</td>
      <td>7.9155</td>
      <td>3.4282</td>
      <td>4.2968</td>
      <td>6.7968</td>
      <td>7.3999</td>
      <td>1.8500</td>
      <td>5.8219</td>
      <td>5.1812</td>
      <td>2.8437</td>
    </tr>
    <tr>
      <th>3632</th>
      <td>0.1749</td>
      <td>-1.9060</td>
      <td>3.9690</td>
      <td>-1.3844</td>
      <td>-0.3440</td>
      <td>-8.8440</td>
      <td>4.1880</td>
      <td>-1.5564</td>
      <td>5.0593</td>
      <td>0.3343</td>
      <td>...</td>
      <td>-4.0126</td>
      <td>2.8344</td>
      <td>2.4499</td>
      <td>2.9312</td>
      <td>2.3750</td>
      <td>-0.4062</td>
      <td>1.4375</td>
      <td>3.9750</td>
      <td>-1.2220</td>
      <td>2.8375</td>
    </tr>
    <tr>
      <th>3633</th>
      <td>-4.5937</td>
      <td>-6.4907</td>
      <td>-6.1594</td>
      <td>-9.1560</td>
      <td>-7.1437</td>
      <td>-6.5406</td>
      <td>2.2031</td>
      <td>-1.7782</td>
      <td>-3.7406</td>
      <td>-0.6406</td>
      <td>...</td>
      <td>-4.6938</td>
      <td>4.8061</td>
      <td>4.9968</td>
      <td>-0.1626</td>
      <td>2.4187</td>
      <td>-0.7750</td>
      <td>4.6781</td>
      <td>1.7658</td>
      <td>0.4595</td>
      <td>0.1843</td>
    </tr>
    <tr>
      <th>3634</th>
      <td>-0.0812</td>
      <td>-6.3120</td>
      <td>1.2810</td>
      <td>-3.5310</td>
      <td>2.1250</td>
      <td>-5.8120</td>
      <td>5.5620</td>
      <td>0.2218</td>
      <td>0.1250</td>
      <td>-1.1874</td>
      <td>...</td>
      <td>-3.8156</td>
      <td>4.1812</td>
      <td>4.1880</td>
      <td>3.7280</td>
      <td>3.0750</td>
      <td>2.1033</td>
      <td>2.8156</td>
      <td>5.5312</td>
      <td>3.8283</td>
      <td>4.1219</td>
    </tr>
  </tbody>
</table>
<p>3635 rows × 140 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evaluate</span><span class="p">(</span><span class="n">train_mat_imp</span><span class="p">,</span> <span class="n">train_mat</span><span class="p">,</span> <span class="n">valid_mat</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;KNN imputer&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KNN imputer train RMSE: 0.00
KNN imputer valid RMSE: 4.79
</pre></div>
</div>
</div>
</div>
</section>
<section id="finding-nearest-neighbors">
<h3>Finding <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.NearestNeighbors.html">nearest neighbors</a><a class="headerlink" href="#finding-nearest-neighbors" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We can look at nearest neighbours of a query item.</p></li>
<li><p>Here our columns are jokes, and users are features for jokes, and we’ll have to find nearest neighbours of columns vectors.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_mat_imp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>130</th>
      <th>131</th>
      <th>132</th>
      <th>133</th>
      <th>134</th>
      <th>135</th>
      <th>136</th>
      <th>137</th>
      <th>138</th>
      <th>139</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-5.9406</td>
      <td>-9.2810</td>
      <td>-9.2810</td>
      <td>-6.7810</td>
      <td>0.8750</td>
      <td>-9.6560</td>
      <td>-9.0310</td>
      <td>-7.4690</td>
      <td>-8.7190</td>
      <td>-9.1560</td>
      <td>...</td>
      <td>-4.5311</td>
      <td>1.8968</td>
      <td>0.6905</td>
      <td>-3.1218</td>
      <td>1.2843</td>
      <td>-2.6063</td>
      <td>-0.1812</td>
      <td>-1.3937</td>
      <td>1.7625</td>
      <td>-0.4092</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.3405</td>
      <td>9.9380</td>
      <td>9.5310</td>
      <td>9.9380</td>
      <td>0.4060</td>
      <td>3.7190</td>
      <td>9.6560</td>
      <td>-2.6880</td>
      <td>4.3438</td>
      <td>-9.1250</td>
      <td>...</td>
      <td>2.2437</td>
      <td>3.1719</td>
      <td>5.0251</td>
      <td>5.1812</td>
      <td>8.2407</td>
      <td>5.9311</td>
      <td>5.8375</td>
      <td>6.3812</td>
      <td>1.1687</td>
      <td>6.2532</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-9.8440</td>
      <td>-3.5750</td>
      <td>-7.2190</td>
      <td>-2.0310</td>
      <td>-9.9380</td>
      <td>-9.9690</td>
      <td>-9.8750</td>
      <td>-9.8120</td>
      <td>-9.7810</td>
      <td>-6.8440</td>
      <td>...</td>
      <td>-4.4186</td>
      <td>-3.1156</td>
      <td>-1.5655</td>
      <td>-5.6250</td>
      <td>0.3720</td>
      <td>-4.0439</td>
      <td>-6.0500</td>
      <td>-5.5563</td>
      <td>-5.4125</td>
      <td>-5.5874</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-5.8120</td>
      <td>-2.4624</td>
      <td>-4.9060</td>
      <td>-2.7781</td>
      <td>-0.0532</td>
      <td>-3.8594</td>
      <td>1.7031</td>
      <td>-0.3687</td>
      <td>1.8469</td>
      <td>0.0593</td>
      <td>...</td>
      <td>-2.0344</td>
      <td>2.1469</td>
      <td>2.8875</td>
      <td>1.6845</td>
      <td>1.2437</td>
      <td>-0.0156</td>
      <td>1.2595</td>
      <td>3.8219</td>
      <td>3.1971</td>
      <td>5.0249</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.3157</td>
      <td>4.7500</td>
      <td>1.8658</td>
      <td>-0.4060</td>
      <td>1.7937</td>
      <td>3.8750</td>
      <td>6.2190</td>
      <td>1.9220</td>
      <td>6.0940</td>
      <td>5.4060</td>
      <td>...</td>
      <td>-0.2844</td>
      <td>1.1313</td>
      <td>4.0157</td>
      <td>3.0344</td>
      <td>4.0406</td>
      <td>0.5218</td>
      <td>4.3594</td>
      <td>4.0968</td>
      <td>3.9250</td>
      <td>3.9657</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3630</th>
      <td>-0.7750</td>
      <td>-9.8120</td>
      <td>-0.0620</td>
      <td>-2.8218</td>
      <td>-4.1470</td>
      <td>-4.8281</td>
      <td>2.2718</td>
      <td>-2.8782</td>
      <td>-1.0125</td>
      <td>0.0688</td>
      <td>...</td>
      <td>-6.6844</td>
      <td>3.0531</td>
      <td>2.8687</td>
      <td>1.5281</td>
      <td>4.5002</td>
      <td>-0.1878</td>
      <td>2.0031</td>
      <td>4.0908</td>
      <td>2.3563</td>
      <td>5.0406</td>
    </tr>
    <tr>
      <th>3631</th>
      <td>2.5188</td>
      <td>-5.0625</td>
      <td>-0.4001</td>
      <td>-9.7190</td>
      <td>-9.3440</td>
      <td>-1.6408</td>
      <td>-4.1187</td>
      <td>8.9380</td>
      <td>8.3750</td>
      <td>-0.9314</td>
      <td>...</td>
      <td>-4.0344</td>
      <td>7.9155</td>
      <td>3.4282</td>
      <td>4.2968</td>
      <td>6.7968</td>
      <td>7.3999</td>
      <td>1.8500</td>
      <td>5.8219</td>
      <td>5.1812</td>
      <td>2.8437</td>
    </tr>
    <tr>
      <th>3632</th>
      <td>0.1749</td>
      <td>-1.9060</td>
      <td>3.9690</td>
      <td>-1.3844</td>
      <td>-0.3440</td>
      <td>-8.8440</td>
      <td>4.1880</td>
      <td>-1.5564</td>
      <td>5.0593</td>
      <td>0.3343</td>
      <td>...</td>
      <td>-4.0126</td>
      <td>2.8344</td>
      <td>2.4499</td>
      <td>2.9312</td>
      <td>2.3750</td>
      <td>-0.4062</td>
      <td>1.4375</td>
      <td>3.9750</td>
      <td>-1.2220</td>
      <td>2.8375</td>
    </tr>
    <tr>
      <th>3633</th>
      <td>-4.5937</td>
      <td>-6.4907</td>
      <td>-6.1594</td>
      <td>-9.1560</td>
      <td>-7.1437</td>
      <td>-6.5406</td>
      <td>2.2031</td>
      <td>-1.7782</td>
      <td>-3.7406</td>
      <td>-0.6406</td>
      <td>...</td>
      <td>-4.6938</td>
      <td>4.8061</td>
      <td>4.9968</td>
      <td>-0.1626</td>
      <td>2.4187</td>
      <td>-0.7750</td>
      <td>4.6781</td>
      <td>1.7658</td>
      <td>0.4595</td>
      <td>0.1843</td>
    </tr>
    <tr>
      <th>3634</th>
      <td>-0.0812</td>
      <td>-6.3120</td>
      <td>1.2810</td>
      <td>-3.5310</td>
      <td>2.1250</td>
      <td>-5.8120</td>
      <td>5.5620</td>
      <td>0.2218</td>
      <td>0.1250</td>
      <td>-1.1874</td>
      <td>...</td>
      <td>-3.8156</td>
      <td>4.1812</td>
      <td>4.1880</td>
      <td>3.7280</td>
      <td>3.0750</td>
      <td>2.1033</td>
      <td>2.8156</td>
      <td>5.5312</td>
      <td>3.8283</td>
      <td>4.1219</td>
    </tr>
  </tbody>
</table>
<p>3635 rows × 140 columns</p>
</div></div></div>
</div>
</section>
<section id="optional-k-nearest-neighbours-on-a-query-joke">
<h3>(Optional) <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours on a query joke<a class="headerlink" href="#optional-k-nearest-neighbours-on-a-query-joke" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s transpose the matrix.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item_user_mat</span> <span class="o">=</span> <span class="n">train_mat_imp</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jokes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/jester_items.csv&quot;</span><span class="p">)</span>
<span class="n">jokes_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>jokeId</th>
      <th>jokeText</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A man visits the doctor. The doctor says "I have bad news for you.You have\ncancer and Alzheimer's disease". \nThe man replies "Well,thank God I don't have cancer!"\n</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>This couple had an excellent relationship going until one day he came home\nfrom work to find his girlfriend packing. He asked her why she was leaving him\nand she told him that she had heard awful things about him. \n\n"What could they possibly have said to make you move out?" \n\n"They told me that you were a pedophile." \n\nHe replied, "That's an awfully big word for a ten year old." \n</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Q. What's 200 feet long and has 4 teeth? \n\nA. The front row at a Willie Nelson Concert.\n</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Q. What's the difference between a man and a toilet? \n\nA. A toilet doesn't follow you around after you use it.\n</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Q.\tWhat's O. J. Simpson's Internet address? \nA.\tSlash, slash, backslash, slash, slash, escape.\n</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">id_joke_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">jokes_df</span><span class="o">.</span><span class="n">jokeId</span><span class="p">,</span> <span class="n">jokes_df</span><span class="o">.</span><span class="n">jokeText</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>


<span class="k">def</span> <span class="nf">get_topk_recommendations</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">query_ind</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">query_idx</span> <span class="o">=</span> <span class="n">item_inverse_mapper</span><span class="p">[</span><span class="n">query_ind</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">neigh_ind</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">query_ind</span><span class="p">]],</span> <span class="n">k</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">neigh_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">neigh_ind</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">query_ind</span> <span class="o">==</span> <span class="n">query_ind</span><span class="p">))</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_joke_map</span><span class="p">[</span><span class="n">item_inverse_mapper</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">neigh_ind</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Query joke: &quot;</span><span class="p">,</span> <span class="n">id_joke_map</span><span class="p">[</span><span class="n">query_idx</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">recs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;top recommendations&quot;</span><span class="p">])</span>


<span class="n">get_topk_recommendations</span><span class="p">(</span><span class="n">item_user_mat</span><span class="p">,</span> <span class="n">query_ind</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Query joke:  Q: If a person who speaks three languages is called &quot;tri-lingual,&quot; and
a person who speaks two languages is called &quot;bi-lingual,&quot; what do call
a person who only speaks one language?

A: American! 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/b3/g26r0dcx4b35vf3nk31216hc0000gr/T/ipykernel_25025/3461118492.py:9: DeprecationWarning:

Calling nonzero on 0d arrays is deprecated, as it behaves surprisingly. Use `atleast_1d(cond).nonzero()` if the old behavior was intended. If the context of this warning is of the form `arr[nonzero(cond)]`, just use `arr[cond]`.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>top recommendations</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Q: What is the difference between George  Washington, Richard Nixon,\nand Bill Clinton?\n\nA: Washington couldn't tell a lie, Nixon couldn't   tell the truth, and\nClinton doesn't know the difference.\n</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A man in a hot air balloon realized he was lost. He reduced altitude and spotted a woman below. He descended a bit more and shouted, "Excuse me, can you help me? I promised a friend I would meet him an hour ago, but I don't know where I am." The woman below replied, "You are in a hot air balloon hovering approximately 30 feet above the ground. You are between 40 and 41 degrees north latitude and between 59 and 60 degrees west longitude." "You must be an engineer," said the balloonist. "I am," replied the woman. "How did you know?" "Well," answered the balloonist, "everything you told me is technically correct, but I have no idea what to make of your information, and the fact is, I am still lost. Frankly, you've not been much help so far." The woman below responded, "You must be in management." "I am," replied the balloonist, "but how did you know?" "Well," said the woman, "you don't know where you are or where you are going. You have risen to where you are due to a large quantity of hot air. You made a promise that you have no idea how to keep, and you expect people beneath you to solve your problems. The fact is, you are in exactly the same position you were in before we met, but now, somehow, it's my fault!"</td>
    </tr>
    <tr>
      <th>2</th>
      <td>If pro- is the opposite of con- then congress must be the opposite\nof progress.\n</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arnold Swartzeneger and Sylvester Stallone are making a movie about\nthe lives of the great composers.  \nStallone says "I want to be Mozart." \nSwartzeneger says: "In that case...  I'll be Bach."\n</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Question</strong></p>
<ul class="simple">
<li><p>Instead of imputation, what would be the consequences if we replace <code class="docutils literal notranslate"><span class="pre">nan</span></code> with zeros so that we can calculate distances between vectors?</p></li>
</ul>
<p><br><br>
<strong>Answer</strong></p>
<p>It’s not a good idea replace ratings with 0, because 0 can be an actual rating value in our case.</p>
</section>
<section id="what-to-do-with-predictions">
<h3>What to do with predictions?<a class="headerlink" href="#what-to-do-with-predictions" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Once you have predictions, you can sort them based on ratings and recommend items with highest ratings.</p></li>
</ul>
</section>
</section>
<section id="break-5-min">
<h2>Break (5 min)<a class="headerlink" href="#break-5-min" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="../_images/eva-coffee.png" /></p>
</section>
<section id="collaborative-filtering">
<h2>Collaborative filtering<a class="headerlink" href="#collaborative-filtering" title="Permalink to this heading">#</a></h2>
<section id="id5">
<h3>Collaborative filtering<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>One of the most popular approach for recommendation systems.</p></li>
<li><p>Approach used by the winning entry (and most of the entries) in the Netflix competition.</p></li>
<li><p>An unsupervised approach</p>
<ul>
<li><p>Only uses the user-item interactions given in the ratings matrix.</p></li>
</ul>
</li>
<li><p><strong>Intuition</strong></p>
<ul>
<li><p>We may have similar users and similar items which can help us predict missing entries.</p></li>
<li><p>Leverage social information to provide recommendations.</p></li>
</ul>
</li>
</ul>
</section>
<section id="problem">
<h3>Problem<a class="headerlink" href="#problem" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Given a utility matrix with many missing entries, how can we predict missing ratings?</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{bmatrix} 
? &amp; ? &amp; \checkmark  &amp; ? &amp; \checkmark\\
\checkmark &amp; ? &amp; ?  &amp; ? &amp; ?\\
? &amp; \checkmark &amp; \checkmark  &amp; ? &amp; \checkmark\\
? &amp; ? &amp; ?  &amp; ? &amp; ?\\
? &amp; ? &amp; ? &amp; \checkmark &amp; ?\\
? &amp; \checkmark &amp; \checkmark  &amp; ? &amp; \checkmark
\end{bmatrix}
\end{split}\]</div>
<blockquote>
<div><p>Note: rating prediction <span class="math notranslate nohighlight">\(\neq\)</span> Classification or regression</p>
</div></blockquote>
</section>
<section id="classification-or-regression">
<h3>Classification or regression<a class="headerlink" href="#classification-or-regression" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We have <span class="math notranslate nohighlight">\(X\)</span> and targets for some rows in <span class="math notranslate nohighlight">\(X\)</span>.</p></li>
<li><p>We want to predict the last column (target column).</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{bmatrix} 
\checkmark &amp; \checkmark &amp; \checkmark  &amp; \checkmark &amp; \checkmark\\
\checkmark &amp; \checkmark &amp; \checkmark  &amp; \checkmark &amp; \checkmark\\
\checkmark &amp; \checkmark &amp; \checkmark  &amp; \checkmark &amp; \checkmark\\
\checkmark &amp; \checkmark &amp; \checkmark  &amp; \checkmark &amp; ?\\
\checkmark &amp; \checkmark &amp; \checkmark  &amp; \checkmark &amp; ?\\
\checkmark &amp; \checkmark &amp; \checkmark  &amp; \checkmark &amp; ?\\
\end{bmatrix}
\end{split}\]</div>
</section>
<section id="rating-prediction">
<h3>Rating prediction<a class="headerlink" href="#rating-prediction" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Ratings data has many missing values in the utility matrix. There is no special target column. We want to predict the missing entries in the matrix.</p></li>
<li><p>Since our goal is to <strong>predict</strong> ratings, usually the utility matrix is referred to as <span class="math notranslate nohighlight">\(Y\)</span> matrix.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{bmatrix} 
? &amp; ? &amp; \checkmark  &amp; ? &amp; \checkmark\\
\checkmark &amp; ? &amp; ?  &amp; ? &amp; ?\\
? &amp; \checkmark &amp; \checkmark  &amp; ? &amp; \checkmark\\
? &amp; ? &amp; ?  &amp; ? &amp; ?\\
? &amp; ? &amp; ? &amp; \checkmark &amp; ?\\
? &amp; \checkmark &amp; \checkmark  &amp; ? &amp; \checkmark
\end{bmatrix}
\end{split}\]</div>
<p><br><br></p>
<ul class="simple">
<li><p>We don’t have sufficient background to understand how collaborative filtering works under-the-hood.</p></li>
<li><p>Let’s look at an example to understand this at a high level.</p></li>
</ul>
</section>
<section id="toy-movie-recommendation-example">
<h3>Toy movie recommendation example<a class="headerlink" href="#toy-movie-recommendation-example" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>It’s a bit hard to create a toy example with jokes.</p></li>
<li><p>So let’s walk through a movie recommendation toy example.</p></li>
<li><p>The toy data below contains movie ratings for seven movies given by 4 users.</p></li>
<li><p>Do you see any pattern here?</p></li>
</ul>
<p><img alt="" src="../_images/toy-movie.png" /></p>
<ul class="simple">
<li><p>In this toy example, we see clear groups of movies and users.</p>
<ul>
<li><p>For movies: Children movies and documentaries</p></li>
<li><p>For users: Children movie lovers and documentary lovers</p></li>
</ul>
</li>
<li><p>How can we identify such latent features?</p>
<ul>
<li><p>Some tools can detect patterns or ‘latent features’. Once these latent features for users and items are identified, you can infer the missing values in the utility matrix. Only a high-level understanding is expected of you here, as the details are beyond the scope of this course.<br />
<br><br>
<img alt="" src="../_images/toy-movie-pattern.png" /></p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="rating-prediction-using-the-surprise-package">
<h3>Rating prediction using the surprise package<a class="headerlink" href="#rating-prediction-using-the-surprise-package" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We’ll be using a package called <a class="reference external" href="https://surprise.readthedocs.io/en/stable/index.html">Surprise</a>.</p></li>
<li><p>The collaborative filtering algorithm we use in this package is called <code class="docutils literal notranslate"><span class="pre">SVD</span></code>.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">scikit</span><span class="o">-</span><span class="n">surprise</span>
</pre></div>
</div>
<p>Let’s try it out on our Jester dataset utility matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">surprise</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">SVD</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Reader</span><span class="p">,</span> <span class="n">accuracy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>  <span class="c1"># Load the data</span>

<span class="c1"># I&#39;m being sloppy here. Probably there is a way to create validset from our already split data.</span>
<span class="n">trainset</span><span class="p">,</span> <span class="n">validset</span> <span class="o">=</span> <span class="n">surprise</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>  <span class="c1"># Split the data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span>
<span class="n">svd_preds</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">validset</span><span class="p">)</span>
<span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">svd_preds</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 5.2893
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.28926338380112
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>No big improvement over the global baseline (RMSE=5.77).</p></li>
<li><p>Probably because we are only considering a sample.</p></li>
</ul>
</section>
<section id="optional-cross-validation-for-recommender-systems">
<h3>(Optional) Cross-validation for recommender systems<a class="headerlink" href="#optional-cross-validation-for-recommender-systems" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We can also carry out cross-validation and grid search with this package.</p></li>
<li><p>Let’s look at an example of cross-validation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAE&quot;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating RMSE, MAE of algorithm SVD on 5 split(s).

                  Fold 1  Fold 2  Fold 3  Fold 4  Fold 5  Mean    Std     
RMSE (testset)    5.2753  5.2655  5.2975  5.3000  5.2511  5.2779  0.0187  
MAE (testset)     4.2083  4.1788  4.2064  4.2196  4.1715  4.1969  0.0185  
Fit time          0.24    0.25    0.25    0.23    0.24    0.24    0.01    
Test time         0.08    0.14    0.08    0.15    0.08    0.11    0.03    
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>test_rmse</th>
      <th>test_mae</th>
      <th>fit_time</th>
      <th>test_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.275266</td>
      <td>4.208326</td>
      <td>0.237202</td>
      <td>0.081728</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.265520</td>
      <td>4.178802</td>
      <td>0.248562</td>
      <td>0.141250</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.297458</td>
      <td>4.206372</td>
      <td>0.249718</td>
      <td>0.082722</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.300010</td>
      <td>4.219648</td>
      <td>0.232634</td>
      <td>0.145835</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.251069</td>
      <td>4.171478</td>
      <td>0.239094</td>
      <td>0.081310</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Jester dataset is available as one of the built-in datasets in this package and you can load it as follows and run cross-validation as follows.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s2">&quot;jester&quot;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAE&quot;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_builtin</span><span class="p">(</span><span class="s2">&quot;jester&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAE&quot;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/surprise/model_selection/validation.py:108,</span> in <span class="ni">cross_validate</span><span class="nt">(algo, data, measures, cv, return_train_measures, n_jobs, pre_dispatch, verbose)</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">get_cv</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span> <span class="n">delayed_list</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span>     <span class="n">delayed</span><span class="p">(</span><span class="n">fit_and_score</span><span class="p">)(</span><span class="n">algo</span><span class="p">,</span> <span class="n">trainset</span><span class="p">,</span> <span class="n">testset</span><span class="p">,</span> <span class="n">measures</span><span class="p">,</span> <span class="n">return_train_measures</span><span class="p">)</span>
<span class="nn">    106     for (trainset, testset)</span> in <span class="ni">cv.split</span><span class="nt">(data)</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span> <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">108</span> <span class="n">out</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">pre_dispatch</span><span class="o">=</span><span class="n">pre_dispatch</span><span class="p">)(</span><span class="n">delayed_list</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span> <span class="p">(</span><span class="n">test_measures_dicts</span><span class="p">,</span> <span class="n">train_measures_dicts</span><span class="p">,</span> <span class="n">fit_times</span><span class="p">,</span> <span class="n">test_times</span><span class="p">)</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">out</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span> <span class="n">test_measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/joblib/parallel.py:1863,</span> in <span class="ni">Parallel.__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1861</span>     <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sequential_output</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1862</span>     <span class="nb">next</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1863</span>     <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_generator</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1865</span> <span class="c1"># Let&#39;s create an ID that uniquely identifies the current call. If the</span>
<span class="g g-Whitespace">   </span><span class="mi">1866</span> <span class="c1"># call is interrupted early and that the same instance is immediately</span>
<span class="g g-Whitespace">   </span><span class="mi">1867</span> <span class="c1"># re-used, this id will be used to prevent workers that were</span>
<span class="g g-Whitespace">   </span><span class="mi">1868</span> <span class="c1"># concurrently finalizing a task from the previous call to run the</span>
<span class="g g-Whitespace">   </span><span class="mi">1869</span> <span class="c1"># callback.</span>
<span class="g g-Whitespace">   </span><span class="mi">1870</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/joblib/parallel.py:1789,</span> in <span class="ni">Parallel._get_sequential_output</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1786</span> <span class="k">yield</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1788</span> <span class="c1"># Sequentially call the tasks and yield the results.</span>
<span class="ne">-&gt; </span><span class="mi">1789</span> <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1790</span>     <span class="bp">self</span><span class="o">.</span><span class="n">n_dispatched_batches</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="g g-Whitespace">   </span><span class="mi">1791</span>     <span class="bp">self</span><span class="o">.</span><span class="n">n_dispatched_tasks</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/surprise/model_selection/validation.py:104,</span> in <span class="ni">&lt;genexpr&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span> <span class="n">measures</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">measures</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">get_cv</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">104</span> <span class="n">delayed_list</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span>     <span class="n">delayed</span><span class="p">(</span><span class="n">fit_and_score</span><span class="p">)(</span><span class="n">algo</span><span class="p">,</span> <span class="n">trainset</span><span class="p">,</span> <span class="n">testset</span><span class="p">,</span> <span class="n">measures</span><span class="p">,</span> <span class="n">return_train_measures</span><span class="p">)</span>
<span class="nn">    106     for (trainset, testset)</span> in <span class="ni">cv.split</span><span class="nt">(data)</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">108</span> <span class="n">out</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">pre_dispatch</span><span class="o">=</span><span class="n">pre_dispatch</span><span class="p">)(</span><span class="n">delayed_list</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span> <span class="p">(</span><span class="n">test_measures_dicts</span><span class="p">,</span> <span class="n">train_measures_dicts</span><span class="p">,</span> <span class="n">fit_times</span><span class="p">,</span> <span class="n">test_times</span><span class="p">)</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">out</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/surprise/model_selection/split.py:117,</span> in <span class="ni">KFold.split</span><span class="nt">(self, data)</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span> <span class="n">raw_trainset</span> <span class="o">=</span> <span class="p">[</span>
<span class="nn">    113     data.raw_ratings[i] for i</span> in <span class="ni">chain</span><span class="nt">(indices[:start], indices[stop:])</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span> <span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> <span class="n">raw_testset</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">raw_ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]]</span>
<span class="ne">--&gt; </span><span class="mi">117</span> <span class="n">trainset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">construct_trainset</span><span class="p">(</span><span class="n">raw_trainset</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span> <span class="n">testset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">construct_testset</span><span class="p">(</span><span class="n">raw_testset</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span> <span class="k">yield</span> <span class="n">trainset</span><span class="p">,</span> <span class="n">testset</span>

<span class="nn">File ~/miniconda3/envs/cpsc330/lib/python3.10/site-packages/surprise/dataset.py:207,</span> in <span class="ni">Dataset.construct_trainset</span><span class="nt">(self, raw_trainset)</span>
<span class="g g-Whitespace">    </span><span class="mi">204</span>         <span class="n">current_i_index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>     <span class="n">ur</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iid</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">207</span>     <span class="n">ir</span><span class="p">[</span><span class="n">iid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">uid</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span> <span class="n">n_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ur</span><span class="p">)</span>  <span class="c1"># number of users</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span> <span class="n">n_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>  <span class="c1"># number of items</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p><br><br><br><br></p>
</section>
</section>
<section id="content-based-filtering">
<h2>Content-based filtering<a class="headerlink" href="#content-based-filtering" title="Permalink to this heading">#</a></h2>
<section id="what-is-content-based-filtering">
<h3>What is content-based filtering?<a class="headerlink" href="#what-is-content-based-filtering" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Supervised machine learning approach</p></li>
<li><p>In collaborative filtering we assumed that we only have ratings data.</p></li>
<li><p>Usually there is some information on items and users available.</p></li>
<li><p>Examples</p>
<ul>
<li><p>Netflix can describe movies as action, romance, comedy, documentaries.</p></li>
<li><p>Amazon could describe books according to topics: math, languages, history.</p></li>
<li><p>Tinder could describe people according to age, location, employment.</p></li>
</ul>
</li>
<li><p>Can we use this information to predict ratings in the utility matrix?</p>
<ul>
<li><p>Yes!</p></li>
</ul>
</li>
</ul>
</section>
<section id="item-and-user-features">
<h3>Item and user features<a class="headerlink" href="#item-and-user-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In collaborative filtering we assumed that we only have ratings data.</p></li>
<li><p>Usually there is some information available on items and users.</p></li>
<li><p>Examples</p>
<ul>
<li><p>Netflix can describe movies as action, romance, comedy, documentaries.</p></li>
<li><p>Amazon could describe books according to topics: math, languages, history.</p></li>
<li><p>Tinder could describe people according to age, location, employment.</p></li>
</ul>
</li>
<li><p>Can we use this information to predict ratings in the utility matrix?</p>
<ul>
<li><p>Yes!</p></li>
</ul>
</li>
</ul>
</section>
<section id="toy-example-movie-recommendation">
<h3>Toy example: Movie recommendation<a class="headerlink" href="#toy-example-movie-recommendation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s consider movie recommendation problem with the following toy data.</p></li>
</ul>
</section>
<section id="ratings-data">
<h3>Ratings data<a class="headerlink" href="#ratings-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/toy_ratings.csv&quot;</span><span class="p">)</span>
<span class="n">toy_ratings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>movie_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sam</td>
      <td>Lion King</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sam</td>
      <td>Jerry Maguire</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Sam</td>
      <td>Roman Holidays</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sam</td>
      <td>Downfall</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Eva</td>
      <td>Titanic</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Eva</td>
      <td>Jerry Maguire</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Eva</td>
      <td>Inception</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Eva</td>
      <td>Man on Wire</td>
      <td>5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Eva</td>
      <td>The Social Dilemma</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Pat</td>
      <td>Titanic</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Pat</td>
      <td>Lion King</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Pat</td>
      <td>Bambi</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Pat</td>
      <td>Cast Away</td>
      <td>3</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Pat</td>
      <td>Jerry Maguire</td>
      <td>5</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Pat</td>
      <td>Downfall</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Pat</td>
      <td>A Beautiful Mind</td>
      <td>3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Jim</td>
      <td>Titanic</td>
      <td>2</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Jim</td>
      <td>Lion King</td>
      <td>3</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Jim</td>
      <td>The Social Dilemma</td>
      <td>5</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Jim</td>
      <td>Malcolm x</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Jim</td>
      <td>Man on Wire</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]))</span>
<span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="s2">&quot;movie_id&quot;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users (N)                : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of movies (M)               : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of users (N)                : 4
Number of movies (M)               : 12
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_key</span> <span class="o">=</span> <span class="s2">&quot;user_id&quot;</span>
<span class="n">item_key</span> <span class="o">=</span> <span class="s2">&quot;movie_id&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span>
<span class="n">item_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">))))</span>
<span class="n">user_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">])))</span>
<span class="n">item_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h3>Utility matrix<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<p>Let’s create a dense utility matrix for our toy dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_Y_from_ratings</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">user_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h3>Utility matrix<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">create_Y_from_ratings</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
<span class="n">utility_mat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">item_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">user_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">utility_mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Downfall</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Man on Wire</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Eva</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Jim</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Goal</strong>: Predict missing entries in the utility matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">surprise</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">SVD</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Reader</span><span class="p">,</span> <span class="n">accuracy</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s predict ratings with collaborative filtering.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>  <span class="c1"># Load the data</span>

<span class="n">trainset</span><span class="p">,</span> <span class="n">validset</span> <span class="o">=</span> <span class="n">surprise</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>  <span class="c1"># Split the data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">trainset</span><span class="o">.</span><span class="n">build_testset</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="n">rating_preds</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">true_r</span><span class="p">,</span> <span class="n">est</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">:</span>
    <span class="n">rating_preds</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iid</span><span class="p">,</span> <span class="n">est</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rating_preds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>defaultdict(list,
            {&#39;Sam&#39;: [(&#39;Lion King&#39;, 3.5442874862516582),
              (&#39;Jerry Maguire&#39;, 3.471958396420975),
              (&#39;Downfall&#39;, 3.141157981632877),
              (&#39;Roman Holidays&#39;, 3.6555436348053982)],
             &#39;Jim&#39;: [(&#39;Lion King&#39;, 3.6494404051925047),
              (&#39;The Social Dilemma&#39;, 3.8739407581035588),
              (&#39;Titanic&#39;, 3.295718235231984),
              (&#39;Man on Wire&#39;, 3.8839492577938532),
              (&#39;Malcolm x&#39;, 3.6435176323135128)],
             &#39;Pat&#39;: [(&#39;A Beautiful Mind&#39;, 3.4463313322323263),
              (&#39;Bambi&#39;, 3.540418795140043),
              (&#39;Jerry Maguire&#39;, 3.4582870107738803),
              (&#39;Titanic&#39;, 3.1872411557123517),
              (&#39;Cast Away&#39;, 3.4442142132704827),
              (&#39;Lion King&#39;, 3.5286392016604875),
              (&#39;Downfall&#39;, 3.133747883605952)],
             &#39;Eva&#39;: [(&#39;The Social Dilemma&#39;, 3.6665140635371194),
              (&#39;Jerry Maguire&#39;, 3.3423360343482957),
              (&#39;Titanic&#39;, 3.113324069881786),
              (&#39;Man on Wire&#39;, 3.685575559931666)]})
</pre></div>
</div>
</div>
</div>
</section>
<section id="movie-features">
<h3>Movie features<a class="headerlink" href="#movie-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Suppose we also have movie features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movie_feats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/toy_movie_feats.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">movie_feats_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A Beautiful Mind</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Bambi</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Cast Away</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Downfall</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Inception</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lion King</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Man on Wire</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>The Social Dilemma</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(12, 6)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>How can we use these features to predict missing ratings?</p></li>
</ul>
</section>
<section id="overall-idea">
<h3>Overall idea<a class="headerlink" href="#overall-idea" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Using the ratings data and movie features, we’ll build <strong>profiles for different users</strong>.</p></li>
<li><p>Let’s consider an example user <strong>Pat</strong>.</p></li>
</ul>
</section>
<section id="pat-s-ratings">
<h3>Pat’s ratings<a class="headerlink" href="#pat-s-ratings" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We don’t know anything about Pat but we know her ratings to movies.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utility_mat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Pat&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A Beautiful Mind      3.0
Bambi                 4.0
Cast Away             3.0
Downfall              2.0
Inception            NaN 
Jerry Maguire         5.0
Lion King             4.0
Malcolm x            NaN 
Man on Wire          NaN 
Roman Holidays       NaN 
The Social Dilemma   NaN 
Titanic               3.0
Name: Pat, dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We also know about movies and their features.</p></li>
<li><p>If Pat gave a high rating to <em>Lion King</em>, it means that she liked the features of the movie.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Lion King&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Action         0
Romance        0
Drama          1
Comedy         0
Children       1
Documentary    0
Name: Lion King, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="supervised-approach-to-rating-prediction">
<h3>Supervised approach to rating prediction<a class="headerlink" href="#supervised-approach-to-rating-prediction" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We treat ratings prediction problem as a set of regression problems.</p></li>
<li><p>Given movie information, we create user profile for each user.</p></li>
<li><p>Build regression model for each user and learn regression weights for each user.</p></li>
</ul>
<ul class="simple">
<li><p>We build a profile for users based on</p>
<ul>
<li><p>the movies they have watched</p></li>
<li><p>their rating for the movies</p></li>
<li><p>the features of the movies</p></li>
</ul>
</li>
<li><p>We train a personalized regression model for each user using this information.</p></li>
</ul>
</section>
<section id="id8">
<h3>Supervised approach to rating prediction<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<p>For each user <span class="math notranslate nohighlight">\(i\)</span> create a user profile as follows.</p>
<ul class="simple">
<li><p>Consider all movies rated by <span class="math notranslate nohighlight">\(i\)</span> and create <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for the user:</p>
<ul>
<li><p>Each row in <code class="docutils literal notranslate"><span class="pre">X</span></code> contains the movie features of movie <span class="math notranslate nohighlight">\(j\)</span> rated by <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p>Each value in <code class="docutils literal notranslate"><span class="pre">y</span></code> is the corresponding rating given to the movie <span class="math notranslate nohighlight">\(j\)</span> by user <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
</ul>
</li>
<li><p>Fit a regression model using <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
<li><p>Apply the model to predict ratings for new items!</p></li>
</ul>
</section>
<section id="let-s-build-user-profiles">
<h3>Let’s build user profiles<a class="headerlink" href="#let-s-build-user-profiles" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Build <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for all users.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>


<span class="k">def</span> <span class="nf">get_lr_data_per_user</span><span class="p">(</span><span class="n">ratings_df</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">lr_y</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">lr_X</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">lr_items</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ratings_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">user_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
        <span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
        <span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">])</span>
        <span class="n">lr_items</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lr_X</span><span class="p">:</span>
        <span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">lr_X</span><span class="p">,</span> <span class="n">lr_y</span><span class="p">,</span> <span class="n">lr_items</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">X_train_usr</span><span class="p">,</span> <span class="n">y_train_usr</span><span class="p">,</span> <span class="n">rated_items</span> <span class="o">=</span> <span class="n">get_lr_data_per_user</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s going is be shape of each <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>?</p></li>
</ul>
</section>
<section id="examine-user-profiles">
<h3>Examine user profiles<a class="headerlink" href="#examine-user-profiles" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s examine some user profiles.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_user_profile</span><span class="p">(</span><span class="n">user_name</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">rated_items</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">movie_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_inverse_mapper</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile for user: &quot;</span><span class="p">,</span> <span class="n">user_name</span><span class="p">)</span>
    <span class="n">profile_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_names</span><span class="p">)</span>
    <span class="n">profile_df</span><span class="p">[</span><span class="s2">&quot;ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">profile_df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pat-s-profile">
<h3>Pat’s profile<a class="headerlink" href="#pat-s-profile" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_user_profile</span><span class="p">(</span><span class="s2">&quot;Pat&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profile for user:  Pat
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Lion King</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Bambi</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Cast Away</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>Downfall</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>A Beautiful Mind</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Pat seems to like Children’s movies and movies with Comedy.</p></li>
<li><p>Seems like she’s not so much into romantic movies.</p></li>
</ul>
</section>
<section id="eva-s-profile">
<h3>Eva’s profile<a class="headerlink" href="#eva-s-profile" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_user_profile</span><span class="p">(</span><span class="s2">&quot;Eva&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profile for user:  Eva
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Inception</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Man on Wire</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>The Social Dilemma</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Eva hasn’t rated many movies. There are not many rows.</p></li>
<li><p>Eva seems to like documentaries and action movies.</p></li>
<li><p>Seems like she’s not so much into romantic movies.</p></li>
</ul>
</section>
<section id="regression-models-for-users">
<h3>Regression models for users<a class="headerlink" href="#regression-models-for-users" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>


<span class="k">def</span> <span class="nf">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Ridge</span><span class="p">()):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span> <span class="nf">predict_for_usr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">movie_names</span><span class="p">):</span>
    <span class="n">feat_vecs</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movie_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feat_vecs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">preds</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="regression-model-for-pat">
<h3>Regression model for Pat<a class="headerlink" href="#regression-model-for-pat" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What are the regression weights learned for Pat?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Pat&quot;</span>
<span class="n">pat_model</span> <span class="o">=</span> <span class="n">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">)</span>
<span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;Coefficients for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">user_name</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pat_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients for Pat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Action</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Romance</th>
      <td>-0.020833</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>0.437500</td>
    </tr>
    <tr>
      <th>Comedy</th>
      <td>0.854167</td>
    </tr>
    <tr>
      <th>Children</th>
      <td>0.458333</td>
    </tr>
    <tr>
      <th>Documentary</th>
      <td>-0.437500</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="predictions-for-pat">
<h3>Predictions for Pat<a class="headerlink" href="#predictions-for-pat" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>How would Pat rate some movies she hasn’t seen?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movies_to_pred</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Roman Holidays&quot;</span><span class="p">,</span> <span class="s2">&quot;Malcolm x&quot;</span><span class="p">]</span>
<span class="n">pred_df</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movies_to_pred</span><span class="p">]</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Pat&quot;</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">predict_for_usr</span><span class="p">(</span><span class="n">pat_model</span><span class="p">,</span> <span class="n">movies_to_pred</span><span class="p">)</span>
<span class="n">pred_df</span><span class="p">[</span><span class="n">user_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;s predicted ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>Pat's predicted ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4.145833</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2.437500</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="regression-model-for-eva">
<h3>Regression model for Eva<a class="headerlink" href="#regression-model-for-eva" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What are the regression weights learned for Eva?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Eva&quot;</span>
<span class="n">eva_model</span> <span class="o">=</span> <span class="n">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">)</span>
<span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;Coefficients for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">user_name</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">eva_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients for Eva</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Action</th>
      <td>0.333333</td>
    </tr>
    <tr>
      <th>Romance</th>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>-0.666667</td>
    </tr>
    <tr>
      <th>Comedy</th>
      <td>-0.666667</td>
    </tr>
    <tr>
      <th>Children</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Documentary</th>
      <td>0.666667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="predictions-for-eva">
<h3>Predictions for Eva<a class="headerlink" href="#predictions-for-eva" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What are the predicted ratings for Eva for a list of movies?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Eva&quot;</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">predict_for_usr</span><span class="p">(</span><span class="n">eva_model</span><span class="p">,</span> <span class="n">movies_to_pred</span><span class="p">)</span>
<span class="n">pred_df</span><span class="p">[</span><span class="n">user_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;s predicted ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>Pat's predicted ratings</th>
      <th>Eva's predicted ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4.145833</td>
      <td>1.666667</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2.437500</td>
      <td>4.666667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="completing-the-utility-matrix-with-content-based-filtering">
<h3>Completing the utility matrix with content-based filtering<a class="headerlink" href="#completing-the-utility-matrix-with-content-based-filtering" title="Permalink to this heading">#</a></h3>
<p>Here is the original utility matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utility_mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Downfall</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Man on Wire</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Eva</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Jim</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Using predictions per user, we can fill in missing entries in the utility matrix.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>

<span class="n">models</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">pred_lin_reg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">models</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">()</span>
    <span class="n">models</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_usr</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="n">pred_lin_reg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred_lin_reg</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">item_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">user_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Downfall</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Man on Wire</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Eva</th>
      <td>2.333333</td>
      <td>3.333333</td>
      <td>2.333333</td>
      <td>4.666667</td>
      <td>3.666667</td>
      <td>1.666667</td>
      <td>3.333333</td>
      <td>4.666667</td>
      <td>4.666667</td>
      <td>1.666667</td>
      <td>4.666667</td>
      <td>2.333333</td>
    </tr>
    <tr>
      <th>Jim</th>
      <td>2.575000</td>
      <td>3.075000</td>
      <td>2.575000</td>
      <td>4.450000</td>
      <td>3.150000</td>
      <td>2.575000</td>
      <td>3.075000</td>
      <td>4.450000</td>
      <td>4.450000</td>
      <td>2.575000</td>
      <td>4.450000</td>
      <td>2.575000</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>3.291667</td>
      <td>3.770833</td>
      <td>3.291667</td>
      <td>2.437500</td>
      <td>3.312500</td>
      <td>4.145833</td>
      <td>3.770833</td>
      <td>2.437500</td>
      <td>2.437500</td>
      <td>4.145833</td>
      <td>2.437500</td>
      <td>3.291667</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>3.810811</td>
      <td>3.675676</td>
      <td>3.810811</td>
      <td>1.783784</td>
      <td>3.351351</td>
      <td>4.270270</td>
      <td>3.675676</td>
      <td>1.783784</td>
      <td>1.783784</td>
      <td>4.270270</td>
      <td>1.783784</td>
      <td>3.810811</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="more-comments-on-content-based-filtering">
<h3>More comments on content-based filtering<a class="headerlink" href="#more-comments-on-content-based-filtering" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The feature matrix for movies can contain different types of features.</p>
<ul>
<li><p>Example: Plot of the movie (text features), actors (categorical features), year of the movie, budget and revenue of the movie (numerical features).</p></li>
<li><p>You’ll apply our usual preprocessing techniques to these features.</p></li>
</ul>
</li>
<li><p>If you have enough data, you could also carry out hyperparameter tuning with cross-validation for each model.</p></li>
<li><p>Finally, although we have been talking about linear models above, you can use any regression model of your choice.</p></li>
</ul>
</section>
<section id="advantages-of-content-based-filtering">
<h3>Advantages of content-based filtering<a class="headerlink" href="#advantages-of-content-based-filtering" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We don’t need many users to provide ratings for an item.</p></li>
<li><p>Each user is modeled separately, so you might be able to capture uniqueness of taste.</p></li>
<li><p>Since you can obtain the features of the items, you can immediately recommend new items.</p>
<ul>
<li><p>This would not have been possible with collaborative filtering.</p></li>
</ul>
</li>
<li><p>Recommendations are interpretable.</p>
<ul>
<li><p>You can explain to the user why you are recommending an item because you have learned weights.</p></li>
</ul>
</li>
</ul>
</section>
<section id="disadvantages-of-content-based-filtering">
<h3>Disadvantages of content-based filtering<a class="headerlink" href="#disadvantages-of-content-based-filtering" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Feature acquisition and feature engineering</p>
<ul>
<li><p>What features should we use to explain the difference in ratings?</p></li>
<li><p>Obtaining those features for each item might be very expensive.</p></li>
</ul>
</li>
<li><p>Less diversity: hardly recommend an item outside the user’s profile.</p></li>
<li><p>Cold start: When a new user shows up, you don’t have any information about them.</p></li>
</ul>
</section>
<section id="hybrid-filtering">
<h3>Hybrid filtering<a class="headerlink" href="#hybrid-filtering" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Combining advantages of collaborative filtering and content-based filtering</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="final-comments-and-summary-a-name-1-a">
<h2>Final comments and summary <a name="1"></a><a class="headerlink" href="#final-comments-and-summary-a-name-1-a" title="Permalink to this heading">#</a></h2>
<section id="formulating-the-problem-of-recommender-systems">
<h3>Formulating the problem of recommender systems<a class="headerlink" href="#formulating-the-problem-of-recommender-systems" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We are given ratings data.</p></li>
<li><p>We use this data to create <strong>utility matrix</strong> which encodes interactions between users and items.</p></li>
<li><p>The utility matrix has many missing entries.</p></li>
<li><p>We defined recommendation systems problem as <strong>matrix completion problem</strong>.</p></li>
</ul>
</section>
<section id="what-did-we-cover">
<h3>What did we cover?<a class="headerlink" href="#what-did-we-cover" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>There is a big world of recommendation systems out there. We talked about some basic traditional approaches to recommender systems.</p>
<ul>
<li><p>collaborative filtering (high level)</p></li>
<li><p>content-based filtering</p></li>
</ul>
</li>
</ul>
<p>If you want to know more advanced approaches to recommender systems, watch this 4-hour summer school tutorial by Xavier Amatriain, Research/Engineering Director &#64; Netflix.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=bLhq63ygoU8">Part1</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=mRToFXlNBpQ">Part2</a></p></li>
</ul>
</section>
<section id="id9">
<h3>Evaluation<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We split the data similar to supervised systems.</p></li>
<li><p>We evaluate recommendation systems using traditional regression metrics such as MSE or RMSE.</p></li>
<li><p>But real evaluation of recommender system can be very tricky because there is no ground truth.</p></li>
<li><p>We have been using RMSE due to the lack of a better measure.</p></li>
<li><p>What we actually want to measure is the interest that our user has in the recommended items.</p></li>
</ul>
</section>
<section id="beyond-error-rate-in-recommendation-systems">
<h3>Beyond error rate in recommendation systems<a class="headerlink" href="#beyond-error-rate-in-recommendation-systems" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>If a system gives the best RMSE it doesn’t necessarily mean that it’s going to give best recommendations.</p></li>
<li><p>In recommendation systems we do not have ground truth.</p></li>
<li><p>Just training your model and evaluating it offline is not ideal.</p></li>
<li><p>Other aspects such as simplicity, interpretation, code maintainability are equally (if not more) important than best validation error.</p></li>
<li><p>Winning system of Netflix Challenge was never adopted.</p>
<ul>
<li><p>Big mess of ensembles was not really maintainable</p></li>
</ul>
</li>
<li><p>There are other considerations.</p></li>
</ul>
</section>
<section id="other-issues-important-in-recommender-systems">
<h3>Other issues important in recommender systems<a class="headerlink" href="#other-issues-important-in-recommender-systems" title="Permalink to this heading">#</a></h3>
</section>
<section id="are-these-good-recommendations">
<h3>Are these good recommendations?<a class="headerlink" href="#are-these-good-recommendations" title="Permalink to this heading">#</a></h3>
<p>You are looking for water shoes and at the moment you are looking at <a class="reference external" href="https://www.amazon.ca/VIFUUR-Barefoot-Quick-Dry-Blue-38-39/dp/B0753DL15Y">VIFUUR Water Sports Shoes</a>, are these good recommendations?</p>
<p><img alt="" src="../_images/reco-diversity.png" /></p>
<p>Now suppose you’ve recently bought VIFUUR Water Sports Shoes and rated them highly. Are these good recommendations now?</p>
<ul class="simple">
<li><p>Not really. Even though you really liked them you don’t need them anymore. You want some non-Water Sports Shoes recommendations.</p></li>
<li><p><strong>Diversity</strong> is about how different are the recommendations.</p>
<ul>
<li><p>Another example: Even if you really really like Star Wars, you might want non-Star-Wars suggestions.</p></li>
</ul>
</li>
<li><p>But be careful. We need a balance here.</p></li>
</ul>
</section>
<section id="id10">
<h3>Are these good recommendations?<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<p><img alt="" src="../_images/freshness.png" /></p>
<ul class="simple">
<li><p>Some of these books don’t have many ratings but it might be a good idea to recommend “fresh” things.</p></li>
<li><p><strong>Freshness</strong>: people tend to get more excited about new/surprising things.</p></li>
</ul>
<ul class="simple">
<li><p>But again you need a balance here. What would happen if you keep surprising the user all the time?</p></li>
<li><p>There might be <strong>trust</strong> issues.</p></li>
<li><p>Another aspect of trust is explaining your recommendation, i.e., telling the user why you made a recommendation. This gives the user an opportunity to understand why your recommendations could be interesting to them.</p></li>
</ul>
<p><img alt="" src="../_images/recommendation-explanation.png" /></p>
<p><a class="reference external" href="https://sudonull.com/post/65548-10-lessons-of-the-Quora-recommendation-system-Retail-Rocket-Blog">Source</a></p>
<p><strong>Persistence</strong>: how long should recommendations last?</p>
<ul class="simple">
<li><p>If you keep not clicking on a recommendation, should it remain a recommendation?</p></li>
</ul>
<p><strong>Social recommendation</strong>: what did your friends watch?</p>
<ul class="simple">
<li><p>Many recommenders	are	now	connected to social	networks.</p></li>
<li><p>“Login using you Facebook	account”.</p></li>
<li><p>Often, people	like similar movies	to their friends.</p></li>
<li><p>If we get a new user, then recommendations are based on friend’s preferences.</p></li>
</ul>
</section>
<section id="types-of-data">
<h3>Types of data<a class="headerlink" href="#types-of-data" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Explicit data: ratings, thumbs up, etc.</p></li>
<li><p>Implicit data: collected from the users’ behaviour (e.g., mouse clicks, purchases, time spent doing something)</p></li>
<li><p>Trust implicit data that costs something, like time or even money.</p>
<ul>
<li><p>this makes it harder to fraud</p></li>
</ul>
</li>
</ul>
</section>
<section id="some-thoughts-on-recommendation-systems">
<h3>Some thoughts on recommendation systems<a class="headerlink" href="#some-thoughts-on-recommendation-systems" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Be mindful of the consequences of recommendation systems.</p>
<ul>
<li><p>Recommendation systems can have terrible consequences.</p></li>
</ul>
</li>
<li><p>Companies such as Amazon,  Netflix, Facebook, Google (YouTube), which extensively use recommendation systems, are profit-driven and so they design these systems to maximize user attention; their focus is not necessarily human well-being.</p></li>
<li><p>There are tons of news and research articles on serious consequences of recommendation systems.</p></li>
</ul>
</section>
<section id="id11">
<h3>Some thoughts on recommendation systems<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Some weird stories which got media attention.<br />
<a class="reference external" href="https://www.forbes.com/sites/kashmirhill/2012/02/16/how-target-figured-out-a-teen-girl-was-pregnant-before-her-father-did/?sh=3171af136668">How Target Figured Out A Teen Girl Was Pregnant Before Her Father Did</a></p></li>
<li><p>More serious consequences are in political contexts.</p>
<ul>
<li><p><a class="reference external" href="https://www.nytimes.com/2018/11/06/technology/myanmar-facebook.html">Facebook Admits It Was Used to Incite Violence in Myanmar</a></p></li>
<li><p><a class="reference external" href="https://www.theatlantic.com/politics/archive/2018/03/youtube-extremism-and-the-long-tail/555350/">YouTube Extremism and the Long Tail</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="my-advice">
<h3>My advice<a class="headerlink" href="#my-advice" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Ask hard and uncomfortable questions to yourself (and to your employer if possible) before implementing and deploying such systems.</p></li>
</ul>
</section>
<section id="resources">
<h3>Resources<a class="headerlink" href="#resources" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=z0dx-YckFko">Collaborative filtering for recommendation systems in Python, by N. Hug</a></p></li>
<li><p><a class="reference external" href="https://www.ted.com/talks/barry_schwartz_the_paradox_of_choice">An interesting talk: The paradox of choice</a></p></li>
<li><p><a class="reference external" href="https://help.netflix.com/en/node/100639">How Netflix’s Recommendations System Works</a></p></li>
<li><p><a class="reference external" href="https://learning.oreilly.com/library/view/hands-on-recommendation-systems/9781788993753/">Hands on Recommendation Systems with Python</a></p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "cpsc330"
        },
        kernelOptions: {
            name: "cpsc330",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'cpsc330'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="15_DBSCAN-hierarchical.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 15: More Clustering</p>
      </div>
    </a>
    <a class="right-next"
       href="17_natural-language-processing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 17: Introduction to natural language processing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes-a-name-lo-a">Learning outcomes <a name="lo"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommender-systems-motivation">Recommender systems motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-recommender-system">What is a recommender system?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-recommender-systems">Example: Recommender Systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-should-we-care-about-recommendation-systems">Why should we care about recommendation systems?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-capstone-project-qxmd">An example Capstone project: QxMD</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-kind-of-data-we-need-to-build-recommendation-systems">What kind of data we need to build recommendation systems?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#main-approaches">Main approaches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-netflix-prize">The Netflix prize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">The Netflix prize</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommender-systems-problem">Recommender systems problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-formulation">Problem formulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utility-matrix">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sparsity-of-utility-matrix">Sparsity of utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-do-we-predict">What do we predict?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-dataset-jester-1-7m-jokes-ratings-dataset">Example dataset: Jester 1.7M jokes ratings dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-stats">Dataset stats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-utility-matrix">Creating utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utility-matrix-for-the-example-problem">Utility matrix for the example problem</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-approaches">Baseline Approaches</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation">Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-splitting">Data splitting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Questions for you</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baselines">Baselines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-average-baseline">Global average baseline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nearest-neighbours-imputation"><span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours imputation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-nearest-neighbors">Finding nearest neighbors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-k-nearest-neighbours-on-a-query-joke">(Optional) <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours on a query joke</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-to-do-with-predictions">What to do with predictions?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#collaborative-filtering">Collaborative filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Collaborative filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-or-regression">Classification or regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rating-prediction">Rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#toy-movie-recommendation-example">Toy movie recommendation example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rating-prediction-using-the-surprise-package">Rating prediction using the surprise package</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-cross-validation-for-recommender-systems">(Optional) Cross-validation for recommender systems</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content-based-filtering">Content-based filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-content-based-filtering">What is content-based filtering?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#item-and-user-features">Item and user features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#toy-example-movie-recommendation">Toy example: Movie recommendation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ratings-data">Ratings data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Utility matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#movie-features">Movie features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overall-idea">Overall idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pat-s-ratings">Pat’s ratings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-approach-to-rating-prediction">Supervised approach to rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Supervised approach to rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-build-user-profiles">Let’s build user profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-user-profiles">Examine user profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pat-s-profile">Pat’s profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eva-s-profile">Eva’s profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-models-for-users">Regression models for users</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-model-for-pat">Regression model for Pat</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictions-for-pat">Predictions for Pat</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-model-for-eva">Regression model for Eva</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictions-for-eva">Predictions for Eva</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completing-the-utility-matrix-with-content-based-filtering">Completing the utility matrix with content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-comments-on-content-based-filtering">More comments on content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-content-based-filtering">Advantages of content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#disadvantages-of-content-based-filtering">Disadvantages of content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hybrid-filtering">Hybrid filtering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-comments-and-summary-a-name-1-a">Final comments and summary <a name="1"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formulating-the-problem-of-recommender-systems">Formulating the problem of recommender systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-cover">What did we cover?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-error-rate-in-recommendation-systems">Beyond error rate in recommendation systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-issues-important-in-recommender-systems">Other issues important in recommender systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#are-these-good-recommendations">Are these good recommendations?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Are these good recommendations?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-data">Types of data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-thoughts-on-recommendation-systems">Some thoughts on recommendation systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Some thoughts on recommendation systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#my-advice">My advice</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>