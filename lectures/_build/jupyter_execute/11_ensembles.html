

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 11: Ensembles &#8212; CPSC 330 Applied Machine Learning 2023W1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/_build/jupyter_execute/11_ensembles';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/UBC-CS-logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/UBC-CS-logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Things you should know</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/README.html">CPSC 330 Documents</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../01_intro.html">Lecture 1: Course Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_decision-trees.html">Lecture 2: Terminology, Baselines, Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_ml-fundamentals.html">Lecture 3: Machine Learning Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_kNNs-SVM-RBF.html">Lecture 4: <span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours and SVM RBFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_preprocessing-pipelines.html">Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_column-transformer-text-feats.html">Lecture 6: <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and Text Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_linear-models.html">Lecture 7: Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_hyperparameter-optimization.html">Lecture 8: Hyperparameter Optimization and Optimization Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_classification-metrics.html">Lecture 9: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_regression-metrics.html">Lecture 10: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11_ensembles.html">Lecture 11: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../12_feat-importances.html">Lecture 12: Feature importances and model transparency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../13_feature-engineering-selection.html">Lecture 13: Feature engineering and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../14_K-Means.html">Lecture 14: K-Means Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../15_DBSCAN-hierarchical.html">Lecture 15: More Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../16_recommender-systems.html">Lecture 16: Recommender Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../17_natural-language-processing.html">Lecture 17: Introduction to natural language processing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/03_class-demo.html">Lecture 3: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/04_class-demo.html">Lecture 4: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/05-06_class-demo.html">Lectures 5 and 6: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/07_class-demo.html">Lectures 7: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/09_class-demo.html">Exploring classification metrics</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../class_demos/14_class-demo.html">Lecture 14: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/15_class-demo.html">Lecture 15: Class demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../Appendix-A.html">Appendix A</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Appendix-B.html">Appendix-B</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../attribution.html">Attributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../LICENSE.html">LICENSE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/lectures/_build/jupyter_execute/11_ensembles.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 11: Ensembles</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-announcements-los">Imports, announcements, LOs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-learning-objectives">Lecture learning objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation-video">Motivation [video]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-11-0">iClicker Exercise 11.0</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-netflix-prize">The Netflix prize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-based-ensemble-models">Tree-based ensemble models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-based-models">Tree-based models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-we-have-class-imbalance">Do we have class imbalance?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baselines">Baselines</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dummyclassifier-baseline"><code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> baseline</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#decisiontreeclassifier-baseline"><code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> baseline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forests">Random forests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea">General idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#randomforestclassifier"><code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-they-work">How do they work?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inject-randomness-in-the-classifier-construction">Inject randomness in the classifier construction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-of-a-bootstrap-samples">An example of a bootstrap samples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-random-forests-classifier">The random forests classifier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-important-hyperparameters">Some important hyperparameters:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forests-number-of-trees-n-estimators-and-the-fundamental-tradeoff">Random forests: number of trees (<code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>) and the fundamental tradeoff</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-trees-and-fundamental-trade-off">Number of trees and fundamental trade-off</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strengths-and-weaknesses">Strengths and weaknesses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weaknesses">Weaknesses</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-11-1">iClicker Exercise 11.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosted-trees-video">Gradient boosted trees [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-prediction-in-boosted-regression-trees">(Optional) Prediction in boosted regression trees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-fitting-in-boosted-regression-trees">(Optional) Fitting in boosted regression trees.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm">LightGBM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#catboost">CatBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#important-hyperparameters">Important hyperparameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosting-in-sklearn">Gradient boosting in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#which-model-should-i-use">Which model should I use?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#averaging">Averaging</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-kind-of-estimators-can-we-combine">What kind of estimators can we combine?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">❓❓ Questions for you</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stacking">Stacking</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-effective-strategy">An effective strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-papers">Relevant papers</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="lectures/_build/jupyter_execute/img/330-banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-11-ensembles">
<h1>Lecture 11: Ensembles<a class="headerlink" href="#lecture-11-ensembles" title="Permalink to this heading">#</a></h1>
<p>UBC 2023-24</p>
<p>Instructor: Varada Kolhatkar and Andrew Roth</p>
<blockquote>
The interests of truth require a diversity of opinions.    
<p>by John Stuart Mill</p>
</blockquote>
<section id="imports-announcements-los">
<h2>Imports, announcements, LOs<a class="headerlink" href="#imports-announcements-los" title="Permalink to this heading">#</a></h2>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="s2">&quot;code&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GridSearchCV</span><span class="p">,</span>
    <span class="n">RandomizedSearchCV</span><span class="p">,</span>
    <span class="n">cross_val_score</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">14</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="s2">&quot;code&quot;</span><span class="p">))</span>
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;plotting_functions&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="lecture-learning-objectives">
<h2>Lecture learning objectives<a class="headerlink" href="#lecture-learning-objectives" title="Permalink to this heading">#</a></h2>
<p>From this lecture, you will be able to</p>
<ul class="simple">
<li><p>Broadly explain the idea of ensembles</p></li>
<li><p>Explain how does predict work in the context of random forest models</p></li>
<li><p>Explain the sources of randomness in random forest algorithm</p></li>
<li><p>Explain the relation between number of estimators and the fundamental tradeoff in the context of random forests</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s random forest classification and regression models and explain their main hyperparameters</p></li>
<li><p>Use other tree-based models such as as <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code>, <code class="docutils literal notranslate"><span class="pre">LGBM</span></code> and <code class="docutils literal notranslate"><span class="pre">CatBoost</span></code></p></li>
<li><p>Broadly explain ensemble approaches, in particular model averaging and stacking.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> implementations of these ensemble methods.</p></li>
</ul>
</section>
<section id="motivation-video">
<h2>Motivation [<a class="reference external" href="https://youtu.be/8litm1H7DLo">video</a>]<a class="headerlink" href="#motivation-video" title="Permalink to this heading">#</a></h2>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-11-0">
<h3>iClicker Exercise 11.0<a class="headerlink" href="#iclicker-exercise-11-0" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p>Which of the following scenarios has worked effectively for you in the past?</p>
<ul class="simple">
<li><p>(A) Working independently on a project/assignment.</p></li>
<li><p>(B) Working with like-minded people.</p></li>
<li><p>(C) Teaming up with a diverse group offering varied perspectives and skills.</p></li>
</ul>
<ul class="simple">
<li><p><strong>Ensembles</strong> are models that combine multiple machine learning models to create more powerful models.</p></li>
</ul>
</section>
<section id="the-netflix-prize">
<h3>The Netflix prize<a class="headerlink" href="#the-netflix-prize" title="Permalink to this heading">#</a></h3>
<p><img alt="" src="lectures/_build/jupyter_execute/img/netflix.png" /></p>
<p><a class="reference external" href="https://netflixtechblog.com/netflix-recommendations-beyond-the-5-stars-part-1-55838468f429">Source</a></p>
<p>Read the <a class="reference external" href="https://lsa.umich.edu/social-solutions/diversity-democracy/oci-series/excerpts/volume-ii/the-netflix-prize.html">story</a> here.</p>
<ul class="simple">
<li><p>Most of the winning solutions for Kaggle competitions involve some kind of ensembling. For example:</p></li>
</ul>
<a class="reference internal image-reference" href="lectures/_build/jupyter_execute/img/fraud_detection_kaggle.png"><img alt="lectures/_build/jupyter_execute/img/fraud_detection_kaggle.png" src="lectures/_build/jupyter_execute/img/fraud_detection_kaggle.png" style="width: 600px; height: 600px;" /></a>
<p>Key idea: Groups can often make better decisions than individuals, especially when group members are diverse enough.</p>
<p><a class="reference external" href="http://wisdomofcrowds.blogspot.com/2009/12/introduction-part-i.html">The Wisdom of Crowds</a></p>
<a class="reference internal image-reference" href="lectures/_build/jupyter_execute/img/wisdom_of_crowds.jpg"><img alt="lectures/_build/jupyter_execute/img/wisdom_of_crowds.jpg" src="lectures/_build/jupyter_execute/img/wisdom_of_crowds.jpg" style="width: 300px; height: 300px;" /></a>
</section>
<section id="tree-based-ensemble-models">
<h3>Tree-based ensemble models<a class="headerlink" href="#tree-based-ensemble-models" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A number of ensemble models in ML literature.</p></li>
<li><p>Most successful ones on a variety of datasets are tree-based models.</p></li>
<li><p>We’ll briefly talk about two such models:</p>
<ul>
<li><p>Random forests</p></li>
<li><p>Gradient boosted trees</p></li>
</ul>
</li>
<li><p>We’ll also talk about averaging and stacking.</p></li>
</ul>
</section>
<section id="tree-based-models">
<h3>Tree-based models<a class="headerlink" href="#tree-based-models" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Decision trees models are</p>
<ul>
<li><p>Interpretable</p></li>
<li><p>They can capture non-linear relationships</p></li>
<li><p>They don’t require scaling of the data and theoretically can work with categorical features and missing values.</p></li>
</ul>
</li>
<li><p>But single decision trees are likely to overfit.</p></li>
</ul>
<ul class="simple">
<li><p>Key idea: Combine multiple trees to build stronger models.</p></li>
<li><p>These kinds of models are extremely popular in industry and machine learning competitions.</p></li>
<li><p>We are going to cover how to use a few popular tree-based models:</p>
<ul>
<li><p>Random forests</p></li>
<li><p>Gradient boosted trees (very high level)</p></li>
</ul>
</li>
<li><p>We will also talk about two common ways to combine different models:</p>
<ul>
<li><p>Averaging</p></li>
<li><p>Stacking</p></li>
</ul>
</li>
</ul>
</section>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s work with <a class="reference external" href="https://www.kaggle.com/uciml/adult-census-income">the adult census data set</a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adult_df_large</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/adult.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">adult_df_large</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">train_df_nan</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">test_df_nan</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">train_df_nan</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>fnlwgt</th>
      <th>education</th>
      <th>education.num</th>
      <th>marital.status</th>
      <th>occupation</th>
      <th>relationship</th>
      <th>race</th>
      <th>sex</th>
      <th>capital.gain</th>
      <th>capital.loss</th>
      <th>hours.per.week</th>
      <th>native.country</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5514</th>
      <td>26</td>
      <td>Private</td>
      <td>256263</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Never-married</td>
      <td>Craft-repair</td>
      <td>Not-in-family</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>25</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>19777</th>
      <td>24</td>
      <td>Private</td>
      <td>170277</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Never-married</td>
      <td>Other-service</td>
      <td>Not-in-family</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>35</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>10781</th>
      <td>36</td>
      <td>Private</td>
      <td>75826</td>
      <td>Bachelors</td>
      <td>13</td>
      <td>Divorced</td>
      <td>Adm-clerical</td>
      <td>Unmarried</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>32240</th>
      <td>22</td>
      <td>State-gov</td>
      <td>24395</td>
      <td>Some-college</td>
      <td>10</td>
      <td>Married-civ-spouse</td>
      <td>Adm-clerical</td>
      <td>Wife</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>9876</th>
      <td>31</td>
      <td>Local-gov</td>
      <td>356689</td>
      <td>Bachelors</td>
      <td>13</td>
      <td>Married-civ-spouse</td>
      <td>Prof-specialty</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;capital.gain&quot;</span><span class="p">,</span> <span class="s2">&quot;capital.loss&quot;</span><span class="p">,</span> <span class="s2">&quot;hours.per.week&quot;</span><span class="p">]</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;workclass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;marital.status&quot;</span><span class="p">,</span>
    <span class="s2">&quot;occupation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;relationship&quot;</span><span class="p">,</span>
    <span class="s2">&quot;native.country&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ordinal_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">]</span>
<span class="n">binary_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span>
<span class="n">drop_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fnlwgt&quot;</span><span class="p">,</span> <span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;education.num&quot;</span><span class="p">]</span>
<span class="n">target_column</span> <span class="o">=</span> <span class="s2">&quot;income&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">education_levels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Preschool&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1st-4th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5th-6th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;7th-8th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;9th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;10th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;11th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;12th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HS-grad&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Prof-school&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Assoc-voc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Assoc-acdm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Some-college&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Bachelors&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Masters&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Doctorate&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">education_levels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="n">ordinal_transformer</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">education_levels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="n">binary_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;if_binary&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer</span><span class="p">,</span> <span class="n">ordinal_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary_transformer</span><span class="p">,</span> <span class="n">binary_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;,
                                  &#x27;hours.per.week&#x27;]),
                                (&#x27;ordinalencoder&#x27;,
                                 OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                             &#x27;1st-4th&#x27;,
                                                             &#x27;5th-6th&#x27;,
                                                             &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                                                             &#x27;10th&#x27;, &#x27;11th&#x27;,
                                                             &#x27;12th&#x27;, &#x27;HS-grad&#x27;,
                                                             &#x27;Prof-school&#x27;,
                                                             &#x27;Assoc-voc&#x27;,
                                                             &#x27;Assoc-acdm&#x27;,
                                                             &#x27;Some-college&#x27;,
                                                             &#x27;Bachelors&#x27;,
                                                             &#x27;Masters&#x27;,
                                                             &#x27;Doctorate&#x27;]],
                                                dtype=&lt;class...
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;,
                                                                dtype=&lt;class &#x27;int&#x27;&gt;))]),
                                 [&#x27;sex&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;,
                                  &#x27;relationship&#x27;, &#x27;native.country&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;,
                                  &#x27;hours.per.week&#x27;]),
                                (&#x27;ordinalencoder&#x27;,
                                 OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                             &#x27;1st-4th&#x27;,
                                                             &#x27;5th-6th&#x27;,
                                                             &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                                                             &#x27;10th&#x27;, &#x27;11th&#x27;,
                                                             &#x27;12th&#x27;, &#x27;HS-grad&#x27;,
                                                             &#x27;Prof-school&#x27;,
                                                             &#x27;Assoc-voc&#x27;,
                                                             &#x27;Assoc-acdm&#x27;,
                                                             &#x27;Some-college&#x27;,
                                                             &#x27;Bachelors&#x27;,
                                                             &#x27;Masters&#x27;,
                                                             &#x27;Doctorate&#x27;]],
                                                dtype=&lt;class...
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;,
                                                                dtype=&lt;class &#x27;int&#x27;&gt;))]),
                                 [&#x27;sex&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;,
                                  &#x27;relationship&#x27;, &#x27;native.country&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;, &#x27;hours.per.week&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">ordinalencoder</label><div class="sk-toggleable__content"><pre>[&#x27;education&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Preschool&#x27;, &#x27;1st-4th&#x27;, &#x27;5th-6th&#x27;, &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                            &#x27;10th&#x27;, &#x27;11th&#x27;, &#x27;12th&#x27;, &#x27;HS-grad&#x27;, &#x27;Prof-school&#x27;,
                            &#x27;Assoc-voc&#x27;, &#x27;Assoc-acdm&#x27;, &#x27;Some-college&#x27;,
                            &#x27;Bachelors&#x27;, &#x27;Masters&#x27;, &#x27;Doctorate&#x27;]],
               dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;sex&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;if_binary&#x27;, dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;native.country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df_nan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_column</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df_nan</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df_nan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_column</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df_nan</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="do-we-have-class-imbalance">
<h3>Do we have class imbalance?<a class="headerlink" href="#do-we-have-class-imbalance" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>There is class imbalance. But without any context, both classes seem equally important.</p></li>
<li><p>Let’s use accuracy as our metric.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>income
&lt;=50K    0.757985
&gt;50K     0.242015
Name: proportion, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scoring_metric</span> <span class="o">=</span> <span class="s2">&quot;accuracy&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>We are going to use models outside sklearn. Some of them cannot handle categorical target values. So we’ll convert them to integers using <code class="docutils literal notranslate"><span class="pre">LabelEncoder</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>

<span class="n">label_encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">y_train_num</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_test_num</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train_num</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 0, 0, ..., 1, 1, 0])
</pre></div>
</div>
</div>
</div>
<p>Let’s store all the results in a dictionary called <code class="docutils literal notranslate"><span class="pre">results</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="baselines">
<h3>Baselines<a class="headerlink" href="#baselines" title="Permalink to this heading">#</a></h3>
<section id="dummyclassifier-baseline">
<h4><code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> baseline<a class="headerlink" href="#dummyclassifier-baseline" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_num</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="decisiontreeclassifier-baseline">
<h4><code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> baseline<a class="headerlink" href="#decisiontreeclassifier-baseline" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Let’s try decision tree classifier on our data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_dt</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Decision tree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_dt</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_num</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.002 (+/- 0.001)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision tree</th>
      <td>0.118 (+/- 0.008)</td>
      <td>0.011 (+/- 0.001)</td>
      <td>0.817 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Decision tree is clearly overfitting.</p>
<p><br><br><br><br></p>
</section>
</section>
</section>
<section id="random-forests">
<h2>Random forests<a class="headerlink" href="#random-forests" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="lectures/_build/jupyter_execute/img/eva-forest.jpg" /></p>
<section id="general-idea">
<h3>General idea<a class="headerlink" href="#general-idea" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A single decision tree is likely to overfit</p></li>
<li><p>Use a collection of diverse decision trees</p></li>
<li><p>Each tree overfits on some part of the data but we can reduce overfitting by averaging the results</p>
<ul>
<li><p>can be shown mathematically</p></li>
</ul>
</li>
</ul>
</section>
<section id="randomforestclassifier">
<h3><code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code><a class="headerlink" href="#randomforestclassifier" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Before understanding the details let’s first try it out.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="n">pipe_rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">RandomForestClassifier</span><span class="p">(</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Random forests&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_num</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.002 (+/- 0.001)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Decision tree</th>
      <td>0.118 (+/- 0.008)</td>
      <td>0.011 (+/- 0.001)</td>
      <td>0.817 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Random forests</th>
      <td>0.358 (+/- 0.023)</td>
      <td>0.037 (+/- 0.001)</td>
      <td>0.847 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The validation scores are better although it seems likes we are still overfitting.</p>
</section>
<section id="how-do-they-work">
<h3>How do they work?<a class="headerlink" href="#how-do-they-work" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Decide how many decision trees we want to build</p>
<ul>
<li><p>can control with <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> hyperparameter</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code> a diverse set of that many decision trees by <strong>injecting randomness</strong> in the model construction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">predict</span></code> by voting (classification) or averaging (regression) of predictions given by individual models</p></li>
</ul>
</section>
<section id="inject-randomness-in-the-classifier-construction">
<h3>Inject randomness in the classifier construction<a class="headerlink" href="#inject-randomness-in-the-classifier-construction" title="Permalink to this heading">#</a></h3>
<p>To ensure that the trees in the random forest are different we inject randomness in two ways:</p>
<ol class="arabic simple">
<li><p>Data: <strong>Build each tree on a bootstrap sample</strong> (i.e., a sample drawn <strong>with replacement</strong> from the training set)</p></li>
<li><p>Features: <strong>At each node, select a random subset of features</strong> (controlled by <code class="docutils literal notranslate"><span class="pre">max_features</span></code> in <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>) and look for the best possible test involving one of these features</p></li>
</ol>
</section>
<section id="an-example-of-a-bootstrap-samples">
<h3>An example of a bootstrap samples<a class="headerlink" href="#an-example-of-a-bootstrap-samples" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Suppose you are training a random forest model with <code class="docutils literal notranslate"><span class="pre">n_estimators=3</span></code>.</p></li>
<li><p>Suppose this is your original dataset with six examples: [0,1,2,3,4,5]</p>
<ul>
<li><p>a sample drawn with replacement for tree 1: [1,1,3,3,3,4]</p></li>
<li><p>a sample drawn with replacement for tree 2: [3,2,2,2,1,1]</p></li>
<li><p>a sample drawn with replacement for tree 3: [0,0,0,4,4,5]</p></li>
</ul>
</li>
<li><p>Each decision tree trains on a total of six examples.</p></li>
<li><p>Each tree trains on a different set of examples.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_forest_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;original&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;tree1&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;tree2&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;tree3&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">random_forest_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original</th>
      <th>tree1</th>
      <th>tree2</th>
      <th>tree3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="the-random-forests-classifier">
<h3>The random forests classifier<a class="headerlink" href="#the-random-forests-classifier" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Create a collection (ensemble) of trees. Grow each tree on an independent bootstrap sample from the data.</p></li>
<li><p>At each node:</p>
<ul>
<li><p>Randomly select a subset of features out of all features (independently for each node).</p></li>
<li><p>Find the best split on the selected features.</p></li>
<li><p>Grow the trees to maximum depth.</p></li>
</ul>
</li>
<li><p>Prediction time</p>
<ul>
<li><p>Vote the trees to get predictions for new example.</p></li>
</ul>
</li>
</ul>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s create a random forest with 3 estimators.</p></li>
<li><p>I’m using <code class="docutils literal notranslate"><span class="pre">max_depth=2</span></code> for easy visualization.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_demo</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_num</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s get the feature names of transformed features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_names</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_features</span>
    <span class="o">+</span> <span class="n">ordinal_features</span>
    <span class="o">+</span> <span class="n">binary_features</span>
    <span class="o">+</span> <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;columntransformer&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-2&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">feature_names</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;age&#39;,
 &#39;capital.gain&#39;,
 &#39;capital.loss&#39;,
 &#39;hours.per.week&#39;,
 &#39;education&#39;,
 &#39;sex&#39;,
 &#39;workclass_Federal-gov&#39;,
 &#39;workclass_Local-gov&#39;,
 &#39;workclass_Never-worked&#39;,
 &#39;workclass_Private&#39;]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s sample a test example where income &gt; 50k.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probs</span> <span class="o">=</span> <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">probs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.55</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([ 582, 1271, 1991, 2268, 2447, 2516, 2556, 4151, 4165, 5294, 5798,
        5970, 6480]),)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">582</span><span class="p">]]</span>
<span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_example</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Classes: &quot;</span><span class="p">,</span> <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction by random forest: &quot;</span><span class="p">,</span> <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_example</span><span class="p">))</span>
<span class="n">transformed_example</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_example</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">transformed_example</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Classes:  [0 1]
Prediction by random forest:  [1]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>age</th>
      <td>0.550004</td>
    </tr>
    <tr>
      <th>capital.gain</th>
      <td>-0.147166</td>
    </tr>
    <tr>
      <th>capital.loss</th>
      <td>-0.217680</td>
    </tr>
    <tr>
      <th>hours.per.week</th>
      <td>1.579660</td>
    </tr>
    <tr>
      <th>education</th>
      <td>15.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>native.country_Trinadad&amp;Tobago</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>native.country_United-States</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>native.country_Vietnam</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>native.country_Yugoslavia</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>native.country_missing</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>85 rows × 1 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>We can look at different trees created by random forest.</p></li>
<li><p>Note that each tree looks at different set of features and slightly different data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;randomforestclassifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">estimators_</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Tree&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">custom_plot_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_example</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tree 1
</pre></div>
</div>
<img alt="../../../_images/2e2ddc3b54caef96a6d1dbb59b7e65243ce320abcfaae3210e8692c02c5d84bb.png" src="../../../_images/2e2ddc3b54caef96a6d1dbb59b7e65243ce320abcfaae3210e8692c02c5d84bb.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>prediction [0.]


Tree 2
</pre></div>
</div>
<img alt="../../../_images/3bc384ca70ce2722a667a563c2963e6544d1b77f9c70ff195d8352330adc586f.png" src="../../../_images/3bc384ca70ce2722a667a563c2963e6544d1b77f9c70ff195d8352330adc586f.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>prediction [1.]


Tree 3
</pre></div>
</div>
<img alt="../../../_images/3e296dfcbdf337572a8b7c19182c4fa5455813957bbcaf6a758bb3d850fd9c88.png" src="../../../_images/3e296dfcbdf337572a8b7c19182c4fa5455813957bbcaf6a758bb3d850fd9c88.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>prediction [1.]
</pre></div>
</div>
</div>
</div>
</section>
<section id="some-important-hyperparameters">
<h3>Some important hyperparameters:<a class="headerlink" href="#some-important-hyperparameters" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>: number of decision trees (higher = more complexity)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: max depth of each decision tree (higher = more complexity)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_features</span></code>: the number of features you get to look at each split (higher = more complexity)</p></li>
</ul>
</section>
<section id="random-forests-number-of-trees-n-estimators-and-the-fundamental-tradeoff">
<h3>Random forests: number of trees (<code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>) and the fundamental tradeoff<a class="headerlink" href="#random-forests-number-of-trees-n-estimators-and-the-fundamental-tradeoff" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">make_num_tree_plot</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="p">)</span> <span class="c1"># User-defined function defined in code/plotting_functions.py </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7e3d59d9370229ebf0a1390eb002c9eef0d723cf48d707359a704e7b94d963ad.png" src="../../../_images/7e3d59d9370229ebf0a1390eb002c9eef0d723cf48d707359a704e7b94d963ad.png" />
</div>
</div>
<section id="number-of-trees-and-fundamental-trade-off">
<h4>Number of trees and fundamental trade-off<a class="headerlink" href="#number-of-trees-and-fundamental-trade-off" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Above: seems like we’re beating the fundamental “tradeoff” by increasing training score and not decreasing validation score much.</p></li>
<li><p>You’ll often see a high training scores for in the context of random forests. That’s normal. It doesn’t mean that the model is overfitting.</p></li>
<li><p>While ensembles often offer improved performance, this benefit isn’t always guaranteed.</p></li>
<li><p>Always opting for more trees in a random forest is preferable, but we sometimes choose fewer trees for faster performance.</p></li>
</ul>
</section>
</section>
<section id="strengths-and-weaknesses">
<h3>Strengths and weaknesses<a class="headerlink" href="#strengths-and-weaknesses" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Usually one of the best performing off-the-shelf classifiers without heavy tuning of hyperparameters</p></li>
<li><p>Don’t require scaling of data</p></li>
<li><p>Less likely to overfit</p></li>
<li><p>Slower than decision trees because we are fitting multiple trees but can easily parallelize training because all trees are independent of each other</p></li>
<li><p>In general, able to capture a much broader picture of the data compared to a single decision tree.</p></li>
</ul>
</section>
<section id="weaknesses">
<h3>Weaknesses<a class="headerlink" href="#weaknesses" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Require more memory</p></li>
<li><p>Hard to interpret</p></li>
<li><p>Tend not to perform well on high dimensional sparse data such as text data</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>There is also something called <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.ExtraTreesClassifier.html"><code class="docutils literal notranslate"><span class="pre">ExtraTreesClassifier</span></code></a> where randomness goes one step further in the way splits are computed. As in random forests, a random subset of candidate features is used, but instead of looking for the most discriminative thresholds, thresholds are drawn at random for each candidate feature and the best of these randomly-generated thresholds is picked as the splitting rule.
<a class="reference external" href="https://scikit-learn.org/stable/modules/ensemble.html#extremely-randomized-trees">Source</a></p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure to set the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> for reproducibility. Changing the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> can have a big impact on the model and the results due to the random nature of these models. Having more trees can get you a more robust estimate.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.stat.berkeley.edu/~breiman/randomforest2001.pdf">The original random forests paper</a> by Leo Breiman.</p>
</div>
</section>
</section>
<section id="id1">
<h2>❓❓ Questions for you<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-11-1">
<h3>iClicker Exercise 11.1<a class="headerlink" href="#iclicker-exercise-11-1" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p><strong>Select the most accurate option below.</strong></p>
<ul class="simple">
<li><p>(A) Every tree in a random forest uses a different bootstrap sample of the training set.</p></li>
<li><p>(B) To train a tree in a random forest, we first randomly select a subset of features. The tree is then restricted to only using those features.</p></li>
<li><p>(C) The <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> hyperparameter of random forests should be tuned to get a better performance on the validation or test data.</p></li>
<li><p>(D) In random forests we build trees in a sequential fashion, where the current tree is dependent upon the previous tree.</p></li>
<li><p>(E) Let classifiers A, B, and C have training errors of 10%, 20%, and 30%, respectively. Then, the best possible training error from averaging A, B and C is 10%.</p></li>
</ul>
<ul class="simple">
<li><p>Why do we create random forests out of random trees (trees where each stump only looks at a subset of the features, and the dataset is a bootstrap sample) rather than creating them out of regular decision trees?</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="gradient-boosted-trees-video">
<h2>Gradient boosted trees [<a class="reference external" href="https://youtu.be/EkFkY9QB2Hw">video</a>]<a class="headerlink" href="#gradient-boosted-trees-video" title="Permalink to this heading">#</a></h2>
<p>Another popular and effective class of tree-based models is gradient boosted trees.</p>
<ul class="simple">
<li><p>No randomization.</p></li>
<li><p>The key idea is combining many simple models called weak learners to create a strong learner.</p></li>
<li><p>They combine multiple shallow (depth 1 to 5) decision trees.</p></li>
<li><p>They build trees in a serial manner, where each tree tries to correct the mistakes of the previous one.</p></li>
</ul>
<section id="optional-prediction-in-boosted-regression-trees">
<h3>(Optional) Prediction in boosted regression trees<a class="headerlink" href="#optional-prediction-in-boosted-regression-trees" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Credit: Adapted from <a class="reference external" href="https://www.students.cs.ubc.ca/~cs-340/L24.pdf">CPSC 340 notes</a></p></li>
<li><p>Gradient boosting starts with an ensemble of <span class="math notranslate nohighlight">\(k\)</span> shallow decision trees.</p></li>
<li><p>For each example <span class="math notranslate nohighlight">\(i\)</span>, each shallow tree makes a continuous prediction: <span class="math notranslate nohighlight">\(\hat{y}_{i1}, \hat{y}_{i2}, \dots, \hat{y}_{ik}\)</span></p></li>
<li><p>The final prediction is sum of individual predictions: <span class="math notranslate nohighlight">\(\hat{y}_{i1} + \hat{y}_{i2} + \dots + \hat{y}_{ik}\)</span></p></li>
<li><p>Note that we do not use the average as we would with random forests because</p>
<ul>
<li><p>In boosting, each tree is not individually trying to predict the true <span class="math notranslate nohighlight">\(y_i\)</span> value</p></li>
<li><p>Instead, each new tree tries to “fix” the prediction made by the old trees, so that sum is <span class="math notranslate nohighlight">\(y_i\)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="optional-fitting-in-boosted-regression-trees">
<h3>(Optional) Fitting in boosted regression trees.<a class="headerlink" href="#optional-fitting-in-boosted-regression-trees" title="Permalink to this heading">#</a></h3>
<p>Consider the following “gradient tree boosting” procedure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Tree</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Tree</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">y_hat</span> <span class="o">+</span> <span class="n">Tree</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Tree</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">y_hat</span> <span class="o">+</span> <span class="n">Tree</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Tree</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">y_hat</span> <span class="o">+</span> <span class="n">Tree</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Each tree is trying to predict residuals (<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">-</span> <span class="pre">y_hat</span></code>) of current prediction.</p>
<ul>
<li><p>True label is 0.9, old prediction is 0.8, so I can improve <code class="docutils literal notranslate"><span class="pre">y_hat</span></code> by predicting 0.1.</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
<p>We’ll not go into the details. If you want to know more, here are some resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.students.cs.ubc.ca/~cs-340/L24.pdf">UBC CPSC 340 Gradient Boosting notes</a></p></li>
<li><p><a class="reference external" href="https://developers.google.com/machine-learning/decision-forests/intro-to-gbdt">Gradient Boosted Decision Trees by Google Developer</a></p></li>
</ul>
<p>We’ll look at brief examples of using the following three gradient boosted tree models.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://xgboost.readthedocs.io/en/latest/">XGBoost</a></p></li>
<li><p><a class="reference external" href="https://lightgbm.readthedocs.io/en/latest/Python-Intro.html">LightGBM</a></p></li>
<li><p><a class="reference external" href="https://catboost.ai/docs/concepts/python-quickstart.html">CatBoost</a></p></li>
</ul>
</section>
<section id="xgboost">
<h3><a class="reference external" href="https://xgboost.ai/about">XGBoost</a><a class="headerlink" href="#xgboost" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Not part of <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> but has similar interface.</p></li>
<li><p>Install it in your conda environment: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">xgboost</span></code></p></li>
<li><p>Supports missing values</p></li>
<li><p>GPU training, networked parallel training</p></li>
<li><p>Supports sparse data</p></li>
<li><p>Typically better scores than random forests</p></li>
</ul>
</section>
<section id="lightgbm">
<h3><a class="reference external" href="https://lightgbm.readthedocs.io/">LightGBM</a><a class="headerlink" href="#lightgbm" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Not part of <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> but has similar interface.</p></li>
<li><p>Install it in your conda environment: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">lightgbm</span></code></p></li>
<li><p>Small model size</p></li>
<li><p>Faster</p></li>
<li><p>Typically better scores than random forests</p></li>
</ul>
<p>Main hyperparameters</p>
</section>
<section id="catboost">
<h3><a class="reference external" href="https://catboost.ai/">CatBoost</a><a class="headerlink" href="#catboost" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Not part of <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> but has similar interface.</p></li>
<li><p>Install it in your course conda environment: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">catboost</span></code></p></li>
<li><p>Usually better scores but slower compared to <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code> and <code class="docutils literal notranslate"><span class="pre">LightGBM</span></code></p></li>
</ul>
</section>
<section id="important-hyperparameters">
<h3>Important hyperparameters<a class="headerlink" href="#important-hyperparameters" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Number of boosting rounds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">learning_rate</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> The learning rate of training</p>
<ul>
<li><p>controls how strongly each tree tries to correct the mistakes of the previous trees</p></li>
<li><p>higher learning rate means each tree can make stronger corrections, which means more complex model</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> of trees (similar to decision trees)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Balancing of positive and negative weights</p></li>
</ul>
<p>In our demo below, we’ll just give equal weight to both classes because we are trying to optimize accuracy. But if you want to give more weight to class 1, for example, you can calculate the data imbalance ratio and set <code class="docutils literal notranslate"><span class="pre">scale_pos_weight</span></code> hyperparameter with that weight.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train_num</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train_num</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ratio</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.1319796954314723
</pre></div>
</div>
</div>
</div>
</section>
<section id="gradient-boosting-in-sklearn">
<h3>Gradient boosting in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code><a class="headerlink" href="#gradient-boosting-in-sklearn" title="Permalink to this heading">#</a></h3>
<p>sklearn also has gradient boosting models.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">GradientBoostingClassifier</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingRegressor.html">GradientBoostingRegressor</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingClassifier.html">HistGradientBoostingClassifier</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor">HistGradientBoostingRegressor</a>  (Inspired by LGBM, supports missing values)</p></li>
</ul>
<p>Let’s try out all these models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostClassifier</span>
<span class="kn">from</span> <span class="nn">lightgbm.sklearn</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span> <span class="n">HistGradientBoostingClassifier</span>

<span class="n">pipe_lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pipe_dt</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
<span class="n">pipe_rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pipe_xgb</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">XGBClassifier</span><span class="p">(</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">pipe_lgbm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">pipe_catboost</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">CatBoostClassifier</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">pipe_sklearn_histGB</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">HistGradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">pipe_sklearn_GB</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic regression&quot;</span><span class="p">:</span> <span class="n">pipe_lr</span><span class="p">,</span>
    <span class="s2">&quot;decision tree&quot;</span><span class="p">:</span> <span class="n">pipe_dt</span><span class="p">,</span>
    <span class="s2">&quot;random forest&quot;</span><span class="p">:</span> <span class="n">pipe_rf</span><span class="p">,</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="n">pipe_xgb</span><span class="p">,</span>
    <span class="s2">&quot;LightGBM&quot;</span><span class="p">:</span> <span class="n">pipe_lgbm</span><span class="p">,</span>
    <span class="s2">&quot;CatBoost&quot;</span><span class="p">:</span> <span class="n">pipe_catboost</span><span class="p">,</span>
    <span class="s2">&quot;sklearn_histGB&quot;</span><span class="p">:</span> <span class="n">pipe_sklearn_histGB</span><span class="p">,</span>
    <span class="s2">&quot;sklearn_GB&quot;</span><span class="p">:</span> <span class="n">pipe_sklearn_GB</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_num</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.006 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>1.391 (+/- 0.120)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.849 (+/- 0.005)</td>
      <td>0.850 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.118 (+/- 0.003)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.817 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.291 (+/- 0.004)</td>
      <td>0.078 (+/- 0.001)</td>
      <td>0.844 (+/- 0.007)</td>
      <td>0.976 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.419 (+/- 0.017)</td>
      <td>0.015 (+/- 0.001)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.898 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.374 (+/- 0.022)</td>
      <td>0.023 (+/- 0.003)</td>
      <td>0.872 (+/- 0.004)</td>
      <td>0.888 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>3.701 (+/- 0.036)</td>
      <td>0.092 (+/- 0.002)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.895 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>sklearn_histGB</th>
      <td>1.648 (+/- 0.106)</td>
      <td>0.035 (+/- 0.002)</td>
      <td>0.871 (+/- 0.005)</td>
      <td>0.887 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>sklearn_GB</th>
      <td>1.858 (+/- 0.007)</td>
      <td>0.015 (+/- 0.002)</td>
      <td>0.864 (+/- 0.004)</td>
      <td>0.870 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Some observations</strong></p>
<ul class="simple">
<li><p>Keep in mind all these results are with default hyperparameters</p></li>
<li><p>Ideally we would carry out hyperparameter optimization for all of them and then compare the results.</p></li>
<li><p>We are using a particular scoring metric (accuracy in this case)</p></li>
<li><p>We are scaling numeric features but it shouldn’t matter for tree-based models</p></li>
<li><p>Look at the standard deviation. Doesn’t look very high.</p>
<ul>
<li><p>The scores look more or less stable.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.006 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>1.391 (+/- 0.120)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.849 (+/- 0.005)</td>
      <td>0.850 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.118 (+/- 0.003)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.817 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.291 (+/- 0.004)</td>
      <td>0.078 (+/- 0.001)</td>
      <td>0.844 (+/- 0.007)</td>
      <td>0.976 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.419 (+/- 0.017)</td>
      <td>0.015 (+/- 0.001)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.898 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.374 (+/- 0.022)</td>
      <td>0.023 (+/- 0.003)</td>
      <td>0.872 (+/- 0.004)</td>
      <td>0.888 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>3.701 (+/- 0.036)</td>
      <td>0.092 (+/- 0.002)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.895 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>sklearn_histGB</th>
      <td>1.648 (+/- 0.106)</td>
      <td>0.035 (+/- 0.002)</td>
      <td>0.871 (+/- 0.005)</td>
      <td>0.887 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>sklearn_GB</th>
      <td>1.858 (+/- 0.007)</td>
      <td>0.015 (+/- 0.002)</td>
      <td>0.864 (+/- 0.004)</td>
      <td>0.870 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Decision trees and random forests overfit</p>
<ul>
<li><p>Other models do not seem to overfit much.</p></li>
</ul>
</li>
<li><p>Fit times</p>
<ul>
<li><p>Decision trees are fast but not very accurate</p></li>
<li><p>LightGBM is faster than decision trees and more accurate!</p></li>
<li><p>CatBoost fit time is highest.</p></li>
<li><p>There is not much difference between the validation scores of XGBoost, LightGBM, and CatBoost.</p></li>
<li><p>Among the best performing models, LightGBM is the fastest one!</p></li>
</ul>
</li>
<li><p>Scores times</p>
<ul>
<li><p>Prediction times are much smaller in all cases.</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="which-model-should-i-use">
<h3>Which model should I use?<a class="headerlink" href="#which-model-should-i-use" title="Permalink to this heading">#</a></h3>
<p><strong>Simple answer</strong></p>
<ul class="simple">
<li><p>Whichever gets the highest CV score making sure that you’re not overusing the validation set.</p></li>
</ul>
<p><strong>Interpretability</strong></p>
<ul class="simple">
<li><p>This is an area of growing interest and concern in ML.</p></li>
<li><p>How important is interpretability for you?</p></li>
<li><p>In the next class we’ll talk about interpretability of non-linear models.</p></li>
</ul>
<p><strong>Speed/code maintenance</strong></p>
<ul class="simple">
<li><p>Other considerations could be speed (fit and/or predict), maintainability of the code.</p></li>
</ul>
<p>Finally, you could use all of them!</p>
<p><br><br><br><br></p>
</section>
</section>
<section id="averaging">
<h2>Averaging<a class="headerlink" href="#averaging" title="Permalink to this heading">#</a></h2>
<p>Earlier we looked at a bunch of classifiers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;logistic regression&#39;, &#39;decision tree&#39;, &#39;random forest&#39;, &#39;XGBoost&#39;, &#39;LightGBM&#39;, &#39;CatBoost&#39;, &#39;sklearn_histGB&#39;, &#39;sklearn_GB&#39;])
</pre></div>
</div>
</div>
</div>
<p>For this demonstration, let’s get rid of sklearn’s gradient boosting models and CatBoost because it’s too slow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;sklearn_histGB&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;sklearn_GB&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;CatBoost&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;logistic regression&#39;, &#39;decision tree&#39;, &#39;random forest&#39;, &#39;XGBoost&#39;, &#39;LightGBM&#39;])
</pre></div>
</div>
</div>
</div>
<p>What if we use all the models in <code class="docutils literal notranslate"><span class="pre">classifiers</span></code> and let them vote during prediction time?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span>

<span class="n">averaging_model</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">voting</span><span class="o">=</span><span class="s2">&quot;soft&quot;</span>
<span class="p">)</span>  <span class="c1"># need the list() here for cross-validation to work!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>  <span class="c1"># global setting</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>VotingClassifier(estimators=[(&#x27;logistic regression&#x27;,
                              Pipeline(steps=[(&#x27;columntransformer&#x27;,
                                               ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                                                StandardScaler(),
                                                                                [&#x27;age&#x27;,
                                                                                 &#x27;capital.gain&#x27;,
                                                                                 &#x27;capital.loss&#x27;,
                                                                                 &#x27;hours.per.week&#x27;]),
                                                                               (&#x27;ordinalencoder&#x27;,
                                                                                OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                                                                            &#x27;1st-4th&#x27;,
                                                                                                            &#x27;5th-6th&#x27;,
                                                                                                            &#x27;7th-8th&#x27;,
                                                                                                            &#x27;9th&#x27;,
                                                                                                            &#x27;10th&#x27;,
                                                                                                            &#x27;11th&#x27;,
                                                                                                            &#x27;12th&#x27;,
                                                                                                            &#x27;HS-grad&#x27;,
                                                                                                            &#x27;Prof-school&#x27;,...
                                                                                Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                                                 SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                                               strategy=&#x27;constant&#x27;)),
                                                                                                (&#x27;onehotencoder&#x27;,
                                                                                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                                                               sparse_output=False))]),
                                                                                [&#x27;workclass&#x27;,
                                                                                 &#x27;marital.status&#x27;,
                                                                                 &#x27;occupation&#x27;,
                                                                                 &#x27;relationship&#x27;,
                                                                                 &#x27;native.country&#x27;]),
                                                                               (&#x27;drop&#x27;,
                                                                                &#x27;drop&#x27;,
                                                                                [&#x27;fnlwgt&#x27;,
                                                                                 &#x27;race&#x27;,
                                                                                 &#x27;education.num&#x27;])])),
                                              (&#x27;lgbmclassifier&#x27;,
                                               LGBMClassifier(random_state=123,
                                                              verbose=-1))]))],
                 voting=&#x27;soft&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">VotingClassifier</label><div class="sk-toggleable__content"><pre>VotingClassifier(estimators=[(&#x27;logistic regression&#x27;,
                              Pipeline(steps=[(&#x27;columntransformer&#x27;,
                                               ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                                                StandardScaler(),
                                                                                [&#x27;age&#x27;,
                                                                                 &#x27;capital.gain&#x27;,
                                                                                 &#x27;capital.loss&#x27;,
                                                                                 &#x27;hours.per.week&#x27;]),
                                                                               (&#x27;ordinalencoder&#x27;,
                                                                                OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                                                                            &#x27;1st-4th&#x27;,
                                                                                                            &#x27;5th-6th&#x27;,
                                                                                                            &#x27;7th-8th&#x27;,
                                                                                                            &#x27;9th&#x27;,
                                                                                                            &#x27;10th&#x27;,
                                                                                                            &#x27;11th&#x27;,
                                                                                                            &#x27;12th&#x27;,
                                                                                                            &#x27;HS-grad&#x27;,
                                                                                                            &#x27;Prof-school&#x27;,...
                                                                                Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                                                 SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                                               strategy=&#x27;constant&#x27;)),
                                                                                                (&#x27;onehotencoder&#x27;,
                                                                                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                                                               sparse_output=False))]),
                                                                                [&#x27;workclass&#x27;,
                                                                                 &#x27;marital.status&#x27;,
                                                                                 &#x27;occupation&#x27;,
                                                                                 &#x27;relationship&#x27;,
                                                                                 &#x27;native.country&#x27;]),
                                                                               (&#x27;drop&#x27;,
                                                                                &#x27;drop&#x27;,
                                                                                [&#x27;fnlwgt&#x27;,
                                                                                 &#x27;race&#x27;,
                                                                                 &#x27;education.num&#x27;])])),
                                              (&#x27;lgbmclassifier&#x27;,
                                               LGBMClassifier(random_state=123,
                                                              verbose=-1))]))],
                 voting=&#x27;soft&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>logistic regression</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;,
                                  &#x27;hours.per.week&#x27;]),
                                (&#x27;ordinalencoder&#x27;,
                                 OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                             &#x27;1st-4th&#x27;,
                                                             &#x27;5th-6th&#x27;,
                                                             &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                                                             &#x27;10th&#x27;, &#x27;11th&#x27;,
                                                             &#x27;12th&#x27;, &#x27;HS-grad&#x27;,
                                                             &#x27;Prof-school&#x27;,
                                                             &#x27;Assoc-voc&#x27;,
                                                             &#x27;Assoc-acdm&#x27;,
                                                             &#x27;Some-college&#x27;,
                                                             &#x27;Bachelors&#x27;,
                                                             &#x27;Masters&#x27;,
                                                             &#x27;Doctorate&#x27;]],
                                                dtype=&lt;class...
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;,
                                                                dtype=&lt;class &#x27;int&#x27;&gt;))]),
                                 [&#x27;sex&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;,
                                  &#x27;relationship&#x27;, &#x27;native.country&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;, &#x27;hours.per.week&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">ordinalencoder</label><div class="sk-toggleable__content"><pre>[&#x27;education&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Preschool&#x27;, &#x27;1st-4th&#x27;, &#x27;5th-6th&#x27;, &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                            &#x27;10th&#x27;, &#x27;11th&#x27;, &#x27;12th&#x27;, &#x27;HS-grad&#x27;, &#x27;Prof-school&#x27;,
                            &#x27;Assoc-voc&#x27;, &#x27;Assoc-acdm&#x27;, &#x27;Some-college&#x27;,
                            &#x27;Bachelors&#x27;, &#x27;Masters&#x27;, &#x27;Doctorate&#x27;]],
               dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;sex&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;if_binary&#x27;, dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;native.country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(max_iter=2000, random_state=123)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>decision tree</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox" ><label for="sk-estimator-id-29" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;,
                                  &#x27;hours.per.week&#x27;]),
                                (&#x27;ordinalencoder&#x27;,
                                 OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                             &#x27;1st-4th&#x27;,
                                                             &#x27;5th-6th&#x27;,
                                                             &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                                                             &#x27;10th&#x27;, &#x27;11th&#x27;,
                                                             &#x27;12th&#x27;, &#x27;HS-grad&#x27;,
                                                             &#x27;Prof-school&#x27;,
                                                             &#x27;Assoc-voc&#x27;,
                                                             &#x27;Assoc-acdm&#x27;,
                                                             &#x27;Some-college&#x27;,
                                                             &#x27;Bachelors&#x27;,
                                                             &#x27;Masters&#x27;,
                                                             &#x27;Doctorate&#x27;]],
                                                dtype=&lt;class...
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;,
                                                                dtype=&lt;class &#x27;int&#x27;&gt;))]),
                                 [&#x27;sex&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;,
                                  &#x27;relationship&#x27;, &#x27;native.country&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" ><label for="sk-estimator-id-30" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;, &#x27;hours.per.week&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox" ><label for="sk-estimator-id-31" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox" ><label for="sk-estimator-id-32" class="sk-toggleable__label sk-toggleable__label-arrow">ordinalencoder</label><div class="sk-toggleable__content"><pre>[&#x27;education&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox" ><label for="sk-estimator-id-33" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Preschool&#x27;, &#x27;1st-4th&#x27;, &#x27;5th-6th&#x27;, &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                            &#x27;10th&#x27;, &#x27;11th&#x27;, &#x27;12th&#x27;, &#x27;HS-grad&#x27;, &#x27;Prof-school&#x27;,
                            &#x27;Assoc-voc&#x27;, &#x27;Assoc-acdm&#x27;, &#x27;Some-college&#x27;,
                            &#x27;Bachelors&#x27;, &#x27;Masters&#x27;, &#x27;Doctorate&#x27;]],
               dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox" ><label for="sk-estimator-id-34" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;sex&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-35" type="checkbox" ><label for="sk-estimator-id-35" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-36" type="checkbox" ><label for="sk-estimator-id-36" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;if_binary&#x27;, dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-37" type="checkbox" ><label for="sk-estimator-id-37" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;native.country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox" ><label for="sk-estimator-id-38" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox" ><label for="sk-estimator-id-39" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-40" type="checkbox" ><label for="sk-estimator-id-40" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-41" type="checkbox" ><label for="sk-estimator-id-41" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-42" type="checkbox" ><label for="sk-estimator-id-42" class="sk-toggleable__label sk-toggleable__label-arrow">DecisionTreeClassifier</label><div class="sk-toggleable__content"><pre>DecisionTreeClassifier(random_state=123)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>random forest</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-43" type="checkbox" ><label for="sk-estimator-id-43" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;,
                                  &#x27;hours.per.week&#x27;]),
                                (&#x27;ordinalencoder&#x27;,
                                 OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                             &#x27;1st-4th&#x27;,
                                                             &#x27;5th-6th&#x27;,
                                                             &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                                                             &#x27;10th&#x27;, &#x27;11th&#x27;,
                                                             &#x27;12th&#x27;, &#x27;HS-grad&#x27;,
                                                             &#x27;Prof-school&#x27;,
                                                             &#x27;Assoc-voc&#x27;,
                                                             &#x27;Assoc-acdm&#x27;,
                                                             &#x27;Some-college&#x27;,
                                                             &#x27;Bachelors&#x27;,
                                                             &#x27;Masters&#x27;,
                                                             &#x27;Doctorate&#x27;]],
                                                dtype=&lt;class...
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;,
                                                                dtype=&lt;class &#x27;int&#x27;&gt;))]),
                                 [&#x27;sex&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;,
                                  &#x27;relationship&#x27;, &#x27;native.country&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-44" type="checkbox" ><label for="sk-estimator-id-44" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;, &#x27;hours.per.week&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-45" type="checkbox" ><label for="sk-estimator-id-45" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-46" type="checkbox" ><label for="sk-estimator-id-46" class="sk-toggleable__label sk-toggleable__label-arrow">ordinalencoder</label><div class="sk-toggleable__content"><pre>[&#x27;education&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-47" type="checkbox" ><label for="sk-estimator-id-47" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Preschool&#x27;, &#x27;1st-4th&#x27;, &#x27;5th-6th&#x27;, &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                            &#x27;10th&#x27;, &#x27;11th&#x27;, &#x27;12th&#x27;, &#x27;HS-grad&#x27;, &#x27;Prof-school&#x27;,
                            &#x27;Assoc-voc&#x27;, &#x27;Assoc-acdm&#x27;, &#x27;Some-college&#x27;,
                            &#x27;Bachelors&#x27;, &#x27;Masters&#x27;, &#x27;Doctorate&#x27;]],
               dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-48" type="checkbox" ><label for="sk-estimator-id-48" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;sex&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-49" type="checkbox" ><label for="sk-estimator-id-49" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-50" type="checkbox" ><label for="sk-estimator-id-50" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;if_binary&#x27;, dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-51" type="checkbox" ><label for="sk-estimator-id-51" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;native.country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-52" type="checkbox" ><label for="sk-estimator-id-52" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-53" type="checkbox" ><label for="sk-estimator-id-53" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-54" type="checkbox" ><label for="sk-estimator-id-54" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-55" type="checkbox" ><label for="sk-estimator-id-55" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-56" type="checkbox" ><label for="sk-estimator-id-56" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(class_weight=&#x27;balanced&#x27;, random_state=123)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>XGBoost</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-57" type="checkbox" ><label for="sk-estimator-id-57" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;,
                                  &#x27;hours.per.week&#x27;]),
                                (&#x27;ordinalencoder&#x27;,
                                 OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                             &#x27;1st-4th&#x27;,
                                                             &#x27;5th-6th&#x27;,
                                                             &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                                                             &#x27;10th&#x27;, &#x27;11th&#x27;,
                                                             &#x27;12th&#x27;, &#x27;HS-grad&#x27;,
                                                             &#x27;Prof-school&#x27;,
                                                             &#x27;Assoc-voc&#x27;,
                                                             &#x27;Assoc-acdm&#x27;,
                                                             &#x27;Some-college&#x27;,
                                                             &#x27;Bachelors&#x27;,
                                                             &#x27;Masters&#x27;,
                                                             &#x27;Doctorate&#x27;]],
                                                dtype=&lt;class...
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;,
                                                                dtype=&lt;class &#x27;int&#x27;&gt;))]),
                                 [&#x27;sex&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;,
                                  &#x27;relationship&#x27;, &#x27;native.country&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-58" type="checkbox" ><label for="sk-estimator-id-58" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;, &#x27;hours.per.week&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-59" type="checkbox" ><label for="sk-estimator-id-59" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-60" type="checkbox" ><label for="sk-estimator-id-60" class="sk-toggleable__label sk-toggleable__label-arrow">ordinalencoder</label><div class="sk-toggleable__content"><pre>[&#x27;education&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-61" type="checkbox" ><label for="sk-estimator-id-61" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Preschool&#x27;, &#x27;1st-4th&#x27;, &#x27;5th-6th&#x27;, &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                            &#x27;10th&#x27;, &#x27;11th&#x27;, &#x27;12th&#x27;, &#x27;HS-grad&#x27;, &#x27;Prof-school&#x27;,
                            &#x27;Assoc-voc&#x27;, &#x27;Assoc-acdm&#x27;, &#x27;Some-college&#x27;,
                            &#x27;Bachelors&#x27;, &#x27;Masters&#x27;, &#x27;Doctorate&#x27;]],
               dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-62" type="checkbox" ><label for="sk-estimator-id-62" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;sex&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-63" type="checkbox" ><label for="sk-estimator-id-63" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-64" type="checkbox" ><label for="sk-estimator-id-64" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;if_binary&#x27;, dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-65" type="checkbox" ><label for="sk-estimator-id-65" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;native.country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-66" type="checkbox" ><label for="sk-estimator-id-66" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-67" type="checkbox" ><label for="sk-estimator-id-67" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-68" type="checkbox" ><label for="sk-estimator-id-68" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-69" type="checkbox" ><label for="sk-estimator-id-69" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-70" type="checkbox" ><label for="sk-estimator-id-70" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=123, ...)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>LightGBM</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-71" type="checkbox" ><label for="sk-estimator-id-71" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;,
                                  &#x27;hours.per.week&#x27;]),
                                (&#x27;ordinalencoder&#x27;,
                                 OrdinalEncoder(categories=[[&#x27;Preschool&#x27;,
                                                             &#x27;1st-4th&#x27;,
                                                             &#x27;5th-6th&#x27;,
                                                             &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                                                             &#x27;10th&#x27;, &#x27;11th&#x27;,
                                                             &#x27;12th&#x27;, &#x27;HS-grad&#x27;,
                                                             &#x27;Prof-school&#x27;,
                                                             &#x27;Assoc-voc&#x27;,
                                                             &#x27;Assoc-acdm&#x27;,
                                                             &#x27;Some-college&#x27;,
                                                             &#x27;Bachelors&#x27;,
                                                             &#x27;Masters&#x27;,
                                                             &#x27;Doctorate&#x27;]],
                                                dtype=&lt;class...
                                                  OneHotEncoder(drop=&#x27;if_binary&#x27;,
                                                                dtype=&lt;class &#x27;int&#x27;&gt;))]),
                                 [&#x27;sex&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False))]),
                                 [&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;,
                                  &#x27;relationship&#x27;, &#x27;native.country&#x27;]),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-72" type="checkbox" ><label for="sk-estimator-id-72" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;age&#x27;, &#x27;capital.gain&#x27;, &#x27;capital.loss&#x27;, &#x27;hours.per.week&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-73" type="checkbox" ><label for="sk-estimator-id-73" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-74" type="checkbox" ><label for="sk-estimator-id-74" class="sk-toggleable__label sk-toggleable__label-arrow">ordinalencoder</label><div class="sk-toggleable__content"><pre>[&#x27;education&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-75" type="checkbox" ><label for="sk-estimator-id-75" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Preschool&#x27;, &#x27;1st-4th&#x27;, &#x27;5th-6th&#x27;, &#x27;7th-8th&#x27;, &#x27;9th&#x27;,
                            &#x27;10th&#x27;, &#x27;11th&#x27;, &#x27;12th&#x27;, &#x27;HS-grad&#x27;, &#x27;Prof-school&#x27;,
                            &#x27;Assoc-voc&#x27;, &#x27;Assoc-acdm&#x27;, &#x27;Some-college&#x27;,
                            &#x27;Bachelors&#x27;, &#x27;Masters&#x27;, &#x27;Doctorate&#x27;]],
               dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-76" type="checkbox" ><label for="sk-estimator-id-76" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;sex&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-77" type="checkbox" ><label for="sk-estimator-id-77" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-78" type="checkbox" ><label for="sk-estimator-id-78" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;if_binary&#x27;, dtype=&lt;class &#x27;int&#x27;&gt;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-79" type="checkbox" ><label for="sk-estimator-id-79" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;workclass&#x27;, &#x27;marital.status&#x27;, &#x27;occupation&#x27;, &#x27;relationship&#x27;, &#x27;native.country&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-80" type="checkbox" ><label for="sk-estimator-id-80" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-81" type="checkbox" ><label for="sk-estimator-id-81" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-82" type="checkbox" ><label for="sk-estimator-id-82" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;fnlwgt&#x27;, &#x27;race&#x27;, &#x27;education.num&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-83" type="checkbox" ><label for="sk-estimator-id-83" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-84" type="checkbox" ><label for="sk-estimator-id-84" class="sk-toggleable__label sk-toggleable__label-arrow">LGBMClassifier</label><div class="sk-toggleable__content"><pre>LGBMClassifier(random_state=123, verbose=-1)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">VotingClassifier</span></code> will take a <em>vote</em> using the predictions of the constituent classifier pipelines.</p>
<p>Main parameter: <code class="docutils literal notranslate"><span class="pre">voting</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">voting='hard'</span></code></p>
<ul>
<li><p>it uses the output of <code class="docutils literal notranslate"><span class="pre">predict</span></code> and actually votes.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">voting='soft'</span></code></p>
<ul>
<li><p>with <code class="docutils literal notranslate"><span class="pre">voting='soft'</span></code> it averages the output of <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> and then thresholds / takes the larger.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>The choice depends on whether you trust <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> from your base classifiers - if so, it’s nice to access that information.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_num</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What happens when you <code class="docutils literal notranslate"><span class="pre">fit</span></code> a <code class="docutils literal notranslate"><span class="pre">VotingClassifier</span></code>?</p>
<ul>
<li><p>It will fit all constituent models.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It seems sklearn requires us to actually call <code class="docutils literal notranslate"><span class="pre">fit</span></code> on the <code class="docutils literal notranslate"><span class="pre">VotingClassifier</span></code>, instead of passing in pre-fit models. This is an implementation choice rather than a conceptual limitation.</p>
</div>
<p>Let’s look at particular test examples where <code class="docutils literal notranslate"><span class="pre">income</span></code> is “&gt;50k” (y=1):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_g50k</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;income == &#39;&gt;50K&#39;&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">test_l50k</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;income == &#39;&lt;=50K&#39;&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span><span class="o">.</span><span class="n">classes_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1])
</pre></div>
</div>
</div>
</div>
<p>What are the predictions given by the voting model?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Voting classifier&quot;</span><span class="p">:</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)}</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>y</th>
      <th>Voting classifier</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For hard voting, these are the votes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>y</th>
      <th>Voting classifier</th>
      <th>logistic regression</th>
      <th>decision tree</th>
      <th>random forest</th>
      <th>XGBoost</th>
      <th>LightGBM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For soft voting, these are the scores:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>y</th>
      <th>Voting classifier</th>
      <th>logistic regression</th>
      <th>decision tree</th>
      <th>random forest</th>
      <th>XGBoost</th>
      <th>LightGBM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>0.663111</td>
      <td>1.0</td>
      <td>0.760000</td>
      <td>0.601041</td>
      <td>0.685786</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>0.247537</td>
      <td>1.0</td>
      <td>0.678924</td>
      <td>0.513223</td>
      <td>0.463582</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>0.636616</td>
      <td>0.5</td>
      <td>0.621537</td>
      <td>0.684857</td>
      <td>0.665882</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>0.616069</td>
      <td>0.0</td>
      <td>0.770000</td>
      <td>0.731338</td>
      <td>0.683015</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>(Aside: the probability scores from <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> are pretty bad)</p>
<p>What’s the prediction probability of the averaging model? Let’s examine prediction probability of the first example from <code class="docutils literal notranslate"><span class="pre">test_g50k</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.41934687, 0.58065313])
</pre></div>
</div>
</div>
</div>
<p>It adds the prediction probabilities given by constituent models and divides the summation by the number of constituent models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sum of probabilities for class 0 at index 1</span>
<span class="n">sum_prob_ex1_class_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">sum_prob_ex1_class_0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.096734368958311
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sum of probabilities for class 1 at index 1</span>
<span class="n">sum_prob_ex1_class_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">sum_prob_ex1_class_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.903265631041689
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_constituents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">averaging_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="p">)</span>
<span class="n">n_constituents</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sum_prob_ex1_class_0</span> <span class="o">/</span> <span class="n">n_constituents</span><span class="p">,</span> <span class="n">sum_prob_ex1_class_1</span> <span class="o">/</span> <span class="n">n_constituents</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.41934687379166224, 0.5806531262083378)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.41934687, 0.58065313])
</pre></div>
</div>
</div>
</div>
<p>They match!</p>
<p>Let’s see how well this model performs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.37822156, 0.62177844])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;Voting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">averaging_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.006 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>1.391 (+/- 0.120)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.849 (+/- 0.005)</td>
      <td>0.850 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.118 (+/- 0.003)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.817 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.291 (+/- 0.004)</td>
      <td>0.078 (+/- 0.001)</td>
      <td>0.844 (+/- 0.007)</td>
      <td>0.976 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.419 (+/- 0.017)</td>
      <td>0.015 (+/- 0.001)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.898 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.374 (+/- 0.022)</td>
      <td>0.023 (+/- 0.003)</td>
      <td>0.872 (+/- 0.004)</td>
      <td>0.888 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>3.701 (+/- 0.036)</td>
      <td>0.092 (+/- 0.002)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.895 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>sklearn_histGB</th>
      <td>1.648 (+/- 0.106)</td>
      <td>0.035 (+/- 0.002)</td>
      <td>0.871 (+/- 0.005)</td>
      <td>0.887 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>sklearn_GB</th>
      <td>1.858 (+/- 0.007)</td>
      <td>0.015 (+/- 0.002)</td>
      <td>0.864 (+/- 0.004)</td>
      <td>0.870 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting</th>
      <td>4.483 (+/- 0.433)</td>
      <td>0.144 (+/- 0.002)</td>
      <td>0.860 (+/- 0.005)</td>
      <td>0.953 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It appears that here we didn’t do much better than our best classifier :(.</p>
<p>Let’s try removing decision tree classifier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers_ndt</span> <span class="o">=</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">del</span> <span class="n">classifiers_ndt</span><span class="p">[</span><span class="s2">&quot;decision tree&quot;</span><span class="p">]</span>
<span class="n">averaging_model_ndt</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">classifiers_ndt</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">voting</span><span class="o">=</span><span class="s2">&quot;soft&quot;</span>
<span class="p">)</span>  <span class="c1"># need the list() here for cross_val to work!</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Voting_ndt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">averaging_model_ndt</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">,</span>
    <span class="n">y_train</span><span class="p">,</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.006 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>1.391 (+/- 0.120)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.849 (+/- 0.005)</td>
      <td>0.850 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.118 (+/- 0.003)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.817 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.291 (+/- 0.004)</td>
      <td>0.078 (+/- 0.001)</td>
      <td>0.844 (+/- 0.007)</td>
      <td>0.976 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.419 (+/- 0.017)</td>
      <td>0.015 (+/- 0.001)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.898 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.374 (+/- 0.022)</td>
      <td>0.023 (+/- 0.003)</td>
      <td>0.872 (+/- 0.004)</td>
      <td>0.888 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>3.701 (+/- 0.036)</td>
      <td>0.092 (+/- 0.002)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.895 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>sklearn_histGB</th>
      <td>1.648 (+/- 0.106)</td>
      <td>0.035 (+/- 0.002)</td>
      <td>0.871 (+/- 0.005)</td>
      <td>0.887 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>sklearn_GB</th>
      <td>1.858 (+/- 0.007)</td>
      <td>0.015 (+/- 0.002)</td>
      <td>0.864 (+/- 0.004)</td>
      <td>0.870 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting</th>
      <td>4.483 (+/- 0.433)</td>
      <td>0.144 (+/- 0.002)</td>
      <td>0.860 (+/- 0.005)</td>
      <td>0.953 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting_ndt</th>
      <td>4.088 (+/- 0.595)</td>
      <td>0.132 (+/- 0.003)</td>
      <td>0.870 (+/- 0.005)</td>
      <td>0.918 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Still the averaging scores are not better than the best performing model.</p>
<ul class="simple">
<li><p>It didn’t happen here but how could the average do better than the best model???</p>
<ul>
<li><p>From the perspective of the best estimator (in this case CatBoost), why are you adding on worse estimators??</p></li>
</ul>
</li>
</ul>
<p>Here’s how this can work:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Example</p></th>
<th class="head"><p>log reg</p></th>
<th class="head"><p>rand forest</p></th>
<th class="head"><p>cat boost</p></th>
<th class="head"><p>Averaged model</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>✅✅❌=&gt;✅</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>✅❌✅=&gt;✅</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌✅✅=&gt;✅</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>In short, as long as the different models make different mistakes, this can work.</p></li>
<li><p>Probably in our case, we didn’t have enough diversity.</p></li>
</ul>
<p>Why not always do this?</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code>/<code class="docutils literal notranslate"><span class="pre">predict</span></code> time.</p></li>
<li><p>Reduction in interpretability.</p></li>
<li><p>Reduction in code maintainability (e.g. Netflix prize).</p></li>
</ol>
<section id="what-kind-of-estimators-can-we-combine">
<h3>What kind of estimators can we combine?<a class="headerlink" href="#what-kind-of-estimators-can-we-combine" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>You can combine</p>
<ul>
<li><p>completely different estimators, or similar estimators.</p></li>
<li><p>estimators trained on different samples.</p></li>
<li><p>estimators with different hyperparameter values.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="id2">
<h2>❓❓ Questions for you<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Is it possible to get better than the best performing model using averaging.</p></li>
<li><p>Is random forest is an averaging model?</p></li>
</ul>
<p><br><br><br><br></p>
</section>
<section id="stacking">
<h2>Stacking<a class="headerlink" href="#stacking" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Another type of ensemble is stacking.</p></li>
<li><p>Instead of averaging the outputs of each estimator, use their outputs as <em>inputs to another model</em>.</p></li>
<li><p>By default for classification, it uses logistic regression.</p>
<ul>
<li><p>We don’t need a complex model here necessarily, more of a weighted average.</p></li>
<li><p>The features going into the logistic regression are the classifier outputs, <em>not</em> the original features!</p></li>
<li><p>So the number of coefficients = the number of base estimators!</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">StackingClassifier</span>
</pre></div>
</div>
</div>
</div>
<p>The code starts to get too slow here; so we’ll remove CatBoost.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span> <span class="o">=</span> <span class="n">StackingClassifier</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>What’s going on in here?</p>
<ul class="simple">
<li><p>It is doing cross-validation by itself by default (see <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.StackingClassifier.html">documentation</a>)</p></li>
</ul>
<blockquote>
<div><p>Note that estimators_ are fitted on the full X while final_estimator_ is trained using cross-validated predictions of the base estimators using cross_val_predict.</p>
</div></blockquote>
<p>Here is the input features (X) to the meta-model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_sample_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">valid_sample_X</span> <span class="o">=</span> <span class="n">valid_sample_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">])</span>
<span class="n">valid_sample_y</span> <span class="o">=</span> <span class="n">valid_sample_df</span><span class="p">[</span><span class="s1">&#39;income&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data = {}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># r4 = {</span>
<span class="c1">#     name + &quot;_proba&quot;: pipe.predict_proba(valid_sample_X)[:, 1]</span>
<span class="c1">#     for (name, pipe) in stacking_model.named_estimators_.items()</span>
<span class="c1"># }</span>
<span class="c1"># data[&#39;y&#39;] = valid_sample_y</span>
<span class="c1"># data.update(r4)</span>
<span class="c1"># pd.DataFrame(data)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Our meta-model is logistic regression (which it is by default).</p></li>
<li><p>Let’s look at the learned coefficients.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">stacking_model</span><span class="o">.</span><span class="n">final_estimator_</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">classifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LightGBM</th>
      <td>4.283186</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.780374</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.656264</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>0.046732</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>-0.120639</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">final_estimator_</span><span class="o">.</span><span class="n">intercept_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-3.3171738])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>It seems that the LightGBM is being trusted the most.</p></li>
<li><p>It’s funny that it has given a negative coefficient to decision tree.</p>
<ul>
<li><p>Our meta model doesn’t trust decision tree model.</p></li>
<li><p>In fact, if the decision tree model says class &gt;=50k, the model is likely to predict the opposite 🙃</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_l50k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;&lt;=50K&#39;, &#39;&lt;=50K&#39;, &#39;&lt;=50K&#39;, &#39;&lt;=50K&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.26109096, 0.73890904],
       [0.58523477, 0.41476523],
       [0.24218502, 0.75781498],
       [0.20576452, 0.79423548]])
</pre></div>
</div>
</div>
</div>
<p>(This is the <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> from meta model logistic regression)</p>
<p>Let’s see how well this model performs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;Stacking&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">stacking_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.006 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
      <td>0.758 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>1.391 (+/- 0.120)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.849 (+/- 0.005)</td>
      <td>0.850 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.118 (+/- 0.003)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.817 (+/- 0.006)</td>
      <td>0.979 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.291 (+/- 0.004)</td>
      <td>0.078 (+/- 0.001)</td>
      <td>0.844 (+/- 0.007)</td>
      <td>0.976 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.419 (+/- 0.017)</td>
      <td>0.015 (+/- 0.001)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.898 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.374 (+/- 0.022)</td>
      <td>0.023 (+/- 0.003)</td>
      <td>0.872 (+/- 0.004)</td>
      <td>0.888 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>3.701 (+/- 0.036)</td>
      <td>0.092 (+/- 0.002)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.895 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>sklearn_histGB</th>
      <td>1.648 (+/- 0.106)</td>
      <td>0.035 (+/- 0.002)</td>
      <td>0.871 (+/- 0.005)</td>
      <td>0.887 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>sklearn_GB</th>
      <td>1.858 (+/- 0.007)</td>
      <td>0.015 (+/- 0.002)</td>
      <td>0.864 (+/- 0.004)</td>
      <td>0.870 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting</th>
      <td>4.483 (+/- 0.433)</td>
      <td>0.144 (+/- 0.002)</td>
      <td>0.860 (+/- 0.005)</td>
      <td>0.953 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting_ndt</th>
      <td>4.088 (+/- 0.595)</td>
      <td>0.132 (+/- 0.003)</td>
      <td>0.870 (+/- 0.005)</td>
      <td>0.918 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Stacking</th>
      <td>19.477 (+/- 0.280)</td>
      <td>0.141 (+/- 0.003)</td>
      <td>0.872 (+/- 0.004)</td>
      <td>0.890 (+/- 0.002)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The situation here is a bit mind-boggling.</p></li>
<li><p>On each fold of cross-validation it is doing cross-validation.</p></li>
<li><p>This is really loops within loops within loops within loops…</p></li>
</ul>
<ul class="simple">
<li><p>We can also try a different final estimator:</p></li>
<li><p>Let’s <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> as a final estimator.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model_tree</span> <span class="o">=</span> <span class="n">StackingClassifier</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">final_estimator</span><span class="o">=</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The results might not be very good. But we can visualize the tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">custom_plot_tree</span><span class="p">(</span><span class="n">stacking_model_tree</span><span class="o">.</span><span class="n">final_estimator_</span><span class="p">,</span> 
                 <span class="n">feature_names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                 <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&quot;&lt;=50K&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&gt;50K&quot;&#39;</span><span class="p">],</span>
                 <span class="n">impurity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2ae9dfe3ba42401d17a5e328b1a143db3b0c35d15b43b3aaa2aa9792ea00aa9b.png" src="../../../_images/2ae9dfe3ba42401d17a5e328b1a143db3b0c35d15b43b3aaa2aa9792ea00aa9b.png" />
</div>
</div>
<section id="an-effective-strategy">
<h3>An effective strategy<a class="headerlink" href="#an-effective-strategy" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Randomly generate a bunch of models with different hyperparameter configurations, and then stack all the models.</p></li>
</ul>
<ul class="simple">
<li><p>What is an advantage of ensembling multiple models as opposed to just choosing one of them?</p>
<ul>
<li><p>You may get a better score.</p></li>
</ul>
</li>
<li><p>What is a disadvantage of ensembling multiple models as opposed to just choosing one of them?</p>
<ul>
<li><p>Slower, more code maintenance issues.</p></li>
</ul>
</li>
</ul>
<p>There are equivalent regression models for all of these:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html"><code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LGBMClassifier</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference external" href="https://lightgbm.readthedocs.io/en/latest/pythonapi/lightgbm.LGBMRegressor.html"><code class="docutils literal notranslate"><span class="pre">LGBMRegressor</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">XGBClassifier</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference external" href="https://xgboost.readthedocs.io/en/latest/python/python_api.html"><code class="docutils literal notranslate"><span class="pre">XGBRegressor</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CatBoostClassifier</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">CatBoostRegressor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VotingClassifier</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.VotingRegressor.html"><code class="docutils literal notranslate"><span class="pre">VotingRegressor</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StackingClassifier</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.StackingRegressor.html"><code class="docutils literal notranslate"><span class="pre">StackingRegressor</span></code></a></p></li>
</ul>
<p>Read documentation of each of these.</p>
<p><br><br><br><br></p>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>You have a number of models in your toolbox now.</p></li>
<li><p>Ensembles are usually pretty effective.</p>
<ul>
<li><p>Tree-based models are particularly popular and effective on a wide range of problems.</p></li>
<li><p>But they trade off code complexity and speed for prediction accuracy.</p></li>
<li><p>Don’t forget that hyperparameter optimization multiplies the slowness of the code!</p></li>
</ul>
</li>
<li><p>Stacking is a bit slower than voting, but generally higher accuracy.</p>
<ul>
<li><p>As a bonus, you get to see the coefficients for each base classifier.</p></li>
</ul>
</li>
<li><p>All the above models have equivalent regression models.</p></li>
</ul>
<section id="relevant-papers">
<h3>Relevant papers<a class="headerlink" href="#relevant-papers" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://jmlr.org/papers/volume15/delgado14a/delgado14a.pdf">Fernandez-Delgado et al. 2014</a> compared 179 classifiers on 121 datasets:</p>
<ul>
<li><p>First best class of methods was Random Forest and second best class of methods was (RBF) SVMs.</p></li>
</ul>
</li>
<li><p>If you like to read original papers <a class="reference external" href="https://www.stat.berkeley.edu/~breiman/randomforest2001.pdf">here</a> is the original paper on Random Forests by Leo Breiman.</p></li>
<li><p><a class="reference external" href="https://medium.com/riskified-technology/xgboost-lightgbm-or-catboost-which-boosting-algorithm-should-i-use-e7fda7bb36bc">XGBoost, LightGBM or CatBoost — which boosting algorithm should I use?</a></p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "cpsc330"
        },
        kernelOptions: {
            name: "cpsc330",
            path: "./lectures/_build/jupyter_execute"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'cpsc330'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-announcements-los">Imports, announcements, LOs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-learning-objectives">Lecture learning objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation-video">Motivation [video]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-11-0">iClicker Exercise 11.0</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-netflix-prize">The Netflix prize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-based-ensemble-models">Tree-based ensemble models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-based-models">Tree-based models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-we-have-class-imbalance">Do we have class imbalance?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baselines">Baselines</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dummyclassifier-baseline"><code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> baseline</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#decisiontreeclassifier-baseline"><code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> baseline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forests">Random forests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea">General idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#randomforestclassifier"><code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-they-work">How do they work?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inject-randomness-in-the-classifier-construction">Inject randomness in the classifier construction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-of-a-bootstrap-samples">An example of a bootstrap samples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-random-forests-classifier">The random forests classifier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-important-hyperparameters">Some important hyperparameters:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forests-number-of-trees-n-estimators-and-the-fundamental-tradeoff">Random forests: number of trees (<code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>) and the fundamental tradeoff</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-trees-and-fundamental-trade-off">Number of trees and fundamental trade-off</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strengths-and-weaknesses">Strengths and weaknesses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weaknesses">Weaknesses</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-11-1">iClicker Exercise 11.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosted-trees-video">Gradient boosted trees [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-prediction-in-boosted-regression-trees">(Optional) Prediction in boosted regression trees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-fitting-in-boosted-regression-trees">(Optional) Fitting in boosted regression trees.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm">LightGBM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#catboost">CatBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#important-hyperparameters">Important hyperparameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosting-in-sklearn">Gradient boosting in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#which-model-should-i-use">Which model should I use?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#averaging">Averaging</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-kind-of-estimators-can-we-combine">What kind of estimators can we combine?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">❓❓ Questions for you</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stacking">Stacking</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-effective-strategy">An effective strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-papers">Relevant papers</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>