

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 5: Preprocessing and sklearn pipelines &#8212; CPSC 330 Applied Machine Learning 2023W1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/_build/jupyter_execute/05_preprocessing-pipelines';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/UBC-CS-logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/UBC-CS-logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Things you should know</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/README.html">CPSC 330 Documents</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../01_intro.html">Lecture 1: Course Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_decision-trees.html">Lecture 2: Terminology, Baselines, Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_ml-fundamentals.html">Lecture 3: Machine Learning Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_kNNs-SVM-RBF.html">Lecture 4: <span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours and SVM RBFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_preprocessing-pipelines.html">Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_column-transformer-text-feats.html">Lecture 6: <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and Text Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_linear-models.html">Lecture 7: Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_hyperparameter-optimization.html">Lecture 8: Hyperparameter Optimization and Optimization Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_classification-metrics.html">Lecture 9: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_regression-metrics.html">Lecture 10: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11_ensembles.html">Lecture 11: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../12_feat-importances.html">Lecture 12: Feature importances and model transparency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../13_feature-engineering-selection.html">Lecture 13: Feature engineering and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../14_K-Means.html">Lecture 14: K-Means Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../15_DBSCAN-hierarchical.html">Lecture 15: More Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../16_recommender-systems.html">Lecture 16: Recommender Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../17_natural-language-processing.html">Lecture 18: Introduction to natural language processing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/03_class-demo.html">Lecture 3: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/04_class-demo.html">Lecture 4: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/05-06_class-demo.html">Lectures 5 and 6: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/07_class-demo.html">Lectures 7: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/09_class-demo.html">Exploring classification metrics</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../class_demos/14_class-demo.html">Lecture 14: Class demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_demos/15_class-demo.html">Lecture 15: Class demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../attribution.html">Attributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../LICENSE.html">LICENSE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/lectures/_build/jupyter_execute/05_preprocessing-pipelines.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 5: Preprocessing and sklearn pipelines</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan">Lecture plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-announcement-los">Imports, announcement, LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-5-1">(iClicker) Exercise 5.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation-and-big-picture-video">Motivation and big picture [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-k-nearest-neighbours-on-the-spotify-dataset">Example: <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours on the Spotify dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling-using-scikit-learn-s-standardscaler">Scaling using <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-and-transform-paradigm-for-transformers"><code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> paradigm for transformers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-api-summary-estimators"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> API summary: estimators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-api-summary-transformers"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> API summary: transformers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-preprocessing-techniques">Common preprocessing techniques</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputation-and-scaling-video">Imputation and scaling [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-splitting-and-baseline">Dataset, splitting, and baseline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#when-is-it-ok-to-do-things-before-splitting">When is it OK to do things before splitting?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-all-transformations-we-need-to-apply-on-the-dataset">What all transformations we need to apply on the dataset?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-first-run-our-baseline-model-dummyregressor">Let’s first run our baseline model <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imputation">Imputation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-the-problem">What’s the problem?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-5-2">(iClicker) Exercise 5.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-transformations-and-the-golden-rule">Feature transformations and the golden rule</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-carry-out-cross-validation">How to carry out cross-validation?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelines">Pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-and-more-compact-syntax-make-pipeline">Alternative and more compact syntax: <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-cross-validation-with-our-pipeline">Let’s try cross-validation with our pipeline</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features-video">Categorical features [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#can-we-use-this-feature-in-the-model">Can we use this feature in the model?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-options">What are the options?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-encoding-occasionally-recommended">Ordinal encoding (occasionally recommended)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one-hot-encoding-ohe">One-hot encoding (OHE)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-do-it-on-our-housing-data">Let’s do it on our housing data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-5-3">(iClicker) Exercise 5.3</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-learn-today">What did we learn today?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-different-transformations-on-different-columns">Problem: Different transformations on different columns</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="lectures/_build/jupyter_execute/img/330-banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-5-preprocessing-and-sklearn-pipelines">
<h1>Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines<a class="headerlink" href="#lecture-5-preprocessing-and-sklearn-pipelines" title="Permalink to this heading">#</a></h1>
<p>UBC 2023-24</p>
<p>Instructor: Varada Kolhatkar and Andrew Roth</p>
<section id="lecture-plan">
<h2>Lecture plan<a class="headerlink" href="#lecture-plan" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Leftover iClicker questions from Lecture 5</p></li>
<li><p>Motivation for preprocessing</p></li>
<li><p>Class demo + break</p></li>
</ul>
</section>
<section id="imports-announcement-los">
<h2>Imports, announcement, LOs<a class="headerlink" href="#imports-announcement-los" title="Permalink to this heading">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">mglearn</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Classifiers and regressors</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>

<span class="c1"># Preprocessing and pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="c1"># train test split and cross validation</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MinMaxScaler</span><span class="p">,</span>
    <span class="n">OneHotEncoder</span><span class="p">,</span>
    <span class="n">OrdinalEncoder</span><span class="p">,</span>
    <span class="n">StandardScaler</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
Intel MKL WARNING: Support of Intel(R) Streaming SIMD Extensions 4.2 (Intel(R) SSE4.2) enabled only processors has been deprecated. Intel oneAPI Math Kernel Library 2025.0 will require Intel(R) Advanced Vector Extensions (Intel(R) AVX) instructions.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">15</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="kn">import</span> <span class="nn">mglearn</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="ne">---&gt; </span><span class="mi">15</span> <span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="c1"># Classifiers and regressors</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;plotting_functions&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="announcements">
<h3>Announcements<a class="headerlink" href="#announcements" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>HW1 grades have been posted.</p></li>
<li><p>Homework 1 solutions have been posted on Canvas under Files tab. Please do not share them with anyone or do not post them anywhere.</p></li>
<li><p>No homework pull requests, please.</p></li>
</ul>
</section>
<section id="learning-outcomes">
<h3>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h3>
<p>From this lecture, you will be able to</p>
<ul class="simple">
<li><p>explain motivation for preprocessing in supervised machine learning;</p></li>
<li><p>identify when to implement feature transformations such as imputation, scaling, and one-hot encoding in a machine learning model development pipeline;</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> transformers for applying feature transformations on your dataset;</p></li>
<li><p>discuss golden rule in the context of feature transformations;</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">sklearn.pipeline.Pipeline</span></code> and <code class="docutils literal notranslate"><span class="pre">sklearn.pipeline.make_pipeline</span></code> to build a preliminary machine learning pipeline.</p></li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-5-1">
<h3>(iClicker) Exercise 5.1<a class="headerlink" href="#iclicker-exercise-5-1" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p>Take a guess: In your machine learning project, how much time will you typically spend on data preparation and transformation?</p>
<ul class="simple">
<li><p>(A) ~80% of the project time</p></li>
<li><p>(B) ~20% of the project time</p></li>
<li><p>(C) ~50% of the project time</p></li>
<li><p>(D) None. Most of the time will be spent on model building</p></li>
</ul>
<p>The question is adapted from <a class="reference external" href="https://developers.google.com/machine-learning/data-prep/process">here</a>.</p>
<p><br><br></p>
</section>
</section>
<section id="motivation-and-big-picture-video">
<h2>Motivation and big picture [<a class="reference external" href="https://youtu.be/xx9HlmzORRk">video</a>]<a class="headerlink" href="#motivation-and-big-picture-video" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>So far we have seen</p>
<ul>
<li><p>Three ML models (decision trees, <span class="math notranslate nohighlight">\(k\)</span>-NNs, SVMs with RBF kernel)</p></li>
<li><p>ML fundamentals (train-validation-test split, cross-validation, the fundamental tradeoff, the golden rule)</p></li>
</ul>
</li>
<li><p>Are we ready to do machine learning on real-world datasets?</p>
<ul>
<li><p>Very often real-world datasets need preprocessing before we use them to build ML models.</p></li>
</ul>
</li>
</ul>
<section id="example-k-nearest-neighbours-on-the-spotify-dataset">
<h3>Example: <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours on the Spotify dataset<a class="headerlink" href="#example-k-nearest-neighbours-on-the-spotify-dataset" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In lab1 you used <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> to predict whether the user would like a particular song or not.</p></li>
<li><p>Can we use <span class="math notranslate nohighlight">\(k\)</span>-NN classifier for this task?</p></li>
<li><p>Intuition: To predict whether the user likes a particular song or not (query point)</p>
<ul>
<li><p>find the songs that are closest to the query point</p></li>
<li><p>let them vote on the target</p></li>
<li><p>take the majority vote as the target for the query point</p></li>
</ul>
</li>
</ul>
<p>In order to run the code below, you need to download the dataset from <a class="reference external" href="https://www.kaggle.com/geomack/spotifyclassification/download">Kaggle</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spotify_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/spotify.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">spotify_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;song_title&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">]),</span>
    <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;song_title&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">]),</span>
    <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean validation score </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">])))</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean validation score 0.508
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.000424</td>
      <td>0.000700</td>
      <td>0.507740</td>
      <td>0.507752</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000443</td>
      <td>0.000264</td>
      <td>0.507740</td>
      <td>0.507752</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000326</td>
      <td>0.000240</td>
      <td>0.507740</td>
      <td>0.507752</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000314</td>
      <td>0.000240</td>
      <td>0.506211</td>
      <td>0.508133</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000400</td>
      <td>0.000320</td>
      <td>0.509317</td>
      <td>0.507359</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">()</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">knn</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean validation score </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">])))</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean validation score 0.546
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.004876</td>
      <td>0.009345</td>
      <td>0.563467</td>
      <td>0.717829</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.001628</td>
      <td>0.007260</td>
      <td>0.535604</td>
      <td>0.721705</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.001522</td>
      <td>0.007215</td>
      <td>0.529412</td>
      <td>0.708527</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.001367</td>
      <td>0.007131</td>
      <td>0.537267</td>
      <td>0.721921</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.001373</td>
      <td>0.006987</td>
      <td>0.562112</td>
      <td>0.711077</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_songs</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">two_songs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>duration_ms</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>key</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>mode</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>valence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>842</th>
      <td>0.229000</td>
      <td>0.494</td>
      <td>147893</td>
      <td>0.666</td>
      <td>0.000057</td>
      <td>9</td>
      <td>0.0469</td>
      <td>-9.743</td>
      <td>0</td>
      <td>0.0351</td>
      <td>140.832</td>
      <td>4.0</td>
      <td>0.704</td>
    </tr>
    <tr>
      <th>654</th>
      <td>0.000289</td>
      <td>0.771</td>
      <td>227143</td>
      <td>0.949</td>
      <td>0.602000</td>
      <td>8</td>
      <td>0.5950</td>
      <td>-4.712</td>
      <td>1</td>
      <td>0.1750</td>
      <td>111.959</td>
      <td>4.0</td>
      <td>0.372</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euclidean_distances</span><span class="p">(</span><span class="n">two_songs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[    0.        , 79250.00543825],
       [79250.00543825,     0.        ]])
</pre></div>
</div>
</div>
</div>
<p>Let’s consider only two features: <code class="docutils literal notranslate"><span class="pre">duration_ms</span></code> and <code class="docutils literal notranslate"><span class="pre">tempo</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_songs_subset</span> <span class="o">=</span> <span class="n">two_songs</span><span class="p">[[</span><span class="s2">&quot;duration_ms&quot;</span><span class="p">,</span> <span class="s2">&quot;tempo&quot;</span><span class="p">]]</span>
<span class="n">two_songs_subset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>duration_ms</th>
      <th>tempo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>842</th>
      <td>147893</td>
      <td>140.832</td>
    </tr>
    <tr>
      <th>654</th>
      <td>227143</td>
      <td>111.959</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euclidean_distances</span><span class="p">(</span><span class="n">two_songs_subset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[    0.        , 79250.00525962],
       [79250.00525962,     0.        ]])
</pre></div>
</div>
</div>
</div>
<p>Do you see any problem?</p>
<ul class="simple">
<li><p>The distance is completely dominated by the the features with larger values</p></li>
<li><p>The features with smaller values are being ignored.</p></li>
<li><p>Does it matter?</p>
<ul>
<li><p>Yes! Scale is based on how data was collected.</p></li>
<li><p>Features on a smaller scale can be highly informative and there is no good reason to ignore them.</p></li>
<li><p>We want our model to be robust and not sensitive to the scale.</p></li>
</ul>
</li>
<li><p>Was this a problem for decision trees?</p></li>
</ul>
</section>
<section id="scaling-using-scikit-learn-s-standardscaler">
<h3>Scaling using <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html"><code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code></a><a class="headerlink" href="#scaling-using-scikit-learn-s-standardscaler" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We’ll use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html"><code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code></a>, which is a <code class="docutils literal notranslate"><span class="pre">transformer</span></code>.</p></li>
<li><p>Only focus on the syntax for now. We’ll talk about scaling in a bit.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>  <span class="c1"># create feature trasformer object</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># fitting the transformer on the train split</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># transforming the train split</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>  <span class="c1"># transforming the test split</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="c1"># original X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>duration_ms</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>key</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>mode</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>valence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1505</th>
      <td>0.004770</td>
      <td>0.585</td>
      <td>214740</td>
      <td>0.614</td>
      <td>0.000155</td>
      <td>10</td>
      <td>0.0762</td>
      <td>-5.594</td>
      <td>0</td>
      <td>0.0370</td>
      <td>114.059</td>
      <td>4.0</td>
      <td>0.2730</td>
    </tr>
    <tr>
      <th>813</th>
      <td>0.114000</td>
      <td>0.665</td>
      <td>216728</td>
      <td>0.513</td>
      <td>0.303000</td>
      <td>0</td>
      <td>0.1220</td>
      <td>-7.314</td>
      <td>1</td>
      <td>0.3310</td>
      <td>100.344</td>
      <td>3.0</td>
      <td>0.0373</td>
    </tr>
    <tr>
      <th>615</th>
      <td>0.030200</td>
      <td>0.798</td>
      <td>216585</td>
      <td>0.481</td>
      <td>0.000000</td>
      <td>7</td>
      <td>0.1280</td>
      <td>-10.488</td>
      <td>1</td>
      <td>0.3140</td>
      <td>127.136</td>
      <td>4.0</td>
      <td>0.6400</td>
    </tr>
    <tr>
      <th>319</th>
      <td>0.106000</td>
      <td>0.912</td>
      <td>194040</td>
      <td>0.317</td>
      <td>0.000208</td>
      <td>6</td>
      <td>0.0723</td>
      <td>-12.719</td>
      <td>0</td>
      <td>0.0378</td>
      <td>99.346</td>
      <td>4.0</td>
      <td>0.9490</td>
    </tr>
    <tr>
      <th>320</th>
      <td>0.021100</td>
      <td>0.697</td>
      <td>236456</td>
      <td>0.905</td>
      <td>0.893000</td>
      <td>6</td>
      <td>0.1190</td>
      <td>-7.787</td>
      <td>0</td>
      <td>0.0339</td>
      <td>119.977</td>
      <td>4.0</td>
      <td>0.3110</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>0.001060</td>
      <td>0.584</td>
      <td>274404</td>
      <td>0.932</td>
      <td>0.002690</td>
      <td>1</td>
      <td>0.1290</td>
      <td>-3.501</td>
      <td>1</td>
      <td>0.3330</td>
      <td>74.976</td>
      <td>4.0</td>
      <td>0.2110</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>0.000021</td>
      <td>0.535</td>
      <td>203500</td>
      <td>0.974</td>
      <td>0.000149</td>
      <td>10</td>
      <td>0.2630</td>
      <td>-3.566</td>
      <td>0</td>
      <td>0.1720</td>
      <td>116.956</td>
      <td>4.0</td>
      <td>0.4310</td>
    </tr>
    <tr>
      <th>1406</th>
      <td>0.503000</td>
      <td>0.410</td>
      <td>256333</td>
      <td>0.648</td>
      <td>0.000000</td>
      <td>7</td>
      <td>0.2190</td>
      <td>-4.469</td>
      <td>1</td>
      <td>0.0362</td>
      <td>60.391</td>
      <td>4.0</td>
      <td>0.3420</td>
    </tr>
    <tr>
      <th>1389</th>
      <td>0.705000</td>
      <td>0.894</td>
      <td>222307</td>
      <td>0.161</td>
      <td>0.003300</td>
      <td>4</td>
      <td>0.3120</td>
      <td>-14.311</td>
      <td>1</td>
      <td>0.0880</td>
      <td>104.968</td>
      <td>4.0</td>
      <td>0.8180</td>
    </tr>
    <tr>
      <th>1534</th>
      <td>0.623000</td>
      <td>0.470</td>
      <td>394920</td>
      <td>0.156</td>
      <td>0.187000</td>
      <td>2</td>
      <td>0.1040</td>
      <td>-17.036</td>
      <td>1</td>
      <td>0.0399</td>
      <td>118.176</td>
      <td>4.0</td>
      <td>0.0591</td>
    </tr>
  </tbody>
</table>
<p>1613 rows × 13 columns</p>
</div></div></div>
</div>
<p>Let’s examine transformed value of the energy feature in the first row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.614
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]))</span><span class="o">/</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.3180174485124284
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>duration_ms</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>key</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>mode</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>valence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1505</th>
      <td>-0.698</td>
      <td>-0.195</td>
      <td>-0.399</td>
      <td>-0.318</td>
      <td>-0.492</td>
      <td>1.276</td>
      <td>-0.738</td>
      <td>0.396</td>
      <td>-1.281</td>
      <td>-0.618</td>
      <td>-0.294</td>
      <td>0.139</td>
      <td>-0.908</td>
    </tr>
    <tr>
      <th>813</th>
      <td>-0.276</td>
      <td>0.296</td>
      <td>-0.374</td>
      <td>-0.796</td>
      <td>0.598</td>
      <td>-1.487</td>
      <td>-0.439</td>
      <td>-0.052</td>
      <td>0.781</td>
      <td>2.728</td>
      <td>-0.803</td>
      <td>-3.781</td>
      <td>-1.861</td>
    </tr>
    <tr>
      <th>615</th>
      <td>-0.600</td>
      <td>1.111</td>
      <td>-0.376</td>
      <td>-0.947</td>
      <td>-0.493</td>
      <td>0.447</td>
      <td>-0.400</td>
      <td>-0.879</td>
      <td>0.781</td>
      <td>2.535</td>
      <td>0.191</td>
      <td>0.139</td>
      <td>0.576</td>
    </tr>
    <tr>
      <th>319</th>
      <td>-0.307</td>
      <td>1.809</td>
      <td>-0.654</td>
      <td>-1.722</td>
      <td>-0.492</td>
      <td>0.170</td>
      <td>-0.763</td>
      <td>-1.461</td>
      <td>-1.281</td>
      <td>-0.609</td>
      <td>-0.840</td>
      <td>0.139</td>
      <td>1.825</td>
    </tr>
    <tr>
      <th>320</th>
      <td>-0.635</td>
      <td>0.492</td>
      <td>-0.131</td>
      <td>1.057</td>
      <td>2.723</td>
      <td>0.170</td>
      <td>-0.458</td>
      <td>-0.176</td>
      <td>-1.281</td>
      <td>-0.653</td>
      <td>-0.074</td>
      <td>0.139</td>
      <td>-0.754</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="fit-and-transform-paradigm-for-transformers">
<h3><code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> paradigm for transformers<a class="headerlink" href="#fit-and-transform-paradigm-for-transformers" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> uses <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> paradigms for feature transformations.</p></li>
<li><p>We <code class="docutils literal notranslate"><span class="pre">fit</span></code> the transformer on the train split and then transform the train split as well as the test split.</p></li>
<li><p>We apply the same transformations on the test split.</p></li>
</ul>
</section>
<section id="sklearn-api-summary-estimators">
<h3><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> API summary: estimators<a class="headerlink" href="#sklearn-api-summary-estimators" title="Permalink to this heading">#</a></h3>
<p>Suppose <code class="docutils literal notranslate"><span class="pre">model</span></code> is a classification or regression model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">X_train_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="sklearn-api-summary-transformers">
<h3><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> API summary: transformers<a class="headerlink" href="#sklearn-api-summary-transformers" title="Permalink to this heading">#</a></h3>
<p>Suppose <code class="docutils literal notranslate"><span class="pre">transformer</span></code> is a transformer used to change the input representation, for example, to tackle missing values or to scales numeric features.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transformer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="p">[</span><span class="n">y_train</span><span class="p">])</span>
<span class="n">X_train_transformed</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_transformed</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>You can pass <code class="docutils literal notranslate"><span class="pre">y_train</span></code> in <code class="docutils literal notranslate"><span class="pre">fit</span></code> but it’s usually ignored. It allows you to pass it just to be consistent with usual usage of <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">fit</span></code> method.</p></li>
<li><p>You can also carry out fitting and transforming in one call using <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code>. But be mindful to use it only on the train split and <strong>not</strong> on the test split.</p></li>
</ul>
<ul class="simple">
<li><p>Do you expect <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> results to change after scaling the data?</p></li>
<li><p>Let’s check whether scaling makes any difference for <span class="math notranslate nohighlight">\(k\)</span>-NNs.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn_unscaled</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">()</span>
<span class="n">knn_unscaled</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">knn_unscaled</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">knn_unscaled</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train score: 0.726
Test score: 0.552
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn_scaled</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">()</span>
<span class="n">knn_scaled</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">knn_scaled</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">knn_scaled</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train score: 0.798
Test score: 0.686
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The scores with scaled data are better compared to the unscaled data in case of <span class="math notranslate nohighlight">\(k\)</span>-NNs.</p></li>
<li><p>I am not carrying out cross-validation here for a reason that we’ll look into soon.</p></li>
<li><p>Note that I am a bit sloppy here and using the test set several times for teaching purposes. But when you build an ML pipeline, please do assessment on the test set only once.</p></li>
</ul>
</section>
<section id="common-preprocessing-techniques">
<h3>Common preprocessing techniques<a class="headerlink" href="#common-preprocessing-techniques" title="Permalink to this heading">#</a></h3>
<p>Some commonly performed feature transformation include:</p>
<ul class="simple">
<li><p>Imputation: Tackling missing values</p></li>
<li><p>Scaling: Scaling of numeric features</p></li>
<li><p>One-hot encoding: Tackling categorical variables</p></li>
</ul>
<p>We can have one lecture on each of them! In this lesson our goal is to getting familiar with them so that we can use them to build ML pipelines.</p>
<p>In the next part of this lecture, we’ll build an ML pipeline using <a class="reference external" href="https://www.kaggle.com/harrywang/housing">California housing prices regression dataset</a>. In the process, we will talk about different feature transformations and how can we apply them so that we do not violate the golden rule.</p>
<p><br><br><br><br></p>
</section>
</section>
<section id="imputation-and-scaling-video">
<h2>Imputation and scaling [<a class="reference external" href="https://youtu.be/G2IXbVzKlt8">video</a>]<a class="headerlink" href="#imputation-and-scaling-video" title="Permalink to this heading">#</a></h2>
<section id="dataset-splitting-and-baseline">
<h3>Dataset, splitting, and baseline<a class="headerlink" href="#dataset-splitting-and-baseline" title="Permalink to this heading">#</a></h3>
<p>We’ll be working on <a class="reference external" href="https://www.kaggle.com/harrywang/housing">California housing prices regression dataset</a> to demonstrate these feature transformation techniques. The task is to predict median house values in Californian districts, given a number of features from these districts. If you are running the notebook on your own, you’ll have to download the data and put it in the data directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">housing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">housing_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>2948.0</td>
      <td>636.0</td>
      <td>2600.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>113600.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>346.0</td>
      <td>130.0</td>
      <td>51.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>137500.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>3355.0</td>
      <td>768.0</td>
      <td>1457.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>170100.0</td>
      <td>NEAR OCEAN</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>1634.0</td>
      <td>274.0</td>
      <td>899.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>129300.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>5566.0</td>
      <td>1465.0</td>
      <td>6303.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>205000.0</td>
      <td>NEAR OCEAN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Some column values are mean/median but some are not.</p>
<p>Let’s add some new features to the dataset which could help predicting the target: <code class="docutils literal notranslate"><span class="pre">median_house_value</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rooms_per_household</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rooms_per_household</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">bedrooms_per_household</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_bedrooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">bedrooms_per_household</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_bedrooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">population_per_household</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">population_per_household</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>2948.0</td>
      <td>636.0</td>
      <td>2600.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>113600.0</td>
      <td>INLAND</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>346.0</td>
      <td>130.0</td>
      <td>51.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>137500.0</td>
      <td>INLAND</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>3355.0</td>
      <td>768.0</td>
      <td>1457.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>170100.0</td>
      <td>NEAR OCEAN</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>1634.0</td>
      <td>274.0</td>
      <td>899.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>129300.0</td>
      <td>INLAND</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>5566.0</td>
      <td>1465.0</td>
      <td>6303.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>205000.0</td>
      <td>NEAR OCEAN</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bedrooms&#39;</span><span class="p">])</span>
<span class="n">test_df</span> <span class="o">=</span>  <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bedrooms&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="when-is-it-ok-to-do-things-before-splitting">
<h3>When is it OK to do things before splitting?<a class="headerlink" href="#when-is-it-ok-to-do-things-before-splitting" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Here it would have been OK to add new features before splitting because we are not using any global information in the data but only looking at one row at a time.</p></li>
<li><p>But just to be safe and to avoid accidentally breaking the golden rule, it’s better to do it after splitting.</p></li>
<li><p>Question: Should we remove <code class="docutils literal notranslate"><span class="pre">total_rooms</span></code>, <code class="docutils literal notranslate"><span class="pre">total_bedrooms</span></code>, and <code class="docutils literal notranslate"><span class="pre">population</span></code> columns?</p>
<ul>
<li><p>Probably. But I am keeping them in this lecture. You could experiment with removing them and examine whether results change.</p></li>
</ul>
</li>
</ul>
</section>
<section id="eda">
<h3>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>113600.0</td>
      <td>INLAND</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>137500.0</td>
      <td>INLAND</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>170100.0</td>
      <td>NEAR OCEAN</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>129300.0</td>
      <td>INLAND</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>205000.0</td>
      <td>NEAR OCEAN</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The feature scales are quite different.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 18576 entries, 6051 to 19966
Data columns (total 10 columns):
 #   Column                    Non-Null Count  Dtype  
---  ------                    --------------  -----  
 0   longitude                 18576 non-null  float64
 1   latitude                  18576 non-null  float64
 2   housing_median_age        18576 non-null  float64
 3   households                18576 non-null  float64
 4   median_income             18576 non-null  float64
 5   median_house_value        18576 non-null  float64
 6   ocean_proximity           18576 non-null  object 
 7   rooms_per_household       18576 non-null  float64
 8   bedrooms_per_household    18391 non-null  float64
 9   population_per_household  18576 non-null  float64
dtypes: float64(9), object(1)
memory usage: 1.6+ MB
</pre></div>
</div>
</div>
</div>
<p>We have one categorical feature and all other features are numeric features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>18576.000000</td>
      <td>18576.000000</td>
      <td>18576.000000</td>
      <td>18576.000000</td>
      <td>18576.000000</td>
      <td>18576.000000</td>
      <td>18576.000000</td>
      <td>18391.000000</td>
      <td>18576.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-119.565888</td>
      <td>35.627966</td>
      <td>28.622255</td>
      <td>500.061100</td>
      <td>3.862552</td>
      <td>206292.067991</td>
      <td>5.426067</td>
      <td>1.097516</td>
      <td>3.052349</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.999622</td>
      <td>2.134658</td>
      <td>12.588307</td>
      <td>383.044313</td>
      <td>1.892491</td>
      <td>115083.856175</td>
      <td>2.512319</td>
      <td>0.486266</td>
      <td>10.020873</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-124.350000</td>
      <td>32.540000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.499900</td>
      <td>14999.000000</td>
      <td>0.846154</td>
      <td>0.333333</td>
      <td>0.692308</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-121.790000</td>
      <td>33.930000</td>
      <td>18.000000</td>
      <td>280.000000</td>
      <td>2.560225</td>
      <td>119400.000000</td>
      <td>4.439360</td>
      <td>1.005888</td>
      <td>2.430323</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-118.490000</td>
      <td>34.250000</td>
      <td>29.000000</td>
      <td>410.000000</td>
      <td>3.527500</td>
      <td>179300.000000</td>
      <td>5.226415</td>
      <td>1.048860</td>
      <td>2.818868</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>-118.010000</td>
      <td>37.710000</td>
      <td>37.000000</td>
      <td>606.000000</td>
      <td>4.736900</td>
      <td>263600.000000</td>
      <td>6.051620</td>
      <td>1.099723</td>
      <td>3.283921</td>
    </tr>
    <tr>
      <th>max</th>
      <td>-114.310000</td>
      <td>41.950000</td>
      <td>52.000000</td>
      <td>6082.000000</td>
      <td>15.000100</td>
      <td>500001.000000</td>
      <td>141.909091</td>
      <td>34.066667</td>
      <td>1243.333333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Seems like total_bedrooms column has some missing values.</p></li>
<li><p>This must have affected our new feature <code class="docutils literal notranslate"><span class="pre">bedrooms_per_household</span></code> as well.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">housing_df</span><span class="p">[</span><span class="s2">&quot;total_bedrooms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>207
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## (optional)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/84c060fccd6da522b0fc0fd6e75f34a1b16f1ba7d6eb87fd2b2ed344ed197bb4.png" src="../../../_images/84c060fccd6da522b0fc0fd6e75f34a1b16f1ba7d6eb87fd2b2ed344ed197bb4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## (optional)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;population_per_household&quot;</span><span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;jet&quot;</span><span class="p">),</span>
    <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/b82f32925c901260e1924466240b359238140764a4a39e97d85abc7d2411fa1f.png" src="../../../_images/b82f32925c901260e1924466240b359238140764a4a39e97d85abc7d2411fa1f.png" />
</div>
</div>
</section>
<section id="what-all-transformations-we-need-to-apply-on-the-dataset">
<h3>What all transformations we need to apply on the dataset?<a class="headerlink" href="#what-all-transformations-we-need-to-apply-on-the-dataset" title="Permalink to this heading">#</a></h3>
<p>Here is what we see from the EDA.</p>
<ul class="simple">
<li><p>Some missing values in <code class="docutils literal notranslate"><span class="pre">total_bedrooms</span></code> column</p></li>
<li><p>Scales are quite different across columns.</p></li>
<li><p>Categorical variable <code class="docutils literal notranslate"><span class="pre">ocean_proximity</span></code></p></li>
</ul>
<p>Read about <a class="reference external" href="https://scikit-learn.org/stable/modules/preprocessing.html">preprocessing techniques implemented in <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We are droping the categorical variable ocean_proximity for now. We&#39;ll come back to it in a bit.</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="s2">&quot;ocean_proximity&quot;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="s2">&quot;ocean_proximity&quot;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="let-s-first-run-our-baseline-model-dummyregressor">
<h3>Let’s first run our baseline model <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code><a class="headerlink" href="#let-s-first-run-our-baseline-model-dummyregressor" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># dictionary to store our results for different models</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns mean and std of cross validation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model :</span>
<span class="sd">        scikit-learn model</span>
<span class="sd">    X_train : numpy array or pandas DataFrame</span>
<span class="sd">        X in the training data</span>
<span class="sd">    y_train :</span>
<span class="sd">        y in the training data</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">        pandas Series with mean scores from cross_validation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">mean_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">std_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">out_col</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_scores</span><span class="p">)):</span>
        <span class="n">out_col</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;%0.3f (+/- %0.3f)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean_scores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">std_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">out_col</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">mean_scores</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/b3/g26r0dcx4b35vf3nk31216hc0000gr/T/ipykernel_4440/4158382658.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  out_col.append((f&quot;%0.3f (+/- %0.3f)&quot; % (mean_scores[i], std_scores[i])))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dummy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.001 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>test_score</th>
      <td>-0.055 (+/- 0.012)</td>
    </tr>
    <tr>
      <th>train_score</th>
      <td>-0.055 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="imputation">
<h3>Imputation<a class="headerlink" href="#imputation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7763</th>
      <td>-118.10</td>
      <td>33.91</td>
      <td>36.0</td>
      <td>130.0</td>
      <td>3.6389</td>
      <td>5.584615</td>
      <td>NaN</td>
      <td>3.769231</td>
    </tr>
    <tr>
      <th>15377</th>
      <td>-117.24</td>
      <td>33.37</td>
      <td>14.0</td>
      <td>779.0</td>
      <td>4.5391</td>
      <td>6.016688</td>
      <td>1.017972</td>
      <td>3.127086</td>
    </tr>
    <tr>
      <th>17730</th>
      <td>-121.76</td>
      <td>37.33</td>
      <td>5.0</td>
      <td>697.0</td>
      <td>5.6306</td>
      <td>5.958393</td>
      <td>1.031564</td>
      <td>3.493544</td>
    </tr>
    <tr>
      <th>15725</th>
      <td>-122.44</td>
      <td>37.78</td>
      <td>44.0</td>
      <td>326.0</td>
      <td>3.8750</td>
      <td>4.739264</td>
      <td>1.024540</td>
      <td>1.720859</td>
    </tr>
    <tr>
      <th>19966</th>
      <td>-119.08</td>
      <td>36.21</td>
      <td>20.0</td>
      <td>348.0</td>
      <td>2.5156</td>
      <td>5.491379</td>
      <td>1.117816</td>
      <td>3.566092</td>
    </tr>
  </tbody>
</table>
<p>18576 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">()</span>
<span class="c1"># knn.fit(X_train, y_train)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="what-s-the-problem">
<h3>What’s the problem?<a class="headerlink" href="#what-s-the-problem" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">ValueError</span><span class="p">:</span> <span class="n">Input</span> <span class="n">contains</span> <span class="n">NaN</span><span class="p">,</span> <span class="n">infinity</span> <span class="ow">or</span> <span class="n">a</span> <span class="n">value</span> <span class="n">too</span> <span class="n">large</span> <span class="k">for</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The classifier is not able to deal with missing values (NaNs).</p></li>
<li><p>What are possible ways to deal with the problem?</p>
<ul>
<li><p>Delete the rows?</p></li>
<li><p>Replace them with some reasonable values?</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> is a transformer in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> to deal with this problem. For example,</p>
<ul>
<li><p>You can impute missing values in categorical columns with the most frequent value.</p></li>
<li><p>You can impute the missing values in numeric columns with the mean or median of the column.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;bedrooms_per_household&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20248</th>
      <td>-119.23</td>
      <td>34.25</td>
      <td>28.0</td>
      <td>9.0</td>
      <td>8.0000</td>
      <td>2.888889</td>
      <td>0.333333</td>
      <td>3.222222</td>
    </tr>
    <tr>
      <th>12649</th>
      <td>-121.47</td>
      <td>38.51</td>
      <td>52.0</td>
      <td>9.0</td>
      <td>3.6250</td>
      <td>2.222222</td>
      <td>0.444444</td>
      <td>8.222222</td>
    </tr>
    <tr>
      <th>3125</th>
      <td>-117.76</td>
      <td>35.22</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.6250</td>
      <td>3.000000</td>
      <td>0.500000</td>
      <td>1.333333</td>
    </tr>
    <tr>
      <th>12138</th>
      <td>-117.22</td>
      <td>33.87</td>
      <td>16.0</td>
      <td>14.0</td>
      <td>2.6250</td>
      <td>4.000000</td>
      <td>0.500000</td>
      <td>2.785714</td>
    </tr>
    <tr>
      <th>8219</th>
      <td>-118.21</td>
      <td>33.79</td>
      <td>33.0</td>
      <td>36.0</td>
      <td>4.5938</td>
      <td>0.888889</td>
      <td>0.500000</td>
      <td>2.666667</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4591</th>
      <td>-118.28</td>
      <td>34.06</td>
      <td>42.0</td>
      <td>1179.0</td>
      <td>1.2254</td>
      <td>2.096692</td>
      <td>NaN</td>
      <td>3.218830</td>
    </tr>
    <tr>
      <th>19485</th>
      <td>-120.98</td>
      <td>37.66</td>
      <td>10.0</td>
      <td>255.0</td>
      <td>0.9336</td>
      <td>3.662745</td>
      <td>NaN</td>
      <td>1.572549</td>
    </tr>
    <tr>
      <th>6962</th>
      <td>-118.05</td>
      <td>33.99</td>
      <td>38.0</td>
      <td>357.0</td>
      <td>3.7328</td>
      <td>4.535014</td>
      <td>NaN</td>
      <td>2.481793</td>
    </tr>
    <tr>
      <th>14970</th>
      <td>-117.01</td>
      <td>32.74</td>
      <td>31.0</td>
      <td>677.0</td>
      <td>2.6973</td>
      <td>5.129985</td>
      <td>NaN</td>
      <td>3.098966</td>
    </tr>
    <tr>
      <th>7763</th>
      <td>-118.10</td>
      <td>33.91</td>
      <td>36.0</td>
      <td>130.0</td>
      <td>3.6389</td>
      <td>5.584615</td>
      <td>NaN</td>
      <td>3.769231</td>
    </tr>
  </tbody>
</table>
<p>18576 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2064, 8)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s check whether the NaN values have been replaced or not</p></li>
<li><p>Note that <code class="docutils literal notranslate"><span class="pre">imputer.transform</span></code> returns an <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array and not a dataframe</p></li>
</ul>
</section>
<section id="scaling">
<h3>Scaling<a class="headerlink" href="#scaling" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>This problem affects a large number of ML methods.</p></li>
<li><p>A number of approaches to this problem. We are going to look into two most popular ones.</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Approach</p></th>
<th class="head"><p>What it does</p></th>
<th class="head"><p>How to update <span class="math notranslate nohighlight">\(X\)</span> (but see below!)</p></th>
<th class="head"><p>sklearn implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>standardization</p></td>
<td><p>sets sample mean to <span class="math notranslate nohighlight">\(0\)</span>, s.d. to <span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">-=</span> <span class="pre">np.mean(X,axis=0)</span></code><br><code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">/=</span>&#160; <span class="pre">np.std(X,axis=0)</span></code></p></td>
<td><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html#sklearn.preprocessing.StandardScaler"><code class="docutils literal notranslate"><span class="pre">StandardScaler()</span></code></a></p></td>
</tr>
</tbody>
</table>
<p>There are all sorts of articles on this; see, e.g. <a class="reference external" href="http://www.dataminingblog.com/standardization-vs-normalization/">here</a> and <a class="reference external" href="https://medium.com/&#64;rrfd/standardize-or-normalize-examples-in-python-e3f174b65dfc">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># [source](https://amueller.github.io/COMS4995-s19/slides/aml-05-preprocessing/#8)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_scaling</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9e06378f07ca6dadf874a7a73566b66ff0508420a66ccf4a27e411be37077f38.png" src="../../../_images/9e06378f07ca6dadf874a7a73566b66ff0508420a66ccf4a27e411be37077f38.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">StandardScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_imp</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_imp</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.908140</td>
      <td>-0.743917</td>
      <td>-0.526078</td>
      <td>0.266135</td>
      <td>-0.389736</td>
      <td>-0.210591</td>
      <td>-0.083813</td>
      <td>0.126398</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.002057</td>
      <td>1.083123</td>
      <td>-0.923283</td>
      <td>-1.253312</td>
      <td>-0.198924</td>
      <td>4.726412</td>
      <td>11.166631</td>
      <td>-0.050132</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.218207</td>
      <td>-1.352930</td>
      <td>1.380504</td>
      <td>0.542873</td>
      <td>-0.635239</td>
      <td>-0.273606</td>
      <td>-0.025391</td>
      <td>-0.099240</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.128188</td>
      <td>-0.753286</td>
      <td>-0.843842</td>
      <td>-0.561467</td>
      <td>0.714077</td>
      <td>0.122307</td>
      <td>-0.280310</td>
      <td>0.010183</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.168196</td>
      <td>-1.287344</td>
      <td>-0.843842</td>
      <td>2.500924</td>
      <td>-1.059242</td>
      <td>-0.640266</td>
      <td>-0.190617</td>
      <td>0.126808</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>18571</th>
      <td>0.733102</td>
      <td>-0.804818</td>
      <td>0.586095</td>
      <td>-0.966131</td>
      <td>-0.118182</td>
      <td>0.063110</td>
      <td>-0.099558</td>
      <td>0.071541</td>
    </tr>
    <tr>
      <th>18572</th>
      <td>1.163195</td>
      <td>-1.057793</td>
      <td>-1.161606</td>
      <td>0.728235</td>
      <td>0.357500</td>
      <td>0.235096</td>
      <td>-0.163397</td>
      <td>0.007458</td>
    </tr>
    <tr>
      <th>18573</th>
      <td>-1.097293</td>
      <td>0.797355</td>
      <td>-1.876574</td>
      <td>0.514155</td>
      <td>0.934269</td>
      <td>0.211892</td>
      <td>-0.135305</td>
      <td>0.044029</td>
    </tr>
    <tr>
      <th>18574</th>
      <td>-1.437367</td>
      <td>1.008167</td>
      <td>1.221622</td>
      <td>-0.454427</td>
      <td>0.006578</td>
      <td>-0.273382</td>
      <td>-0.149822</td>
      <td>-0.132875</td>
    </tr>
    <tr>
      <th>18575</th>
      <td>0.242996</td>
      <td>0.272667</td>
      <td>-0.684960</td>
      <td>-0.396991</td>
      <td>-0.711754</td>
      <td>0.025998</td>
      <td>0.042957</td>
      <td>0.051269</td>
    </tr>
  </tbody>
</table>
<p>18576 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">()</span>
<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7978563117812038
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Big difference in the KNN training performance after scaling the data.</p></li>
<li><p>But we saw last week that training score doesn’t tell us much. We should look at the cross-validation score.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="id1">
<h2>❓❓ Questions for you<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-5-2">
<h3>(iClicker) Exercise 5.2<a class="headerlink" href="#iclicker-exercise-5-2" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p><strong>Select all of the following statements which are TRUE.</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> ensures a fixed range (i.e., minimum and maximum values) for the features.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> calculates mean and standard deviation for each feature separately.</p></li>
<li><p>In general, it’s a good idea to apply scaling on numeric features before training <span class="math notranslate nohighlight">\(k\)</span>-NN or SVM RBF models.</p></li>
<li><p>The transformed feature values might be hard to interpret for humans.</p></li>
<li><p>After applying <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> The transformed data has a different shape than the original data.</p></li>
</ol>
<p><br><br><br><br></p>
<p><br><br></p>
</section>
</section>
<section id="break-5-min">
<h2>Break (5 min)<a class="headerlink" href="#break-5-min" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="lectures/_build/jupyter_execute/img/eva-coffee.png" /></p>
<p><br><br><br><br></p>
</section>
<section id="feature-transformations-and-the-golden-rule">
<h2>Feature transformations and the golden rule<a class="headerlink" href="#feature-transformations-and-the-golden-rule" title="Permalink to this heading">#</a></h2>
<section id="how-to-carry-out-cross-validation">
<h3>How to carry out cross-validation?<a class="headerlink" href="#how-to-carry-out-cross-validation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Last week we saw that cross validation is a better way to get a realistic assessment of the model.</p></li>
<li><p>Let’s try cross-validation with transformed data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">()</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_imp</span><span class="p">)</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_imp</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_imp</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">knn</span><span class="p">,</span> <span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.008132</td>
      <td>0.152928</td>
      <td>0.696373</td>
      <td>0.794236</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.007522</td>
      <td>0.127681</td>
      <td>0.684447</td>
      <td>0.791467</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.007437</td>
      <td>0.138511</td>
      <td>0.695532</td>
      <td>0.789436</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.007342</td>
      <td>0.140131</td>
      <td>0.679478</td>
      <td>0.793243</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.007334</td>
      <td>0.085792</td>
      <td>0.680657</td>
      <td>0.794820</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Do you see any problem here?</p></li>
<li><p>Are we applying <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> on train portion and <code class="docutils literal notranslate"><span class="pre">transform</span></code> on validation portion in each fold?</p>
<ul>
<li><p>Here you might be allowing information from the validation set to <strong>leak</strong> into the training step.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>You need to apply the <strong>SAME</strong> preprocessing steps to train/validation.</p></li>
<li><p>With many different transformations and cross validation the code gets unwieldy very quickly.</p></li>
<li><p>Likely to make mistakes and “leak” information.</p></li>
</ul>
<ul class="simple">
<li><p>In these examples our test accuracies look fine, but our methodology is flawed.</p></li>
<li><p>Implications can be significant in practice!</p></li>
</ul>
</section>
<section id="pipelines">
<h3>Pipelines<a class="headerlink" href="#pipelines" title="Permalink to this heading">#</a></h3>
<p>Can we do this in a more elegant and organized way?</p>
<ul class="simple">
<li><p>YES!! Using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html"><code class="docutils literal notranslate"><span class="pre">scikit-learn</span> <span class="pre">Pipeline</span></code></a>.</p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html"><code class="docutils literal notranslate"><span class="pre">scikit-learn</span> <span class="pre">Pipeline</span></code></a> allows you to define a “pipeline” of transformers with a final estimator.</p></li>
</ul>
<p>Let’s combine the preprocessing and model with pipeline</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Simple example of a pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="p">(</span><span class="s2">&quot;regressor&quot;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">()),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Syntax: pass in a list of steps.</p></li>
<li><p>The last step should be a <strong>model/classifier/regressor</strong>.</p></li>
<li><p>All the earlier steps should be <strong>transformers</strong>.</p></li>
</ul>
</section>
<section id="alternative-and-more-compact-syntax-make-pipeline">
<h3>Alternative and more compact syntax: <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code><a class="headerlink" href="#alternative-and-more-compact-syntax-make-pipeline" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Shorthand for <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> constructor</p></li>
<li><p>Does not permit naming steps</p></li>
<li><p>Instead the names of steps are set to lowercase of their types automatically; <code class="docutils literal notranslate"><span class="pre">StandardScaler()</span></code> would be named as <code class="docutils literal notranslate"><span class="pre">standardscaler</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">KNeighborsRegressor</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;simpleimputer&#x27;, SimpleImputer(strategy=&#x27;median&#x27;)),
                (&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;simpleimputer&#x27;, SimpleImputer(strategy=&#x27;median&#x27;)),
                (&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div></div></div></div></div>
</div>
<ul class="simple">
<li><p>Note that we are passing <code class="docutils literal notranslate"><span class="pre">X_train</span></code> and <strong>not</strong> the imputed or scaled data here.</p></li>
</ul>
<p>When you call <code class="docutils literal notranslate"><span class="pre">fit</span></code> on the pipeline, it carries out the following steps:</p>
<ul class="simple">
<li><p>Fit <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> on <code class="docutils literal notranslate"><span class="pre">X_train</span></code></p></li>
<li><p>Transform <code class="docutils literal notranslate"><span class="pre">X_train</span></code> using the fit <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> to create <code class="docutils literal notranslate"><span class="pre">X_train_imp</span></code></p></li>
<li><p>Fit <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> on <code class="docutils literal notranslate"><span class="pre">X_train_imp</span></code></p></li>
<li><p>Transform <code class="docutils literal notranslate"><span class="pre">X_train_imp</span></code> using the fit <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> to create <code class="docutils literal notranslate"><span class="pre">X_train_imp_scaled</span></code></p></li>
<li><p>Fit the model (<code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code> in our case) on <code class="docutils literal notranslate"><span class="pre">X_train_imp_scaled</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([126500., 117380., 187700., ..., 259500., 308120.,  60860.])
</pre></div>
</div>
</div>
</div>
<p>Note that we are passing original data to <code class="docutils literal notranslate"><span class="pre">predict</span></code> as well. This time the pipeline is carrying out following steps:</p>
<ul class="simple">
<li><p>Transform <code class="docutils literal notranslate"><span class="pre">X_train</span></code> using the fit <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> to create <code class="docutils literal notranslate"><span class="pre">X_train_imp</span></code></p></li>
<li><p>Transform <code class="docutils literal notranslate"><span class="pre">X_train_imp</span></code> using the fit <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> to create <code class="docutils literal notranslate"><span class="pre">X_train_imp_scaled</span></code></p></li>
<li><p>Predict using the fit model (<code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code> in our case) on <code class="docutils literal notranslate"><span class="pre">X_train_imp_scaled</span></code>.</p></li>
</ul>
<p><img alt="" src="lectures/_build/jupyter_execute/img/pipeline.png" /></p>
<!-- <img src='./img/pipeline.png' width="800"> -->
<p><a class="reference external" href="https://amueller.github.io/COMS4995-s20/slides/aml-04-preprocessing/#18">Source</a></p>
</section>
<section id="let-s-try-cross-validation-with-our-pipeline">
<h3>Let’s try cross-validation with our pipeline<a class="headerlink" href="#let-s-try-cross-validation-with-our-pipeline" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;imp + scaling + knn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/b3/g26r0dcx4b35vf3nk31216hc0000gr/T/ipykernel_4440/4158382658.py:26: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  out_col.append((f&quot;%0.3f (+/- %0.3f)&quot; % (mean_scores[i], std_scores[i])))
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.055 (+/- 0.012)</td>
      <td>-0.055 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>imp + scaling + knn</th>
      <td>0.017 (+/- 0.001)</td>
      <td>0.135 (+/- 0.013)</td>
      <td>0.693 (+/- 0.014)</td>
      <td>0.797 (+/- 0.015)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Using a <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> takes care of applying the <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> on the train portion and only <code class="docutils literal notranslate"><span class="pre">transform</span></code> on the validation portion in each fold.</p>
<p><br><br><br><br></p>
</section>
</section>
<section id="categorical-features-video">
<h2>Categorical features [<a class="reference external" href="https://youtu.be/2mJ9rAhMMl0">video</a>]<a class="headerlink" href="#categorical-features-video" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Recall that we had dropped the categorical feature <code class="docutils literal notranslate"><span class="pre">ocean_proximity</span></code> feature from the dataframe. But it could potentially be a useful feature in this task.</p></li>
<li><p>Let’s create our <code class="docutils literal notranslate"><span class="pre">X_train</span></code> and and <code class="docutils literal notranslate"><span class="pre">X_test</span></code> again by keeping the feature in the data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7763</th>
      <td>-118.10</td>
      <td>33.91</td>
      <td>36.0</td>
      <td>130.0</td>
      <td>3.6389</td>
      <td>5.584615</td>
      <td>NaN</td>
      <td>3.769231</td>
    </tr>
    <tr>
      <th>15377</th>
      <td>-117.24</td>
      <td>33.37</td>
      <td>14.0</td>
      <td>779.0</td>
      <td>4.5391</td>
      <td>6.016688</td>
      <td>1.017972</td>
      <td>3.127086</td>
    </tr>
    <tr>
      <th>17730</th>
      <td>-121.76</td>
      <td>37.33</td>
      <td>5.0</td>
      <td>697.0</td>
      <td>5.6306</td>
      <td>5.958393</td>
      <td>1.031564</td>
      <td>3.493544</td>
    </tr>
    <tr>
      <th>15725</th>
      <td>-122.44</td>
      <td>37.78</td>
      <td>44.0</td>
      <td>326.0</td>
      <td>3.8750</td>
      <td>4.739264</td>
      <td>1.024540</td>
      <td>1.720859</td>
    </tr>
    <tr>
      <th>19966</th>
      <td>-119.08</td>
      <td>36.21</td>
      <td>20.0</td>
      <td>348.0</td>
      <td>2.5156</td>
      <td>5.491379</td>
      <td>1.117816</td>
      <td>3.566092</td>
    </tr>
  </tbody>
</table>
<p>18576 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s try to build a <code class="docutils literal notranslate"><span class="pre">KNeighborRegressor</span></code> on this data using our pipeline</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#pipe.fit(X_train, X_train)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This failed because we have non-numeric data.</p></li>
<li><p>Imagine how <span class="math notranslate nohighlight">\(k\)</span>-NN would calculate distances when you have non-numeric features.</p></li>
</ul>
<section id="can-we-use-this-feature-in-the-model">
<h3>Can we use this feature in the model?<a class="headerlink" href="#can-we-use-this-feature-in-the-model" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>, most algorithms require numeric inputs.</p></li>
<li><p>Decision trees could theoretically work with categorical features.</p>
<ul>
<li><p>However, the sklearn implementation does not support this.</p></li>
</ul>
</li>
</ul>
</section>
<section id="what-are-the-options">
<h3>What are the options?<a class="headerlink" href="#what-are-the-options" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Drop the column (not recommended)</p>
<ul>
<li><p>If you know that the column is not relevant to the target in any way you may drop it.</p></li>
</ul>
</li>
<li><p>We can transform categorical features to numeric ones so that we can use them in the model.</p>
<ul>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OrdinalEncoder.html">Ordinal encoding</a> (occasionally recommended)</p></li>
<li><p>One-hot encoding (recommended in most cases) (this lecture)</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_toy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;English&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Vietnamese&quot;</span><span class="p">,</span>
            <span class="s2">&quot;English&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mandarin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;English&quot;</span><span class="p">,</span>
            <span class="s2">&quot;English&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mandarin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;English&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Vietnamese&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mandarin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;French&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Spanish&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mandarin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Hindi&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">X_toy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>English</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Vietnamese</td>
    </tr>
    <tr>
      <th>2</th>
      <td>English</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>4</th>
      <td>English</td>
    </tr>
    <tr>
      <th>5</th>
      <td>English</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>7</th>
      <td>English</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Vietnamese</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>10</th>
      <td>French</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Spanish</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Hindi</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="ordinal-encoding-occasionally-recommended">
<h3>Ordinal encoding (occasionally recommended)<a class="headerlink" href="#ordinal-encoding-occasionally-recommended" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Here we simply assign an integer to each of our unique categorical labels.</p></li>
<li><p>We can use sklearn’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OrdinalEncoder.html"><code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code></a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="n">enc</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">()</span>
<span class="n">enc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">X_toy_ord</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_toy_ord</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;language_enc&quot;</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_toy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language</th>
      <th>language_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>English</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Vietnamese</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>English</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mandarin</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>English</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>English</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Mandarin</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>English</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Vietnamese</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Mandarin</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>French</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Spanish</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Mandarin</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Hindi</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What’s the problem with this approach?</p>
<ul class="simple">
<li><p>We have imposed ordinality on the categorical data.</p></li>
<li><p>For example, imagine when you are calculating distances. Is it fair to say that French and Hindi are closer than French and Spanish?</p></li>
<li><p>In general, label encoding is useful if there is ordinality in your data and capturing it is important for your problem, e.g., <code class="docutils literal notranslate"><span class="pre">[cold,</span> <span class="pre">warm,</span> <span class="pre">hot]</span></code>.</p></li>
</ul>
<section id="one-hot-encoding-ohe">
<h4>One-hot encoding (OHE)<a class="headerlink" href="#one-hot-encoding-ohe" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Create new binary columns to represent our categories.</p></li>
<li><p>If we have <span class="math notranslate nohighlight">\(c\)</span> categories in our column.</p>
<ul>
<li><p>We create <span class="math notranslate nohighlight">\(c\)</span> new binary columns to represent those categories.</p></li>
</ul>
</li>
<li><p>Example: Imagine a language column which has the information on whether you</p></li>
<li><p>We can use sklearn’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html"><code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code></a> to do so.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One-hot encoding is called one-hot because only one of the newly created features is 1 for each data point.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">enc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">X_toy_ohe</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_toy_ohe</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">enc</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">([</span><span class="s2">&quot;language&quot;</span><span class="p">]),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_toy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language_English</th>
      <th>language_French</th>
      <th>language_Hindi</th>
      <th>language_Mandarin</th>
      <th>language_Spanish</th>
      <th>language_Vietnamese</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="let-s-do-it-on-our-housing-data">
<h3>Let’s do it on our housing data<a class="headerlink" href="#let-s-do-it-on-our-housing-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
<span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]])</span>
<span class="n">X_imp_ohe_train</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can look at the new features created using <code class="docutils literal notranslate"><span class="pre">categories_</span></code> attribute</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span><span class="o">.</span><span class="n">categories_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([&#39;&lt;1H OCEAN&#39;, &#39;INLAND&#39;, &#39;ISLAND&#39;, &#39;NEAR BAY&#39;, &#39;NEAR OCEAN&#39;],
       dtype=object)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_ohe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_imp_ohe_train</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">ohe</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">([</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">transformed_ohe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ocean_proximity_&lt;1H OCEAN</th>
      <th>ocean_proximity_INLAND</th>
      <th>ocean_proximity_ISLAND</th>
      <th>ocean_proximity_NEAR BAY</th>
      <th>ocean_proximity_NEAR OCEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7763</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15377</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>17730</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15725</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>19966</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>18576 rows × 5 columns</p>
</div></div></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>One-hot encoded variables are also referred to as <strong>dummy variables</strong>.
You will often see people using <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.get_dummies.html"><code class="docutils literal notranslate"><span class="pre">get_dummies</span></code> method of pandas</a> to convert categorical variables into dummy variables. That said, using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> has the advantage of making it easy to treat training and test set in a consistent way.</p>
</div>
</section>
</section>
<section id="id2">
<h2>❓❓ Questions for you<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-5-3">
<h3>(iClicker) Exercise 5.3<a class="headerlink" href="#iclicker-exercise-5-3" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/SNBF</strong></p>
<p><strong>Select all of the following statements which are TRUE.</strong></p>
<ol class="arabic simple">
<li><p>You can have scaling of numeric features, one-hot encoding of categorical features, and <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> estimator within a single pipeline.</p></li>
<li><p>Once you have a <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> pipeline object with an estimator as the last step, you can call <code class="docutils literal notranslate"><span class="pre">fit</span></code>, <code class="docutils literal notranslate"><span class="pre">predict</span></code>, and <code class="docutils literal notranslate"><span class="pre">score</span></code> on it.</p></li>
<li><p>You can carry out data splitting within <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> pipeline.</p></li>
<li><p>We have to be careful of the order we put each transformation and model in a pipeline.</p></li>
<li><p>If you call <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code> with a pipeline object, it will call <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> on the training fold and only <code class="docutils literal notranslate"><span class="pre">transform</span></code> on the validation fold.</p></li>
</ol>
</section>
</section>
<section id="what-did-we-learn-today">
<h2>What did we learn today?<a class="headerlink" href="#what-did-we-learn-today" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Motivation for preprocessing</p></li>
<li><p>Common preprocessing steps</p>
<ul>
<li><p>Imputation</p></li>
<li><p>Scaling</p></li>
<li><p>One-hot encoding</p></li>
</ul>
</li>
<li><p>Golden rule in the context of preprocessing</p></li>
<li><p>Building simple supervised machine learning pipelines using <code class="docutils literal notranslate"><span class="pre">sklearn.pipeline.make_pipeline</span></code>.</p></li>
</ul>
<section id="problem-different-transformations-on-different-columns">
<h3>Problem: Different transformations on different columns<a class="headerlink" href="#problem-different-transformations-on-different-columns" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>How do we put this together with other columns in the data before fitting the regressor?</p></li>
<li><p>Before we fit our regressor, we want to apply different transformations on different columns</p>
<ul>
<li><p>Numeric columns</p>
<ul>
<li><p>imputation</p></li>
<li><p>scaling</p></li>
</ul>
</li>
<li><p>Categorical columns</p>
<ul>
<li><p>imputation</p></li>
<li><p>one-hot encoding</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Coming up: sklearn’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html"><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code></a>!!</strong></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "cpsc330"
        },
        kernelOptions: {
            name: "cpsc330",
            path: "./lectures/_build/jupyter_execute"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'cpsc330'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan">Lecture plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-announcement-los">Imports, announcement, LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-5-1">(iClicker) Exercise 5.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation-and-big-picture-video">Motivation and big picture [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-k-nearest-neighbours-on-the-spotify-dataset">Example: <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours on the Spotify dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling-using-scikit-learn-s-standardscaler">Scaling using <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-and-transform-paradigm-for-transformers"><code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> paradigm for transformers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-api-summary-estimators"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> API summary: estimators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-api-summary-transformers"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> API summary: transformers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-preprocessing-techniques">Common preprocessing techniques</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputation-and-scaling-video">Imputation and scaling [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-splitting-and-baseline">Dataset, splitting, and baseline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#when-is-it-ok-to-do-things-before-splitting">When is it OK to do things before splitting?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-all-transformations-we-need-to-apply-on-the-dataset">What all transformations we need to apply on the dataset?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-first-run-our-baseline-model-dummyregressor">Let’s first run our baseline model <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imputation">Imputation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-the-problem">What’s the problem?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-5-2">(iClicker) Exercise 5.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-transformations-and-the-golden-rule">Feature transformations and the golden rule</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-carry-out-cross-validation">How to carry out cross-validation?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelines">Pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-and-more-compact-syntax-make-pipeline">Alternative and more compact syntax: <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-cross-validation-with-our-pipeline">Let’s try cross-validation with our pipeline</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features-video">Categorical features [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#can-we-use-this-feature-in-the-model">Can we use this feature in the model?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-options">What are the options?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-encoding-occasionally-recommended">Ordinal encoding (occasionally recommended)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one-hot-encoding-ohe">One-hot encoding (OHE)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-do-it-on-our-housing-data">Let’s do it on our housing data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-5-3">(iClicker) Exercise 5.3</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-learn-today">What did we learn today?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-different-transformations-on-different-columns">Problem: Different transformations on different columns</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>